{"version":3,"sources":["webpack://cui-light-app/webpack/universalModuleDefinition","webpack://cui-light-app/webpack/bootstrap","webpack://cui-light-app/./src/core/models/errors.ts","webpack://cui-light-app/./src/core/utils/statics.ts","webpack://cui-light-app/./src/core/utils/functions.ts","webpack://cui-light-app/./src/core/models/setup.ts","webpack://cui-light-app/./src/core/development/console.ts","webpack://cui-light-app/./src/core/development/factory.ts","webpack://cui-light-app/./src/core/api/functions.ts","webpack://cui-light-app/./src/core/observers/mutations.ts","webpack://cui-light-app/./src/core/utils/interactions.ts","webpack://cui-light-app/./src/core/queue/queue.ts","webpack://cui-light-app/./src/core/bus/handlers.ts","webpack://cui-light-app/./src/core/bus/executors.ts","webpack://cui-light-app/./src/core/bus/bus.ts","webpack://cui-light-app/./src/core/styles/appender.ts","webpack://cui-light-app/./src/core/models/utils.ts","webpack://cui-light-app/./src/core/factories/interactions.ts","webpack://cui-light-app/./src/core/helpers/helpers.ts","webpack://cui-light-app/./src/core/utils/actions.ts","webpack://cui-light-app/./src/app/managers/element.ts","webpack://cui-light-app/./src/app/managers/plugins.ts","webpack://cui-light-app/./src/core/api/handler.ts","webpack://cui-light-app/./src/app/instance.ts","webpack://cui-light-app/./src/core/animation/definitions.ts","webpack://cui-light-app/./src/app/initializer.ts","webpack://cui-light-app/./src/core/builders/element.ts","webpack://cui-light-app/./src/plugins/alert/builder.ts","webpack://cui-light-app/./src/plugins/alert/handler.ts","webpack://cui-light-app/./src/plugins/alert/alert.ts","webpack://cui-light-app/./src/plugins/click/click.ts","webpack://cui-light-app/./src/plugins/focus/focus.ts","webpack://cui-light-app/./src/plugins/keys/listener.ts","webpack://cui-light-app/./src/plugins/keys/observer.ts","webpack://cui-light-app/./src/plugins/keys/keys.ts","webpack://cui-light-app/./src/core/listeners/media.ts","webpack://cui-light-app/./src/plugins/light/light.ts","webpack://cui-light-app/./src/core/listeners/move.ts","webpack://cui-light-app/./src/plugins/move/observer.ts","webpack://cui-light-app/./src/plugins/move/move.ts","webpack://cui-light-app/./src/core/builders/icon.ts","webpack://cui-light-app/./src/plugins/notification/builder.ts","webpack://cui-light-app/./src/plugins/notification/notification.ts","webpack://cui-light-app/./src/plugins/notification/helpers.ts","webpack://cui-light-app/./src/plugins/print/print.ts","webpack://cui-light-app/./src/plugins/resize/observer.ts","webpack://cui-light-app/./src/plugins/resize/resize.ts","webpack://cui-light-app/./src/plugins/toast/handler.ts","webpack://cui-light-app/./src/plugins/toast/toast.ts","webpack://cui-light-app/./src/core/utils/aria.ts","webpack://cui-light-app/./src/core/utils/dictionary.ts","webpack://cui-light-app/./src/core/handlers/modules/handler.ts","webpack://cui-light-app/./src/core/handlers/base.ts","webpack://cui-light-app/./src/core/utils/arguments.ts","webpack://cui-light-app/./src/components/modules/click/click.ts","webpack://cui-light-app/./src/components/accordion/accordion.ts","webpack://cui-light-app/./src/core/animation/animators.ts","webpack://cui-light-app/./src/core/animation/engine.ts","webpack://cui-light-app/./src/components/banner/banner.ts","webpack://cui-light-app/./src/components/circle/circle.ts","webpack://cui-light-app/./src/components/close/close.ts","webpack://cui-light-app/./src/components/cover/cover.ts","webpack://cui-light-app/./src/components/dialog/dialog.ts","webpack://cui-light-app/./src/core/listeners/hover.ts","webpack://cui-light-app/./src/core/position/evaluator.ts","webpack://cui-light-app/./src/core/position/calculator.ts","webpack://cui-light-app/./src/core/utils/task.ts","webpack://cui-light-app/./src/components/modules/hover/hover.ts","webpack://cui-light-app/./src/components/drop/drop.ts","webpack://cui-light-app/./src/components/float/helpers.ts","webpack://cui-light-app/./src/components/float/float.ts","webpack://cui-light-app/./src/components/icon/icon.ts","webpack://cui-light-app/./src/components/offcanvas/offcanvas.ts","webpack://cui-light-app/./src/core/models/elements.ts","webpack://cui-light-app/./src/core/listeners/scroll.ts","webpack://cui-light-app/./src/components/offset/modes.ts","webpack://cui-light-app/./src/components/offset/offset.ts","webpack://cui-light-app/./src/components/open/open.ts","webpack://cui-light-app/./src/core/intersection/intersection.ts","webpack://cui-light-app/./src/components/parallax/animator.ts","webpack://cui-light-app/./src/components/parallax/parallax.ts","webpack://cui-light-app/./src/core/observers/intersection.ts","webpack://cui-light-app/./src/components/resize/resize.ts","webpack://cui-light-app/./src/components/scroll/scroll.ts","webpack://cui-light-app/./src/components/scrollspy/mode.ts","webpack://cui-light-app/./src/components/scrollspy/scrollspy.ts","webpack://cui-light-app/./src/core/handlers/drag/detectors.ts","webpack://cui-light-app/./src/core/handlers/drag/drag.ts","webpack://cui-light-app/./src/components/sortable/sortable.ts","webpack://cui-light-app/./src/components/spinner/spinner.ts","webpack://cui-light-app/./src/components/switch/slider.ts","webpack://cui-light-app/./src/components/switch/switch.ts","webpack://cui-light-app/./src/components/switch/switcher.ts","webpack://cui-light-app/./src/components/toggle/toggle.ts","webpack://cui-light-app/./src/components/tooltip/tooltip.ts","webpack://cui-light-app/./src/index.ts","webpack://cui-light-app/./src/app/init.ts","webpack://cui-light-app/./src/plugins/module.ts","webpack://cui-light-app/./src/components/module.ts"],"names":["root","factory","exports","module","define","amd","window","installedModules","__webpack_require__","moduleId","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","ErrorBase","Error","message","super","setPrototypeOf","this","ItemNotFoundError","ArgumentError","CuiInstanceInitError","RegisterElementError","AnimatorError","CSSVariableError","CuiPositionError","CLASSES","ICONS","close","accordion","special_menu","special_fail","special_success","CSS_VARIABLES","STATICS","logLevel","prefix","EVENTS","COMPONENTS_COUNTER","idx","counter","is","val","typecheck","length","Array","isArray","isEmpty","getName","sleep","timeout","Promise","resolve","setTimeout","getRangeValue","min","max","getRangeValueOrDefault","def","isNaN","joinAttributesForQuery","attributes","join","are","calcWindowSize","width","size","parseAttributeString","attribute","ret","out","startsWith","endsWith","JSON","parse","jsonify","e","console","error","component","functionName","Date","toLocaleString","parseJsonString","trim","includes","split","forEach","sp","splitColon","tag","undefined","replace","getIntOrDefault","integer","parseFloat","parseInt","getStyleValue","target","currentStyle","getComputedStyle","getPropertyValue","isInRange","parseAttribute","element","getAttribute","isStringTrue","toLowerCase","replacePrefix","getRandomInt","Math","ceil","floor","random","getParentCuiElement","parent","parentElement","$cuid","getChildrenHeight","height","from","children","child","getBoundingClientRect","enumerateObject","callback","prop","calculateNextIndex","currentIndex","totalLength","text","shift","getEnumOrDefault","defVal","values","joinWithScopeSelector","getChildSelectorFromScoped","scopedSelector","CuiSetup","autoLightMode","scrollThreshold","resizeThreshold","plugins","document","body","parallaxAnimations","init","cacheSize","animationTime","animationTimeShort","animationTimeLong","CuiSetupInit","app","interaction","busSetup","development","cuid","log","prepString","type","logByType","warn","stack","id","level","debug","warning","devTool","getMatchingComponents","node","components","filter","hasAttribute","createCuiElement","utils","next","generateCUID","tagName","setAttribute","createComponent","destroyCuiElement","$handlers","destroyComponent","args","handler","handle","updateComponent","refresh","destroy","_log","subtree","childList","attributeFilter","MutationObserver","mutationCallback","observe","disconnect","mutations","observer","mutation","item","attributeName","handeComponentUpdate","handleChildListMutation","onMutation","then","result","catch","exception","addedLen","addedNodes","removedLen","removedNodes","handleAddedNodes","handleRemovedNodes","nodes","handleAddedNode","hasChildNodes","querySelectorAll","handleAddedChildren","push","matchingComponents","handleDestroyChildren","CuiComponentMutationHandler","selector","unobserve","flag","record","records","reduce","matchesSelector","isAnyItemMatching","array","find","matches","FastDom","requestAnimationFrame","ctx","createTask","schedule","tasks","task","recursion","flush","rec","writes","reads","run","SyncInteractions","isRunning","raf","CuiQueue","adapter","index","findIndex","_item","compare","splice","item1","item2","items","getItemsForFlush","onFlush","callError","queue","onError","events","add","SimpleEventEmitHandlerAdapter","executor","event","idMatches","execute","TaskedEventEmitHandlerAdapter","promises","all","CuiEventEmitHandlerFactory","emitId","handleId","CuiCallbackExecutor","emitHandler","cui","rand","rand2","generateRandomString","isAttached","getCuid","ev","callbacks","evId","evValue","setup","sort","first","second","priority","initBusInstance","mapEvents","eventsDef","on","detach","detachAll","emit","isSubscribing","detachByCuid","busName","handlerName","current","interactions","style","head","getElementsByTagName","createElement","createTextNode","appendChild","initialSetup","fromInit","errorReport","fastDom","onInteractionError","bus","styleAppender","classes","classList","contains","mutate","remove","documentElement","setProperty","plugin","action","actions","x","inTarget","outTarget","inAction","outAction","onFinish","className","CuiInboundAction","setLightMode","setDarkMode","getLightMode","removeAttribute","el","DummyAction","substring","map","single","elements","now","fetch","attr","attributeValue","onClick","addEventListener","eventName","lock","unlock","actionStr","animationClass","act","animate","delay","performAction","ids","cuiElement","disposeId","description","matching","initElements","setComponents","setAttributes","setPlugins","start","stop","querySelector","arg","data","cuiArg","argArr","addCuiArgument","SWIPE_ANIMATIONS_DEFINITIONS","left","transform","translateX","to","unit","right","previous","fade","opacity","settings","appPrefix","icons","icon","swipeAnimations","animation","innerHTML","textContent","raw","build","reverse","switches","title","headerBuilder","setClasses","titleElement","getPrefixedString","appendChildrens","dialog","setId","container","str","onYes","onNo","onCancel","onOk","content","closeStr","iconStr","getElementById","updateElement","onClose","state","dialogBuilder","createHeader","createBody","createFooter","onAlert","validateEvent","popup","options","show","onWindowClick","removeEventListener","source","timestamp","CuiLightFocusPlugin","keybordClass","mouseClass","touchClass","onKeyDownEvent","onMouseEvent","onTouchEvent","update","cls","getClass","prevCls","hasCls","hasPrevCls","singleEmit","keys","onKeyDown","onKeyUp","code","setCallback","attach","keySetup","connect","CuiMediaQueryListener","mediaQuery","matchMedia","autoLightInit","autoLight","onChange","autoLightSetup","onMouseDown","onMouseUp","onMouseMove","onTouchStart","onTouchEnd","onTouchMove","passive","publishMouseEvent","publishTouchEvent","cancelable","preventDefault","clientX","y","clientY","moveX","movementX","moveY","movementY","touch","touches","changedTouches","gestures","onMove","onMoveLock","pushMoveEvent","diffX","diffY","getGestureDiff","gesture","calculateGesture","pushGestureEvent","firstEvent","lastEvent","tresholdX","innerWidth","absDiffX","abs","absDiffY","innerHeight","getGestureEventName","timespstamp","changeX","changeY","svgString","scale","created","htmlString","template","createElementFromString","append","toString","getNotification","cache","parts","getHeader","NOTIFICATION_BODY_CLS","setRawChildren","setTextContent","getBody","NOTIFICATION_FOOTER_CLS","onEvent","getActionsList","getFooter","NOTIFICATION_CLS","MARGIN_SMALL_VERTICAL","getClassByType","NOTIFICATION_TITLE_CLS","iconCloseElement","closeElement","ICON_CLS","NOTIFICATION_CLOSE_CLS","setChildren","NOTIFICATION_HEADER_CLS","createCache","getOrCreateContainer","validateNotificationData","onNotificationClose","notificationEl","addNotificationToTree","timeoutId","auto","setAutoClose","NOTIFICATION_ANIMATION_IN","NOTIFICATION_ACTIVE_CLS","notifiactionElement","insertBefore","firstChild","notification","fromTimeout","dissmissed","holder","clearTimeout","NOTIFICATION_ANIMATION_OUT","autoPrintInit","autoPrint","setPrintMode","threshold","listener","resizeData","resize","diff","currentSize","pushUpdateToItems","toastElement","onToastShow","AriaAttributes","label","throwOnEmptyKey","containsKey","indexOf","len","checkLock","removeClasses","componentName","isLocked","activeClassName","helper","fName","registerElement","unregisterElement","actionsHelper","prevArgs","isInitialized","logWarning","registerInDebug","setClassesAs","logInfo","performLifecycleOp","onHandle","assign","onRefresh","logError","onRemove","detachEmiitedEvents","removeFromDebug","performActions","method","operation","openFromEvent","closeFromEvent","openAct","closeAct","onInit","onUpdate","detachEvent","onDestroy","checkLockAndWarn","isActive","escClose","keyClose","onKeyClose","onBeforeOpen","onActionFinish","onAfterOpen","setClass","setAria","onBeforeClose","onAfterClose","removeClass","open","emitEvent","setSelector","prepareRecords","added","removed","changed","parserCallbacks","num","TypeParser","props","fillDefaultValues","main","currentType","parseValue","thisProp","thisValue","newVal","prperty","corrector","default","CuiClickModule","click","onElementClick","prevent","stopPropagation","CuiAccordionComponent","addModule","onSwitch","queryItems","openCloseTarget","currentTarget","previousTarget","hasClass","removeClassesAs","closeAllExcept","switch","triggers","foundIndex","trigger","progress","factor","calcUnitValue","cur","buildSingle","calcNewValue","prepUnitValue","ColorAnimator","red","green","blue","alpha","newColor","adjustColor","filters","filterName","color","cleanOnFinish","animators","animator","reportError","revert","animationProgress","shouldCalcRevert","animateAsync","initialProgress","pr","currProgress","callUpdate","endAnimation","reverted","perform","shouldCleanOnFinish","setOnError","setElement","setAnimators","swipe","CuiBanerComponent","setOnFinish","onSwipeFinish","absRatio","back","finish","newRatio","offsetWidth","setProps","iconSvg","svg","getTotalLength","readStyle","onSetProgress","strokeDashoffset","updateStyle","CuiCloseComponent","getTarget","emitClose","finally","cuiId","defTimeout","CuiCoverComponent","isPlugin","isAnyActive","pageYOffset","top","scrollTo","outClose","CuiDialogComponent","onMouseOut","onMouseOver","mouseEvent","force","invoke","isHovering","box","targetBox","getTopPosition","getBottomPosition","getMiddlePosition","getLeftPosition","getRightPosition","getCenterPosition","initial","number","getVerticalPosition","getHorizontalPosition","throwIfNotValid","validate","evaluator","setMargin","position","elementBox","setElementBox","setTarget","vertical","horizontal","outVNum","outVPos","getAutoVerticalPosition","outHNum","outHPos","getAutoHorizontalPosition","autoRenew","canRun","onHover","autoClose","pos","margin","CuiDropComponenet","onTriggerClick","setPreferred","onElementHover","acquireTrigger","onHoverEvent","setDataFromArgs","setStatic","findAndCloseOpenedDrop","onOpen","calculate","toggleActions","runAutoCloseTask","opened","toggle","BasePositionCalculator","BaseResizeCalculator","offsetLeft","offsetTop","CuiFloatComponent","move","peform","newWidth","newHeight","fitsWindow","newX","newY","offsetHeight","CuiIconComponent","addIcon","setScale","childNodes","iconElement","getDefaultOpenClass","getDefaultCloseClass","CuiOffCanvasComponent","setPositionLeft","scrollY","CuiElementBoxFactory","Window","WindowElementBox","HTMLElement","HTMLElementBox","ElementBox","scrollHeight","scrollWidth","scrollTop","scrollLeft","pageXOffset","onScrollFinish","getScrollLeft","getScrollTop","passedThreshold","base","scrolling","CuiOffsetStaticMode","offsetX","offsetY","CuiOffsetDynamicMode","fitsOffsetY","fitsOffsetX","CuiOffsetComponent","onScroll","checkAndPerformActions","getRoot","matchesOffset","callEvent","calcaRatio","exceededThreshold","ratioX","ratioY","ratY","clientHeight","toFixed","clientWidth","CuiOpenComponent","emitOpen","handleClickCui","setThreshold","isInProgress","prepareCallbackResult","currentTop","currentBottom","childBottom","currentLeft","currentRight","childRight","parentBottom","getHeight","parentRight","getWidth","verticalRatio","calcChildVerticalRatio","horizontalRatio","calcChildHorizontalRatio","propName","targets","startRatio","stopRatio","CuiParallaxComponent","sutils","setMutationSelector","getTargets","getParent","onIntersection","clean","setParent","curr","calculateRatio","targetSetup","getTargetAnimator","cleanStyle","CuiIntersectionObserver","IntersectionObserver","rootMargin","small","medium","large","xlarge","CuiResizeComponent","isInViewport","setNewValue","entries","isIntersecting","newValue","isSmartMode","getSmartValue","getValue","newAction","rect","bottom","behavior","getTargetsParent","getOffsetTop","by","scrollBy","CuiScrollSpyModeHandlerFactory","ratio","forEachAction","links","linksActions","getMatching","last","removeActions","lastElement","intersecting","addActions","isRoot","link","linkAction","CuiScrollspyComponent","updateResult","queryAll","found","isInBounds","cancelTimeout","CuiSortableComponent","onDragStart","onDragOver","onDragEnd","onSortAnimationFinish","getTargetsAndTrggers","setLongPressTimeout","setElements","getPressedElementIdx","startMovementPrep","getFinishAnimation","createPreview","setPreviewPosition","setCurrentPosition","removePreview","detected","detect","insertElement","destination","stopMovementPrep","spinner","onPause","removeIfAnyExisists","svgIcon","addSpinner","existing","paused","autoTimeout","loop","CuiSliderComponent","onAnimationFinish","onPushSwitch","getLinks","getActiveIndex","setLinkActive","setStyle","getElementHeight","startTask","nextIdx","adjustMoveRatio","errorOccured","in","CuiSwitchComponent","parseArguments","getSwitches","setSwitchesActive","nextItem","performSwitchAction","sw","emitLinkSwitch","isList","CuiSwitcherComponent","onClickEvent","targetId","getTargetCuid","handleListClick","handleItemClick","targetCuid","currentSelector","targetIndex","CuiToggleComponent","CuiTooltipComponent","removeTooltip","getDataFromArgs","createTooltip","maxWidth","toolbox","CUI_LIGHT_VERSION","cuiInit","initializer","pluginList","light","print","notifcationTimeout","focusSetup","GetPlugins","componentList","GetComponents","appPlugins"],"mappings":"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","file":"index.min.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"cui-light-app\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"cui-light-app\"] = factory();\n\telse\n\t\troot[\"cui-light-app\"] = factory();\n})(window, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","export class ErrorBase extends Error {\r\n    constructor(name: string, message?: string,) {\r\n        super(message);\r\n        Object.setPrototypeOf(this, new.target.prototype);\r\n        this.name = name;\r\n    }\r\n}\r\n\r\nexport class ItemNotFoundError extends ErrorBase {\r\n    constructor(message?: string) {\r\n        super(\"ItemNotFoundError\", message);\r\n    }\r\n}\r\n\r\nexport class ArgumentError extends ErrorBase {\r\n    constructor(message?: string) {\r\n        super(\"ArgumentError\", message);\r\n    }\r\n}\r\n\r\nexport class CuiBusError extends ErrorBase {\r\n    constructor(message?: string) {\r\n        super(\"ArgumentError\", message);\r\n    }\r\n}\r\n\r\nexport class CuiInstanceInitError extends ErrorBase {\r\n    constructor(message?: string) {\r\n        super(\"CuiInstanceInitError\", message);\r\n    }\r\n}\r\n\r\nexport class CuiScrollSpyOutOfRangeError extends ErrorBase {\r\n    constructor(message?: string) {\r\n        super(\"CuiScrollSpyOutOfRangeError\", message);\r\n    }\r\n}\r\n\r\n\r\nexport class RegisterElementError extends ErrorBase {\r\n    constructor(message?: string) {\r\n        super(\"RegisterElementError\", message);\r\n    }\r\n}\r\n\r\nexport class AnimatorError extends ErrorBase {\r\n    constructor(message?: string) {\r\n        super(\"AnimatorError\", message);\r\n    }\r\n}\r\n\r\nexport class CSSVariableError extends ErrorBase {\r\n    constructor(message?: string) {\r\n        super(\"CSSVariableError\", message);\r\n    }\r\n}\r\n\r\nexport class CuiColorError extends ErrorBase {\r\n    constructor(message?: string) {\r\n        super(\"CuiColorError\", message);\r\n    }\r\n}\r\n\r\nexport class CuiPositionError extends ErrorBase {\r\n    constructor(message?: string) {\r\n        super(\"CuiPositionError\", message);\r\n    }\r\n}","import { CuiLogLevel } from \"./types\";\r\n//import { CuiColorPair } from \"../models/colors\";\r\nimport { counter } from \"./functions\";\r\nimport { ICuiDevelopmentToolFactory } from \"../development/interfaces\";\r\nimport { ICuiMeasure } from \"../models/interfaces\";\r\nexport const CUID_ATTRIBUTE = \"cuid\";\r\n\r\nexport const CLASSES = {\r\n    dark: 'dark',\r\n    animProgress: 'animation-progress',\r\n    print: 'print',\r\n    active: 'active',\r\n    swipingOn: \"swiping-on\",\r\n    selectionOff: \"selection-off\",\r\n}\r\n\r\nexport const ICONS: any = {\r\n    close: \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 20 20\\\" width=\\\"20\\\" height=\\\"20\\\"><path d=\\\"M 1.9999999,1.9999999 18,18\\\"></path><path d=\\\"M 18,1.9999999 1.9999999,18\\\"></path></svg>\",\r\n    accordion: \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 20 20\\\" width=\\\"20\\\" height=\\\"20\\\"><path d=\\\"M 5.0000475,7.4490018 10.000024,12.551028 15,7.4490018\\\"></path></svg>\",\r\n    special_menu: \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 20 20\\\" width=\\\"20\\\" height=\\\"20\\\"><path class=\\\"menu_handle_2\\\" d=\\\"M 1,10 H 19\\\"></path><path class=\\\"menu_handle_1\\\" d=\\\"M 1,4.8571429 H 19\\\"></path><path  class=\\\"menu_handle_3\\\" d=\\\"M 1,15.142857 H 19\\\"></path></svg>\",\r\n    special_fail: \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" class=\\\"special-fail\\\" viewBox=\\\"0 0 100 100\\\" width=\\\"100\\\" height=\\\"100\\\"><path class=\\\"circle\\\" d=\\\"M 50,7.000001 A 43,43 0 0 1 92.999999,50 43,43 0 0 1 50,92.999999 43,43 0 0 1 7.0000011,50 43,43 0 0 1 50,7.000001 Z\\\"></path><path class=\\\"arm_1\\\" d=\\\"M 28.536809,28.536809 71.342023,71.342023\\\"></path><path class=\\\"arm_2\\\" d=\\\"M 71.342023,28.536809 28.536809,71.342023\\\"></path></svg>\",\r\n    special_success: \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" class=\\\"special-success\\\" viewBox=\\\"0 0 100 100\\\" width=\\\"100\\\" height=\\\"100\\\"><path class=\\\"circle\\\" d=\\\"M 50,7 A 43,43 0 0 1 93,50 43,43 0 0 1 50,93 43,43 0 0 1 7,50 43,43 0 0 1 50,7 Z\\\"></path><path class=\\\"arm\\\" d=\\\"M 22.988405,48.234784 36.946233,72.410453 75.516456,33.84023\\\"></path></svg>\",\r\n};\r\n\r\n// export const COLORS = ['red', 'green', 'blue', 'alpha']\r\n\r\n// export const CSS_APP_BACKGROUND_COLORS: CuiColorPair = {\r\n//     light: '--cui-color-light-app-background',\r\n//     dark: '--cui-color-dark-app-background'\r\n// }\r\n\r\n// export const CSS_COMPONENT_BACKGROUND_COLORS: CuiColorPair = {\r\n//     light: '--cui-color-light-background',\r\n//     dark: '--cui-color-dark-background '\r\n// }\r\n\r\n// export const CSS_COMPONENT_BORDER_COLORS: CuiColorPair = {\r\n//     light: '--cui-color-light-border',\r\n//     dark: '--cui-color-dark-border'\r\n// }\r\n\r\n// export const CSS_THEMES = {\r\n//     light: {\r\n//         base: '--cui-color-light-base',\r\n//         muted: '--cui-color-light-muted',\r\n//         active: '--cui-color-light-active'\r\n//     },\r\n//     dark: {\r\n//         base: '--cui-color-dark-base',\r\n//         muted: '--cui-color-dark-muted',\r\n//         active: '--cui-color-dark-active'\r\n//     },\r\n//     accent: {\r\n//         base: '--cui-color-primary',\r\n//         muted: '--cui-color-primary-muted',\r\n//         active: '--cui-color-primary-active'\r\n//     },\r\n//     secondary: {\r\n//         base: '--cui-color-secondary',\r\n//         muted: '--cui-color-secondary-muted',\r\n//         active: '--cui-color-secondary-active'\r\n//     },\r\n//     success: {\r\n//         base: '--cui-color-success',\r\n//         muted: '--cui-color-success-muted',\r\n//         active: '--cui-color-success-active'\r\n//     },\r\n//     warning: {\r\n//         base: '--cui-color-warning',\r\n//         muted: '--cui-color-warning-muted',\r\n//         active: '--cui-color-warning-active'\r\n//     },\r\n//     error: {\r\n//         base: '--cui-color-error',\r\n//         muted: '--cui-color-error-muted',\r\n//         active: '--cui-color-error-active'\r\n//     }\r\n// }\r\n\r\nexport const SCOPE_SELECTOR = \":scope \";\r\n\r\nexport const CSS_VARIABLES: any = {\r\n    fontSize: \"--{prefix}-font-size\",\r\n    lineHeight: \"--{prefix}-line-height\",\r\n    animationTime: \"--{prefix}-animation-time\",\r\n    animationTimeLong: \"--{prefix}-animation-time-long\",\r\n    animationTimeShort: \"--{prefix}-animation-time-short\",\r\n    colorLightAppBackground: \"--{prefix}-color-light-app-background\",\r\n    colorLightBackground: \"--{prefix}-color-light-background\",\r\n    colorLightBorder: \"--{prefix}-color-light-border\",\r\n    colorLightBase: \"--{prefix}-color-light-base\",\r\n    colorLightActive: \"--{prefix}-color-light-active\",\r\n    colorLightMuted: \"--{prefix}-color-light-muted\",\r\n    colorDarkAppBackground: \"--{prefix}-color-dark-app-background\",\r\n    colorDarkBackground: \"--{prefix}-color-dark-background\",\r\n    colorDarkBorder: \"--{prefix}-color-dark-border\",\r\n    colorDarkBase: \"--{prefix}-color-dark-base\",\r\n    colorDarkActive: \"--{prefix}-color-dark-active\",\r\n    colorDarkMuted: \"--{prefix}-color-dark-muted\",\r\n    colorAccent: \"--{prefix}-color-primary\",\r\n    colorAccentActive: \"--{prefix}-color-primary-active\",\r\n    colorAccentMuted: \"--{prefix}-color-primary-muted\",\r\n    colorAccentShade: \"--{prefix}-color-primary-shade\",\r\n    colorAccentShadeDark: \"--{prefix}-color-primary-shade-dark\",\r\n    colorSecondary: \"--{prefix}-color-secondary\",\r\n    colorSecondaryActive: \"--{prefix}-color-secondary-active\",\r\n    colorSecondaryMuted: \"--{prefix}-color-secondary-muted\",\r\n    colorSecondaryShade: \"--{prefix}-color-secondary-shade\",\r\n    colorSecondaryShadeDark: \"--{prefix}-color-secondary-shade-dark\",\r\n    colorWarning: \"--{prefix}-color-warning\",\r\n    colorWarningActive: \"--{prefix}-color-warning-active\",\r\n    colorWarningMuted: \"--{prefix}-color-warning-muted\",\r\n    colorWarningShade: \"--{prefix}-color-warning-shade\",\r\n    colorWarningShadeDark: \"--{prefix}-color-warning-shade-dark\",\r\n    colorSuccess: \"--{prefix}-color-success\",\r\n    colorSuccessActive: \"--{prefix}-color-success-active\",\r\n    colorSuccessMuted: \"--{prefix}-color-success-muted\",\r\n    colorSuccessShade: \"--{prefix}-color-success-shade\",\r\n    colorSuccessShadeDark: \"--{prefix}-color-success-shade-dark\",\r\n    colorError: \"--{prefix}-color-error\",\r\n    colorErrorActive: \"--{prefix}-color-error-active\",\r\n    colorErrorMuted: \"--{prefix}-color-error-muted\",\r\n    colorErrorShade: \"--{prefix}-color-error-shade\",\r\n    colorErrorShadeDark: \"--{prefix}-color-error-shade-dark\",\r\n    inputBackground: \"--{prefix}-input-background-color\",\r\n    colorShade: \"--{prefix}-color-shade\",\r\n    colorShadeDarker: \"--{prefix}-color-shade-darker\",\r\n    colorShadeLight: \"--{prefix}-color-shade-light\",\r\n    colorShadeLighter: \"--{prefix}-color-shade-light-lighter\",\r\n    outline: \"--{prefix}-outline\",\r\n    borderRadius: \"--{prefix}-border-radius\",\r\n    padding: \"--{prefix}-padding\",\r\n    margin: \"--{prefix}-margin\",\r\n    scrollbarWidth: \"--{prefix}-scrollbar-width\",\r\n    componentSpace: \"--{prefix}-component-space\",\r\n    accordionIcon: \"--{prefix}-accordion-icon\"\r\n}\r\n\r\n\r\nexport class STATICS {\r\n    static logLevel: CuiLogLevel = 'none';\r\n    static prefix: string = 'cui';\r\n    static devTool: ICuiDevelopmentToolFactory;\r\n}\r\n\r\nexport const EVENTS = {\r\n    INSTANCE_INITIALIZED: 'instance-initialized',\r\n    INSTANCE_FINISHED: 'instance-finished',\r\n    RESIZE: \"resize\",\r\n    OPEN: \"open\",\r\n    OPENED: \"opened\",\r\n    CLOSE: \"close\",\r\n    CLOSED: \"closed\",\r\n    TOGGLE: \"toggle\",\r\n    TOGGLED: 'toggled',\r\n    SWITCH: \"switch\",\r\n    SWITCHED: \"switched\",\r\n    ON_SCROLL: \"scroll\",\r\n    TARGET_CHANGE: 'targetchange',\r\n    INTERSECTION: 'intersection',\r\n    KEYDOWN: 'keydown',\r\n    SCROLLBY: 'scrollby',\r\n    WINDOW_CLICK: 'windowclick',\r\n    OFFSET: 'offset',\r\n    PROGRESS_CHANGE: \"progresschange\",\r\n    PROGRESS_CHANGED: \"progresschanged\",\r\n    CHANGE: \"change\",\r\n    CHANGED: \"changed\",\r\n    GLOBAL_MOVE: \"globalmove\",\r\n    MOVE_LOCK: \"movelock\",\r\n    PAUSE: \"pause\",\r\n    PAUSED: \"paused\",\r\n    SORTED: \"sorted\",\r\n    SORT_START: \"sortstart\",\r\n    TOAST: \"toast\",\r\n    TOAST_SHOW: \"toastshow\",\r\n    TOAST_HIDDEN: \"toasthidden\",\r\n    ALERT: \"alert\",\r\n    GESTURE_DOWN: \"gesture-down\",\r\n    GESTURE_UP: \"gesture-up\",\r\n    GESTURE_LEFT: \"gesture-left\",\r\n    GESTURE_RIGHT: \"gesture-right\",\r\n    NOTIFY: \"notify\",\r\n    NOTIFIED: \"notified\",\r\n}\r\n\r\n// export const GLOBAL_EVENTS = [EVENTS.ALERT, EVENTS.TOAST, EVENTS.KEYDOWN, EVENTS.MOVE_LOCK, EVENTS.GLOBAL_MOVE, EVENTS.RESIZE]\r\n\r\nexport const OBSERVABLE_SCROLL = \"SCROLL\";\r\nexport const OBSERVABLE_INTERSECTION = \"INTERSECTION\";\r\nexport const COMPONENTS_COUNTER = counter();\r\n\r\nexport const SCREEN_SIZE_SMALL = 640;\r\nexport const SCREEN_SIZE_MEDIUM = 960;\r\nexport const SCREEN_SIZE_LARGE = 1200;\r\nexport const SCREEN_SIZE_XLARGE = 1600;\r\n\r\nexport const MEASUREMENT: ICuiMeasure[] = []","import { CuiLightMode, CuiWindowSize } from \"./types\";\r\nimport { ArgumentError } from \"../models/errors\";\r\nimport { CuiElement } from \"../models/interfaces\";\r\nimport { COMPONENTS_COUNTER, MEASUREMENT, SCOPE_SELECTOR, SCREEN_SIZE_LARGE, SCREEN_SIZE_MEDIUM, SCREEN_SIZE_SMALL, SCREEN_SIZE_XLARGE } from \"./statics\";\r\n\r\n/**\r\n * Checks if value is defined an is not null\r\n * Additionally with type check it can check value if it is not empty string or collection or object\r\n * \r\n * @param val - value\r\n * @param typecheck - default true - additional check whether value is not empty (string, collection, object)\r\n * @returns whether value passed all conditions\r\n */\r\nexport function is(val: any, typecheck: boolean = true): boolean {\r\n    if (typeof val !== 'undefined' && val !== null) {\r\n        if (!typecheck) {\r\n            return true;\r\n        } else {\r\n            return !isEmpty(val)\r\n        }\r\n    }\r\n    return false;\r\n}\r\n\r\n/**\r\n * Checks if value is empty string, array or object\r\n *\r\n *\r\n * @param val - value\r\n * @returns whether value passed all conditions\r\n */\r\nexport function isEmpty(val: any): boolean {\r\n    if (typeof val === \"string\") {\r\n        return val.length === 0\r\n    }\r\n    if (typeof val === \"boolean\") {\r\n        return val;\r\n    }\r\n    else if (Array.isArray(val)) {\r\n        return val.length === 0\r\n    }\r\n    return false\r\n}\r\n\r\nexport function getName(prefix: string, name: string) {\r\n    if (!is(prefix) || !is(name)) {\r\n        throw new ArgumentError(\"Missing argument value\")\r\n    }\r\n    return `${prefix}-${name}`\r\n}\r\n\r\nexport function sleep(timeout: number): Promise<boolean> {\r\n    return new Promise(resolve => setTimeout(() => {\r\n        resolve(true)\r\n    }, timeout));\r\n}\r\n\r\n/**\r\n * Creates proper html element from given string\r\n * @param htmlString - string containing html\r\n */\r\nexport function createElementFromString(htmlString: string): Element | null {\r\n    if (!is(htmlString)) {\r\n        return null;\r\n    }\r\n    let template = document.createElement('template')\r\n    template.innerHTML = htmlString\r\n    return template.content.children.length > 0 ? template.content.children[0] : null;\r\n}\r\n\r\nexport function getMatchingAttribute(element: any, attributes: string[]): string | null {\r\n    let attr = null;\r\n    let len = attributes.length;\r\n    for (let i = 0; i < len; i++) {\r\n        let attribute = attributes[i];\r\n        if (element.hasAttribute(attribute)) {\r\n            attr = attribute\r\n            break;\r\n        }\r\n    }\r\n    return attr;\r\n}\r\n\r\n// export function getMatchingAttributes(element: any, attributes: string[]): string[] {\r\n//     if (!element || !is(element.hasAttribute)) {\r\n//         return [];\r\n//     }\r\n//     return attributes.filter(a => {\r\n//         return element.hasAttribute(a);\r\n//     });\r\n// }\r\n\r\nexport function getRangeValue(value: number, min: number, max: number) {\r\n    if (value < min) {\r\n        return min;\r\n    } else if (value > max) {\r\n        return max;\r\n    }\r\n    return value;\r\n}\r\n\r\nexport function getRangeValueOrDefault(value: number | undefined, min: number, max: number, def: number) {\r\n    if (value === null || typeof value === 'undefined' || isNaN(value)) {\r\n        return def;\r\n    }\r\n    return getRangeValue(value, min, max)\r\n}\r\n\r\nexport function increaseValue(value: number, amount: number): number {\r\n    return amount < 0 || amount > 1 ? 0 : value + (value * amount);\r\n}\r\n\r\nexport function decreaseValue(value: number, amount: number): number {\r\n    return amount < 0 || amount > 1 ? 0 : value - (value * amount);\r\n}\r\n\r\nexport function clone(object: any): any {\r\n    if (!is(object)) {\r\n        return null;\r\n    }\r\n    return Object.assign({}, object);\r\n}\r\n\r\nexport function getSingleColorRatio(first: number, second: number, max: number): number {\r\n    return Math.abs(((first - second) / max) * 100)\r\n}\r\n\r\n/**\r\n * Creates string containg css selector for array of attributes\r\n * @param attributes - attributes values\r\n */\r\nexport function joinAttributesForQuery(attributes: string[]): string {\r\n    if (!is(attributes)) {\r\n        return \"\"\r\n    }\r\n    return `[${attributes.join('],[')}]`\r\n}\r\n\r\n/**\r\n * Checks light system light mode\r\n * @returns Light Mode - dark/light\r\n */\r\nexport function getSystemLightMode(): CuiLightMode {\r\n    return window.matchMedia &&\r\n        window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';\r\n}\r\n\r\n/**\r\n * Check print mode in the browser window\r\n * @returns true if window is displayed in print mode\r\n */\r\nexport function getSystemPrintMode(): boolean {\r\n    return window.matchMedia &&\r\n        window.matchMedia('print').matches;\r\n}\r\n\r\n/**\r\n * Verifies whether attributes exist and have some values\r\n * @param attributes attributes list\r\n */\r\nexport function are(...attributes: any[]): boolean {\r\n    if (!is(attributes)) {\r\n        return false\r\n    }\r\n    let c = attributes.length;\r\n    for (let i = 0; i < c; i++) {\r\n        if (!is(attributes[i])) {\r\n            return false;\r\n        }\r\n    }\r\n    return true;\r\n}\r\n\r\nexport function calcWindowSize(width: number): CuiWindowSize {\r\n    let size: CuiWindowSize = \"none\";\r\n    if (width >= SCREEN_SIZE_SMALL) {\r\n        size = 'small';\r\n    }\r\n    if (width >= SCREEN_SIZE_MEDIUM) {\r\n        size = \"medium\";\r\n    }\r\n    if (width >= SCREEN_SIZE_LARGE) {\r\n        size = \"large\"\r\n    }\r\n\r\n    if (width >= SCREEN_SIZE_XLARGE) {\r\n        size = 'xlarge';\r\n    }\r\n    return size;\r\n}\r\n\r\n/**\r\n * Creates object from string.\r\n * Supported syntaxes are:\r\n * - JSON\r\n * - single value\r\n * - key:value,value;key=value\r\n * \r\n * @param attribute - attribute value\r\n */\r\nexport function parseAttributeString(attribute: string | null): any {\r\n    let ret: any = {};\r\n    if (!is(attribute)) {\r\n        return ret;\r\n    }\r\n    //@ts-ignore - null already checked\r\n    ret = parseJsonString(attribute.trim())\r\n    if (!is(ret)) {\r\n        //@ts-ignore - null already checked\r\n        if (!attribute.includes(';') && !attribute.includes(':')) {\r\n            ret = attribute;\r\n        } else {\r\n            ret = {}\r\n            //@ts-ignore - null already checked\r\n            attribute.split(';').forEach(val => {\r\n                let sp = splitColon(val);\r\n                let tag = undefined;\r\n                let value = \"\";\r\n                if (sp.length < 2) {\r\n                    return;\r\n                }\r\n                tag = sp[0].trim();\r\n                value = sp[1].trim();\r\n                if (tag)\r\n                    ret[tag] = value.replace('U+0003B', ';');\r\n            })\r\n        }\r\n    }\r\n    return ret\r\n}\r\n\r\n/**\r\n * Creates object from JSON string\r\n* String must start with { and end with }\r\n *\r\n * @param attribute - attribute value\r\n * @returns object if string passes test, null otherwise\r\n */\r\n\r\nexport function parseJsonString(attribute: string): any | null {\r\n    let out = null;\r\n    if (is(attribute) && attribute.startsWith('{') && attribute.endsWith('}')) {\r\n        try {\r\n            out = jsonify(attribute);\r\n        } catch (e) {\r\n            console.error(prepLogString(\"An exception occured\", 'Functions', 'parseJsonString'), e)\r\n        }\r\n        return out;\r\n    }\r\n    return null;\r\n}\r\n\r\n/**\r\n * Creates object from JSON string\r\n * @param attribute - JSON string\r\n */\r\nexport function jsonify(attribute: string): any {\r\n    return attribute && attribute.length > 0 ? JSON.parse(attribute) : {}\r\n}\r\n\r\nexport function getOffsetTop(element: HTMLElement) {\r\n    if (!is(element)) {\r\n        return -1;\r\n    }\r\n    let val = element.offsetTop - parseInt(getStyleValue(element, 'margin-top')) - parseInt(getStyleValue(element, 'padding-top')) - parseInt(getStyleValue(element, 'border-top-width'))\r\n    return val < 0 ? element.offsetTop : val;\r\n}\r\n\r\nexport function getOffsetLeft(element: HTMLElement) {\r\n    if (!is(element)) {\r\n        return -1;\r\n    }\r\n    let val = element.offsetLeft - parseInt(getStyleValue(element, 'margin-left')) - parseInt(getStyleValue(element, 'padding-left')) - parseInt(getStyleValue(element, 'border-left-width'))\r\n    return val < 0 ? element.offsetLeft : val;\r\n}\r\n\r\nexport function getIntOrDefault(value: any, def: number): number {\r\n    if (!value) {\r\n        return def;\r\n    }\r\n    let integer = value.includes && value.includes('.') ? parseFloat(value) : parseInt(value);\r\n    return isNaN(integer) ? def : integer;\r\n}\r\n\r\nexport function getStyleValue(target: any, property: string): any {\r\n    if (!is(target) || !is(property)) {\r\n        return null;\r\n    }\r\n    if (target.currentStyle) {\r\n        return target.currentStyle[property];\r\n    } else if (window.getComputedStyle) {\r\n        return window.getComputedStyle(target, null).getPropertyValue(property)\r\n    }\r\n    return null;\r\n}\r\n\r\nexport function prepLogString(message: string, component: string, functionName?: string) {\r\n    return `[${new Date().toLocaleString()}][${component ?? \"-\"}][${functionName ?? '-'}][${message}]`\r\n}\r\n\r\nexport function isInRange(value: number, min: number, max: number): boolean {\r\n    return is(value) && value >= min && value <= max;\r\n}\r\n\r\nexport function getActiveClass(prefix: string) {\r\n    return `${prefix ?? \"\"}-active`;\r\n}\r\n\r\nexport function parseAttribute(element: Element, attribute: string): any {\r\n    return are(element, attribute) ? parseAttributeString(element.getAttribute(attribute)) : null;\r\n}\r\n\r\n\r\n/**\r\n *  Checks whether string value contains synonym of true\r\n * @param value - string to check\r\n */\r\nexport function isStringTrue(value: string): boolean {\r\n    return is(value) ? ['y', 't', 'true', 'yes'].includes(value.toLowerCase()) : false\r\n}\r\n\r\nexport function boolStringOrDefault(prop: any, def: boolean): boolean {\r\n    return is(prop) ? isStringTrue(prop) : def;\r\n}\r\n\r\nexport function getStringOrDefault(value: any, def: string) {\r\n    return is(value) ? value.toLowerCase() : def;\r\n}\r\n\r\n/**\r\n * Checks whether device supports touch\r\n */\r\nexport function isTouchSupported(): boolean {\r\n    return ('ontouchstart' in window) ||\r\n        (navigator.maxTouchPoints > 0) ||\r\n        (navigator.msMaxTouchPoints > 0);\r\n}\r\n\r\n/**\r\n * Checks whether value is type of string\r\n * @param {any} value - value to be checked\r\n */\r\nexport function isString(value: any): boolean {\r\n    return typeof value === 'string';\r\n}\r\n\r\n\r\n/**\r\n * Replaces mask {prefix} with actual value in the string\r\n * @param {string} value - text containg a mask\r\n * @param {string} prefix - value to be put in place of mask\r\n */\r\nexport function replacePrefix(value: string, prefix: string): string {\r\n    return !is(value) ? value : value.replace(\"{prefix}\", prefix ?? \"\");\r\n}\r\n\r\n/**\r\n * Generates identifier for Cui element\r\n * \r\n * @param element - Cui element selector\r\n * @returns generated identifier\r\n */\r\nexport function generateCUID(element?: string) {\r\n    let starter = is(element) ? element : \"cui-element\"\r\n    return `${starter}-${COMPONENTS_COUNTER.next().value}`;\r\n}\r\n\r\n/**\r\n * Generates random string\r\n */\r\nexport function generateRandomString(): string {\r\n    let rand = getRandomInt(1, 1000)\r\n    let rand2 = getRandomInt(1, 100)\r\n    return `${Math.floor(Math.random() * rand2)}-${Math.floor(rand)}`;\r\n}\r\n/**\r\n * Generates random integer\r\n * @param min - min number\r\n * @param max - max number\r\n * @returns random integer\r\n */\r\nexport function getRandomInt(min: number, max: number): number {\r\n    min = Math.ceil(min);\r\n    max = Math.floor(max);\r\n    return Math.floor(Math.random() * (max - min + 1)) + min;\r\n}\r\n\r\n\r\n\r\nexport function* counter(): Generator<number, number, number> {\r\n    let idx = 0;\r\n    while (true) {\r\n        let reset = yield idx++;\r\n        if (reset || idx > 200000) {\r\n            idx = 0\r\n        }\r\n    }\r\n}\r\n\r\nexport function all<T>(array: T[], condition: (t: T) => boolean) {\r\n    return array && array.length > 0 && array.find((t: T) => !condition(t)) === undefined;\r\n}\r\n\r\nexport function getHandlerExtendingOrNull<T>(target: CuiElement, fName: string): T | null {\r\n    if (!is(target.$handlers)) {\r\n        return null;\r\n    }\r\n\r\n    for (let handler in target.$handlers) {\r\n\r\n        if (target.$handlers.hasOwnProperty(handler)) {\r\n            let h: any = target.$handlers[handler];\r\n            if (hasFunction(h, fName))\r\n                return h;\r\n        }\r\n    }\r\n    return null;\r\n}\r\n\r\n/**\r\n * Checks whether property exists on the object and it is a function\r\n * @param obj - object\r\n * @param fName - property name\r\n */\r\nexport function hasFunction(obj: any, fName: string) {\r\n    return is(obj[fName]) && typeof obj[fName] === 'function'\r\n}\r\n\r\n/**\r\n * Gets closest parent element which is a cUI element\r\n * @param element \r\n */\r\nexport function getParentCuiElement(element: Element): Element | undefined {\r\n    if (!is(element)) {\r\n        return undefined;\r\n    }\r\n    let parent = element.parentElement as any;\r\n    return is(parent) && is(parent.$cuid) ? parent : getParentCuiElement(parent);\r\n}\r\n\r\n/**\r\n * Calculates element height by calculating childerns heights\r\n * @param element\r\n */\r\nexport function getChildrenHeight(element: Element): number {\r\n    let height: number = 0;\r\n    if (!element) {\r\n        return -1;\r\n    }\r\n    Array.from(element.children).forEach((child: Element) => {\r\n        height += child.getBoundingClientRect().height;\r\n    })\r\n    return height > 0 ? height + 4 : height;\r\n}\r\n\r\nexport function enumerateObject<T extends object>(object: T, callback: (property: string, value: any) => void) {\r\n    if (!are(object, callback)) {\r\n        return;\r\n    }\r\n    for (let prop in object) {\r\n        if (object.hasOwnProperty(prop)) {\r\n            callback(prop, object[prop]);\r\n        }\r\n    }\r\n}\r\n\r\nexport function round(value: number, decimalPlaces: number): number {\r\n    const multiplier = 10 ** decimalPlaces;\r\n    return Math.floor(value) / multiplier;\r\n}\r\n\r\nexport function calculateNextIndex(val: any, currentIndex: number, totalLength: number): number {\r\n    let idx = -1;\r\n    switch (val) {\r\n        case 'prev':\r\n            idx = currentIndex <= 0 ? totalLength - 1 : currentIndex - 1;\r\n            break;\r\n        case 'next':\r\n            idx = currentIndex < totalLength - 1 ? currentIndex + 1 : 0\r\n            break;\r\n        case 'first':\r\n            idx = 0;\r\n            break;\r\n        case 'last':\r\n            idx = totalLength - 1;\r\n        default:\r\n            idx = getIntOrDefault(val, -1);\r\n            break;\r\n    }\r\n    return idx;\r\n}\r\n\r\nexport function getFirstMatching<T>(array: T[], callback: (t: T, index: number) => boolean): T | undefined {\r\n    let count = array.length;\r\n    if (!array || count === 0) {\r\n        return undefined;\r\n    }\r\n\r\n    for (let idx = 0; idx < count; idx++) {\r\n        if (callback(array[idx], idx)) {\r\n            return array[idx];\r\n        }\r\n    }\r\n    return undefined;\r\n}\r\n\r\nexport function mapObject<T, V>(input: T, callback: (t: T) => V): V {\r\n    return callback(input);\r\n}\r\n\r\nexport function mapObjectArray<T, V>(input: T[], callback: (t: T) => V): V[] {\r\n    return input.map((item: T) => {\r\n        return mapObject(item, callback);\r\n    })\r\n}\r\n\r\n/**\r\n * Delays callback execution by specific time. Callback cannot be called again until previous execution finishes or was cancelled\r\n * @param callback - callback to execute\r\n * @param delayTime - time in ms that execution shall be delayed by\r\n * @returns Cancel callback\r\n */\r\nexport function delay(callback: (...args: any[]) => void, delayTime: number) {\r\n    if (!are(callback, delayTime)) {\r\n        throw new Error(\"[delay]: Input arguments are not correct\")\r\n    }\r\n    let id: any = null;\r\n    return function (...args: any[]) {\r\n        if (id === null) {\r\n            id = setTimeout(() => {\r\n                callback(...args);\r\n                id = null;\r\n            }, delayTime)\r\n        }\r\n        return function () {\r\n            if (id !== null) {\r\n                clearTimeout(id);\r\n                id = null;\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nexport function splitColon(text: string): string[] {\r\n    let ret: string[] = [];\r\n    if (!is(text)) {\r\n        return ret;\r\n    }\r\n    let split = text.split(\":\");\r\n    if (split.length === 1) {\r\n        return split;\r\n    }\r\n    let tag = split.shift();\r\n    // @ts-ignore tag is always defined\r\n    return [tag, split.join(\":\")];\r\n}\r\n\r\nexport function getEnumOrDefault<T>(value: T, defVal: T, ...values: T[]): T {\r\n    if (values.includes(value)) {\r\n        return value;\r\n    }\r\n    return defVal;\r\n}\r\n\r\nexport function joinWithScopeSelector(value: string) {\r\n    return SCOPE_SELECTOR + value;\r\n}\r\n\r\nexport function measure(name?: string) {\r\n    const optName = name ?? \"\";\r\n    return function (target: Object, propertyKey: string, descriptor: PropertyDescriptor) {\r\n        const originalMethod = descriptor.value;\r\n        descriptor.value = function (...args: any[]) {\r\n            const start = performance.now();\r\n            const result = originalMethod.apply(this, args);\r\n            const finish = performance.now();\r\n            MEASUREMENT.push({\r\n                target: optName,\r\n                method: propertyKey,\r\n                time: finish - start\r\n            })\r\n            return result;\r\n        };\r\n\r\n        return descriptor;\r\n    }\r\n};\r\n\r\nexport function getChildSelectorFromScoped(scopedSelector: string): string {\r\n    const split = scopedSelector.split(\">\");\r\n    return split[split.length - 1].trim();\r\n}\r\n\r\nexport function applyMixins(derivedCtor: any, constructors: any[]) {\r\n    constructors.forEach((baseCtor) => {\r\n        Object.getOwnPropertyNames(baseCtor.prototype).forEach((name) => {\r\n            Object.defineProperty(\r\n                derivedCtor.prototype,\r\n                name,\r\n                Object.getOwnPropertyDescriptor(baseCtor.prototype, name) ||\r\n                Object.create(null)\r\n            );\r\n        });\r\n    });\r\n}","import { ParallaxAnimations } from \"../animation/interfaces\";\r\nimport { ICuiEventBusQueueSetup } from \"../bus/interfaces\";\r\nimport { ICuiDevelopmentToolFactory } from \"../development/interfaces\";\r\nimport { CuiLogLevel, CuiInteractionsType } from \"../utils/types\";\r\n\r\ninterface CuiSetupCommon {\r\n    prefix?: string;\r\n    logLevel?: CuiLogLevel;\r\n    cacheSize?: number;\r\n    autoLightMode?: boolean;\r\n    animationTime?: number;\r\n    animationTimeShort?: number;\r\n    animationTimeLong?: number;\r\n    scrollThreshold?: number;\r\n    resizeThreshold?: number;\r\n    root: HTMLElement;\r\n}\r\n\r\nexport class CuiSetup implements CuiSetupCommon {\r\n    prefix: string;\r\n    logLevel?: CuiLogLevel;\r\n    cacheSize?: number;\r\n    autoLightMode?: boolean;\r\n    animationTime?: number;\r\n    animationTimeShort?: number;\r\n    animationTimeLong?: number;\r\n    scrollThreshold: number;\r\n    resizeThreshold: number;\r\n    plugins: any;\r\n    root: HTMLElement;\r\n    parallaxAnimations: ParallaxAnimations;\r\n\r\n    constructor() {\r\n        this.autoLightMode = false;\r\n        this.scrollThreshold = 20;\r\n        this.resizeThreshold = 20;\r\n        this.prefix = \"cui\";\r\n        this.plugins = {};\r\n        this.root = document.body;\r\n        this.parallaxAnimations = {};\r\n    }\r\n\r\n    fromInit(init: CuiSetupInit): CuiSetup {\r\n        this.prefix = init.prefix ?? \"cui\";\r\n        this.logLevel = init.logLevel;\r\n        this.cacheSize = init.cacheSize;\r\n        this.autoLightMode = init.autoLightMode;\r\n        this.animationTime = init.animationTime;\r\n        this.animationTimeShort = init.animationTimeShort;\r\n        this.animationTimeLong = init.animationTimeLong;\r\n        this.scrollThreshold = init.scrollThreshold;\r\n        this.resizeThreshold = init.resizeThreshold;\r\n        this.root = init.root;\r\n        this.parallaxAnimations = init.parallaxAnimations;\r\n\r\n        return this;\r\n    }\r\n}\r\n\r\n\r\nexport class CuiSetupInit implements CuiSetupCommon {\r\n    prefix: string;\r\n    app: string;\r\n    interaction: CuiInteractionsType;\r\n    logLevel: CuiLogLevel;\r\n    cacheSize: number;\r\n    autoLightMode?: boolean;\r\n    animationTime: number;\r\n    animationTimeShort: number;\r\n    animationTimeLong: number;\r\n    scrollThreshold: number;\r\n    resizeThreshold: number;\r\n    busSetup?: ICuiEventBusQueueSetup[];\r\n    development: ICuiDevelopmentToolFactory | undefined;\r\n    parallaxAnimations: ParallaxAnimations;\r\n    root: HTMLElement;\r\n    constructor() {\r\n        this.prefix = 'cui';\r\n        this.app = '$cui';\r\n        this.logLevel = 'warning';\r\n        this.interaction = 'async';\r\n        this.animationTime = 300;\r\n        this.animationTimeShort = 150;\r\n        this.animationTimeLong = 500;\r\n        this.cacheSize = 500;\r\n        this.autoLightMode = false;\r\n        this.scrollThreshold = 20;\r\n        this.resizeThreshold = 20;\r\n        this.root = document.body;\r\n        this.busSetup = undefined;\r\n        this.development = undefined;\r\n        this.parallaxAnimations = {};\r\n    }\r\n}","import { STATICS } from \"../utils/statics\";\r\nimport { CuiLogLevel } from \"../utils/types\";\r\nimport { CuiDevelopmentStateType, ICuiDevelopmentTool } from \"./interfaces\";\r\n\r\nexport class CuiConsoleDevelopementTool implements ICuiDevelopmentTool {\r\n    #cuid: string;\r\n    #name: string;\r\n    #level: CuiLogLevel;\r\n    constructor(name: string, logLevel?: CuiLogLevel) {\r\n        this.#name = name;\r\n        this.#cuid = '-';\r\n        this.#level = logLevel ?? STATICS.logLevel;\r\n\r\n    }\r\n    registerElement(element: HTMLElement, cuid: string, component: string): void {\r\n        this.#cuid = cuid;\r\n        console.log(this.prepString(\"Register element: \" + cuid, 'debug', component))\r\n    }\r\n    unregisterElement(cuid: string, component: string): void {\r\n        this.#cuid = '-'\r\n        console.log(this.prepString(\"Unregister element: \" + cuid, 'debug', component))\r\n    }\r\n\r\n    setProperty<T>(cuid: string, component: string, name: string, t: T): void {\r\n        //throw new Error(\"Method not implemented.\");\r\n    }\r\n\r\n    pushState(cuid: string, component: string, type: CuiDevelopmentStateType, message: string, functionName?: string): void {\r\n        this.logByType(type, message, functionName);\r\n    }\r\n\r\n    log(type: CuiDevelopmentStateType, message: string, functionName?: string): void {\r\n        this.logByType(type, message, functionName);\r\n    }\r\n\r\n    debug(message: string, functionName?: string): void {\r\n        if (this.#level === 'debug') {\r\n            console.log(this.prepString(message, \"debug\", functionName))\r\n        }\r\n    }\r\n    warning(message: string, functionName?: string): void {\r\n        if (this.#level === 'warning' || this.#level === 'debug')\r\n            console.warn(this.prepString(message, \"warning\", functionName))\r\n    }\r\n    error(message: string, functionName?: string): void {\r\n        if (this.#level === 'error' || this.#level === 'debug' || this.#level === 'warning')\r\n            console.error(this.prepString(message, \"error\", functionName))\r\n    }\r\n    exception(e: Error, functionName?: string): void {\r\n        console.error(this.prepString(`An exception occured: ${e.name}: ${e.message}`, \"exception\", functionName))\r\n        if (this.#level === 'debug')\r\n            console.error(e.stack)\r\n    }\r\n\r\n    setId(id: string) {\r\n        if (id)\r\n            this.#cuid = id;\r\n    }\r\n\r\n    private prepString(message: string, level: string, functionName?: string) {\r\n        return `[${new Date().toLocaleString()}][${level}][${this.#name}][${functionName ?? '-'}][${this.#cuid}][${message}]`\r\n    }\r\n\r\n    private logByType(type: CuiDevelopmentStateType, message: string, functionName?: string) {\r\n        switch (type) {\r\n            case 'debug':\r\n                this.debug(message, functionName);\r\n                break;\r\n            case 'warning':\r\n                this.warning(message, functionName);\r\n                break;\r\n            case 'error':\r\n                this.error(message, functionName);\r\n                break;\r\n        }\r\n    }\r\n}","import { STATICS } from \"../utils/statics\";\r\nimport { CuiConsoleDevelopementTool } from \"./console\";\r\nimport { ICuiDevelopmentTool, ICuiDevelopmentToolFactory } from \"./interfaces\";\r\n\r\nexport class CuiConsoleDevToolFactory implements ICuiDevelopmentToolFactory {\r\n    get(name: string): ICuiDevelopmentTool {\r\n        return new CuiConsoleDevelopementTool(name);\r\n    }\r\n\r\n}\r\n\r\nexport class CuiDevtoolFactory {\r\n    static get(name: string): ICuiDevelopmentTool {\r\n        if (!STATICS.devTool) {\r\n            STATICS.devTool = new CuiConsoleDevToolFactory();\r\n        }\r\n        return STATICS.devTool.get(name);\r\n    }\r\n}","import { RegisterElementError } from \"../models/errors\";\r\nimport { ICuiComponent, CuiHTMLElement } from \"../models/interfaces\";\r\nimport { CuiUtils } from \"../models/utils\";\r\nimport { generateCUID, are, enumerateObject, parseAttribute } from \"../utils/functions\";\r\nimport { CUID_ATTRIBUTE } from \"../utils/statics\";\r\n\r\nexport function getMatchingComponents(node: any, components: ICuiComponent[]): ICuiComponent[] {\r\n    return components.filter(component => {\r\n        return node.hasAttribute && node.hasAttribute(component.attribute);\r\n    })\r\n}\r\n\r\nexport async function createCuiElement(node: any, components: ICuiComponent[], utils: CuiUtils): Promise<boolean> {\r\n    if (!are(node, components, utils)) {\r\n        return false;\r\n    }\r\n    let element = node as CuiHTMLElement;\r\n    if (!element.$cuid) {\r\n        element.$cuid = node.hasAttribute(CUID_ATTRIBUTE) ? node.getAttribute(CUID_ATTRIBUTE) : generateCUID(node.tagName);\r\n        node.setAttribute(CUID_ATTRIBUTE, element.$cuid);\r\n    }\r\n    for (let component of components) {\r\n        await createComponent(element, component, utils, parseAttribute(element, component.attribute))\r\n    }\r\n    return true;\r\n}\r\n\r\nexport async function destroyCuiElement(node: any): Promise<boolean> {\r\n    const element = node as CuiHTMLElement;\r\n    if (!element.$handlers) {\r\n        return false;\r\n    }\r\n    for (let name in element.$handlers) {\r\n        await destroyComponent(element, name);\r\n    }\r\n\r\n    return true;\r\n}\r\n\r\nexport function addCuiArgument<T extends object>(element: HTMLElement, cuiArg: string, args: T): boolean {\r\n    if (!are(cuiArg, args, element)) {\r\n        return false;\r\n    }\r\n    if (element.hasAttribute(cuiArg)) {\r\n        return false;\r\n    }\r\n    let argArr: string[] = [];\r\n    enumerateObject(args, (arg: string, value: string) => {\r\n        argArr.push(`${arg}: ${value}`);\r\n    })\r\n    element.setAttribute(cuiArg, argArr.join(\"; \"));\r\n    return true;\r\n\r\n}\r\n\r\nexport async function createComponent(node: CuiHTMLElement, component: ICuiComponent, utils: CuiUtils, args?: any): Promise<boolean> {\r\n    if (!node.$handlers) {\r\n        node.$handlers = {};\r\n    }\r\n    // If handler already exists - ignore\r\n    if (node.$handlers[component.attribute]) {\r\n        return false;\r\n    }\r\n    try {\r\n        let handler = component.get(node, utils);\r\n        node.$handlers[component.attribute] = handler;\r\n        await node.$handlers[component.attribute].handle(args);\r\n    } catch (e) {\r\n        throw new RegisterElementError(`An error occured during [${component.attribute}] initialization: ${e.message}`);\r\n    }\r\n    return true;\r\n}\r\n\r\nexport async function updateComponent(node: CuiHTMLElement, component: string, args?: any): Promise<boolean> {\r\n    if (!node || !node.$handlers) {\r\n        return false;\r\n    }\r\n\r\n    let handler = node.$handlers[component];\r\n    if (!handler) {\r\n        return false;\r\n    }\r\n    try {\r\n        if (handler.refresh)\r\n            await handler.refresh(args);\r\n    } catch (e) {\r\n        throw new RegisterElementError(`An error occured during [${component}] update: ${e.message}`);\r\n    }\r\n    return true;\r\n}\r\n\r\nasync function destroyComponent(node: CuiHTMLElement, component: string): Promise<boolean> {\r\n    if (!node || !node.$handlers) {\r\n        return false;\r\n    }\r\n\r\n    let handler = node.$handlers[component];\r\n    if (!handler) {\r\n        return false;\r\n    }\r\n    try {\r\n        await handler.destroy();\r\n    } catch (e) {\r\n        throw new RegisterElementError(`An error occured during [${component}] destroy: ${e.message}`);\r\n    }\r\n    return true;\r\n}","import { ICuiComponent, ICuiPluginManager, CuiHTMLElement } from \"../models/interfaces\";\r\nimport { is, are, joinAttributesForQuery, parseAttribute, measure } from \"../utils/functions\";\r\nimport { CuiUtils } from \"../models/utils\";\r\nimport { ICuiDevelopmentTool } from \"../development/interfaces\";\r\nimport { CuiDevtoolFactory } from \"../development/factory\";\r\nimport { createCuiElement, destroyCuiElement, getMatchingComponents, updateComponent } from \"../api/functions\";\r\n\r\nexport interface ICuiMutionObserver {\r\n    // setOptions(options: MutationObserverInit): ICuiMutionObserver;\r\n    setPlugins(plugins: ICuiPluginManager): ICuiMutionObserver;\r\n    setComponents(components: ICuiComponent[]): ICuiMutionObserver;\r\n    setAttributes(attributes: string[]): ICuiMutionObserver;\r\n    start(): ICuiMutionObserver;\r\n    stop(): ICuiMutionObserver;\r\n}\r\n\r\nexport interface ICuiComponentMutationObserver {\r\n    observe(): void;\r\n    unobserve(): void;\r\n    isObserving(): boolean;\r\n    onMutation(callback: (record: MutationRecord[]) => void): void;\r\n    disable(flag: boolean): void;\r\n    setSelector(selector: string): void;\r\n    setAttributes(attributes: string[]): void;\r\n}\r\n\r\n\r\nexport class CuiMutationObserver implements ICuiMutionObserver {\r\n    _log: ICuiDevelopmentTool;\r\n    #observer: MutationObserver | undefined;\r\n    #options: MutationObserverInit | undefined;\r\n    #element: HTMLElement;\r\n    plugins: ICuiPluginManager | undefined;\r\n    #components: ICuiComponent[];\r\n    #utils: CuiUtils;\r\n    #queryString: string;\r\n    constructor(element: HTMLElement, utils: CuiUtils) {\r\n        this.#observer = undefined;\r\n        this.plugins = undefined;\r\n        this.#options = undefined;\r\n        this.#element = element\r\n        this._log = CuiDevtoolFactory.get('CuiMutationObserver')\r\n        this.#components = [];\r\n        this.#utils = utils;\r\n        this.#queryString = \"\";\r\n\r\n    }\r\n\r\n    setPlugins(plugins: ICuiPluginManager): ICuiMutionObserver {\r\n        this.plugins = plugins;\r\n        return this;\r\n    }\r\n\r\n    setComponents(components: ICuiComponent[]): ICuiMutionObserver {\r\n        this.#components = components;\r\n        return this;\r\n    }\r\n\r\n    setAttributes(attributes: string[]): ICuiMutionObserver {\r\n        this.#options = {\r\n            attributes: true,\r\n            subtree: true,\r\n            childList: true,\r\n            attributeFilter: attributes\r\n        }\r\n        this.#queryString = joinAttributesForQuery(attributes);\r\n        return this;\r\n    }\r\n\r\n    start(): ICuiMutionObserver {\r\n        this._log.debug(\"Starting\")\r\n        if (!this.#options) {\r\n            this._log.error(\"Cannot start - options are not defined\")\r\n            return this;\r\n        }\r\n        this.#observer = new MutationObserver(this.mutationCallback.bind(this));\r\n        this.#observer.observe(this.#element, this.#options)\r\n        this._log.debug(\"Started\")\r\n        return this;\r\n    }\r\n\r\n    stop(): ICuiMutionObserver {\r\n        this._log.debug(\"Stopping\")\r\n        if (!this.#observer) {\r\n            this._log.debug(\"Observer not available\")\r\n            return this;\r\n        }\r\n        this.#observer.disconnect()\r\n        this.#observer = undefined;\r\n        this._log.debug(\"Stopped\")\r\n        return this;\r\n    }\r\n\r\n    private mutationCallback(mutations: MutationRecord[], observer: MutationObserver) {\r\n        mutations.forEach((mutation: MutationRecord) => {\r\n            switch (mutation.type) {\r\n                case 'attributes':\r\n                    const item = mutation.target as CuiHTMLElement;\r\n                    if (!are(mutation.attributeName, item)) {\r\n                        this._log.error(\"Mutation attribute doesn't not exisist\");\r\n                        break;\r\n                    }\r\n                    // @ts-ignore attribute is defined\r\n                    this.handeComponentUpdate(mutation.attributeName, item);\r\n                    break;\r\n\r\n                case 'childList':\r\n                    this.handleChildListMutation(mutation);\r\n                    break;\r\n            }\r\n            if (is(this.plugins)) {\r\n                // @ts-ignore plugins is defined here\r\n                this.plugins.onMutation(mutation).then(() => {\r\n                    //\r\n                })\r\n            }\r\n        })\r\n    }\r\n\r\n    private handeComponentUpdate(attributeName: string, item: CuiHTMLElement) {\r\n        let args = parseAttribute(item, attributeName);\r\n        updateComponent(item, attributeName, args)\r\n            .then((result) => {\r\n                this._log.debug(\"Component: \" + attributeName + \" updated with: \" + result, \"handeComponentUpdate\")\r\n            })\r\n            .catch((e) => {\r\n                this._log.exception(e);\r\n            })\r\n    }\r\n\r\n    private handleChildListMutation(mutation: MutationRecord) {\r\n        const addedLen = mutation.addedNodes.length;\r\n        const removedLen = mutation.removedNodes.length;\r\n        if (addedLen > 0) {\r\n            this._log.debug(\"Registering added nodes: \" + addedLen)\r\n            this.handleAddedNodes(mutation.addedNodes).then((result) => {\r\n                this._log.debug(\"Added nodes: \" + addedLen + \" with status: \" + result)\r\n            }).catch((e) => {\r\n                this._log.exception(e);\r\n            });\r\n        } else if (removedLen > 0) {\r\n            this._log.debug(\"Removing nodes: \" + removedLen);\r\n            this.handleRemovedNodes(mutation.removedNodes).then((result) => {\r\n                this._log.debug(\"Removed nodes: \" + removedLen + \" with status: \" + result)\r\n            }).catch((e) => {\r\n                this._log.exception(e);\r\n            });\r\n        }\r\n    }\r\n\r\n    private async handleAddedNodes(nodes: NodeList): Promise<boolean> {\r\n        for (let node of nodes) {\r\n            await this.handleAddedNode(node);\r\n            let element = node as Element\r\n            let children = element.hasChildNodes() ? element.querySelectorAll(this.#queryString) : null;\r\n            if (is(children)) {\r\n                // @ts-ignore children is defined\r\n                this._log.debug(\"Additional nodes to add: \" + children.length);\r\n                // @ts-ignore children is defined\r\n                await this.handleAddedChildren(children);\r\n            }\r\n        }\r\n        return true;\r\n    }\r\n\r\n\r\n    private async handleAddedChildren(nodes: NodeList): Promise<boolean[]> {\r\n        let result: boolean[] = [];\r\n        for (let node of nodes) {\r\n            result.push(await this.handleAddedNode(node));\r\n        }\r\n        return result;\r\n    }\r\n\r\n    private async handleAddedNode(node: any): Promise<boolean> {\r\n        let matchingComponents = getMatchingComponents(node, this.#components)\r\n        return createCuiElement(node, matchingComponents, this.#utils);\r\n    }\r\n\r\n    private async handleRemovedNodes(nodes: NodeList): Promise<boolean> {\r\n        for (let node of nodes) {\r\n            await destroyCuiElement(node);\r\n            let element = node as Element;\r\n            let children = node.hasChildNodes() ? element.querySelectorAll(this.#queryString) : null;\r\n            if (is(children)) {\r\n                // @ts-ignore children is defined\r\n                this._log.debug(\"Additional nodes to remove: \" + children.length)\r\n                // @ts-ignore children is defined\r\n                await this.handleDestroyChildren(children);\r\n            }\r\n\r\n        }\r\n        return true;\r\n    }\r\n\r\n    private async handleDestroyChildren(nodes: NodeList): Promise<boolean[]> {\r\n        let result = [];\r\n        for (let child of nodes) {\r\n            result.push(await destroyCuiElement(child));\r\n        }\r\n        return result;\r\n    }\r\n}\r\n\r\n\r\nexport class CuiComponentMutationHandler implements ICuiComponentMutationObserver {\r\n    #isObserving: boolean;\r\n    #observer: MutationObserver;\r\n    #element: Element;\r\n    #disabled: boolean;\r\n    #selector: string | undefined;\r\n    #options: MutationObserverInit = {\r\n        childList: true,\r\n        subtree: true,\r\n    }\r\n\r\n    #callback?: (record: MutationRecord[]) => void;\r\n    constructor(target: Element, selector?: string) {\r\n        this.#disabled = false;\r\n        this.#isObserving = false;\r\n        this.#element = target;\r\n        this.#selector = selector;\r\n        this.#callback = undefined;\r\n        this.#observer = new MutationObserver(this.mutationCallback.bind(this));\r\n    }\r\n\r\n    observe(): void {\r\n        if (!this.#isObserving && !this.#disabled) {\r\n            this.#observer.observe(this.#element, this.#options);\r\n            this.#isObserving = true;\r\n        }\r\n    }\r\n\r\n    unobserve(): void {\r\n        if (this.#isObserving) {\r\n            this.#observer.disconnect();\r\n            this.#isObserving = false;\r\n        }\r\n    }\r\n\r\n    setSelector(selector?: string) {\r\n        this.#selector = selector;\r\n    }\r\n\r\n    setAttributes(attributes: string[]) {\r\n        if (attributes && attributes.length > 0) {\r\n            this.#options = {\r\n                ...this.#options,\r\n                attributes: true,\r\n                attributeFilter: attributes\r\n            }\r\n        }\r\n        this.#options = {\r\n            childList: true,\r\n            subtree: true,\r\n        }\r\n\r\n        this.unobserve();\r\n    }\r\n\r\n    isObserving(): boolean {\r\n        return this.#isObserving;\r\n    }\r\n\r\n    disable(flag: boolean): void {\r\n        this.#disabled = flag;\r\n        if (this.#disabled) {\r\n            this.unobserve();\r\n        }\r\n    }\r\n\r\n    onMutation(callback: (record: MutationRecord[]) => void): void {\r\n        this.#callback = callback;\r\n    }\r\n\r\n    private mutationCallback(record: MutationRecord[]) {\r\n        let records: MutationRecord[] = record.reduce<MutationRecord[]>((result, record) => {\r\n            if (this.#selector && record.type === 'childList') {\r\n                if (this.matchesSelector(record)) {\r\n                    result.push(record)\r\n                }\r\n            } else {\r\n                result.push(record)\r\n            }\r\n            return result;\r\n        }, [])\r\n        if (this.#callback) {\r\n            this.#callback(records);\r\n        }\r\n    }\r\n\r\n    private matchesSelector(record: MutationRecord): boolean {\r\n        if (record.addedNodes.length > 0) {\r\n            return this.isAnyItemMatching([...record.addedNodes] as HTMLElement[]);\r\n        }\r\n        if (record.removedNodes.length > 0) {\r\n            return this.isAnyItemMatching([...record.removedNodes] as HTMLElement[]);\r\n        }\r\n        return false;\r\n    }\r\n\r\n    private isAnyItemMatching(array: HTMLElement[]): boolean {\r\n        //@ts-ignore\r\n        return (array.find((node) => (<HTMLElement>node).matches(this.#selector)) !== null);\r\n    }\r\n}","import { IUIInteractionProvider } from \"../models/interfaces\";\r\n\r\nexport class FastDom implements IUIInteractionProvider {\r\n    #writes: any[];\r\n    #reads: any[];\r\n    #raf: any;\r\n    #isScheduled: boolean = false;\r\n    #limit: number;\r\n    #reportCallback: ((e: Error) => void) | undefined;\r\n\r\n    constructor() {\r\n        this.#raf = window.requestAnimationFrame.bind(window)\r\n        this.#writes = []\r\n        this.#reads = []\r\n        this.#limit = 5;\r\n        this.#reportCallback = undefined;\r\n\r\n    }\r\n\r\n    onError(callback: (e: Error) => void) {\r\n        this.#reportCallback = callback;\r\n    }\r\n\r\n    mutate(callback: any, ctx: any, ...args: any[]): void {\r\n        this.#reads.push(this.createTask(callback, ctx, ...args))\r\n        this.schedule()\r\n    }\r\n\r\n    fetch(callback: any, ctx: any, ...args: any[]): void {\r\n        this.#writes.push(this.createTask(callback, ctx, ...args))\r\n        this.schedule()\r\n    }\r\n\r\n    private createTask(callback: any, ctx: any, ...args: any[]): any {\r\n        return ctx || args ? callback.bind(ctx, ...args) : callback;\r\n    }\r\n\r\n    private run(tasks: any[]) {\r\n        let task = null\r\n        while (task = tasks.shift()) {\r\n            task()\r\n        }\r\n    }\r\n\r\n    private schedule(recursion?: number) {\r\n        if (!this.#isScheduled) {\r\n            this.#isScheduled = true;\r\n            if (recursion && recursion >= this.#limit) {\r\n                throw new Error(\"Fast Dom limit reached\")\r\n            } else {\r\n                this.#raf(this.flush.bind(this, recursion));\r\n            }\r\n\r\n        }\r\n    }\r\n\r\n    private flush(recursion?: number) {\r\n        let rec: number = recursion ?? 0;\r\n        let error = null;\r\n        let writes = this.#writes;\r\n        let reads = this.#reads;\r\n\r\n        try {\r\n            this.run(reads);\r\n            this.run(writes);\r\n        } catch (e) {\r\n            if (this.#reportCallback) {\r\n                this.#reportCallback(e);\r\n            } else {\r\n                console.error(`An error has been captured in interactions: ${e.message}`);\r\n                //console.error(e)\r\n            }\r\n            error = e\r\n        }\r\n        this.#isScheduled = false;\r\n        if (error || this.#writes.length || this.#reads.length) {\r\n            this.schedule(rec + 1);\r\n        }\r\n    }\r\n}\r\n\r\nexport class SyncInteractions implements IUIInteractionProvider {\r\n    tasks: any[];\r\n    raf: any;\r\n    isRunning: boolean = false;\r\n    constructor() {\r\n        this.tasks = [];\r\n        this.raf = window.requestAnimationFrame.bind(window)\r\n    }\r\n\r\n    mutate(callback: any, ctx: any, ...args: any[]): void {\r\n        this.tasks.push(this.createTask(callback, ctx, ...args))\r\n        this.schedule()\r\n    }\r\n\r\n    fetch(callback: any, ctx: any, ...args: any[]): void {\r\n        this.tasks.push(this.createTask(callback, ctx, ...args))\r\n        this.schedule()\r\n    }\r\n\r\n    private schedule() {\r\n        if (!this.isRunning) {\r\n            this.isRunning = true;\r\n            this.raf(this.flush.bind(this))\r\n        }\r\n    }\r\n\r\n    private flush() {\r\n        let task = null\r\n        while (task = this.tasks.shift()) {\r\n            try {\r\n                task()\r\n            }\r\n            catch (e) {\r\n            }\r\n        }\r\n        this.isRunning = false\r\n    }\r\n\r\n    private createTask(callback: any, ctx: any, ...args: any[]): any {\r\n        return ctx || args ? callback.bind(ctx, ...args) : callback;\r\n    }\r\n\r\n}","import { CuiQueueCompareCallback, CuiQueueErrorCallback, ICuiQueue, ICuiQueueAdapter } from \"./interfaces\";\r\n\r\nexport class CuiQueue<T> implements ICuiQueue<T> {\r\n    #items: T[];\r\n    #lock: boolean;\r\n    #adapter: ICuiQueueAdapter<T>;\r\n    #onError?: CuiQueueErrorCallback<T>;\r\n    #comparer?: CuiQueueCompareCallback<T>;\r\n\r\n    constructor(adapter: ICuiQueueAdapter<T>) {\r\n        this.#lock = false;\r\n        this.#items = [];\r\n        this.#adapter = adapter;\r\n        this.#comparer = undefined;\r\n        this.#onError = undefined;\r\n    }\r\n\r\n    add(item: T): void {\r\n        this.#items.push(item);\r\n        if (this.#lock) {\r\n            return;\r\n        }\r\n\r\n        this.#lock = true;\r\n        this.flush().then(() => {\r\n            this.#lock = false;\r\n        })\r\n    }\r\n\r\n    delete(item: T): T | undefined {\r\n        const index = this.#items.findIndex(_item => this.compare(_item, item));\r\n        if (index < 0) {\r\n            return undefined;\r\n        }\r\n        return this.#items.splice(index, 1)[0];\r\n    }\r\n\r\n    isLocked(): boolean {\r\n        return this.#lock;\r\n    }\r\n\r\n    setCompareCallback(callback: CuiQueueCompareCallback<T>) {\r\n        this.#comparer = callback;\r\n    }\r\n\r\n    onError(callback: CuiQueueErrorCallback<T>) {\r\n        this.#onError = callback;\r\n    }\r\n\r\n    private compare(item1: T, item2: T): boolean {\r\n        if (this.#comparer) {\r\n            return this.#comparer(item1, item2)\r\n        }\r\n        return Object.is(item1, item2);\r\n    }\r\n\r\n    private async flush(): Promise<boolean> {\r\n        const items = this.getItemsForFlush();\r\n        if (items.length === 0) {\r\n            return true;\r\n        }\r\n        try {\r\n            await this.#adapter.onFlush(items);\r\n        } catch (e) {\r\n            this.callError(e, items);\r\n        }\r\n\r\n        return this.flush();\r\n    }\r\n\r\n    private getItemsForFlush(): T[] {\r\n        if (this.#adapter.type === 'batch') {\r\n            let result = [...this.#items];\r\n            this.#items = []\r\n            return result;\r\n        }\r\n        const item = this.#items.shift();\r\n        if (item) {\r\n            return [item];\r\n        }\r\n        return [];\r\n    }\r\n\r\n    private callError(error: unknown, items?: T[]) {\r\n        if (this.#onError) {\r\n            this.#onError(error, items)\r\n        }\r\n    }\r\n}","import { CuiDevtoolFactory } from \"../development/factory\";\r\nimport { ICuiDevelopmentTool } from \"../development/interfaces\";\r\nimport { CuiQueueAdapterType, ICuiQueue, ICuiQueueAdapter } from \"../queue/interfaces\";\r\nimport { CuiQueue } from \"../queue/queue\";\r\nimport { is } from \"../utils/functions\";\r\nimport { ICuiCallbackExecutor, ICuiEventEmitHandler, CuiEventReceiver } from \"./interfaces\";\r\n\r\nexport interface EmitHandlerData {\r\n    events: CuiEventReceiver;\r\n    cuid: string | null;\r\n    args?: any;\r\n}\r\n\r\nexport class EmitHandler implements ICuiEventEmitHandler {\r\n    queue: ICuiQueue<EmitHandlerData>;\r\n    log: ICuiDevelopmentTool;\r\n    constructor(name: string, adapter: ICuiQueueAdapter<EmitHandlerData>) {\r\n        this.log = CuiDevtoolFactory.get(name);\r\n        this.queue = new CuiQueue<EmitHandlerData>(adapter);\r\n        this.queue.onError((e: unknown) => {\r\n            this.log.error(e as any, \"Flush\");\r\n        })\r\n    }\r\n\r\n    async handle(events: CuiEventReceiver, cuid: string, args?: any): Promise<boolean> {\r\n        if (!is(events)) {\r\n            this.log.warning(\"No events provided\")\r\n            return false;\r\n        }\r\n        this.queue.add({\r\n            events: events,\r\n            cuid: cuid,\r\n            args: args\r\n        })\r\n        return true;\r\n    }\r\n}\r\n\r\nexport class SimpleEventEmitHandlerAdapter implements ICuiQueueAdapter<EmitHandlerData> {\r\n    type?: CuiQueueAdapterType;\r\n    #executor: ICuiCallbackExecutor;\r\n    constructor(executor: ICuiCallbackExecutor) {\r\n        this.type = 'single';\r\n        this.#executor = executor;\r\n    }\r\n\r\n    async onFlush(items: EmitHandlerData[]): Promise<boolean> {\r\n        for (const task of items) {\r\n            for (let id in task.events) {\r\n                let event = task.events[id]\r\n                if (idMatches(task.cuid, event.$cuid))\r\n                    await this.#executor.execute(event.callback, task.args)\r\n            }\r\n        }\r\n        return true;\r\n    }\r\n}\r\n\r\nexport class TaskedEventEmitHandlerAdapter implements ICuiQueueAdapter<EmitHandlerData> {\r\n    type?: CuiQueueAdapterType;\r\n    #executor: ICuiCallbackExecutor;\r\n    constructor(executor: ICuiCallbackExecutor) {\r\n        this.type = 'single';\r\n        this.#executor = executor;\r\n    }\r\n\r\n    async onFlush(items: EmitHandlerData[]): Promise<boolean> {\r\n        for (const task of items) {\r\n            let promises: Promise<boolean>[] = []\r\n            for (let id in task.events) {\r\n                let event = task.events[id]\r\n                if (idMatches(task.cuid, event.$cuid))\r\n                    promises.push(this.#executor.execute(event.callback, task.args))\r\n            }\r\n            await Promise.all(promises);\r\n        }\r\n        return true;\r\n    }\r\n}\r\n\r\nexport class CuiEventEmitHandlerFactory {\r\n    static get(name: string, executor: ICuiCallbackExecutor): ICuiEventEmitHandler {\r\n        switch (name) {\r\n            case \"tasked\":\r\n                return new EmitHandler(\"TaskedEventEmitHandler\", new TaskedEventEmitHandlerAdapter(executor));\r\n            default:\r\n                return new EmitHandler(\"SimpleEventEmitHandler\", new SimpleEventEmitHandlerAdapter(executor));\r\n        }\r\n    }\r\n}\r\n\r\nfunction idMatches(emitId: string | null | undefined, handleId: string | null | undefined) {\r\n    return !is(emitId) || (is(emitId) && emitId == handleId);\r\n}","import { ICuiCallbackExecutor } from \"./interfaces\";\r\n\r\n\r\nexport class CuiCallbackExecutor implements ICuiCallbackExecutor {\r\n    async execute(callback: any, args?: any): Promise<boolean> {\r\n        try {\r\n            callback(args)\r\n            return true;\r\n        } catch (e) {\r\n\r\n        }\r\n\r\n        return false;\r\n    }\r\n}","import { CuiElement } from \"../models/interfaces\";\r\nimport { is, are, generateRandomString, enumerateObject } from \"../utils/functions\";\r\nimport { ArgumentError } from \"../models/errors\";\r\nimport { CuiEventEmitHandlerFactory } from \"./handlers\";\r\nimport { CuiCallbackExecutor } from \"./executors\";\r\nimport { CuiBusCallback, CuiBusExtStatistics, CuiEventObj, CuiEventReceiver, ICuiEventBus, ICuiEventBusQueueSetup, ICuiEventEmitHandler } from \"./interfaces\";\r\nimport { ICuiDevelopmentTool } from \"../development/interfaces\";\r\nimport { CuiDevtoolFactory } from \"../development/factory\";\r\n\r\ninterface ICuiBusMapping {\r\n    [name: string]: number;\r\n}\r\n\r\nexport class CuiEventBus implements ICuiEventBus {\r\n    #events: { [event: string]: CuiEventReceiver }\r\n    #log: ICuiDevelopmentTool;\r\n    #eventHandler: ICuiEventEmitHandler;\r\n    #name: string;\r\n    constructor(emitHandler: ICuiEventEmitHandler, name?: string) {\r\n        this.#events = {};\r\n        this.#eventHandler = emitHandler;\r\n        this.#name = name ?? \"CuiEventBus\"\r\n        this.#log = CuiDevtoolFactory.get(this.#name);\r\n    }\r\n\r\n    /**\r\n     * Attaches event to event bus\r\n     * \r\n     * @param {string} name - Event name\r\n     * @param {any} callback - callback function\r\n     * @param {CuiContext} ctx - callback context with id\r\n     * @param {CuiElement} cui - optional - cui element which event shall be attached to \r\n     */\r\n    on<T>(name: string, callback: CuiBusCallback<T>, cui?: CuiElement): string | null {\r\n        if (!are(name, callback)) {\r\n            throw new ArgumentError(\"Missing argument\")\r\n        }\r\n        // When context is not provided (e.g. anonymous function) then generate random\r\n        let id = this.#name + \"-\" + generateRandomString();\r\n\r\n\r\n        if (!this.#events[name]) {\r\n            this.#events[name] = {}\r\n        }\r\n        if (this.isAttached(this.#events[name], id, cui)) {\r\n            return null;\r\n        }\r\n        this.#log.debug(`Attaching new event: [${name}] for: [${id}]`)\r\n\r\n        this.#events[name][id] = { callback: callback, $cuid: this.getCuid(cui) }\r\n        return id;\r\n    }\r\n\r\n    /**\r\n    * Detaches specific event from event bus\r\n    *\r\n    * @param {string} name - Event name\r\n    * @param {CuiContext} ctx - callback context with id\r\n    * @param {CuiElement} cui - optional - cui element which event shall be attached to\r\n    */\r\n    detach(name: string, id: string): void {\r\n        if (!are(name, id)) {\r\n            throw new ArgumentError(\"Missing argument\")\r\n        }\r\n        let ev = this.#events[name]\r\n        this.#log.debug(`Detaching item: [${id}] from [${name}]`)\r\n        if (this.isAttached(ev, id)) {\r\n            delete ev[id];\r\n        }\r\n    }\r\n\r\n    /**\r\n    * Detaches all callbacks from event\r\n    *\r\n    * @param {string} name - Event name\r\n    */\r\n    detachAll(name: string): void {\r\n        if (is(name) && this.#events[name]) {\r\n            delete this.#events[name]\r\n        } else {\r\n            this.#log.error(`Event name is missing or incorrect`, \"detachAll\")\r\n        }\r\n    }\r\n\r\n    /**\r\n    * Emits event call to event bus\r\n    *\r\n    * @param {string} name - Event name\r\n    * @param {string} cuid - id of component which emits the event\r\n    * @param {any[]} args  - event arguments\r\n    */\r\n    async emit<T>(event: string, cuid: string | null, args?: T): Promise<boolean> {\r\n        if (!is(event)) {\r\n            throw new ArgumentError(\"Event name is incorrect\");\r\n        }\r\n\r\n        let callbacks = this.#events[event];\r\n        if (is(callbacks)) {\r\n            this.#log.debug(`Emit: [${event}]`)\r\n            await this.#eventHandler.handle(callbacks, cuid, args)\r\n        }\r\n        return true;\r\n    }\r\n\r\n    /**\r\n    * Checks whether given context is already attached to specific event\r\n    *\r\n    * @param {string} name - Event name\r\n    * @param {CuiContext} ctx - callback context with id\r\n    * @param {CuiElement} cui - optional - cui element which event shall be attached to\r\n    */\r\n    isSubscribing(name: string, id: string, cui?: CuiElement) {\r\n        let ev = this.#events[name]\r\n        return this.isAttached(ev, id, cui)\r\n    }\r\n\r\n    /**\r\n     * Detaches callbacks by component cuid - this is used to clean up attachments on component deletion\r\n     * @param {string} event - event name\r\n     * @param {string} cuid - cuid of the component\r\n     */\r\n    detachByCuid(event: string, cuid: string): void {\r\n        if (!are(event, cuid)) {\r\n            return;\r\n        }\r\n        let ev = this.#events[event];\r\n        if (!is(ev)) {\r\n            return;\r\n        }\r\n        enumerateObject({ ...ev }, (evId: string, evValue: CuiEventObj) => {\r\n            if (evValue.$cuid === cuid) {\r\n                delete ev[evId]\r\n            }\r\n        })\r\n    }\r\n\r\n    private isAttached(ev: CuiEventReceiver, id: string, cui?: CuiElement): boolean {\r\n        if (is(cui)) {\r\n            // @ts-ignore\r\n            return is(ev) && is(id) && is(ev[id]) && ev[id].$cuid == cui.$cuid;\r\n        }\r\n        return is(ev) && is(id) && is(ev[id]);\r\n    }\r\n\r\n    private getCuid(cui?: CuiElement) {\r\n        // @ts-ignore\r\n        return is(cui) ? cui.$cuid : null;\r\n    }\r\n\r\n\r\n}\r\n\r\n\r\nexport class CuiEventExtBus implements ICuiEventBus {\r\n    #events: { [event: string]: number };\r\n    #log: ICuiDevelopmentTool;\r\n    #buses: ICuiEventBus[];\r\n    #last: number;\r\n    constructor(setup: ICuiEventBusQueueSetup[]) {\r\n        this.#log = CuiDevtoolFactory.get(\"CuiEventBus\");\r\n        this.#buses = [];\r\n        this.#events = {};\r\n        this.#last = 0;\r\n        if (is(setup)) {\r\n            this.#log.debug(\"Initiating buses\")\r\n            let sorted = setup.length === 1 ? setup : setup.sort((first, second) => {\r\n                return first.priority - second.priority\r\n            })\r\n            sorted.forEach((item, index) => {\r\n                this.#buses.push(this.initBusInstance(item.name, item.handler))\r\n                this.#events = {\r\n                    ...this.#events,\r\n                    ...this.mapEvents(item.eventsDef, index),\r\n                }\r\n                this.#log.debug(`Bus ${item.name} has been initialized with number: ${index}`)\r\n            })\r\n\r\n            this.#buses.push(this.initBusInstance(\"DefaultEventBus\", 'tasked'))\r\n            this.#last = this.#buses.length - 1;\r\n            this.#log.debug(`Bus initialization finished`);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Attaches event to event bus\r\n     * \r\n     * @param {string} name - Event name\r\n     * @param {any} callback - callback function\r\n     * @param {CuiContext} ctx - callback context with id\r\n     * @param {CuiElement} cui - optional - cui element which event shall be attached to \r\n     */\r\n    on<T>(name: string, callback: CuiBusCallback<T>, cui?: CuiElement): string | null {\r\n\r\n        if (!are(name, callback)) {\r\n            throw new ArgumentError(\"Missing argument\")\r\n        }\r\n        return this.get(name).on(name, callback, cui);\r\n    }\r\n\r\n    /**\r\n    * Detaches specific event from event bus\r\n    *\r\n    * @param {string} name - Event name\r\n    * @param {CuiContext} ctx - callback context with id\r\n    * @param {CuiElement} cui - optional - cui element which event shall be attached to\r\n    */\r\n    detach(name: string, id: string, cui?: CuiElement): void {\r\n        if (!are(name, id)) {\r\n            throw new ArgumentError(\"Missing argument\")\r\n        }\r\n        this.get(name).detach(name, id, cui);\r\n    }\r\n\r\n    /**\r\n    * Detaches all callbacks from event\r\n    *\r\n    * @param {string} name - Event name\r\n    */\r\n    detachAll(name: string): void {\r\n        this.get(name).detachAll(name);\r\n    }\r\n\r\n    /**\r\n    * Emits event call to event bus\r\n    *\r\n    * @param {string} name - Event name\r\n    * @param {string} cuid - id of component which emits the event\r\n    * @param {any[]} args  - event arguments\r\n    */\r\n    async emit<T>(event: string, cuid: string | null, args?: T): Promise<boolean> {\r\n        if (!is(event)) {\r\n            throw new ArgumentError(\"Event name is incorrect\");\r\n        }\r\n        return this.get(event).emit(event, cuid, args);\r\n    }\r\n\r\n    /**\r\n    * Checks whether given context is already attached to specific event\r\n    *\r\n    * @param {string} name - Event name\r\n    * @param {CuiContext} ctx - callback context with id\r\n    * @param {CuiElement} cui - optional - cui element which event shall be attached to\r\n    */\r\n    isSubscribing(name: string, id: string, cui?: CuiElement) {\r\n        return this.get(name).isSubscribing(name, id, cui);\r\n    }\r\n\r\n    /**\r\n    * Detaches callbacks by component cuid - this is used to clean up attachments on component deletion\r\n    * @param {string} event - event name\r\n    * @param {string} cuid - cuid of the component\r\n    */\r\n    detachByCuid(event: string, cuid: string): void {\r\n        if (!are(event, cuid)) {\r\n            return\r\n        }\r\n        this.get(event).detachByCuid(event, cuid);\r\n    }\r\n\r\n\r\n    /**\r\n     * Creates and initializes event bus instance\r\n     * @param busName Event bus name for logger\r\n     * @param handlerName handler name to create proper handler instance\r\n     */\r\n    private initBusInstance(busName: string, handlerName: string): ICuiEventBus {\r\n        if (!are(busName, handlerName)) {\r\n            throw new ArgumentError(\"Bus name or handler name is incorrect\");\r\n        }\r\n        let executor = new CuiCallbackExecutor();\r\n        let handler = CuiEventEmitHandlerFactory.get(handlerName, executor);\r\n        return new CuiEventBus(handler, busName);\r\n    }\r\n\r\n    /**\r\n     * Creates mapping object from events array\r\n     * @param events events array\r\n     * @param index queue number\r\n     */\r\n    private mapEvents(events: string[], index: number): ICuiBusMapping {\r\n        return events.reduce((result: ICuiBusMapping, current: string) => {\r\n            if (!result[current]) {\r\n                return {\r\n                    ...result,\r\n                    [current]: index\r\n                }\r\n            }\r\n            return result;\r\n        }, {})\r\n    }\r\n\r\n    /**\r\n     * Retrives porper event bus based on event name\r\n     * @param event \r\n     */\r\n    private get(event: string): ICuiEventBus {\r\n        let idx = this.#events[event];\r\n        return this.#buses[idx ?? this.#last];\r\n    }\r\n}\r\n\r\nexport class CuiEventBusFactory {\r\n    static get(setup?: ICuiEventBusQueueSetup[]): ICuiEventBus {\r\n        //@ts-ignore - setup is underfined check is perfromed\r\n        return is(setup) ? new CuiEventExtBus(setup) : new CuiEventBus(CuiEventEmitHandlerFactory.get('tasked', new CuiCallbackExecutor()));\r\n    }\r\n}\r\n\r\nexport class CuiBusExtStatisticsHandler {\r\n    #isOn: boolean;\r\n    #statistics: CuiBusExtStatistics;\r\n    constructor(gather: boolean, queueCount: number) {\r\n        this.#isOn = gather;\r\n        this.#statistics = {\r\n            queueCount: queueCount,\r\n            events: {}\r\n        }\r\n    }\r\n\r\n    addEvent(event: string, queueNumber: number, emitCount?: number) {\r\n        this.#statistics.events[event] = {\r\n            name: event,\r\n            queueNumber: queueNumber,\r\n            emits: emitCount ?? 0\r\n        }\r\n    }\r\n\r\n    addQueue() {\r\n        this.#statistics.queueCount += 1;\r\n    }\r\n\r\n    addEmit(event: string, queueNumber?: number) {\r\n        if (!this.#isOn) {\r\n            return;\r\n        }\r\n\r\n        if (this.#statistics.events[event]) {\r\n            this.#statistics.events[event].emits += 1;\r\n        } else {\r\n            this.addEvent(event, queueNumber ?? -1, 1);\r\n        }\r\n\r\n    }\r\n\r\n    getStatistics(): CuiBusExtStatistics {\r\n        return this.#statistics;\r\n    }\r\n\r\n}","import { is } from \"../utils/functions\";\r\nimport { IUIInteractionProvider } from \"../models/interfaces\";\r\n\r\nexport interface ICuiDocumentStyleAppender {\r\n    append(style: string): boolean;\r\n}\r\n\r\nexport class CuiDocumentStyleAppender implements ICuiDocumentStyleAppender {\r\n    constructor(interactions: IUIInteractionProvider) {\r\n    }\r\n\r\n    append(style: string): boolean {\r\n        if (is(style)) {\r\n            const head = document.head || document.getElementsByTagName('head')[0]\r\n            const node = document.createElement('style');\r\n            const text = document.createTextNode(style);\r\n            // node.type = 'text/css';\r\n            node.appendChild(text);\r\n            head.appendChild(node);\r\n        }\r\n        return true;\r\n    }\r\n\r\n}","import { IUIInteractionProvider } from \"./interfaces\";\r\nimport { CuiSetup, CuiSetupInit } from \"./setup\";\r\nimport { CuiLightMode } from \"../utils/types\";\r\nimport { CuiInteractionsFactory } from \"../factories/interactions\";\r\nimport { CuiEventBusFactory } from \"../bus/bus\";\r\nimport { are, getName, is, replacePrefix } from \"../utils/functions\";\r\nimport { CLASSES } from \"../utils/statics\";\r\nimport { ICuiDocumentStyleAppender, CuiDocumentStyleAppender } from \"../styles/appender\";\r\n//import { CuiInstanceColorHandler } from \"../handlers/colors\";\r\nimport { CSSVariableError } from \"./errors\";\r\nimport { ICuiEventBus } from \"../bus/interfaces\";\r\n\r\nexport class CuiUtils {\r\n    interactions: IUIInteractionProvider;\r\n    bus: ICuiEventBus;\r\n    setup: CuiSetup;\r\n    // cache: ICuiManager<CuiCachable>;\r\n    // colors: CuiInstanceColorHandler;\r\n    styleAppender: ICuiDocumentStyleAppender;\r\n    #plugins: string[];\r\n    constructor(initialSetup: CuiSetupInit, plugins?: string[]) {\r\n        this.setup = new CuiSetup().fromInit(initialSetup);\r\n        this.interactions = CuiInteractionsFactory.get(initialSetup.interaction, this.onInteractionError.bind(this));\r\n        // this.cache = new CuiCacheManager(this.setup.cacheSize);\r\n        this.bus = CuiEventBusFactory.get(initialSetup.busSetup);\r\n        // this.colors = new CuiInstanceColorHandler(this.interactions);\r\n\r\n        this.styleAppender = new CuiDocumentStyleAppender(this.interactions);\r\n        this.#plugins = plugins ?? [];\r\n    }\r\n\r\n    setLightMode(mode: CuiLightMode) {\r\n        const name: string = getName(this.setup.prefix, CLASSES.dark);\r\n        const classes = document.body.classList;\r\n        if (mode === 'dark' && !classes.contains(name)) {\r\n            this.interactions.mutate(() => {\r\n                classes.add(name);\r\n            }, this)\r\n\r\n        } else if (mode === 'light' && classes.contains(name)) {\r\n            this.interactions.mutate(() => {\r\n                classes.remove(name);\r\n            }, this)\r\n        }\r\n    }\r\n\r\n    getLightMode(): CuiLightMode {\r\n        const name: string = getName(this.setup.prefix, CLASSES.dark);\r\n        return document.body.classList.contains(name) ? 'dark' : 'light';\r\n    }\r\n\r\n    setPrintMode(flag: boolean) {\r\n        const name: string = getName(this.setup.prefix, CLASSES.print);\r\n        const classes = document.body.classList;\r\n        if (flag && !classes.contains(name)) {\r\n            classes.add(name);\r\n\r\n        } else if (!flag && classes.contains(name)) {\r\n            classes.remove(name);\r\n        }\r\n    }\r\n\r\n    isPrintMode(): boolean {\r\n        const name: string = getName(this.setup.prefix, CLASSES.print);\r\n        return document.body.classList.contains(name);\r\n    }\r\n\r\n    setProperty(name: string, value: string) {\r\n        if (!are(name, value)) {\r\n            throw new CSSVariableError(\"Property or value was not provided\");\r\n        }\r\n        let prop = replacePrefix(name, this.setup.prefix);\r\n        this.interactions.mutate(() => {\r\n            document.documentElement.style.setProperty(prop, value);\r\n        }, null)\r\n\r\n    }\r\n\r\n    isPlugin(name: string) {\r\n        return is(name) && this.#plugins.find(plugin => plugin === name);\r\n    }\r\n\r\n    private onInteractionError(e: Error) {\r\n        console.error(\"An error has been captured from interactions\");\r\n        console.error(e);\r\n    }\r\n}","import { IUIInteractionProvider } from \"../models/interfaces\";\r\nimport { CuiInteractionsType } from \"../utils/types\";\r\nimport { FastDom, SyncInteractions } from \"../utils/interactions\";\r\n\r\nexport class CuiInteractionsFactory {\r\n    /**\r\n     * Gets new instance of component focused logger\r\n     * @param type - Interactions type\r\n     */\r\n    public static get(type: CuiInteractionsType, errorReport?: (e: Error) => void): IUIInteractionProvider {\r\n        const interactionType = type;\r\n        switch (interactionType) {\r\n            case 'async':\r\n                const fastDom = new FastDom();\r\n                if (errorReport)\r\n                    fastDom.onError(errorReport);\r\n                return fastDom;\r\n            default:\r\n                return new SyncInteractions();\r\n        }\r\n    }\r\n}","import { IUIInteractionProvider } from \"../models/interfaces\";\r\nimport { ICuiComponentAction } from \"../utils/actions\";\r\nimport { CLASSES } from \"../utils/statics\";\r\nimport { is } from \"../utils/functions\";\r\n\r\nexport class CuiActionsHelper {\r\n    #interactions: IUIInteractionProvider;\r\n    constructor(interactions: IUIInteractionProvider) {\r\n        this.#interactions = interactions;\r\n    }\r\n\r\n    async performAction(target: Element, action: ICuiComponentAction, timeout: number, callback?: () => void): Promise<boolean> {\r\n        return new Promise((resolve) => {\r\n            this.#interactions.mutate(() => {\r\n                action.add(target);\r\n                target.classList.add(CLASSES.animProgress);\r\n                setTimeout(() => {\r\n                    this.#interactions.mutate(() => {\r\n                        action.remove(target);\r\n                        target.classList.remove(CLASSES.animProgress);\r\n                        if (callback)\r\n                            callback();\r\n                        resolve(true)\r\n                    }, null)\r\n                }, timeout)\r\n            }, null)\r\n        })\r\n    }\r\n\r\n    async performActions(target: Element, actions: ICuiComponentAction[], timeout: number, callback?: () => void): Promise<boolean> {\r\n        return new Promise((resolve) => {\r\n            this.#interactions.mutate(() => {\r\n                actions.forEach(x => x.add(target));\r\n                target.classList.add(CLASSES.animProgress);\r\n                setTimeout(() => {\r\n                    this.#interactions.mutate(() => {\r\n                        actions.forEach(x => x.remove(target));\r\n                        target.classList.remove(CLASSES.animProgress);\r\n                        if (callback)\r\n                            callback();\r\n                        resolve(true)\r\n                    }, null)\r\n                }, timeout)\r\n            }, null)\r\n        })\r\n    }\r\n\r\n    async performSwitchAction(inTarget: Element, outTarget: Element | null, inAction: ICuiComponentAction[], outAction: ICuiComponentAction[], onFinish: () => void, timeout: number): Promise<boolean> {\r\n        return new Promise((resolve) => {\r\n            this.#interactions.mutate(() => {\r\n                inAction.forEach(x => x.add(inTarget));\r\n                inTarget.classList.add(CLASSES.animProgress);\r\n                if (is(outTarget)) {\r\n                    //@ts-ignore\r\n                    outAction.forEach(x => x.add(outTarget));\r\n                    //@ts-ignore\r\n                    outTarget.classList.add(CLASSES.animProgress);\r\n                }\r\n                setTimeout(() => {\r\n                    this.#interactions.mutate(() => {\r\n                        inAction.forEach(x => x.remove(inTarget));\r\n                        inTarget.classList.remove(CLASSES.animProgress);\r\n                        if (is(outTarget)) {\r\n                            //@ts-ignore\r\n                            outAction.forEach(x => x.remove(outTarget));\r\n                            //@ts-ignore\r\n                            outTarget.classList.remove(CLASSES.animProgress);\r\n                        }\r\n                        onFinish();\r\n                        resolve(true)\r\n                    }, null)\r\n                }, timeout)\r\n            }, null)\r\n        })\r\n    }\r\n}","import { is, are, splitColon } from \"./functions\";\r\nimport { CuiUtils } from \"../models/utils\";\r\n\r\nexport interface ICuiComponentAction {\r\n    add(element: Element, utils?: CuiUtils): void;\r\n    remove(element: Element, utils?: CuiUtils): void;\r\n    toggle(element: Element, utils?: CuiUtils): void;\r\n}\r\n\r\nexport class CuiClassAction implements ICuiComponentAction {\r\n    #class: string;\r\n\r\n    constructor(className: string) {\r\n        this.#class = className;\r\n    }\r\n\r\n    add(element: Element, utils?: CuiUtils): void {\r\n        if (are(element, this.#class) && !element.classList.contains(this.#class)) {\r\n            element.classList.add(this.#class);\r\n        }\r\n    }\r\n\r\n    remove(element: Element, utils?: CuiUtils): void {\r\n        if (are(element, this.#class) && element.classList.contains(this.#class)) {\r\n            element.classList.remove(this.#class);\r\n        }\r\n    }\r\n\r\n    toggle(element: Element, utils?: CuiUtils): void {\r\n        if (are(element, this.#class)) {\r\n            if (element.classList.contains(this.#class)) {\r\n                element.classList.remove(this.#class);\r\n            } else {\r\n                element.classList.add(this.#class);\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nexport class CuiInboundAction implements ICuiComponentAction {\r\n    #name: string;\r\n\r\n    constructor(name: string) {\r\n        this.#name = name;\r\n    }\r\n    add(element: Element, utils?: CuiUtils): void {\r\n        if (!utils) {\r\n            return;\r\n        }\r\n        switch (this.#name) {\r\n            case 'dark-mode':\r\n                utils.setLightMode('dark')\r\n                break;\r\n            case 'light-mode':\r\n                utils.setLightMode('light')\r\n                break;\r\n        }\r\n    }\r\n\r\n    remove(element: Element, utils?: CuiUtils): void {\r\n        if (!utils) {\r\n            return;\r\n        }\r\n        switch (this.#name) {\r\n            case 'dark-mode':\r\n                utils.setLightMode('light')\r\n                break;\r\n            case 'light-mode':\r\n                utils.setLightMode('dark')\r\n                break;\r\n        }\r\n    }\r\n\r\n    toggle(element: Element, utils?: CuiUtils): void {\r\n        if (!utils) {\r\n            return;\r\n        }\r\n        switch (this.#name) {\r\n            case 'dark-mode':\r\n                this.setDarkMode(utils)\r\n                break;\r\n            case 'light-mode':\r\n                this.setDarkMode(utils)\r\n                break;\r\n        }\r\n    }\r\n\r\n    private setDarkMode(utils: CuiUtils) {\r\n        if (utils.getLightMode() === 'dark') {\r\n            utils.setLightMode('light')\r\n        } else {\r\n            utils.setLightMode('dark')\r\n        }\r\n    }\r\n}\r\n\r\nexport class AttributeAction implements ICuiComponentAction {\r\n    #attributeName: string;\r\n    #attributeValue: string;\r\n    constructor(attribute: string) {\r\n        [this.#attributeName, this.#attributeValue] = splitColon(attribute);// attribute.split(',')\r\n    }\r\n\r\n    add(element: Element, utils?: CuiUtils): void {\r\n        if (!are(element, this.#attributeName, this.#attributeValue)) {\r\n            return;\r\n        }\r\n        element.setAttribute(this.#attributeName, this.#attributeValue)\r\n    }\r\n\r\n    remove(element: Element, utils?: CuiUtils): void {\r\n        if (!are(element, this.#attributeName, this.#attributeValue)) {\r\n            return;\r\n        }\r\n        if (element.hasAttribute(this.#attributeName)) {\r\n            element.removeAttribute(this.#attributeName)\r\n        }\r\n\r\n    }\r\n\r\n    toggle(element: Element, utils?: CuiUtils): void {\r\n        if (!are(element, this.#attributeName, this.#attributeValue)) {\r\n            return;\r\n        }\r\n        if (element.hasAttribute(this.#attributeName)) {\r\n            element.removeAttribute(this.#attributeName)\r\n        } else {\r\n            element.setAttribute(this.#attributeName, this.#attributeValue)\r\n        }\r\n    }\r\n}\r\n\r\n\r\nexport class StyleAction implements ICuiComponentAction {\r\n    #attributeName: string;\r\n    #attributeValue: string;\r\n    constructor(attribute: string) {\r\n        [this.#attributeName, this.#attributeValue] = splitColon(attribute);\r\n    }\r\n\r\n    add(element: Element, utils?: CuiUtils): void {\r\n        if (!are(element, this.#attributeName, this.#attributeValue)) {\r\n            return;\r\n        }\r\n        let el = element as any;\r\n        if (el.style && !el.style[this.#attributeName]) {\r\n            el.style[this.#attributeName] = this.#attributeValue;\r\n        }\r\n\r\n    }\r\n\r\n    remove(element: Element, utils?: CuiUtils): void {\r\n        if (!are(element, this.#attributeName, this.#attributeValue)) {\r\n            return;\r\n        }\r\n        let el = element as any;\r\n        if (el.style && el.style[this.#attributeName]) {\r\n            el.style[this.#attributeName] = \"\";\r\n        }\r\n\r\n    }\r\n\r\n    toggle(element: Element, utils?: CuiUtils): void {\r\n        if (!are(element, this.#attributeName, this.#attributeValue)) {\r\n            return;\r\n        }\r\n        let el = element as any;\r\n        if (!el.style) {\r\n            return;\r\n        }\r\n        if (!el.style[this.#attributeName]) {\r\n            el.style[this.#attributeName] = this.#attributeValue;\r\n        } else {\r\n            delete el.style[this.#attributeName];\r\n        }\r\n    }\r\n}\r\n\r\nexport class DummyAction implements ICuiComponentAction {\r\n    constructor() {\r\n    }\r\n\r\n    add(element: Element, utils?: CuiUtils): void {\r\n\r\n    }\r\n\r\n    remove(element: Element, utils?: CuiUtils): void {\r\n    }\r\n\r\n    toggle(element: Element, utils?: CuiUtils): void {\r\n    }\r\n}\r\n\r\nexport class CuiActionsFatory {\r\n    public static get(value: string): ICuiComponentAction {\r\n        if (!is(value)) {\r\n            return new DummyAction();\r\n        }\r\n        let indicator = value[0];\r\n        switch (indicator) {\r\n            case '.':\r\n                return new CuiClassAction(value.substring(1));\r\n            case '~':\r\n                return new CuiInboundAction(value.substring(1));\r\n            case \"&\":\r\n                return new AttributeAction(value.substring(1));\r\n            case \"^\":\r\n                return new StyleAction(value.substring(1));\r\n            default:\r\n                return new CuiClassAction(value);\r\n        }\r\n    }\r\n}\r\n\r\nexport class CuiActionsListFactory {\r\n    public static get(value: string): ICuiComponentAction[] {\r\n        if (!is(value)) {\r\n            return [];\r\n        }\r\n        const split = value.split(',');\r\n        return split.map(single => {\r\n            return CuiActionsFatory.get(single.trim());\r\n        })\r\n    }\r\n}","import { is, are } from \"../../core/utils/functions\";\r\nimport { CuiCachable, CuiElement } from \"../../core/models/interfaces\";\r\nimport { CLASSES } from \"../../core/utils/statics\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiActionsHelper } from \"../../core/helpers/helpers\";\r\nimport { CuiActionsFatory, CuiClassAction } from \"../../core/utils/actions\";\r\nimport { ICuiDevelopmentTool } from \"../../core/development/interfaces\";\r\nimport { CuiDevtoolFactory } from \"../../core/development/factory\";\r\n\r\nexport class ElementManager implements CuiCachable {\r\n    #elements: Element[];\r\n    #isLocked: boolean;\r\n    #logger: ICuiDevelopmentTool;\r\n    #cDt: number;\r\n    #utils: CuiUtils;\r\n    #actionsHelper: CuiActionsHelper;\r\n    constructor(elements: Element[], utils: CuiUtils) {\r\n        this.#elements = elements;\r\n        this.#isLocked = false;\r\n        this.#logger = CuiDevtoolFactory.get(\"ElementManager\");\r\n        this.#utils = utils;\r\n        this.#cDt = Date.now();\r\n        this.#actionsHelper = new CuiActionsHelper(utils.interactions);\r\n    }\r\n\r\n    async toggleClass(className: string): Promise<boolean> {\r\n        if (!is(className)) {\r\n            return false;\r\n        }\r\n        return this.call((element) => {\r\n            if (!element.classList.contains(className)) {\r\n                element.classList.add(className);\r\n            } else {\r\n                element.classList.remove(className);\r\n            }\r\n        }, 'toggleClass');\r\n    }\r\n\r\n    async toggleClassAs(className: string): Promise<boolean> {\r\n        if (!is(className)) {\r\n            return false;\r\n        }\r\n        return this.call((element) => {\r\n            let classes = element.classList;\r\n            this.#utils.interactions.fetch(() => {\r\n                if (!classes.contains(className)) {\r\n                    this.#utils.interactions.mutate(classes.add, classes, className);\r\n                } else {\r\n                    this.#utils.interactions.mutate(classes.remove, classes, className);\r\n                }\r\n            }, this)\r\n\r\n        }, 'toggleClassAs');\r\n    }\r\n\r\n    async setClass(className: string): Promise<boolean> {\r\n        if (!is(className)) {\r\n            return false;\r\n        }\r\n        return this.call((element) => {\r\n            if (!element.classList.contains(className)) {\r\n                element.classList.add(className)\r\n            }\r\n        }, 'setClass');\r\n    }\r\n\r\n    async setClassAs(className: string): Promise<boolean> {\r\n        if (!is(className)) {\r\n            return false;\r\n        }\r\n\r\n        return this.call((element) => {\r\n            let classes = element.classList;\r\n            this.#utils.interactions.fetch(() => {\r\n                if (!classes.contains(className)) {\r\n                    this.#utils.interactions.mutate(classes.add, classes, className);\r\n                }\r\n            }, this)\r\n\r\n        }, 'setClassAs');\r\n    }\r\n\r\n    async removeClass(className: string): Promise<boolean> {\r\n        if (!is(className)) {\r\n            return false;\r\n        }\r\n        return this.call((element) => {\r\n            if (element.classList.contains(className)) {\r\n                element.classList.remove(className)\r\n            }\r\n        }, 'removeClass');\r\n    }\r\n\r\n    async removeClassAs(className: string): Promise<boolean> {\r\n        if (!is(className)) {\r\n            return false;\r\n        }\r\n        return this.call((element) => {\r\n            let classes = element.classList;\r\n            this.#utils.interactions.fetch(() => {\r\n                if (classes.contains(className)) {\r\n                    this.#utils.interactions.mutate(classes.remove, classes, className);\r\n                }\r\n            }, this)\r\n        }, 'removeClass');\r\n    }\r\n\r\n    getAttribute(attributeName: string): string[] {\r\n        if (!is(attributeName)) {\r\n            return [];\r\n        }\r\n        return this.#elements.reduce<string[]>((val: string[], current: Element) => {\r\n            let attr = current.getAttribute(attributeName);\r\n            if (attr != null) {\r\n                val.push(attr)\r\n            }\r\n            return val;\r\n        }, []);\r\n    }\r\n\r\n    async setAttribute(attributeName: string, attributeValue?: string): Promise<boolean> {\r\n        if (!is(attributeName)) {\r\n            return false;\r\n        }\r\n        return this.call((element) => {\r\n            element.setAttribute(attributeName, attributeValue ?? \"\")\r\n        }, 'setAttribute');\r\n    }\r\n\r\n    async setAttributeAs(attributeName: string, attributeValue?: string): Promise<boolean> {\r\n        if (!is(attributeName)) {\r\n            return false;\r\n        }\r\n        return this.call((element) => {\r\n            this.#utils.interactions.mutate(element.setAttribute, element, attributeName, attributeValue ?? \"\")\r\n        }, 'setAttributeAs');\r\n    }\r\n\r\n    async removeAttribute(attributeName: string): Promise<boolean> {\r\n        if (!is(attributeName)) {\r\n            return false;\r\n        }\r\n        return this.call((element) => {\r\n            element.removeAttribute(attributeName)\r\n        }, 'removeAttribute');\r\n    }\r\n\r\n    async removeAttributeAs(attributeName: string): Promise<boolean> {\r\n        if (!is(attributeName)) {\r\n            return false;\r\n        }\r\n        return this.call((element) => {\r\n            this.#utils.interactions.mutate(element.removeAttribute, element, attributeName);\r\n        }, 'removeAttributeAs');\r\n    }\r\n\r\n    async toggleAttribute(attributeName: string, attributeValue?: string): Promise<boolean> {\r\n        if (!is(attributeName)) {\r\n            return false;\r\n        }\r\n        return this.call((element) => {\r\n            if (element.hasAttribute(attributeName)) {\r\n                element.removeAttribute(attributeName)\r\n            } else {\r\n                element.setAttribute(attributeName, attributeValue ?? \"\")\r\n            }\r\n        }, 'toggleAttribute');\r\n    }\r\n\r\n    async toggleAttributeAs(attributeName: string, attributeValue?: string): Promise<boolean> {\r\n        if (!is(attributeName)) {\r\n            return false;\r\n        }\r\n        return this.call((element) => {\r\n            this.#utils.interactions.fetch(() => {\r\n                if (element.hasAttribute(attributeName)) {\r\n                    this.#utils.interactions.mutate(element.removeAttribute, element, attributeName);\r\n                } else {\r\n                    this.#utils.interactions.mutate(element.setAttribute, element, attributeName, attributeValue ?? \"\")\r\n                }\r\n            }, this)\r\n\r\n        }, 'toggleAttributeAs');\r\n    }\r\n\r\n    async click(onClick: (ev: MouseEvent) => void): Promise<boolean> {\r\n        if (!is(onClick)) {\r\n            return false;\r\n        }\r\n        return this.call((element) => {\r\n            //@ts-ignore\r\n            element.addEventListener('click', onClick);\r\n        }, 'click');\r\n    }\r\n\r\n    async event(eventName: string, callback: any): Promise<boolean> {\r\n        if (!is(eventName) || !is(callback)) {\r\n            return false;\r\n        }\r\n        return this.call((element) => {\r\n            element.addEventListener(eventName, callback);\r\n        }, 'event');\r\n    }\r\n\r\n    async call(callback: (element: Element, index: Number) => void, functionName?: string): Promise<boolean> {\r\n        if (this.#isLocked) {\r\n            this.#logger.error(\"Element is locked\", functionName)\r\n        }\r\n        this.lock();\r\n        this.#elements.forEach((element, index) => {\r\n            callback(element, index)\r\n        })\r\n        this.unlock();\r\n        return true;\r\n    }\r\n\r\n    async setAction(actionStr: string, animationClass: string, timeout?: number): Promise<boolean> {\r\n        if (!is(actionStr)) {\r\n            return false\r\n        }\r\n        let act = CuiActionsFatory.get(actionStr);\r\n        return this.animate(animationClass, timeout, (element: Element) => {\r\n            act.add(element);\r\n        })\r\n    }\r\n\r\n    async removeAction(actionStr: string, animationClass: string, timeout?: number): Promise<boolean> {\r\n        if (!is(actionStr)) {\r\n            return false\r\n        }\r\n        let act = CuiActionsFatory.get(actionStr);\r\n        return this.animate(animationClass, timeout, (element: Element) => {\r\n            act.remove(element);\r\n        })\r\n    }\r\n    /**\r\n     * Perform animation on the element\r\n     * @param animationClass \r\n     * @param timeout \r\n     * @param callback \r\n     */\r\n    async animate(animationClass: string, timeout?: number, callback?: (element: Element) => void) {\r\n        if (!is(animationClass)) {\r\n            return false\r\n        }\r\n        const delay = timeout ?? this.#utils.setup.animationTime ?? 0;\r\n        const action = new CuiClassAction(animationClass);\r\n        return this.call((element) => {\r\n            return this.#actionsHelper.performAction(element, action, delay, () => {\r\n                if (callback)\r\n                    callback(element);\r\n            });\r\n        });\r\n    }\r\n\r\n    emit(event: string, ...args: any[]): void {\r\n        if (!is(event)) {\r\n            this.#logger.warning(\"Not enough data to emit event\", \"emit\")\r\n            return;\r\n        }\r\n        this.call((element: Element) => {\r\n            let cuid = (<CuiElement>(element as any)).$cuid;\r\n            if (is(cuid)) {\r\n                this.#logger.debug(`Emitting event ${event} to ${cuid}`)\r\n                this.#utils.bus.emit(event, cuid, ...args);\r\n            }\r\n        }, \"emit\")\r\n    }\r\n\r\n    on(event: string, callback: any): string[] {\r\n        let ids: string[] = []\r\n        if (!are(event, callback)) {\r\n            this.#logger.error(\"Incorrect arguments\", \"on\")\r\n            return ids;\r\n        }\r\n\r\n        this.call((element: Element) => {\r\n            let cuiElement = (<CuiElement>(element as any));\r\n            if (is(cuiElement)) {\r\n                let disposeId = this.#utils.bus.on(event, callback, cuiElement);\r\n                if (disposeId != null)\r\n                    ids.push(disposeId);\r\n            }\r\n        }, \"on\")\r\n        return ids;\r\n    }\r\n\r\n    detach(event: string, id: string): void {\r\n        if (!are(event, id)) {\r\n            this.#logger.error(\"Incorrect arguments\", \"detach\")\r\n        }\r\n        this.call((element: Element) => {\r\n            let cuiElement = (<CuiElement>(element as any));\r\n            if (is(cuiElement)) {\r\n                this.#utils.bus.detach(event, id, cuiElement);\r\n            }\r\n        }, \"detach\")\r\n    }\r\n\r\n    read(callback: any, ...args: any[]): void {\r\n        this.#utils.interactions.fetch(callback, this, ...args)\r\n    }\r\n\r\n    change(callback: any, ...args: any[]): void {\r\n        this.#utils.interactions.mutate(callback, this, ...args)\r\n    }\r\n\r\n    elements(): Element[] {\r\n        return this.#elements;\r\n    }\r\n\r\n    count() {\r\n        return this.#elements.length;\r\n    }\r\n\r\n    lock() {\r\n        this.#isLocked = true;\r\n    }\r\n\r\n    unlock() {\r\n        this.#isLocked = false;\r\n    }\r\n\r\n    isLocked(): boolean {\r\n        return this.#isLocked;\r\n    }\r\n\r\n    refresh(): boolean {\r\n        return (Date.now() - this.#cDt) < 360000;\r\n    }\r\n}","import { CuiDevtoolFactory } from \"../../core/development/factory\";\r\nimport { ICuiDevelopmentTool } from \"../../core/development/interfaces\";\r\nimport { ICuiPlugin, ICuiMutiationPlugin, ICuiPluginManager } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { is } from \"../../core/utils/functions\";\r\n\r\n\r\n\r\nexport class CuiPluginManager implements ICuiPluginManager {\r\n    #plugins: ICuiPlugin[];\r\n    #mutated: ICuiMutiationPlugin[];\r\n    #log: ICuiDevelopmentTool;\r\n    constructor(plugins: ICuiPlugin[]) {\r\n        this.#plugins = plugins ?? [];\r\n        this.#log = CuiDevtoolFactory.get(\"CuiPluginManager\");\r\n        this.#mutated = [];\r\n    }\r\n\r\n    init(utils: CuiUtils): void {\r\n        this.#log.debug(\"Plugins initialization started: \" + this.#plugins.length)\r\n        this.#mutated = this.#plugins.filter((plugin: any) => {\r\n            return is(plugin.mutation);\r\n        }) as any;\r\n        this.#plugins.forEach(plugin => {\r\n            plugin.init(utils);\r\n            utils.setup.plugins[plugin.description] = plugin.setup;\r\n        })\r\n        this.#log.debug(\"Plugins have been initialized\");\r\n    }\r\n\r\n    get(name: string): ICuiPlugin | undefined {\r\n        if (!is(name)) {\r\n            return undefined;\r\n        }\r\n        return this.#plugins.find(p => p.name === name);\r\n    }\r\n\r\n    has(name: string): boolean {\r\n        return is(this.get(name))\r\n    }\r\n\r\n    async onMutation(mutation: MutationRecord): Promise<boolean> {\r\n        let tasks: Promise<boolean>[] = [];\r\n        this.#mutated.forEach((plugin: any) => {\r\n            tasks.push(plugin.mutation(mutation))\r\n        })\r\n        let result: boolean[] = await Promise.all(tasks);\r\n        return result.find(val => {\r\n            val === false\r\n        }) ? false : true;\r\n    }\r\n\r\n}","import { CuiHTMLElement, ICuiComponent } from \"../models/interfaces\";\r\nimport { CuiUtils } from \"../models/utils\";\r\nimport { ICuiApiHandler } from \"./interfaces\";\r\nimport { createCuiElement, destroyCuiElement, getMatchingComponents, updateComponent } from \"./functions\";\r\n\r\nexport class CuiApiHandler implements ICuiApiHandler {\r\n    #components: ICuiComponent[];\r\n    #utils: CuiUtils;\r\n\r\n    constructor(components: ICuiComponent[], utils: CuiUtils) {\r\n        this.#components = components;\r\n        this.#utils = utils;\r\n    }\r\n    async registerComponent(node: CuiHTMLElement): Promise<boolean> {\r\n        let matching = getMatchingComponents(node, this.#components);\r\n        if (!matching || matching.length === 0) {\r\n            return false;\r\n        }\r\n        return createCuiElement(node, matching, this.#utils);\r\n    }\r\n    async updateComponent(node: CuiHTMLElement, component: string, args?: any): Promise<boolean> {\r\n        if (!node.hasAttribute(component)) {\r\n            return false;\r\n        }\r\n        return updateComponent(node, component, args);\r\n    }\r\n    async destroyComponent(node: CuiHTMLElement): Promise<boolean> {\r\n        return destroyCuiElement(node);\r\n    }\r\n\r\n}","import { CuiSetupInit } from \"../core/models/setup\";\r\nimport { is, joinAttributesForQuery, are } from \"../core/utils/functions\";\r\nimport { STATICS, EVENTS, CSS_VARIABLES } from \"../core/utils/statics\";\r\nimport { ICuiPlugin, ICuiComponent, ICuiPluginManager, CuiElement } from \"../core/models/interfaces\";\r\nimport { ICuiMutionObserver, CuiMutationObserver } from \"../core/observers/mutations\";\r\nimport { CuiUtils } from \"../core/models/utils\";\r\nimport { CuiInstanceInitError } from \"../core/models/errors\";\r\nimport { ElementManager } from \"./managers/element\";\r\nimport { CuiPluginManager } from \"./managers/plugins\";\r\nimport { CuiDevtoolFactory } from \"../core/development/factory\";\r\nimport { ICuiDevelopmentTool } from \"../core/development/interfaces\";\r\nimport { ICuiApiHandler } from \"src/core/api/interfaces\";\r\nimport { CuiApiHandler } from \"../core/api/handler\";\r\nimport { getMatchingComponents, createCuiElement, addCuiArgument } from \"../core/api/functions\";\r\n\r\nexport class CuiInstance {\r\n    #log: ICuiDevelopmentTool;\r\n    #mutationObserver: ICuiMutionObserver | undefined;\r\n    #utils: CuiUtils;\r\n    #plugins: ICuiPluginManager;\r\n    #components: ICuiComponent[];\r\n    #rootElement: HTMLElement;\r\n    #mutatedAttributes: string[];\r\n    #api: ICuiApiHandler;\r\n    constructor(setup: CuiSetupInit, plugins: ICuiPlugin[], components: ICuiComponent[]) {\r\n        STATICS.prefix = setup.prefix;\r\n        STATICS.logLevel = setup.logLevel;\r\n        if (setup.development)\r\n            STATICS.devTool = setup.development;\r\n        this.#plugins = new CuiPluginManager(plugins);\r\n        this.#components = components ?? [];\r\n        this.#utils = new CuiUtils(setup, plugins.map(plugin => { return plugin.name; }));\r\n        this.#log = CuiDevtoolFactory.get(\"CuiInstance\");\r\n        this.#rootElement = setup.root;\r\n        this.#mutationObserver = undefined;\r\n        this.#mutatedAttributes = [];\r\n        this.#api = new CuiApiHandler(this.#components, this.#utils);\r\n    }\r\n\r\n    async init(): Promise<CuiInstance> {\r\n        this.#log.debug(\"Instance started\", \"init\")\r\n        // Init elements\r\n        if (!is(window.MutationObserver)) {\r\n            throw new CuiInstanceInitError(\"Mutation observer does not exists\");\r\n        }\r\n        this.#mutatedAttributes = this.#components.map(x => { return x.attribute }); // MUTATED_ATTRIBUTES; \r\n        const initElements = is(this.#mutatedAttributes) ? this.#rootElement.querySelectorAll(joinAttributesForQuery(this.#mutatedAttributes)) : null;\r\n        if (is(initElements)) {\r\n            //@ts-ignore initElements already checked\r\n            this.#log.debug(`Initiating ${initElements.length} elements`)\r\n            let promises = [];\r\n            //@ts-ignore initElements already checked\r\n            for (let element of initElements) {\r\n                try {\r\n                    let matchingComponents = getMatchingComponents(element, this.#components)\r\n                    promises.push(createCuiElement(element, matchingComponents, this.#utils));\r\n                } catch (e) {\r\n                    this.#log.exception(e);\r\n                }\r\n            }\r\n            await Promise.all(promises);\r\n        }\r\n        this.#log.debug(\"Init plugins\", \"init\")\r\n        // Init plugins\r\n        this.#plugins.init(this.#utils);\r\n\r\n        if (are(this.#components, this.#mutatedAttributes)) {\r\n            this.#log.debug(\"Init mutation observer\", \"init\")\r\n            this.#mutationObserver = new CuiMutationObserver(this.#rootElement, this.#utils)\r\n            this.#mutationObserver.setComponents(this.#components).setAttributes(this.#mutatedAttributes)\r\n            this.#mutationObserver.setPlugins(this.#plugins);\r\n            this.#mutationObserver.start();\r\n        }\r\n\r\n        this.#log.debug(\"Setting CSS globals\", 'init')\r\n        this.#utils.interactions.mutate(() => {\r\n            this.#utils.setProperty(CSS_VARIABLES.animationTimeLong, `${this.#utils.setup.animationTimeLong}ms`)\r\n            this.#utils.setProperty(CSS_VARIABLES.animationTime, `${this.#utils.setup.animationTime}ms`);\r\n            this.#utils.setProperty(CSS_VARIABLES.animationTimeShort, `${this.#utils.setup.animationTimeShort}ms`);\r\n        }, null)\r\n\r\n        this.#utils.bus.emit(EVENTS.INSTANCE_INITIALIZED, null)\r\n        return this;\r\n    }\r\n\r\n    finish(): void {\r\n        if (this.#mutationObserver)\r\n            this.#mutationObserver.stop();\r\n        this.#utils.bus.emit(EVENTS.INSTANCE_FINISHED, null)\r\n    }\r\n\r\n    get(selector: string): ElementManager | undefined {\r\n        const elements = this.all(selector);\r\n        if (!elements) {\r\n            return undefined;\r\n        }\r\n        const newElement = new ElementManager(elements, this.#utils);\r\n        return newElement\r\n    }\r\n\r\n    all(selector: string): Element[] | undefined {\r\n        const nodes: NodeListOf<Element> = document.querySelectorAll(selector);\r\n        if (!is(nodes)) {\r\n            return undefined;\r\n        }\r\n        return [...nodes];\r\n    }\r\n\r\n    getUtils(): CuiUtils {\r\n        return this.#utils//;\r\n    }\r\n\r\n    on(event: string, callback: any, element?: CuiElement): string | null {\r\n        if (!are(event, callback)) {\r\n            this.#log.error(\"Incorrect arguments\", \"on\")\r\n            return null;\r\n        }\r\n        return this.#utils.bus.on(event, callback, element);\r\n    }\r\n\r\n    detach(event: string, id: string): void {\r\n        if (!are(event, id)) {\r\n            this.#log.error(\"Incorrect arguments\", \"detach\")\r\n        }\r\n        this.#utils.bus.detach(event, id);\r\n    }\r\n\r\n    detachAll(event: string): void {\r\n        if (!is(event)) {\r\n            this.#log.error(\"Incorrect arguments\", \"detachAll\")\r\n        }\r\n        this.#utils.bus.detachAll(event);\r\n    }\r\n\r\n    emit(event: string, element: Element | string, ...args: any[]): void {\r\n        if (!are(event, element)) {\r\n            this.#log.warning(\"Not enough data to emit event\", \"emit\")\r\n            return;\r\n        }\r\n        let cuid = null\r\n        if (typeof element === 'string' && element.startsWith('~')) {\r\n            cuid = element.substring(1);\r\n        } else {\r\n            let el = typeof element === 'string' ? document.querySelector(element) : element;\r\n            cuid = (<CuiElement>(el as any)).$cuid;\r\n        }\r\n        if (!is(cuid)) {\r\n            this.#log.warning(\"Element is not a cUI element\", \"emit\")\r\n            return\r\n        }\r\n        this.#utils.bus.emit(event, cuid, ...args);\r\n    }\r\n\r\n    getPlugin(name: string): ICuiPlugin | undefined {\r\n        return this.#plugins.get(name);\r\n    }\r\n\r\n    api(): ICuiApiHandler {\r\n        return this.#api;\r\n    }\r\n\r\n\r\n    /**\r\n     * Creates cUI element outside of cUI root scope\r\n     * @param element \r\n     * @param arg \r\n     * @param data \r\n     */\r\n    async createCuiElement<T extends object>(element: HTMLElement, arg: string, data: T): Promise<boolean> {\r\n        if (!is(arg) || !this.#mutatedAttributes.includes(arg)) {\r\n            this.#log.error(\"Element cannot be created: Unknown attribute\")\r\n            return false;\r\n        }\r\n        let component = this.#components.find(component => component.attribute === arg);\r\n\r\n        if (!component)\r\n            return false;\r\n\r\n        if (addCuiArgument(element, arg, data)) {\r\n            return createCuiElement(element, [component], this.#utils);\r\n        }\r\n\r\n        return false;\r\n    }\r\n}","import { PropsTypes } from \"./engine\";\r\nimport { AnimationProperty } from \"./interfaces\";\r\n\r\nexport interface AnimationDefinition {\r\n    previous: DefinitionItem;\r\n    current: DefinitionItem;\r\n}\r\n\r\nexport interface DefinitionItem {\r\n    left: AnimationProperty<PropsTypes>;\r\n    right: AnimationProperty<PropsTypes>\r\n}\r\n\r\nexport interface CuiAnimationsDefinition {\r\n    [id: string]: AnimationDefinition;\r\n}\r\n\r\nexport const SWIPE_ANIMATIONS_DEFINITIONS: CuiAnimationsDefinition = {\r\n    \"slide\": {\r\n        current: {\r\n            left: {\r\n                transform: {\r\n                    translateX: {\r\n                        from: 0,\r\n                        to: -100,\r\n                        unit: \"%\"\r\n                    }\r\n                }\r\n            },\r\n            right: {\r\n                transform: {\r\n                    translateX: {\r\n                        from: 0,\r\n                        to: 100,\r\n                        unit: \"%\"\r\n                    }\r\n                }\r\n            }\r\n        },\r\n        previous: {\r\n            left: {\r\n                transform: {\r\n                    translateX: {\r\n                        from: 100,\r\n                        to: 0,\r\n                        unit: \"%\"\r\n                    }\r\n                }\r\n            },\r\n            right: {\r\n                transform: {\r\n                    translateX: {\r\n                        from: -100,\r\n                        to: 0,\r\n                        unit: \"%\"\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    },\r\n    fade: {\r\n        current: {\r\n            left: {\r\n                opacity: {\r\n                    from: 1,\r\n                    to: 0\r\n                }\r\n            },\r\n            right: {\r\n                opacity: {\r\n                    from: 1,\r\n                    to: 0\r\n                }\r\n            }\r\n        },\r\n        previous: {\r\n            left: {\r\n                opacity: {\r\n                    from: 0,\r\n                    to: 1\r\n                }\r\n            },\r\n            right: {\r\n                opacity: {\r\n                    from: 0,\r\n                    to: 1\r\n                }\r\n            }\r\n        }\r\n    },\r\n    push: {\r\n        current: {\r\n            left: {\r\n                transform: {\r\n                    translateX: {\r\n                        from: 0,\r\n                        to: -10,\r\n                        unit: \"%\"\r\n                    }\r\n                }\r\n            },\r\n            right: {\r\n                transform: {\r\n                    translateX: {\r\n                        from: 0,\r\n                        to: 10,\r\n                        unit: \"%\"\r\n                    }\r\n                }\r\n            }\r\n        },\r\n        previous: {\r\n            left: {\r\n                transform: {\r\n                    translateX: {\r\n                        from: 100,\r\n                        to: 0,\r\n                        unit: \"%\"\r\n                    }\r\n                }\r\n            },\r\n            right: {\r\n                transform: {\r\n                    translateX: {\r\n                        from: -100,\r\n                        to: 0,\r\n                        unit: \"%\"\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n","import { CuiSetupInit } from \"../core/models/setup\";\r\nimport { is } from \"../core/utils/functions\";\r\nimport { CuiInstance } from \"./instance\";\r\nimport { ICONS } from \"../core/utils/statics\";\r\nimport { ICuiComponent, ICuiPlugin } from \"../core/models/interfaces\";\r\nimport { CuiAnimationsDefinition, SWIPE_ANIMATIONS_DEFINITIONS } from \"../core/animation/definitions\";\r\n\r\nexport interface CuiInitData {\r\n    plugins?: ICuiPlugin[];\r\n    components?: ICuiComponent[];\r\n    setup?: CuiSetupInit;\r\n    icons?: any;\r\n    swipeAnimations?: CuiAnimationsDefinition;\r\n}\r\n\r\nexport interface CuiInitResult {\r\n    result: boolean;\r\n    message?: string;\r\n}\r\n\r\nexport class CuiInitializer {\r\n    #window: any;\r\n    constructor() {\r\n        this.#window = window;\r\n    }\r\n\r\n    async init(setup: CuiInitData): Promise<CuiInitResult> {\r\n        let settings: CuiSetupInit = { ... new CuiSetupInit(), ...setup.setup }\r\n        const appPrefix: string = settings.app;\r\n        const result: CuiInitResult = {\r\n            result: false\r\n        }\r\n        if (is(this.#window[appPrefix])) {\r\n            result.message = \"Instance is already initialized\";\r\n            return result;\r\n        }\r\n        if (is(setup.icons)) {\r\n            for (let icon in setup.icons) {\r\n                ICONS[icon] = setup.icons[icon];\r\n            }\r\n        }\r\n        if (is(setup.swipeAnimations)) {\r\n            for (let animation in setup.swipeAnimations) {\r\n                SWIPE_ANIMATIONS_DEFINITIONS[animation] = setup.swipeAnimations[animation];\r\n            }\r\n\r\n        }\r\n        try {\r\n            this.#window[appPrefix] = new CuiInstance(settings, setup.plugins ?? [], setup.components ?? [])\r\n            await this.#window[appPrefix].init();\r\n        } catch (e) {\r\n            console.error(e);\r\n            result.message = \"An error occured during initialization\";\r\n            return result;\r\n        }\r\n        result.result = true;\r\n        return result;\r\n    }\r\n}","import { is, enumerateObject, are } from \"../utils/functions\";\r\n\r\nexport interface ElementBuilderAttribute {\r\n    [name: string]: string;\r\n}\r\nexport class ElementBuilder {\r\n    #id: string | undefined;\r\n    #classes: string[];\r\n    #attributes: ElementBuilderAttribute | undefined;\r\n    #tag: string;\r\n    #text: string | undefined;\r\n    #children: Element[];\r\n    #rawChildren: ElementBuilder[];\r\n    #callback: ((ev: any) => void) | undefined;\r\n    #evName: string | undefined;\r\n    constructor(tag: string) {\r\n        this.#tag = tag;\r\n        this.#classes = [];\r\n        this.#attributes = undefined;\r\n        this.#id = undefined;\r\n        this.#text = undefined;\r\n        this.#children = [];\r\n        this.#rawChildren = [];\r\n        this.#evName = undefined;\r\n        this.#callback = undefined;\r\n    }\r\n\r\n    setId(id: string): ElementBuilder {\r\n        this.#id = id;\r\n        return this;\r\n    }\r\n\r\n    setClasses(...classList: string[]): ElementBuilder {\r\n        this.#classes = classList;\r\n        return this;\r\n    }\r\n\r\n    setAttributes(attributes: ElementBuilderAttribute): ElementBuilder {\r\n        this.#attributes = attributes;\r\n        return this;\r\n    }\r\n\r\n    setTextContent(text: string) {\r\n        this.#text = text;\r\n        return this;\r\n    }\r\n\r\n    setChildren(...elements: Element[]) {\r\n        this.#children = [...elements];\r\n        return this;\r\n    }\r\n\r\n    setRawChildren(...elements: ElementBuilder[]) {\r\n        this.#rawChildren = [...elements];\r\n        return this;\r\n    }\r\n\r\n    onEvent(name: string, callback: (ev: any) => void) {\r\n        this.#evName = name;\r\n        this.#callback = callback;\r\n        return this;\r\n    }\r\n\r\n    build(innerHTML?: string): HTMLElement {\r\n        let element = document.createElement(this.#tag);\r\n        if (is(this.#id)) {\r\n            // @ts-ignore id is checked\r\n            element.id = this.#id;\r\n        }\r\n        if (is(this.#classes)) {\r\n            element.classList.add(...this.#classes);\r\n        }\r\n        if (is(this.#attributes)) {\r\n            // @ts-ignore attributes are checked\r\n            enumerateObject(this.#attributes, (attr: string, value: string) => {\r\n                element.setAttribute(attr, value);\r\n            })\r\n        }\r\n        if (is(innerHTML)) {\r\n            // @ts-ignore innerHTML checked already\r\n            element.innerHTML = innerHTML;\r\n        } else if (is(this.#text)) {\r\n            // @ts-ignore text checked already\r\n            element.textContent = this.#text;\r\n        }\r\n        this.#rawChildren.forEach(raw => { element.appendChild(raw.build()) });\r\n        this.#children.forEach(child => element.appendChild(child));\r\n\r\n        if (are(this.#evName, this.#callback)) {\r\n            // @ts-ignore\r\n            element.addEventListener(this.#evName, (ev) => {\r\n                // @ts-ignore\r\n                this.#callback(ev);\r\n            })\r\n        }\r\n        return element;\r\n    }\r\n}","import { ElementBuilder } from \"../../core/builders/element\";\r\nimport { is } from \"../../core/utils/functions\";\r\n\r\nexport class DialogBuilder {\r\n    #header: Element | undefined;\r\n    #body: Element | undefined;\r\n    #footer: Element | undefined;\r\n    #prefix: string;\r\n    #switches: string;\r\n    #reverse: boolean;\r\n    constructor(prefix: string, reverse: boolean, switches?: string) {\r\n        this.#prefix = prefix;\r\n        this.#header = this.#footer = this.#body = undefined;\r\n        this.#switches = switches ?? \"\";\r\n        this.#reverse = reverse;\r\n    }\r\n\r\n    createHeader(title: string, classes: string[], elements?: Element[]) {\r\n        if (!is(classes)) {\r\n            classes = []\r\n        }\r\n        if (!is(elements)) {\r\n            elements = []\r\n        }\r\n        let headerBuilder = new ElementBuilder('div');\r\n        headerBuilder.setClasses(`${this.#prefix}-dialog-header`, ...classes)\r\n        this.#header = headerBuilder.build();\r\n\r\n        let titleElement = new ElementBuilder('span').setClasses(this.getPrefixedString(\"-dialog-title\")).build(title)\r\n\r\n        this.#header.appendChild(titleElement);\r\n        // @ts-ignore\r\n        this.appendChildrens(this.#header, ...elements);\r\n\r\n    }\r\n\r\n    createFooter(classes: string[], elements: Element[]) {\r\n        if (!is(classes)) {\r\n            classes = []\r\n        }\r\n        if (!is(elements)) {\r\n            elements = []\r\n        }\r\n        this.#footer = new ElementBuilder('div').setClasses(this.getPrefixedString(\"-dialog-footer\"), ...classes).build();\r\n        // @ts-ignore\r\n        this.appendChildrens(this.#footer, ...elements);\r\n    }\r\n\r\n    createBody(classes: string[], elements: Element[]) {\r\n        if (!is(classes)) {\r\n            classes = []\r\n        }\r\n        if (!is(elements)) {\r\n            elements = []\r\n        }\r\n        this.#body = new ElementBuilder('div').setClasses(this.getPrefixedString(\"-dialog-body\"), ...classes).build();\r\n        // @ts-ignore\r\n        this.appendChildrens(this.#body, ...elements);\r\n    }\r\n\r\n    build(id: string): HTMLElement {\r\n        let classes = [this.getPrefixedString(\"-dialog\")]\r\n        if (this.#reverse) {\r\n            classes.push(this.getPrefixedString('-reverse-auto'));\r\n        }\r\n        let dialog = new ElementBuilder('div').setId(id).setClasses(...classes).setAttributes({\r\n            [this.getPrefixedString('-dialog')]: this.#switches\r\n        }).build();\r\n        let container = new ElementBuilder('div').setClasses(this.getPrefixedString(\"-dialog-container\")).build();\r\n        if (this.#header)\r\n            container.appendChild(this.#header);\r\n        if (this.#body)\r\n            container.appendChild(this.#body);\r\n        if (this.#footer)\r\n            container.appendChild(this.#footer);\r\n        dialog.appendChild(container);\r\n        return dialog;\r\n    }\r\n\r\n    private appendChildrens(parent: Element, ...elements: Element[]) {\r\n        if (is(elements)) {\r\n            elements.forEach((element) => parent.appendChild(element));\r\n        }\r\n    }\r\n    private getPrefixedString(str: string) {\r\n        return this.#prefix + str\r\n    }\r\n}","import { ElementManager } from \"../../app/managers/element\";\r\nimport { ElementBuilder } from \"../../core/builders/element\";\r\nimport { CuiContext } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { is } from \"../../core/utils/functions\";\r\nimport { DialogBuilder } from \"./builder\";\r\nimport { CuiAlertOptions, CuiAlertType } from \"./models\";\r\n\r\nexport interface ICuiAlertHandler {\r\n    show(root: Element): void;\r\n}\r\n\r\ninterface AlertCallbacks {\r\n    [name: string]: (() => void) | undefined;\r\n}\r\n\r\nabstract class CuiAlertHandlerBase implements ICuiAlertHandler, CuiContext {\r\n    #callbacks: AlertCallbacks;\r\n    #utils: CuiUtils;\r\n    #id: string;\r\n    #manager: ElementManager | undefined;\r\n    closeStr: string;\r\n    iconStr: string;\r\n    content: string;\r\n    title: string;\r\n    prefix: string;\r\n    reverse: boolean;\r\n    #attid: string | null;\r\n    constructor(setup: CuiUtils, id: string, data: CuiAlertOptions) {\r\n        this.#callbacks = {\r\n            \"yes\": data.onYes,\r\n            \"no\": data.onNo,\r\n            \"cancel\": data.onCancel,\r\n            \"ok\": data.onOk\r\n        }\r\n        this.content = data.message;\r\n        this.title = data.title;\r\n        this.prefix = setup.setup.prefix;\r\n        this.#utils = setup;\r\n        this.#id = id;\r\n        this.reverse = false;\r\n        this.#attid = null;\r\n        this.closeStr = `${this.#utils.setup.prefix}-close`;\r\n        this.iconStr = `${this.#utils.setup.prefix}-icon`;\r\n        this.#manager = undefined;\r\n    }\r\n\r\n    getId(): string {\r\n        return this.#id;\r\n    }\r\n\r\n    show(root: Element): void {\r\n        if (!this.#utils) {\r\n            return;\r\n        }\r\n\r\n        let element = document.getElementById(this.#id);\r\n        if (!is(element)) {\r\n            element = this.createElement();\r\n            this.#utils.interactions.mutate(() => {\r\n                // @ts-ignore - already checked\r\n                root.appendChild(element);\r\n            }, null)\r\n\r\n        } else {\r\n            // @ts-ignore - already checked\r\n            this.updateElement(element);\r\n        }\r\n        setTimeout(() => {\r\n            // @ts-ignore - already checked\r\n            this.#manager = new ElementManager([element], this.#utils);\r\n            let ids = this.#manager.on('closed', this.onClose.bind(this));\r\n            this.#attid = ids.length > 0 ? ids[0] : null;\r\n            this.#manager.emit(\"open\");\r\n        }, 50);\r\n    }\r\n\r\n    updateElement(element: HTMLElement) {\r\n        this.#utils.interactions.fetch(() => {\r\n            let title = element.querySelector(`.${this.prefix}-dialog-title`);\r\n            let content = element.querySelector(`.${this.prefix}-dialog-body>p`);\r\n            this.#utils.interactions.mutate(() => {\r\n                if (title) {\r\n                    title.innerHTML = this.title;\r\n                }\r\n                if (content) {\r\n                    content.innerHTML = this.content;\r\n                }\r\n            }, null)\r\n        }, null)\r\n    }\r\n\r\n    onClose(arg: any) {\r\n        try {\r\n            if (is(arg) && arg.state && this.#callbacks) {\r\n                if (is(this.#callbacks[arg.state])) {\r\n                    let callback = this.#callbacks[arg.state];\r\n                    if (callback) {\r\n                        callback();\r\n                    }\r\n                }\r\n            }\r\n        } finally {\r\n            if (this.#attid != null) {\r\n                if (this.#manager)\r\n                    this.#manager.detach('closed', this.#attid);\r\n                this.#attid = null;\r\n            }\r\n\r\n            this.#manager = undefined;\r\n        }\r\n    }\r\n\r\n    abstract createElement(): HTMLElement;\r\n\r\n\r\n}\r\n\r\nexport class CuiAlertHandler extends CuiAlertHandlerBase {\r\n    #id: string;\r\n    constructor(setup: CuiUtils, id: string, data: CuiAlertOptions) {\r\n        super(setup, id, data);\r\n        this.#id = id;\r\n        this.reverse = data.reverse ?? false;\r\n    }\r\n\r\n    createElement() {\r\n        let dialogBuilder = new DialogBuilder(this.prefix, this.reverse);\r\n\r\n        dialogBuilder.createHeader(this.title, [], [\r\n            new ElementBuilder('a').setClasses(`${this.prefix}-icon`).setAttributes({\r\n                [this.closeStr]: \"state: cancel\",\r\n                [this.iconStr]: \"close\"\r\n            }).build()\r\n        ]);\r\n        dialogBuilder.createBody([], [\r\n            new ElementBuilder('p').build(this.content)\r\n        ]);\r\n        dialogBuilder.createFooter([`${this.prefix}-flex`, `${this.prefix}-right`], [\r\n            new ElementBuilder('button').setClasses(`${this.prefix}-button`, `${this.prefix}-margin-small-right`).setAttributes({ [this.closeStr]: \"state: cancel\" }).build(\"Cancel\"),\r\n            new ElementBuilder('button').setClasses(`${this.prefix}-button`, `${this.prefix}-accent`).setAttributes({ [this.closeStr]: \"state: ok\" }).build(\"Ok\")\r\n        ])\r\n        return dialogBuilder.build(this.#id);\r\n    }\r\n}\r\n\r\nexport class CuiInfoAlertUpHandler extends CuiAlertHandlerBase {\r\n    #id: string;\r\n    constructor(setup: CuiUtils, id: string, data: CuiAlertOptions) {\r\n        super(setup, id, data);\r\n        this.#id = id;\r\n        this.content = data.message;;\r\n        this.title = data.title;\r\n        this.prefix = setup.setup.prefix;\r\n        this.reverse = data.reverse ?? false;\r\n\r\n    }\r\n\r\n    createElement() {\r\n        let dialogBuilder = new DialogBuilder(this.prefix, this.reverse);\r\n        dialogBuilder.createHeader(this.title, []);\r\n        dialogBuilder.createBody([], [\r\n            new ElementBuilder('p').build(this.content)\r\n        ]);\r\n        dialogBuilder.createFooter([`${this.prefix}-flex`, `${this.prefix}-right`], [\r\n            new ElementBuilder('button').setClasses(`${this.prefix}-button`, `${this.prefix}-accent`).setAttributes({ [this.closeStr]: \"state: ok\" }).build(\"Ok\")\r\n        ])\r\n\r\n        return dialogBuilder.build(this.#id);\r\n    }\r\n}\r\n\r\nexport class CuiYesNoPopUpHandler extends CuiAlertHandlerBase {\r\n    #id: string;\r\n    constructor(setup: CuiUtils, id: string, data: CuiAlertOptions) {\r\n        super(setup, id, data);\r\n        this.#id = id;\r\n        this.content = data.message;\r\n        this.title = data.title;\r\n        this.prefix = setup.setup.prefix;\r\n        this.reverse = data.reverse ?? false;\r\n    }\r\n\r\n    createElement() {\r\n        let dialogBuilder = new DialogBuilder(this.prefix, this.reverse);\r\n\r\n        dialogBuilder.createHeader(this.title, [], [\r\n            new ElementBuilder('a').setClasses(`${this.prefix}-icon`).setAttributes({\r\n                [this.closeStr]: \"state: cancel\",\r\n                [this.iconStr]: \"close\"\r\n            }).build()\r\n        ]);\r\n        dialogBuilder.createBody([], [\r\n            new ElementBuilder('p').build(this.content)\r\n        ]);\r\n        dialogBuilder.createFooter([`${this.prefix}-flex`, `${this.prefix}-right`], [\r\n            new ElementBuilder('button').setClasses(`${this.prefix}-button`, `${this.prefix}-margin-small-right`).setAttributes({ [this.closeStr]: \"state: no\" }).build(\"No\"),\r\n            new ElementBuilder('button').setClasses(`${this.prefix}-button`, `${this.prefix}-accent`).setAttributes({ [this.closeStr]: \"state: yes\" }).build(\"Yes\")\r\n        ])\r\n        return dialogBuilder.build(this.#id);\r\n    }\r\n}\r\n\r\nexport class CuiAlertFactory {\r\n    static get(id: string, type: CuiAlertType, data: CuiAlertOptions, utils: CuiUtils): ICuiAlertHandler | undefined {\r\n        if (type === \"Info\") {\r\n            return new CuiInfoAlertUpHandler(utils, id, data);\r\n        } else if (type === 'YesNoCancel') {\r\n            return new CuiYesNoPopUpHandler(utils, id, data);\r\n        } else if (type === 'OkCancel') {\r\n            return new CuiAlertHandler(utils, id, data);\r\n        }\r\n        return undefined;\r\n    }\r\n}\r\n\r\n\r\n","import { CuiDevtoolFactory } from \"../../core/development/factory\";\r\nimport { ICuiDevelopmentTool } from \"../../core/development/interfaces\";\r\nimport { ICuiPlugin } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { EVENTS } from \"../../core/utils/statics\";\r\nimport { CuiAlertFactory } from \"./handler\";\r\nimport { CuiAlertEvent } from \"./models\";\r\n\r\n\r\n\r\nexport class CuiAlertsPlugin implements ICuiPlugin {\r\n    description: string;\r\n    name: string;\r\n    setup: any;\r\n\r\n    #handleId: string | null;\r\n    #utils: CuiUtils | undefined;\r\n    #log: ICuiDevelopmentTool;\r\n    constructor() {\r\n        this.name = \"alert-plugin\";\r\n        this.description = \"CuiAlertsPlugin\";\r\n\r\n        this.#handleId = null;\r\n        this.#utils = undefined;\r\n        //@ts-ignore\r\n        this.#log = null;\r\n    }\r\n    init(utils: CuiUtils): void {\r\n        this.#log = CuiDevtoolFactory.get(\"CuiAlertsPlugin\");\r\n        this.#utils = utils;\r\n        this.detach();\r\n        this.#handleId = this.#utils.bus.on(EVENTS.ALERT, this.onAlert.bind(this), { $cuid: this.name });\r\n    }\r\n\r\n    destroy(): void {\r\n        this.detach();\r\n    }\r\n\r\n    private detach() {\r\n        if (this.#handleId && this.#utils) {\r\n            this.#utils.bus.detach(EVENTS.ALERT, this.#handleId);\r\n\r\n            this.#handleId = null;\r\n        }\r\n    }\r\n\r\n    private onAlert(event: CuiAlertEvent) {\r\n        if (!this.#utils) {\r\n            this.#log.error(\"Utils are not set\");\r\n            return;\r\n        }\r\n        if (!this.validateEvent(event)) {\r\n            this.#log.error(\"Event validation failed\");\r\n            return;\r\n        }\r\n        let popup = CuiAlertFactory.get(event.id, event.type, event.options, this.#utils);\r\n        if (!popup) {\r\n            this.#log.error(\"Possibly incorrect alert type\");\r\n            return;\r\n        }\r\n        popup.show(this.#utils.setup.root);\r\n    }\r\n\r\n    private validateEvent(event: CuiAlertEvent): boolean {\r\n        if (!event || !event.id || !event.type || !event.options) {\r\n            return false;\r\n        }\r\n        return true\r\n    }\r\n}\r\n","import { ICuiEventBus } from \"src/core/bus/interfaces\";\r\nimport { GlobalClickEvent } from \"src/core/models/events\";\r\nimport { ICuiPlugin } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { EVENTS } from \"../../core/utils/statics\";\r\n\r\nexport class CuiWindowClickPlugin implements ICuiPlugin {\r\n    description: string;\r\n    name: string = 'click-plugin';\r\n    setup: any;\r\n    #bus: ICuiEventBus | undefined;\r\n    #boundClick: (ev: MouseEvent) => void;\r\n\r\n    constructor() {\r\n        this.description = \"CuiWindowClickPlugin\";\r\n        this.#bus = undefined;\r\n        this.#boundClick = this.onWindowClick.bind(this);\r\n    }\r\n\r\n    init(utils: CuiUtils): void {\r\n        this.#bus = utils.bus;\r\n        window.addEventListener('click', this.#boundClick)\r\n    }\r\n\r\n    destroy(): void {\r\n        window.removeEventListener('click', this.#boundClick);\r\n    }\r\n\r\n    onWindowClick(ev: MouseEvent) {\r\n        if (this.#bus)\r\n            this.#bus.emit<GlobalClickEvent>(EVENTS.WINDOW_CLICK, null, {\r\n                ev: ev,\r\n                source: \"CuiWindowClickPlugin\",\r\n                timestamp: Date.now(),\r\n                name: EVENTS.WINDOW_CLICK\r\n            })\r\n    }\r\n}","import { ICuiPlugin, IUIInteractionProvider } from \"src/core/models/interfaces\";\r\nimport { CuiUtils } from \"src/core/models/utils\";\r\n\r\nconst DEFAULT_FOCUS_VISIBLE = \"focus-visible\";\r\nconst DEFAULT_FOCUS_PRECISE = \"focus-precise\";\r\n\r\ntype FocusInputType = \"keyboard\" | \"mouse\" | \"touch\" | \"none\";\r\n\r\nexport interface ICuiLightFocusPluginSetup {\r\n    keybordClass?: string;\r\n    mouseClass?: string;\r\n    touchClass?: string;\r\n}\r\n\r\nexport class CuiLightFocusPlugin implements ICuiPlugin {\r\n    description: string;\r\n    name: string;\r\n    setup: ICuiLightFocusPluginSetup;\r\n    #interactions: IUIInteractionProvider | undefined;\r\n    #inputType: FocusInputType;\r\n    #onMouseListener: any;\r\n    #onTouchListener: any;\r\n    #onKeyDownListener: any;\r\n    #currentCls: string | undefined;\r\n    constructor(setup: ICuiLightFocusPluginSetup) {\r\n        this.setup = {\r\n            keybordClass: DEFAULT_FOCUS_VISIBLE,\r\n            mouseClass: DEFAULT_FOCUS_PRECISE,\r\n            touchClass: DEFAULT_FOCUS_PRECISE,\r\n            ...setup\r\n        }\r\n\r\n        this.description = \"CuiLightFocusPlugin\";\r\n        this.name = \"focus-plugin\";\r\n        this.#interactions = undefined;\r\n\r\n        this.#onKeyDownListener = this.onKeyDownEvent.bind(this);\r\n        this.#onMouseListener = this.onMouseEvent.bind(this);\r\n        this.#onTouchListener = this.onTouchEvent.bind(this);\r\n\r\n        this.#inputType = 'none';\r\n        this.#currentCls = undefined;\r\n\r\n    }\r\n\r\n    init(utils: CuiUtils): void {\r\n        this.#interactions = utils.interactions;\r\n        document.body.addEventListener('touchstart', this.#onTouchListener);\r\n        document.body.addEventListener('mousedown', this.#onMouseListener);\r\n        window.addEventListener('keydown', this.#onKeyDownListener);\r\n\r\n    }\r\n\r\n    private onMouseEvent(ev: MouseEvent) {\r\n        if (this.#inputType === 'mouse') {\r\n            return;\r\n        }\r\n        this.update('mouse');\r\n    }\r\n\r\n    private onKeyDownEvent(ev: KeyboardEvent) {\r\n        if (this.#inputType === 'keyboard') {\r\n            return;\r\n        }\r\n        this.update('keyboard');\r\n    }\r\n\r\n    private onTouchEvent(ev: TouchEvent) {\r\n        if (this.#inputType === 'touch') {\r\n            return;\r\n        }\r\n        this.update('touch');\r\n    }\r\n\r\n    private update(type: FocusInputType) {\r\n        let cls = this.getClass(type);\r\n        this.setClasses(cls, this.#currentCls, () => {\r\n            this.#currentCls = cls\r\n            this.#inputType = type;\r\n        })\r\n    }\r\n\r\n    private getClass(type: FocusInputType): string | undefined {\r\n        switch (type) {\r\n            case \"keyboard\":\r\n                return this.setup.keybordClass;\r\n            case \"mouse\":\r\n                return this.setup.mouseClass;\r\n            case \"touch\":\r\n                return this.setup.touchClass;\r\n            default:\r\n                return undefined;\r\n        }\r\n    }\r\n    private setClasses(cls: string | undefined, prevCls: string | undefined, callback: () => void) {\r\n        if (!this.#interactions || cls === prevCls) {\r\n            return;\r\n        }\r\n\r\n        this.#interactions.fetch(() => {\r\n            let hasCls = cls && document.body.classList.contains(cls);\r\n            let hasPrevCls = prevCls && document.body.classList.contains(prevCls);\r\n            // @ts-ignore interactions is set\r\n            this.#interactions.mutate(() => {\r\n                if (!hasCls)\r\n                    // @ts-ignore cls is set\r\n                    document.body.classList.add(cls);\r\n                if (hasPrevCls) {\r\n                    // @ts-ignore prevCls is set\r\n                    document.body.classList.remove(prevCls);\r\n                }\r\n                callback();\r\n            }, null)\r\n\r\n        }, null)\r\n    }\r\n\r\n    destroy(): void {\r\n        document.body.removeEventListener('touchstart', this.#onTouchListener);\r\n        document.body.removeEventListener('mousedown', this.#onMouseListener);\r\n        window.removeEventListener('keydown', this.#onKeyDownListener);\r\n    }\r\n\r\n}","import { ICuiEventListener } from \"../../core/models/interfaces\";\r\nimport { is } from \"../../core/utils/functions\";\r\n\r\nexport class CuiKeyPressListener implements ICuiEventListener<KeyboardEvent> {\r\n    #callback: ((t: KeyboardEvent) => void) | undefined;\r\n    #keys: string[];\r\n    #inProgress: boolean;\r\n    #singleEmit: boolean;\r\n    #isAttached: boolean;\r\n\r\n    #onKeyDownBound: (ev: KeyboardEvent) => void;\r\n    #onKeyUpBound: (ev: KeyboardEvent) => void;\r\n\r\n    constructor(singleEmit: boolean, keys?: string[]) {\r\n        this.#inProgress = false;\r\n        this.#singleEmit = true;\r\n        this.#isAttached = false;\r\n        this.#callback = undefined;\r\n        this.#keys = keys ?? [];\r\n\r\n        this.#onKeyDownBound = this.onKeyDown.bind(this);\r\n        this.#onKeyUpBound = this.onKeyUp.bind(this);\r\n    }\r\n\r\n    setCallback(callback: (t: KeyboardEvent) => void): void {\r\n        this.#callback = callback;\r\n    }\r\n\r\n    isInProgress(): boolean {\r\n        return this.#inProgress;\r\n    }\r\n\r\n    attach(): void {\r\n        document.addEventListener('keydown', this.#onKeyDownBound)\r\n        if (this.#singleEmit) {\r\n            document.addEventListener('keyup', this.#onKeyUpBound)\r\n        }\r\n        this.#isAttached = true;\r\n    }\r\n\r\n    detach(): void {\r\n        document.removeEventListener('keydown', this.#onKeyDownBound)\r\n        if (this.#singleEmit) {\r\n            document.addEventListener('keyup', this.#onKeyUpBound)\r\n        }\r\n        this.#isAttached = false;\r\n    }\r\n\r\n    isAttached(): boolean {\r\n        return this.#isAttached;\r\n    }\r\n\r\n    onKeyDown(ev: KeyboardEvent) {\r\n        if (this.#inProgress) {\r\n            return;\r\n        }\r\n        this.#inProgress = true;\r\n        try {\r\n            if ((!is(this.#keys) || this.#keys.includes(ev.code)) && this.#callback) {\r\n                this.#callback(ev);\r\n            }\r\n\r\n        } catch (e) {\r\n            console.error(e)\r\n        } finally {\r\n            if (!this.#singleEmit)\r\n                this.#inProgress = false;\r\n        }\r\n    }\r\n\r\n    onKeyUp(ev: KeyboardEvent) {\r\n        this.#inProgress = false;\r\n    }\r\n}","import { ICuiEventBus } from \"src/core/bus/interfaces\";\r\nimport { KeyDownEvent } from \"src/core/models/events\";\r\nimport { EVENTS } from \"../../core/utils/statics\";\r\nimport { CuiKeyPressListener } from \"./listener\";\r\n\r\n\r\nexport interface ICuiKeysObserver {\r\n    connect(): void;\r\n    disconnect(): void;\r\n}\r\nexport class CuiKeysObserver {\r\n    #listener: CuiKeyPressListener;\r\n    #bus: ICuiEventBus\r\n    constructor(bus: ICuiEventBus) {\r\n        this.#bus = bus;\r\n        this.#listener = new CuiKeyPressListener(true);\r\n        this.#listener.setCallback(this.onKeyDown.bind(this))\r\n    }\r\n    connect(): void {\r\n        this.#listener.attach();\r\n    }\r\n    disconnect(): void {\r\n        this.#listener.detach();\r\n    }\r\n\r\n    onKeyDown(ev: KeyboardEvent) {\r\n        this.#bus.emit<KeyDownEvent>(EVENTS.KEYDOWN, null, {\r\n            timestamp: Date.now(),\r\n            name: EVENTS.KEYDOWN,\r\n            source: \"CuiKeysObserver\",\r\n            event: ev\r\n        })\r\n    }\r\n\r\n}","import { ICuiPlugin } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { ICuiKeysObserver, CuiKeysObserver } from \"./observer\";\r\n\r\n\r\nexport interface CuiKeysObserverPluginSetup {\r\n    dummy?: boolean;\r\n}\r\n\r\nexport class CuiKeysObserverPlugin implements ICuiPlugin {\r\n    description: string;\r\n    name: string = 'keys-plugin';\r\n    setup: CuiKeysObserverPluginSetup;\r\n    #keysObserver: ICuiKeysObserver | undefined;\r\n    constructor(keySetup: CuiKeysObserverPluginSetup) {\r\n        this.description = \"CuiKeysObserverPlugin\";\r\n        this.setup = keySetup;\r\n        this.#keysObserver = undefined;\r\n    }\r\n\r\n    init(utils: CuiUtils): void {\r\n        this.#keysObserver = new CuiKeysObserver(utils.bus);\r\n        this.#keysObserver.connect();\r\n    }\r\n\r\n    destroy(): void {\r\n        if (this.#keysObserver)\r\n            this.#keysObserver.disconnect();\r\n    }\r\n}","import { ICuiEventListener } from \"../models/interfaces\";\r\n\r\nexport class CuiMediaQueryListener implements ICuiEventListener<MediaQueryListEvent> {\r\n\r\n    #mediaQuery: string;\r\n    #callback: ((t: MediaQueryListEvent) => void) | undefined;\r\n    #isInitialized: boolean;\r\n    #inProgress: boolean;\r\n\r\n    #onEventBound: (ev: MediaQueryListEvent) => void;\r\n    constructor(mediaQuery: string) {\r\n        this.#mediaQuery = mediaQuery;\r\n        this.#isInitialized = false;\r\n        this.#callback = undefined;\r\n        this.#inProgress = false;\r\n\r\n        this.#onEventBound = this.event.bind(this);\r\n    }\r\n    setCallback(callback: (t: MediaQueryListEvent) => void): void {\r\n        this.#callback = callback;\r\n    }\r\n\r\n    isInProgress(): boolean {\r\n        return this.#inProgress;\r\n    }\r\n    attach(): void {\r\n        if (!window.matchMedia || this.#isInitialized || !this.#mediaQuery) {\r\n            return;\r\n        }\r\n        window.matchMedia(this.#mediaQuery)\r\n            .addEventListener('change', this.#onEventBound)\r\n        this.#isInitialized = true\r\n    }\r\n\r\n    detach(): void {\r\n        if (this.#isInitialized) {\r\n            window.matchMedia(this.#mediaQuery).removeEventListener('change', this.#onEventBound);\r\n            this.#isInitialized = false\r\n        }\r\n    }\r\n\r\n    isAttached(): boolean {\r\n        return this.#isInitialized;\r\n    }\r\n\r\n    private event(ev: MediaQueryListEvent): void {\r\n        if (this.#inProgress || !this.#callback) {\r\n            return\r\n        }\r\n        this.#inProgress = true;\r\n        try {\r\n            this.#callback(ev);\r\n        } catch (e) {\r\n            console.error(e)\r\n        } finally {\r\n            this.#inProgress = false;\r\n        }\r\n    }\r\n}","import { ICuiPlugin } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { getSystemLightMode } from \"../../core/utils/functions\";\r\nimport { CuiMediaQueryListener } from \"../../core/listeners/media\";\r\n\r\nexport interface AutoLightPluginSetup {\r\n    autoLight: boolean;\r\n}\r\n\r\nexport class CuiAutoLightModePlugin implements ICuiPlugin {\r\n    description: string = 'Dark vs Light mode auto switcher';\r\n    name: string = 'auto-light';\r\n    setup: AutoLightPluginSetup;\r\n    #listener: CuiMediaQueryListener | undefined;\r\n    #utils: CuiUtils | undefined;\r\n    constructor(autoLightInit: AutoLightPluginSetup) {\r\n        this.description = \"CuiAutoLightModePlugin\";\r\n        this.setup = autoLightInit;\r\n        this.#utils = undefined;\r\n        this.#listener = undefined\r\n    }\r\n\r\n    init(utils: CuiUtils): void {\r\n        this.#utils = utils\r\n        if (this.setup.autoLight && getSystemLightMode() === 'dark') {\r\n            this.#utils.setLightMode('dark')\r\n        }\r\n        this.#listener = new CuiMediaQueryListener('(prefers-color-scheme: dark)')\r\n        this.#listener.setCallback(this.onChange.bind(this))\r\n        this.#listener.attach();\r\n    }\r\n\r\n    destroy(): void {\r\n        if (this.#listener)\r\n            this.#listener.detach();\r\n    }\r\n\r\n    onChange(ev: MediaQueryListEvent) {\r\n        if (!this.#utils) {\r\n            return;\r\n        }\r\n        let autoLightSetup = this.#utils.setup.plugins[this.description] as AutoLightPluginSetup;\r\n        let autoLight = autoLightSetup?.autoLight ?? false;\r\n        if (autoLight) {\r\n            if (ev.matches) {\r\n                this.#utils.setLightMode('dark')\r\n            } else {\r\n                this.#utils.setLightMode('light')\r\n            }\r\n        }\r\n    }\r\n\r\n}","import { ICuiEventListener } from \"../models/interfaces\";\r\nimport { is } from \"../utils/functions\";\r\nimport { EVENTS } from \"../utils/statics\";\r\n\r\ninterface OnMoveCallback {\r\n    (ev: ICuiMoveData): void;\r\n}\r\n\r\ninterface IMoveListener {\r\n    onMove(data: OnMoveCallback): void\r\n    start(): void;\r\n    stop(): void;\r\n}\r\n\r\nexport type CuiMoveEventState = \"down\" | \"up\" | \"move\";\r\nexport interface ICuiMoveData {\r\n    x: number;\r\n    y: number;\r\n    moveX: number;\r\n    moveY: number;\r\n    type: CuiMoveEventState;\r\n    target: EventTarget | null;\r\n    event: MouseEvent | TouchEvent;\r\n}\r\n\r\nexport class CuiMoveEventListener implements ICuiEventListener<ICuiMoveData> {\r\n    #element: HTMLElement | Document;\r\n    #onEvent: ((t: ICuiMoveData) => void) | undefined;\r\n    #isLocked: boolean;\r\n    #isAttached: boolean;\r\n    #preventDefault: boolean;\r\n    #target: Element | undefined;\r\n    constructor(element?: HTMLElement) {\r\n        this.#isLocked = false;\r\n        this.#element = element ?? document.body;\r\n        this.#isAttached = false;\r\n        this.#preventDefault = false;\r\n        this.#onEvent = undefined;\r\n        this.#target = undefined;\r\n\r\n        this.onMouseDown = this.onMouseDown.bind(this);\r\n        this.onMouseUp = this.onMouseUp.bind(this)\r\n        this.onMouseMove = this.onMouseMove.bind(this)\r\n        this.onTouchStart = this.onTouchStart.bind(this)\r\n        this.onTouchEnd = this.onTouchEnd.bind(this)\r\n        this.onTouchMove = this.onTouchMove.bind(this)\r\n    }\r\n\r\n    setCallback(callback: (t: ICuiMoveData) => void): void {\r\n        this.#onEvent = callback;\r\n    }\r\n\r\n    setTarget(element: Element) {\r\n        this.#target = element;\r\n    }\r\n    isInProgress(): boolean {\r\n        return this.#isLocked;\r\n    }\r\n    preventDefault(flag: boolean) {\r\n        this.#preventDefault = flag;\r\n    }\r\n    attach(): void {\r\n        if (this.#isAttached) {\r\n            return;\r\n        }\r\n\r\n        //@ts-ignore\r\n        this.#element.addEventListener('mousedown', this.onMouseDown, { passive: false } as any);\r\n        //@ts-ignore\r\n        this.#element.addEventListener('mouseup', this.onMouseUp, { passive: false } as any);\r\n        //@ts-ignore\r\n        this.#element.addEventListener('mousemove', this.onMouseMove, { passive: false } as any);\r\n        //@ts-ignore\r\n        this.#element.addEventListener('touchstart', this.onTouchStart, { passive: false } as any);\r\n        //@ts-ignore\r\n        this.#element.addEventListener('touchend', this.onTouchEnd, { passive: false } as any);\r\n        //@ts-ignore\r\n        this.#element.addEventListener('touchmove', this.onTouchMove, { passive: false } as any);\r\n        this.#isAttached = true;\r\n    }\r\n    detach(): void {\r\n        if (!this.#isAttached) {\r\n            return;\r\n        }\r\n        //@ts-ignore\r\n        this.#element.removeEventListener('mousedown', this.onMouseDown, { passive: false } as any);\r\n        //@ts-ignore\r\n        this.#element.removeEventListener('mouseup', this.onMouseUp, { passive: false } as any);\r\n        //@ts-ignore\r\n        this.#element.removeEventListener('mousemove', this.onMouseMove, { passive: false } as any);\r\n        //@ts-ignore\r\n        this.#element.removeEventListener('touchstart', this.onTouchStart, { passive: false } as any);\r\n        //@ts-ignore\r\n        this.#element.removeEventListener('touchend', this.onTouchEnd, { passive: false } as any);\r\n        //@ts-ignore\r\n        this.#element.removeEventListener('touchmove', this.onTouchMove, { passive: false } as any);\r\n        this.#isAttached = false;\r\n    }\r\n\r\n    isAttached(): boolean {\r\n        return this.#isAttached\r\n    }\r\n\r\n    onMouseDown(ev: MouseEvent) {\r\n        if (this.#isLocked) {\r\n            return;\r\n        }\r\n        if (this.#target && !this.#target.contains(ev.target as Node)) {\r\n            return;\r\n        }\r\n\r\n        this.#isLocked = true;\r\n        this.publishMouseEvent(\"down\", ev)\r\n\r\n    }\r\n\r\n    onMouseUp(ev: MouseEvent) {\r\n        if (!this.#isLocked) {\r\n            return;\r\n        }\r\n        this.#isLocked = false;\r\n        this.publishMouseEvent(\"up\", ev)\r\n\r\n    }\r\n\r\n    onMouseMove(ev: MouseEvent) {\r\n        if (this.#isLocked) {\r\n            this.publishMouseEvent(\"move\", ev)\r\n        }\r\n    }\r\n\r\n    onTouchStart(ev: TouchEvent) {\r\n        if (this.#isLocked) {\r\n            return;\r\n        }\r\n        if (this.#target && !this.#target.contains(ev.target as Node)) {\r\n            return;\r\n        }\r\n        this.#isLocked = true;\r\n        this.publishTouchEvent('down', ev);\r\n    }\r\n\r\n    onTouchEnd(ev: TouchEvent) {\r\n        if (!this.#isLocked) {\r\n            return;\r\n        }\r\n        this.#isLocked = false;\r\n        this.publishTouchEvent('up', ev);\r\n    }\r\n\r\n    onTouchMove(ev: TouchEvent) {\r\n        if (this.#isLocked) {\r\n            this.publishTouchEvent('move', ev);\r\n        }\r\n    }\r\n\r\n    private publishMouseEvent(type: CuiMoveEventState, ev: MouseEvent) {\r\n        if (this.#preventDefault && ev.cancelable) {\r\n            ev.preventDefault();\r\n        }\r\n        if (!is(this.#onEvent)) { return }\r\n        // @ts-ignore\r\n        this.#onEvent({\r\n            type: type,\r\n            x: ev.clientX,\r\n            y: ev.clientY,\r\n            moveX: ev.movementX,\r\n            moveY: ev.movementY,\r\n            target: ev.target,\r\n            event: ev,\r\n        })\r\n\r\n    }\r\n\r\n    private publishTouchEvent(type: CuiMoveEventState, ev: TouchEvent) {\r\n        if (this.#preventDefault && ev.cancelable)\r\n            ev.preventDefault();\r\n        if (!is(this.#onEvent)) {\r\n            return;\r\n        }\r\n        let touch = null;\r\n        if (ev.touches.length > 0) {\r\n            touch = ev.touches[0]\r\n        } else if (ev.changedTouches.length > 0) {\r\n            touch = ev.changedTouches[0]\r\n        }\r\n        // @ts-ignore - already checked\r\n        this.#onEvent({\r\n            event: ev,\r\n            type: type,\r\n            target: ev.target,\r\n            //@ts-ignore\r\n            x: is(touch) ? touch.clientX : -1,\r\n            //@ts-ignore\r\n            y: is(touch) ? touch.clientY : -1,\r\n            moveX: -1,\r\n            moveY: -1\r\n        })\r\n\r\n    }\r\n\r\n}\r\n","import { ICuiEventBus } from \"src/core/bus/interfaces\";\r\nimport { ICuiMoveEvent } from \"src/core/models/events\";\r\nimport { CuiMoveEventListener, ICuiMoveData } from \"../../core/listeners/move\";\r\nimport { EVENTS } from \"../../core/utils/statics\";\r\n\r\nconst DEFAULT_GESTURE_TRESHOLD = 0.3;\r\ntype GlobalMoveGesture = 'up' | 'down' | 'left' | 'right' | 'none'\r\n\r\nexport class CuiMoveObserver {\r\n    #bus: ICuiEventBus;\r\n    #moveListener: CuiMoveEventListener;\r\n    #isLocked: boolean;\r\n    #eventId: string | null;\r\n    #firstEvent: ICuiMoveData | undefined;\r\n    #wasFirstEventSend: boolean;\r\n    #gesturesEnabled: boolean;\r\n    constructor(bus: ICuiEventBus, gestures: boolean) {\r\n        this.#bus = bus;\r\n        this.#moveListener = new CuiMoveEventListener();\r\n        this.#moveListener.setCallback(this.onMove.bind(this));\r\n        this.#firstEvent = undefined;\r\n        this.#isLocked = false;\r\n        this.#eventId = null;\r\n        this.#wasFirstEventSend = false;\r\n        this.#gesturesEnabled = gestures;\r\n    }\r\n\r\n    attach() {\r\n        if (!this.#moveListener.isAttached()) {\r\n            this.#moveListener.attach();\r\n            this.#eventId = this.#bus.on(EVENTS.MOVE_LOCK, this.onMoveLock.bind(this))\r\n        }\r\n    }\r\n\r\n    detach() {\r\n        if (this.#moveListener.isAttached()) {\r\n            this.#moveListener.detach();\r\n            this.#eventId != null && this.#bus.detach(EVENTS.MOVE_LOCK, this.#eventId);\r\n        }\r\n\r\n    }\r\n\r\n    isAttached() {\r\n        return this.#moveListener.isAttached();\r\n    }\r\n\r\n    private onMove(data: ICuiMoveData) {\r\n        if (this.#isLocked) {\r\n            return;\r\n        }\r\n        switch (data.type) {\r\n            case \"down\":\r\n                this.#firstEvent = data;\r\n                this.#wasFirstEventSend = false\r\n                break;\r\n            case \"move\":\r\n                if (this.#firstEvent && !this.#wasFirstEventSend) {\r\n                    this.pushMoveEvent(this.#firstEvent)\r\n                    this.#wasFirstEventSend = true;\r\n                }\r\n                this.pushMoveEvent(data)\r\n                break;\r\n            case \"up\":\r\n                this.pushMoveEvent(data)\r\n                if (this.#firstEvent) {\r\n                    if (this.#gesturesEnabled) {\r\n                        const { diffX, diffY } = this.getGestureDiff(this.#firstEvent, data);\r\n                        const gesture = this.calculateGesture(diffX, diffY);\r\n                        this.pushGestureEvent(gesture, diffX, diffY);\r\n                    }\r\n                    this.#firstEvent = undefined;\r\n                }\r\n                break;\r\n        }\r\n\r\n    }\r\n\r\n    private pushMoveEvent(data: ICuiMoveData) {\r\n        this.#bus.emit<ICuiMoveEvent>(EVENTS.GLOBAL_MOVE, null, {\r\n            ...data,\r\n            source: \"CuiMoveObserver\",\r\n            timestamp: Date.now(),\r\n            name: EVENTS.GLOBAL_MOVE\r\n        });\r\n    }\r\n\r\n    private onMoveLock(flag: boolean) {\r\n        this.#isLocked = flag;\r\n    }\r\n\r\n    private getGestureDiff(firstEvent: ICuiMoveData, lastEvent: ICuiMoveData) {\r\n        return {\r\n            diffX: lastEvent.x - firstEvent.x,\r\n            diffY: lastEvent.y - firstEvent.y\r\n        }\r\n    }\r\n\r\n    private calculateGesture(diffX: number, diffY: number): GlobalMoveGesture {\r\n        const tresholdX = window.innerWidth * DEFAULT_GESTURE_TRESHOLD;\r\n        const absDiffX = Math.abs(diffX);\r\n        const absDiffY = Math.abs(diffY);\r\n        if (absDiffX > absDiffY && absDiffX > tresholdX) {\r\n            return diffX > 0 ? \"right\" : \"left\";\r\n        }\r\n        const tresholdY = window.innerHeight * DEFAULT_GESTURE_TRESHOLD;\r\n        if (absDiffY > tresholdY) {\r\n            return diffY > 0 ? \"down\" : 'up';\r\n        }\r\n        return 'none';\r\n    }\r\n\r\n    private pushGestureEvent(type: GlobalMoveGesture, diffX: number, diffY: number) {\r\n        const eventName = this.getGestureEventName(type);\r\n        if (!eventName) {\r\n            return;\r\n        }\r\n        this.#bus.emit(eventName, null, {\r\n            timespstamp: Date.now(),\r\n            changeX: diffX,\r\n            changeY: diffY,\r\n            name: eventName,\r\n            source: \"CuiMoveObserver\"\r\n        })\r\n\r\n    }\r\n\r\n    private getGestureEventName(type: GlobalMoveGesture): string | null {\r\n        switch (type) {\r\n            case \"up\":\r\n                return EVENTS.GESTURE_UP;\r\n            case 'down':\r\n                return EVENTS.GESTURE_DOWN;\r\n            case \"left\":\r\n                return EVENTS.GESTURE_LEFT;\r\n            case \"right\":\r\n                return EVENTS.GESTURE_RIGHT;\r\n            default:\r\n                return null;\r\n        }\r\n    }\r\n}","import { ICuiPlugin } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiMoveObserver } from \"./observer\";\r\n\r\n\r\nexport class CuiMoveObserverPlugin implements ICuiPlugin {\r\n    description: string;\r\n    name: string = 'move-observer-plugin';\r\n    setup: any;\r\n    #moveObserver: CuiMoveObserver | undefined;\r\n    #gesturesEnabled: boolean;\r\n    constructor(gestures?: boolean) {\r\n        this.description = \"CuiMoveObserverPlugin\";\r\n        this.#moveObserver = undefined;\r\n        this.#gesturesEnabled = gestures === false ? false : true;\r\n    }\r\n\r\n    init(utils: CuiUtils): void {\r\n        this.#moveObserver = new CuiMoveObserver(utils.bus, this.#gesturesEnabled);\r\n        this.#moveObserver.attach();\r\n    }\r\n\r\n    destroy(): void {\r\n        if (this.#moveObserver && this.#moveObserver.isAttached())\r\n            this.#moveObserver.detach();\r\n    }\r\n}","import { createElementFromString, getIntOrDefault, is } from \"../utils/functions\";\r\n\r\nexport class IconBuilder {\r\n    #element: string;\r\n    #scale: number;\r\n    #appender: IconScaleAppender;\r\n\r\n    constructor(svgString: string) {\r\n        this.#element = svgString;\r\n        this.#scale = 1;\r\n        this.#appender = new IconScaleAppender();\r\n    }\r\n\r\n    setScale(scale: number): IconBuilder {\r\n        this.#scale = scale\r\n        return this\r\n    }\r\n\r\n    build(): Element | null {\r\n        let created = createElementFromString(this.#element)\r\n        if (is(created) && this.#scale) {\r\n            // @ts-ignore created is checked already\r\n            this.#appender.append(created, this.#scale)\r\n        }\r\n        return created\r\n    }\r\n}\r\n\r\nexport class IconScaleAppender {\r\n    append(element: Element, value: number): void {\r\n        let width = getIntOrDefault(element.getAttribute(\"width\"), 20)\r\n        let height = getIntOrDefault(element.getAttribute(\"height\"), 20);\r\n        element.setAttribute(\"width\", (width * value).toString())\r\n        element.setAttribute(\"height\", (height * value).toString())\r\n    }\r\n}","import { IconBuilder } from \"../../core/builders/icon\";\r\nimport { ElementBuilder } from \"../../core/builders/element\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { are, is } from \"../../core/utils/functions\";\r\nimport { CuiNotificationType, ICuiNotification, ICuiNotificationAction } from \"./interfaces\";\r\nimport { CuiDevtoolFactory } from \"../../core/development/factory\";\r\n\r\n\r\n\r\nconst closeIcon = \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 20 20\\\" width=\\\"20\\\" height=\\\"20\\\"><path d=\\\"M 3,3 17,17\\\"></path><path d=\\\"M 17,3 3,17\\\"></path></svg>\";\r\n\r\n\r\nexport default async function getNotification(data: ICuiNotification, utils: CuiUtils, cache: any, onClose: () => void): Promise<HTMLElement | undefined> {\r\n    let prefix = utils.setup.prefix;\r\n\r\n    if (!are(data.title, data.id)) {\r\n        return undefined;\r\n    }\r\n    const parts: ElementBuilder[] = [getHeader(data.title, cache, onClose)];\r\n    if (is(data.message)) {\r\n        //@ts-ignore message is defined\r\n        parts.push(getBody(data.message, cache))\r\n    }\r\n    if (is(data.actions)) {\r\n        //@ts-ignore actions is defined\r\n        parts.push(getFooter(data.actions, cache, onClose));\r\n    }\r\n\r\n    return new ElementBuilder('div').setClasses(cache.NOTIFICATION_CLS, cache.MARGIN_SMALL_VERTICAL, getClassByType(prefix, data.type)).setId(data.id).setRawChildren(...parts).build();\r\n\r\n}\r\n\r\nfunction getHeader(title: string, cache: any, onClose: () => void): ElementBuilder {\r\n    const titleElement = new ElementBuilder('span').setClasses(cache.NOTIFICATION_TITLE_CLS).setTextContent(title);\r\n    const iconCloseElement = new IconBuilder(closeIcon).build();\r\n    const closeElement = new ElementBuilder('a').setClasses(cache.ICON_CLS, cache.NOTIFICATION_CLOSE_CLS).onEvent('click', onClose);\r\n    if (iconCloseElement) {\r\n        closeElement.setChildren(iconCloseElement)\r\n    }\r\n    const header = new ElementBuilder('div').setClasses(cache.NOTIFICATION_HEADER_CLS).setRawChildren(titleElement, closeElement);\r\n    return header;\r\n}\r\n\r\nfunction getBody(message: string, cache: any): ElementBuilder {\r\n    return new ElementBuilder('div').setClasses(cache.NOTIFICATION_BODY_CLS).setRawChildren(new ElementBuilder('div').setTextContent(message));\r\n}\r\n\r\nfunction getFooter(actions: ICuiNotificationAction[], cache: any, onClose: () => void): ElementBuilder {\r\n    return new ElementBuilder('div').setClasses(cache.NOTIFICATION_FOOTER_CLS).setRawChildren(getActionsList(actions, onClose));\r\n}\r\n\r\nfunction getActionsList(actions: ICuiNotificationAction[], onClose: () => void): ElementBuilder {\r\n    return new ElementBuilder('ul').setRawChildren(...actions.map(action => {\r\n        return new ElementBuilder('li').setRawChildren(new ElementBuilder('a').onEvent('click', () => {\r\n            try {\r\n                action.callback();\r\n            } catch (e) {\r\n                const log = CuiDevtoolFactory.get(\"Notifications\");\r\n                log.exception(e, \"OnActionClick\");\r\n            } finally {\r\n                onClose();\r\n            }\r\n        }).setTextContent(action.name))\r\n    }));\r\n}\r\n\r\nfunction getClassByType(prefix: string, type?: CuiNotificationType) {\r\n    return `${prefix}-${type ?? 'default'}`;\r\n}","import { ElementBuilder } from \"../../core/builders/element\";\r\nimport { are, replacePrefix } from \"../../core/utils/functions\";\r\nimport { EVENTS } from \"../../core/utils/statics\";\r\nimport { ICuiPlugin } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiActionsHelper } from \"../../core/helpers/helpers\";\r\nimport { CuiClassAction } from \"../../core/utils/actions\";\r\nimport { ElementsHolder, ICuiNotification, ICuiNotificationPluginSetup } from \"./interfaces\";\r\nimport { validateNotificationData } from \"./helpers\";\r\nimport getNotification from \"./builder\";\r\n\r\n\r\nconst CONTAINER_ID = \"notifications-container\";\r\nconst CONTAINER_CLS = \"{prefix}-notification-container\";\r\n\r\nconst NOTIFICATION_CLS = '{prefix}-notification';\r\nconst NOTIFICATION_HEADER_CLS = '{prefix}-notification-header';\r\nconst NOTIFICATION_TITLE_CLS = '{prefix}-notification-title';\r\nconst NOTIFICATION_BODY_CLS = '{prefix}-notification-body';\r\nconst NOTIFICATION_FOOTER_CLS = '{prefix}-notification-footer';\r\nconst NOTIFICATION_ACTIVE_CLS = '{prefix}-active';\r\nconst NOTIFICATION_ICON_CLS = \"{prefix}-notification-icon\";\r\nconst NOTIFICATION_CLOSE_CLS = \"{prefix}-notification-close\";\r\nconst ICON_CLS = \"{prefix}-icon\";\r\n\r\nconst NOTIFICATION_ANIMATION_IN = \"{prefix}-notification-animation-in\";\r\nconst NOTIFICATION_ANIMATION_OUT = \"{prefix}-notification-animation-out\";\r\nconst MARGIN_SMALL_VERTICAL = \"{prefix}-margin-small-vertical\";\r\n\r\n\r\n\r\n\r\n\r\nexport class CuiNotificationPlugin implements ICuiPlugin {\r\n    description: string;\r\n    name: string = 'notification-plugin';\r\n    setup: any;\r\n    #utils: CuiUtils | undefined;\r\n    #container: HTMLElement | null;\r\n    #handleId: string | null;\r\n    #cache: any;\r\n    #holder: ElementsHolder;\r\n    #actionsHelper: CuiActionsHelper | undefined;\r\n    #timeout: number;\r\n\r\n    constructor(setup: ICuiNotificationPluginSetup) {\r\n        this.description = \"CuiNotificationPlugin\";\r\n        this.#container = null;\r\n        this.#utils = undefined;\r\n        this.#handleId = null;\r\n        this.#cache = {};\r\n        this.#holder = {};\r\n        this.#actionsHelper = undefined;\r\n        this.#timeout = setup.timeout ?? 5000;\r\n    }\r\n\r\n    init(utils: CuiUtils): void {\r\n        this.createCache(utils.setup.prefix);\r\n        this.getOrCreateContainer(utils, document.body);\r\n        this.#actionsHelper = new CuiActionsHelper(utils.interactions);\r\n        this.#utils = utils\r\n        this.#handleId = this.#utils.bus.on(EVENTS.NOTIFY, this.onEvent.bind(this), { $cuid: this.name });\r\n    }\r\n\r\n    destroy(): void {\r\n        if (this.#container)\r\n            this.#container.remove();\r\n        if (this.#handleId && this.#utils) {\r\n            this.#utils.bus.detach(EVENTS.NOTIFY, this.#handleId);\r\n        }\r\n    }\r\n\r\n    private onEvent(data: ICuiNotification) {\r\n        if (!validateNotificationData(data) || !this.#utils || !this.#actionsHelper || !this.#container) {\r\n            return;\r\n        }\r\n\r\n        if (this.#holder[data.id]) {\r\n            return;\r\n        }\r\n        // Create element\r\n        getNotification(data, this.#utils, this.#cache, () => {\r\n            this.onNotificationClose(data, false, true);\r\n        }).then(notificationEl => {\r\n            if (!notificationEl) {\r\n                return;\r\n            }\r\n            this.addNotificationToTree(notificationEl)\r\n            // Set timeout function\r\n            let timeoutId = null;\r\n            //  If auto option is not specifically set to false\r\n            if (!(data.auto === false)) {\r\n                timeoutId = this.setAutoClose(data);\r\n            }\r\n            // Setup holder\r\n            this.#holder[data.id] = {\r\n                element: notificationEl,\r\n                timeoutId: timeoutId\r\n            }\r\n            // Call open\r\n            this.act(notificationEl, this.#cache.NOTIFICATION_ANIMATION_IN).then(() => {\r\n                notificationEl.classList.add(this.#cache.NOTIFICATION_ACTIVE_CLS);\r\n            });\r\n        });\r\n    }\r\n\r\n    private setAutoClose(data: ICuiNotification): any {\r\n        return setTimeout(() => {\r\n            this.onNotificationClose(data, true, false);\r\n        }, this.#timeout);\r\n    }\r\n\r\n    private addNotificationToTree(notifiactionElement: HTMLElement) {\r\n        //@ts-ignore utils is defined\r\n        this.#utils.interactions.mutate(() => {\r\n            // Add to DOM treee\r\n            //@ts-ignore container is defined\r\n            if (this.#container.children.length === 0) {\r\n                //@ts-ignore container is defined\r\n                this.#container.appendChild(notifiactionElement)\r\n            } else {\r\n                //@ts-ignore container is defined\r\n                this.#container.insertBefore(notifiactionElement, this.#container.firstChild);\r\n            }\r\n        }, null)\r\n    }\r\n\r\n    private onNotificationClose(notification: ICuiNotification, fromTimeout: boolean, dissmissed: boolean) {\r\n        if (!notification || !this.#actionsHelper || !this.#utils) {\r\n            return;\r\n        }\r\n        const holder = this.#holder[notification.id];\r\n        if (!holder) {\r\n            return;\r\n        }\r\n\r\n        if (!fromTimeout) {\r\n            clearTimeout(holder.timeoutId);\r\n        }\r\n\r\n        this.act(holder.element, this.#cache.NOTIFICATION_ANIMATION_OUT).then(() => {\r\n            // @ts-ignore utils is defined\r\n            this.#utils.bus.emit(EVENTS.NOTIFIED, null, { ...notification, dissmissed: dissmissed })\r\n            holder.element.remove();\r\n            delete this.#holder[notification.id];\r\n        })\r\n    }\r\n\r\n    private getOrCreateContainer(utils: CuiUtils, root: HTMLElement) {\r\n        this.#container = document.getElementById(CONTAINER_ID);\r\n        if (!this.#container) {\r\n            this.#container = new ElementBuilder('div').setClasses(replacePrefix(CONTAINER_CLS, utils.setup.prefix)).build();\r\n            root.appendChild(this.#container);\r\n        }\r\n    }\r\n\r\n    private createCache(prefix: string) {\r\n        this.#cache = {\r\n            \"NOTIFICATION_CLS\": replacePrefix(NOTIFICATION_CLS, prefix),\r\n            \"NOTIFICATION_HEADER_CLS\": replacePrefix(NOTIFICATION_HEADER_CLS, prefix),\r\n            \"NOTIFICATION_TITLE_CLS\": replacePrefix(NOTIFICATION_TITLE_CLS, prefix),\r\n            \"NOTIFICATION_BODY_CLS\": replacePrefix(NOTIFICATION_BODY_CLS, prefix),\r\n            \"NOTIFICATION_FOOTER_CLS\": replacePrefix(NOTIFICATION_FOOTER_CLS, prefix),\r\n            \"NOTIFICATION_ACTIVE_CLS\": replacePrefix(NOTIFICATION_ACTIVE_CLS, prefix),\r\n            \"NOTIFICATION_ANIMATION_IN\": replacePrefix(NOTIFICATION_ANIMATION_IN, prefix),\r\n            \"NOTIFICATION_ANIMATION_OUT\": replacePrefix(NOTIFICATION_ANIMATION_OUT, prefix),\r\n            \"NOTIFICATION_ICON_CLS\": replacePrefix(NOTIFICATION_ICON_CLS, prefix),\r\n            \"NOTIFICATION_CLOSE_CLS\": replacePrefix(NOTIFICATION_CLOSE_CLS, prefix),\r\n            \"ICON_CLS\": replacePrefix(ICON_CLS, prefix),\r\n            \"MARGIN_SMALL_VERTICAL\": replacePrefix(MARGIN_SMALL_VERTICAL, prefix),\r\n        }\r\n    }\r\n\r\n    async act(element: HTMLElement, animationClass: string, timeout?: number): Promise<boolean> {\r\n        //@ts-ignore utils is ignored\r\n        const delay = timeout ?? this.#utils.setup.animationTime;\r\n        const action = new CuiClassAction(animationClass);\r\n        //@ts-ignore actionsHelper is defined\r\n        return this.#actionsHelper.performAction(element, action, delay ?? 0);\r\n    }\r\n\r\n}","import { are, is } from \"../../core/utils/functions\";\r\nimport { ICuiNotification } from \"./interfaces\";\r\n\r\nexport function validateNotificationData(data: ICuiNotification): boolean {\r\n    return is(data) && are(data.id, data.title);\r\n}","import { ICuiPlugin } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { getSystemPrintMode } from \"../../core/utils/functions\";\r\nimport { CuiMediaQueryListener } from \"../../core/listeners/media\";\r\n\r\nexport interface AutoPrintPluginSetup {\r\n    autoPrint: boolean;\r\n}\r\n\r\nexport class CuiAutoPrintModePlugin implements ICuiPlugin {\r\n    description: string = 'Auto print mode';\r\n    name: string = 'auto-print';\r\n    setup: AutoPrintPluginSetup;\r\n    #listener: CuiMediaQueryListener | undefined;\r\n    #utils: CuiUtils | undefined;\r\n    constructor(autoPrintInit: AutoPrintPluginSetup) {\r\n        this.description = \"CuiAutoPrintModePlugin\";\r\n        this.setup = autoPrintInit;\r\n        this.#listener = undefined;\r\n        this.#utils = undefined;\r\n    }\r\n\r\n    init(utils: CuiUtils): void {\r\n        this.#utils = utils;\r\n        if (this.setup.autoPrint && getSystemPrintMode()) {\r\n            this.#utils.setPrintMode(true)\r\n        }\r\n        this.#listener = new CuiMediaQueryListener('print')\r\n        this.#listener.setCallback(this.onChange.bind(this))\r\n        this.#listener.attach();\r\n    }\r\n\r\n    destroy(): void {\r\n        if (this.#listener)\r\n            this.#listener.detach();\r\n    }\r\n\r\n    onChange(ev: MediaQueryListEvent) {\r\n        if (!this.#utils) {\r\n            return;\r\n        }\r\n        this.setup = this.#utils.setup.plugins[this.description] as AutoPrintPluginSetup;\r\n        let autoPrint = this.setup?.autoPrint ?? false;\r\n        if (autoPrint) {\r\n            if (ev.matches) {\r\n                this.#utils.setPrintMode(true)\r\n            } else {\r\n                this.#utils.setPrintMode(false)\r\n            }\r\n        }\r\n    }\r\n\r\n}","import { CuiWindowSize } from \"../../core/utils/types\";\r\nimport { calcWindowSize } from \"../../core/utils/functions\";\r\nimport { ICuiEventBus } from \"../../core/bus/interfaces\";\r\nimport { EVENTS } from \"../../core/utils/statics\";\r\nimport { CuiResizeData } from \"src/core/models/events\";\r\n\r\nexport interface ICuiResizable {\r\n    resize(data: CuiResizeData): Promise<boolean>;\r\n}\r\n\r\nexport interface ICuiResizableObserver {\r\n    observe(target: ICuiResizable): void;\r\n    unobserve(target: ICuiResizable): void;\r\n    connect(): void;\r\n    disconnect(): void;\r\n}\r\n\r\n\r\n\r\nexport class CuiResizeObserver implements ICuiResizableObserver {\r\n\r\n    #items: ICuiResizable[];\r\n    #promises: Promise<boolean>[];\r\n    #prevYValue: number;\r\n    #inProgress: boolean;\r\n    #previousSize: CuiWindowSize;\r\n    #threshold: number;\r\n    #bus: ICuiEventBus;\r\n    #listenerBoundCall: (ev: UIEvent) => void;\r\n    constructor(bus: ICuiEventBus, threshold?: number) {\r\n        this.#items = [];\r\n        this.#promises = [];\r\n        this.#prevYValue = window.innerWidth;\r\n        this.#inProgress = false;\r\n        this.#previousSize = calcWindowSize(window.innerWidth)\r\n        this.#threshold = threshold ?? 0;\r\n        this.#bus = bus;\r\n        this.#listenerBoundCall = this.listener.bind(this);\r\n    }\r\n\r\n    observe(target: ICuiResizable): void {\r\n        let idx = this.#items.findIndex(x => x === target)\r\n        if (idx < 0) {\r\n            this.#items.push(target);\r\n        }\r\n    }\r\n\r\n    unobserve(target: ICuiResizable): void {\r\n        let idx = this.#items.findIndex(x => x === target)\r\n        if (idx >= 0) {\r\n            this.#items.splice(idx, 1)\r\n        }\r\n    }\r\n    connect(): void {\r\n        window.addEventListener('resize', this.#listenerBoundCall)\r\n    }\r\n\r\n    disconnect(): void {\r\n        window.removeEventListener('resize', this.#listenerBoundCall)\r\n    }\r\n\r\n    private pushUpdateToItems(resizeData: CuiResizeData) {\r\n        if (this.#items.length < 1) {\r\n            return;\r\n        }\r\n        this.#promises = [];\r\n        this.#items.forEach(x => {\r\n            this.#promises.push(x.resize(resizeData))\r\n        })\r\n        Promise.all(this.#promises)\r\n        this.#promises = [];\r\n    }\r\n\r\n    private listener(ev: UIEvent) {\r\n        if (this.#inProgress) {\r\n            return;\r\n        }\r\n        this.#inProgress = true\r\n        const diff = window.innerWidth - this.#prevYValue;\r\n\r\n        if (Math.abs(diff) >= this.#threshold) {\r\n            const currentSize = calcWindowSize(window.innerWidth);\r\n            if (currentSize !== this.#previousSize) {\r\n                const resizeData: CuiResizeData = {\r\n                    current: currentSize,\r\n                    previous: this.#previousSize,\r\n                    width: window.innerWidth,\r\n                    height: window.innerHeight,\r\n                    timestamp: Date.now(),\r\n                    name: EVENTS.RESIZE,\r\n                    source: \"CuiResizeObserver\"\r\n                };\r\n                this.#bus.emit(EVENTS.RESIZE, \"\", resizeData)\r\n                this.pushUpdateToItems(resizeData);\r\n\r\n                this.#previousSize = currentSize;\r\n            }\r\n        }\r\n        this.#inProgress = false\r\n    }\r\n\r\n\r\n}","import { ICuiPlugin } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { ICuiResizableObserver, CuiResizeObserver } from \"./observer\";\r\n\r\nexport interface CuiResizeObserverPluginSetup {\r\n    resizeThreshold?: number;\r\n}\r\n\r\nexport class CuiResizeObserverPlugin implements ICuiPlugin {\r\n    description: string;\r\n    name: string = 'resize-observer-plugin';\r\n    setup: any;\r\n    #resizeObserver: ICuiResizableObserver | undefined;\r\n\r\n    constructor(setup: CuiResizeObserverPluginSetup) {\r\n        this.description = \"CuiResizeObserverPlugin\";\r\n        this.#resizeObserver = undefined;\r\n        this.setup = setup\r\n    }\r\n\r\n    init(utils: CuiUtils): void {\r\n        this.#resizeObserver = new CuiResizeObserver(utils.bus, this.setup.resizeThreshold ?? 20);\r\n        this.#resizeObserver.connect();\r\n    }\r\n\r\n    destroy(): void {\r\n        if (this.#resizeObserver)\r\n            this.#resizeObserver.disconnect();\r\n    }\r\n}","import { IUIInteractionProvider } from \"../../core/models/interfaces\";\r\nimport { is, sleep } from \"../../core/utils/functions\";\r\nimport { CLASSES } from \"../../core/utils/statics\";\r\n\r\nexport class CuiToastHandler {\r\n    #interactions: IUIInteractionProvider;\r\n    #selector: string;\r\n    #className: string;\r\n    #activeCls: string;\r\n    #animationTime: number;\r\n    #lock: boolean;\r\n    #animClsIn: string;\r\n    #animClsOut: string;\r\n    constructor(interaction: IUIInteractionProvider, prefix: string, animationTime: number) {\r\n        this.#interactions = interaction;\r\n        this.#selector = `.${prefix}-toast`;\r\n        this.#className = `${prefix}-toast`;\r\n        this.#activeCls = `${prefix}-active`;\r\n        this.#animationTime = animationTime;\r\n        this.#lock = false;\r\n        this.#animClsIn = `${prefix}-toast-animation-in`;\r\n        this.#animClsOut = `${prefix}-toast-animation-out`\r\n    }\r\n\r\n    async show(message: string): Promise<boolean> {\r\n        if (this.#lock) {\r\n            return false;\r\n        }\r\n        this.#lock = true;\r\n        let toastElement = document.querySelector(this.#selector);\r\n        if (!is(toastElement)) {\r\n            toastElement = document.createElement('div');\r\n            toastElement.classList.add(this.#className);\r\n            document.body.appendChild(toastElement);\r\n            await sleep(10);\r\n        }\r\n\r\n        this.#interactions.mutate(() => {\r\n            //@ts-ignore\r\n            toastElement.textContent = message;\r\n            //@ts-ignore\r\n            toastElement.classList.add(CLASSES.animProgress);\r\n            //@ts-ignore\r\n            toastElement.classList.add(this.#animClsIn);\r\n        }, this);\r\n\r\n        await sleep(this.#animationTime);\r\n        this.#interactions.mutate(() => {\r\n            //@ts-ignore\r\n            toastElement.classList.remove(CLASSES.animProgress);\r\n            //@ts-ignore\r\n            toastElement.classList.remove(this.#animClsIn);\r\n            //@ts-ignore\r\n            toastElement.classList.add(this.#activeCls);\r\n        }, this)\r\n        await sleep(3000);\r\n        this.#interactions.mutate(() => {\r\n            //@ts-ignore\r\n            toastElement.classList.add(CLASSES.animProgress);\r\n            //@ts-ignore\r\n            toastElement.classList.add(this.#animClsOut);\r\n        }, this)\r\n\r\n        setTimeout(() => {\r\n            this.#interactions.mutate(() => {\r\n                //@ts-ignore\r\n                toastElement.classList.remove(CLASSES.animProgress);\r\n                //@ts-ignore\r\n                toastElement.classList.remove(this.#animClsOut);\r\n                //@ts-ignore\r\n                toastElement.classList.remove(this.#activeCls);\r\n            }, this)\r\n            this.#lock = false;\r\n        }, this.#animationTime);\r\n        return true;\r\n    }\r\n}","import { EVENTS } from \"../../core/utils/statics\";\r\nimport { ICuiPlugin } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiToastHandler } from \"./handler\";\r\n\r\nexport interface CuiToastPluginSetup {\r\n\r\n}\r\n\r\nexport class CuiToastPlugin implements ICuiPlugin {\r\n    description: string;\r\n    name: string = 'toast-plugin';\r\n    setup: any;\r\n    #toastHandler: CuiToastHandler | undefined;\r\n    #eventId: string | null;\r\n    #utils: CuiUtils | undefined;\r\n    constructor(setup: CuiToastPluginSetup) {\r\n        this.description = \"CuiToastPlugin\";\r\n        this.setup = setup;\r\n        this.#toastHandler = undefined;\r\n        this.#eventId = null;\r\n        this.#utils = undefined;\r\n    }\r\n\r\n    init(utils: CuiUtils): void {\r\n        this.#utils = utils;\r\n        if (!this.#toastHandler) {\r\n            this.#toastHandler = new CuiToastHandler(utils.interactions, utils.setup.prefix, utils.setup.animationTime ?? 300);\r\n        }\r\n\r\n        this.#eventId = utils.bus.on(EVENTS.TOAST, this.onToastShow.bind(this), { $cuid: this.name });\r\n    }\r\n\r\n    destroy(): void {\r\n        if (this.#utils && this.#eventId) {\r\n            this.#utils.bus.detach(EVENTS.TOAST, this.#eventId);\r\n            this.#eventId = null;\r\n        }\r\n    }\r\n\r\n    private onToastShow(message: string) {\r\n        if (!this.#toastHandler || !this.#utils) {\r\n            return;\r\n        }\r\n        this.#utils.bus.emit(EVENTS.TOAST_SHOW, null, []);\r\n        this.#toastHandler.show(message).then(() => {\r\n            if (this.#utils)\r\n                this.#utils.bus.emit(EVENTS.TOAST_HIDDEN, null, []);\r\n        })\r\n    }\r\n}","export class AriaAttributes {\r\n    public static setLabel(element: Element, label: string): void {\r\n        if (!element.hasAttribute('aria-label')) {\r\n            element.setAttribute('aria-label', label);\r\n        }\r\n    }\r\n\r\n    public static setAria(element: Element, attr: string, value: string) {\r\n        if (!element.hasAttribute(attr)) {\r\n            element.setAttribute(attr, value);\r\n        }\r\n    }\r\n\r\n    public static removeAria(element: Element, attr: string) {\r\n        if (element.hasAttribute(attr)) {\r\n            element.removeAttribute(attr);\r\n        }\r\n    }\r\n}","import { ICuiDictionary, ICuiDictionaryItem } from \"../models/interfaces\";\r\nimport { ItemNotFoundError, ArgumentError } from \"../models/errors\";\r\nimport { is } from \"./functions\";\r\n\r\nexport class CuiDictionary<T> implements ICuiDictionary<T> {\r\n\r\n    #keys: string[];\r\n    #values: T[];\r\n    #lock: boolean;\r\n\r\n    constructor(init?: ICuiDictionaryItem<T>[]) {\r\n        this.#keys = []\r\n        this.#values = []\r\n        this.#lock = false;\r\n\r\n        if (init) {\r\n            init.forEach(x => {\r\n                if (!is(x.key)) {\r\n                    this.#keys = []\r\n                    this.#values = []\r\n                    throw new ArgumentError(\"Key is empty\");\r\n                }\r\n                this.add(x.key, x.value)\r\n            })\r\n        }\r\n    }\r\n\r\n    add(key: string, value: T): void {\r\n        this.throwOnEmptyKey(key)\r\n        this.lock(() => {\r\n            if (this.containsKey(key))\r\n                throw new Error(\"Key already exists\");\r\n            this.#keys.push(key)\r\n            this.#values.push(value)\r\n        })\r\n    }\r\n\r\n    remove(key: string): void {\r\n        this.throwOnEmptyKey(key);\r\n        this.lock(() => {\r\n            let index = this.#keys.indexOf(key);\r\n            if (index < 0) {\r\n                return;\r\n            }\r\n            this.#keys.splice(index, 1)\r\n            this.#values.splice(index, 1)\r\n        })\r\n    }\r\n\r\n    get(key: string): T | undefined {\r\n        this.throwOnEmptyKey(key)\r\n        let value = undefined\r\n        this.lock(() => {\r\n            let index = this.indexOf(key)\r\n            if (index >= 0) {\r\n                value = this.#values[index];\r\n            }\r\n        })\r\n        return value;\r\n    }\r\n\r\n    containsKey(key: string): boolean {\r\n        return is(key) && this.indexOf(key) >= 0\r\n    }\r\n\r\n    keys(): string[] {\r\n        return [...this.#keys];\r\n    }\r\n    values(): T[] {\r\n        return [...this.#values];\r\n    }\r\n\r\n    indexOf(key: string): number {\r\n        return is(key) ? this.#keys.indexOf(key) : -1;\r\n    }\r\n\r\n    update(key: string, value: T): void {\r\n        this.throwOnEmptyKey(key)\r\n        this.lock(() => {\r\n            let index = this.indexOf(key)\r\n            if (index < 0) {\r\n                throw new ItemNotFoundError(`Item with key [${key}] not found`)\r\n            }\r\n            this.#values[index] = value\r\n        })\r\n\r\n    }\r\n\r\n    clear() {\r\n        this.lock(() => {\r\n            this.#values = [];\r\n            this.#keys = [];\r\n        });\r\n\r\n    }\r\n\r\n    forEach(callback: (key: string, value: T) => void) {\r\n        this.lock(() => {\r\n            let len = this.#keys.length;\r\n            for (let index = 0; index < len; index++) {\r\n                callback(this.#keys[index], this.#values[index]);\r\n            }\r\n        });\r\n    }\r\n\r\n    private checkLock(): void {\r\n        if (this.#lock) {\r\n            throw new Error(\"You cannot alter dictionary when is locked!\");\r\n        }\r\n    }\r\n\r\n    private lock(callback: () => void) {\r\n        this.checkLock();\r\n        this.#lock = true;\r\n        try {\r\n            callback();\r\n        } catch (e) {\r\n            throw e;\r\n        } finally {\r\n            this.#lock = false;\r\n        }\r\n    }\r\n\r\n    private throwOnEmptyKey(key: string) {\r\n        if (!is(key)) {\r\n            throw new ArgumentError(\"Key is empty\");\r\n        }\r\n    }\r\n}","import { ICuiDictionary } from \"../../../core/models/interfaces\";\r\nimport { CuiDictionary } from \"../../../core/utils/dictionary\";\r\nimport { ICuiHandlerModule } from \"./interfaces\";\r\n\r\nexport class CuiModulesHandler<T> {\r\n    #dict: ICuiDictionary<ICuiHandlerModule<T>>;\r\n    constructor() {\r\n        this.#dict = new CuiDictionary();\r\n    }\r\n\r\n    add(module: ICuiHandlerModule<T>): void {\r\n        this.#dict.add(module.type, module);\r\n    }\r\n\r\n    remove(type: string): void {\r\n        this.#dict.remove(type);\r\n    }\r\n\r\n    async init(args: T): Promise<boolean> {\r\n        let promises: Promise<boolean>[] = []\r\n        this.#dict.forEach((name, module) => promises.push(module.init(args)))\r\n        await Promise.all(promises);\r\n        return true;\r\n    }\r\n\r\n    async update(args: T): Promise<boolean> {\r\n        let promises: Promise<boolean>[] = []\r\n        this.#dict.forEach((name, module) => {\r\n            if (module.update) {\r\n                promises.push(module.update(args));\r\n            }\r\n        })\r\n        await Promise.all(promises);\r\n        return true;\r\n    }\r\n\r\n    async destroy(): Promise<boolean> {\r\n        let promises: Promise<boolean>[] = []\r\n        this.#dict.forEach((name, module) => promises.push(module.destroy()))\r\n        await Promise.all(promises);\r\n        return true\r\n    }\r\n}","import { IUIInteractionProvider, CuiContext, ICuiComponentHandler, ICuiParsable, ICuiOpenable, ICuiClosable, CuiHTMLElement } from \"../models/interfaces\";\r\nimport { CuiUtils } from \"../models/utils\";\r\nimport { ICuiComponentMutationObserver, CuiComponentMutationHandler } from \"../observers/mutations\";\r\nimport { AriaAttributes } from \"../utils/aria\";\r\nimport { CuiActionsHelper } from \"../helpers/helpers\";\r\nimport { ICuiComponentAction, CuiActionsListFactory } from \"../utils/actions\";\r\nimport { is, getActiveClass, clone } from \"../utils/functions\";\r\nimport { EVENTS } from \"../utils/statics\";\r\nimport { ICuiDevelopmentTool } from \"../development/interfaces\";\r\nimport { CuiDevtoolFactory } from \"../development/factory\";\r\nimport { EventBase, KeyDownEvent } from \"../models/events\";\r\nimport { CuiModulesHandler } from \"./modules/handler\";\r\nimport { ICuiHandlerModule } from \"./modules/interfaces\";\r\n\r\nexport interface CuiChildMutation {\r\n    removed: Node[];\r\n    added: Node[];\r\n    changed: Node[];\r\n}\r\n\r\nexport class ComponentHelper {\r\n    #interactions: IUIInteractionProvider;\r\n    constructor(interactions: IUIInteractionProvider) {\r\n        this.#interactions = interactions;\r\n    }\r\n\r\n    hasClass(cls: string, element: Element): boolean {\r\n        return cls && element.classList.contains(cls) ? true : false;\r\n    }\r\n\r\n    setClass(cls: string, element: Element): void {\r\n        this.setClasses([cls], element);\r\n    }\r\n\r\n    setClasses(classes: string[], element?: Element) {\r\n        if (element) {\r\n            element.classList.add(...classes)\r\n        }\r\n    }\r\n\r\n    setClassesAs(element: Element, ...classes: string[]) {\r\n        this.#interactions.mutate(this.setClasses, this, classes, element);\r\n    }\r\n\r\n    removeClass(cls: string, element: Element) {\r\n        this.removeClasses([cls], element);\r\n    }\r\n\r\n    removeClasses(classes: string[], element?: Element) {\r\n        if (element) {\r\n            element.classList.remove(...classes)\r\n        }\r\n    }\r\n\r\n    removeClassesAs(element: Element, ...classes: string[]) {\r\n        this.#interactions.mutate(this.removeClasses, this, classes, element);\r\n    }\r\n\r\n    removeAttribute(attributeName: string, element: Element) {\r\n        if (element && element.hasAttribute(attributeName))\r\n            element.removeAttribute(attributeName);\r\n    }\r\n\r\n    setStyle(element: any, property: string, value: string) {\r\n        if (element && element[\"style\"] && is(value)) {\r\n            element.style[property] = value\r\n        }\r\n    }\r\n\r\n\r\n}\r\n\r\nexport class CuiComponentBase implements CuiContext {\r\n    _log: ICuiDevelopmentTool;\r\n    utils: CuiUtils;\r\n    element: HTMLElement;\r\n    cuid: string;\r\n    isLocked: boolean;\r\n    activeClassName: string;\r\n    helper: ComponentHelper;\r\n    #emittedEvents: string[];\r\n    componentName: string;\r\n    constructor(componentName: string, element: HTMLElement, utils: CuiUtils) {\r\n        this._log = CuiDevtoolFactory.get(componentName);\r\n        this.utils = utils;\r\n        this.element = element;\r\n        this.cuid = (<any>element).$cuid;\r\n        this.isLocked = false;\r\n        // this._log.setId(this.cuid);\r\n        this.activeClassName = getActiveClass(utils.setup.prefix);\r\n        this.helper = new ComponentHelper(utils.interactions);\r\n        this.#emittedEvents = [];\r\n        this.componentName = componentName;\r\n    }\r\n\r\n\r\n    mutate(callback: any, ...args: any[]): void {\r\n        this.utils.interactions.mutate(callback, this, ...args)\r\n    }\r\n\r\n    fetch(callback: any, ...args: any[]): void {\r\n        this.utils.interactions.fetch(callback, this, ...args)\r\n    }\r\n\r\n    getEventName(name: string) {\r\n        return [name, this.cuid].join('-');\r\n    }\r\n\r\n    /**\r\n     * Emits event using passed data and cuid of the element\r\n     * NOTE: Don't use it to emit global events\r\n     * @param event Event name\r\n     * @param data Data to emit\r\n     */\r\n    emitEvent<T extends EventBase>(event: string, data: T, source?: CuiHTMLElement) {\r\n        if (!this.#emittedEvents.includes(event))\r\n            this.#emittedEvents.push(event);\r\n\r\n        this.utils.bus.emit(event, this.cuid, {\r\n            ...data,\r\n            name: event,\r\n            timestamp: Date.now(),\r\n            source: source ?? this.element,\r\n        })\r\n    }\r\n\r\n    onEvent<T>(event: string, callback: (t: T) => void): string | null {\r\n        return this.utils.bus.on(event, callback, this.element as any)\r\n    }\r\n\r\n    detachEvent(event: string, id: string | null) {\r\n        if (id != null) {\r\n            this.utils.bus.detach(event, id);\r\n            id = \"\";\r\n        }\r\n    }\r\n\r\n    getId(): string {\r\n        return this.cuid;\r\n    }\r\n\r\n    checkLockAndWarn(fName?: string): boolean {\r\n        if (this.isLocked) {\r\n            this._log.warning(\"Component is locked\", fName)\r\n            return true\r\n        }\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * Helper which checks whether element has an active flag set\r\n     */\r\n    isActive(): boolean {\r\n        return this.element.classList.contains(this.activeClassName);\r\n    }\r\n\r\n    detachEmiitedEvents() {\r\n        this.#emittedEvents.forEach(event => {\r\n            this.utils.bus.detachByCuid(event, this.cuid);\r\n            this._log.debug(\"Detaching event: \" + event + \" on component delete\");\r\n        })\r\n    }\r\n\r\n    registerInDebug(): void {\r\n        this._log.registerElement(this.element, this.cuid, this.componentName);\r\n    }\r\n\r\n    removeFromDebug(): void {\r\n        this._log.unregisterElement(this.cuid, this.componentName);\r\n    }\r\n\r\n    setDebugProperty<T>(name: string, value: T): void {\r\n    }\r\n\r\n    logInfo(message: string, functionName?: string) {\r\n        this._log.debug(message, functionName);\r\n    }\r\n\r\n    logWarning(message: string, functionName?: string) {\r\n        this._log.warning(message, functionName);\r\n    }\r\n\r\n    logError(message: string, functionName?: string, error?: Error) {\r\n        this._log.error(message, functionName);\r\n        if (error) {\r\n            this._log.exception(error, functionName)\r\n        }\r\n    }\r\n}\r\n\r\nexport abstract class CuiHandlerBase<T extends ICuiParsable> extends CuiComponentBase implements ICuiComponentHandler {\r\n    args: T;\r\n    prevArgs: T | undefined;\r\n    isInitialized: boolean;\r\n    actionsHelper: CuiActionsHelper;\r\n    #attribute: string;\r\n    #moduleHandler: CuiModulesHandler<T>;\r\n    constructor(componentName: string, element: HTMLElement, attribute: string, args: T, utils: CuiUtils) {\r\n        super(componentName, element, utils);\r\n        this.args = args;\r\n        this.actionsHelper = new CuiActionsHelper(utils.interactions)\r\n        this.prevArgs = undefined;\r\n        this.isInitialized = false;\r\n        this.#attribute = attribute;\r\n        this.#moduleHandler = new CuiModulesHandler();\r\n    }\r\n\r\n    async handle(args: any): Promise<boolean> {\r\n\r\n        if (this.isInitialized) {\r\n            this.logWarning(\"Trying to initialize handler again\", 'handle');\r\n            return false;\r\n        }\r\n        if (!this.checkLock(\"handle\")) {\r\n            return false;\r\n        }\r\n        this.isLocked = true;\r\n        this.registerInDebug();\r\n        this.args.parse(args);\r\n        if (!this.element.classList.contains(this.#attribute)) {\r\n            this.helper.setClassesAs(this.element, this.#attribute)\r\n        }\r\n\r\n        this.logInfo(\"Init\", 'handle');\r\n        await this.#moduleHandler.init(args);\r\n        return this.performLifecycleOp(\"onHandle\", this.onHandle(), () => {\r\n            this.isLocked = false; this.isInitialized = true;\r\n        });\r\n    }\r\n\r\n    async refresh(args: any): Promise<boolean> {\r\n        this.logInfo(\"Update\", 'refresh')\r\n        if (!this.isInitialized) {\r\n            this.logError(\"Cannot update not initialized component\", 'refresh');\r\n            return false;\r\n        }\r\n        if (!this.checkLock(\"refresh\")) {\r\n            return false;\r\n        }\r\n        this.isLocked = true;\r\n\r\n        this.prevArgs = clone(this.args);\r\n        this.args.parse(args);\r\n        this._log.debug(\"Component update\", 'refresh');\r\n        await this.#moduleHandler.update(args);\r\n        return this.performLifecycleOp(\"onRefresh\", this.onRefresh(), () => {\r\n            this.isLocked = false;\r\n        });\r\n    }\r\n\r\n    async destroy(): Promise<boolean> {\r\n        this.logInfo(\"Destroy\", \"destroy\");\r\n        if (!this.isInitialized) {\r\n            this.logError(\"Cannot update not initialized component\", 'destroy');\r\n            return false;\r\n        }\r\n        if (!this.checkLock('destroy')) {\r\n            return false;\r\n        }\r\n        this.isLocked = true;\r\n        await this.#moduleHandler.destroy();\r\n        return this.performLifecycleOp(\"onRemove\", this.onRemove(), () => {\r\n            this.detachEmiitedEvents();\r\n            this.removeFromDebug();\r\n            this.isInitialized = false;\r\n            this.isLocked = false;\r\n        });\r\n    }\r\n\r\n    /**\r\n    * Helper created for elements that animate - perfroms an action *add*, after timeout it performs *remove*.\r\n    * \r\n    * @param action - action to perfrom\r\n    * @param timeout - timeout specified for action removal\r\n    * @param onFinish - callback to be performed after action is finished after removal\r\n    * @param callback - optional - callback to be executed in mutation on action removal, e.g. additional DOM changes on element\r\n    */\r\n    async performAction(actions: ICuiComponentAction[], timeout: number, onFinish: () => void, callback?: () => void): Promise<boolean> {\r\n        if (await this.actionsHelper.performActions(this.element, actions, timeout, callback)) {\r\n            onFinish();\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    addModule(module: ICuiHandlerModule<T>) {\r\n        this.#moduleHandler.add(module);\r\n    }\r\n\r\n    private checkLock(method?: string): boolean {\r\n        if (this.isLocked) {\r\n            this.logWarning(\"Handler is locked\", method);\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n\r\n\r\n    private async performLifecycleOp(method: string, operation: Promise<boolean>, onFinish: () => void): Promise<boolean> {\r\n        let result = false;\r\n        try {\r\n            result = await operation;\r\n        } catch (e) {\r\n            this.logError(\"An exception occured in\" + method, method, e)\r\n        } finally {\r\n            onFinish();\r\n        }\r\n        return result\r\n    }\r\n\r\n\r\n    // Abstract\r\n    abstract onHandle(): Promise<boolean>;\r\n    abstract onRefresh(): Promise<boolean>;\r\n    abstract onRemove(): Promise<boolean>;\r\n}\r\n\r\n\r\nexport interface CuiInteractableArgs {\r\n    timeout: number;\r\n    openAct: string;\r\n    closeAct: string;\r\n    escClose: boolean;\r\n    keyClose: string;\r\n}\r\n\r\nexport abstract class CuiInteractableHandler<T extends ICuiParsable & CuiInteractableArgs> extends CuiHandlerBase<T> implements ICuiOpenable, ICuiClosable {\r\n    #openEventId: string | null;\r\n    #closeEventId: string | null;\r\n    #keyCloseEventId: string | null;\r\n    #openAct: ICuiComponentAction[];\r\n    #closeAct: ICuiComponentAction[];\r\n    constructor(componentName: string, element: HTMLElement, attribute: string, args: T, utils: CuiUtils) {\r\n        super(componentName, element, attribute, args, utils);\r\n        this.#openEventId = null;\r\n        this.#closeEventId = null;\r\n        this.#keyCloseEventId = null;\r\n        this.#closeAct = [];\r\n        this.#openAct = [];\r\n    }\r\n\r\n    async onHandle(): Promise<boolean> {\r\n        this.#openEventId = this.onEvent(EVENTS.OPEN, this.openFromEvent.bind(this))\r\n        this.#closeEventId = this.onEvent(EVENTS.CLOSE, this.closeFromEvent.bind(this))\r\n        this.#openAct = CuiActionsListFactory.get(this.args.openAct)\r\n        this.#closeAct = CuiActionsListFactory.get(this.args.closeAct)\r\n        this.onInit();\r\n        return true;\r\n    }\r\n\r\n\r\n    async onRefresh(): Promise<boolean> {\r\n        if (!this.prevArgs || this.args.openAct !== this.prevArgs.openAct) {\r\n            this.#openAct = CuiActionsListFactory.get(this.args.openAct)\r\n        }\r\n        if (!this.prevArgs || this.args.closeAct !== this.prevArgs.closeAct) {\r\n            this.#closeAct = CuiActionsListFactory.get(this.args.closeAct)\r\n        }\r\n        this.onUpdate();\r\n        return true;\r\n    }\r\n\r\n    async onRemove(): Promise<boolean> {\r\n        this.detachEvent(EVENTS.CLOSE, this.#closeEventId);\r\n        this.detachEvent(EVENTS.OPEN, this.#openEventId);\r\n        this.onDestroy();\r\n        return true;\r\n    }\r\n\r\n    async open(args?: any): Promise<boolean> {\r\n        if (this.checkLockAndWarn(\"open\")) {\r\n            return false;\r\n        }\r\n        if (this.isActive()) {\r\n            this.logWarning(\"Component is already opened\");\r\n            return false;\r\n        }\r\n        if (this.args.escClose || is(this.args.keyClose)) {\r\n            this.#keyCloseEventId = this.onEvent(EVENTS.KEYDOWN, this.onKeyClose.bind(this))\r\n        }\r\n\r\n        if (!this.onBeforeOpen()) {\r\n            return false;\r\n        }\r\n        this.isLocked = true;\r\n        return this.performAction(this.#openAct, this.args.timeout, this.onActionFinish.bind(this, this.onAfterOpen.bind(this), EVENTS.OPENED, args), () => {\r\n            this.helper.setClass(this.activeClassName, this.element)\r\n            AriaAttributes.setAria(this.element, 'aria-expanded', 'true');\r\n        });\r\n    }\r\n\r\n    async close(args?: any): Promise<boolean> {\r\n        if (this.checkLockAndWarn(\"close\")) {\r\n            return false;\r\n        }\r\n        if (!this.isActive()) {\r\n            this.logWarning(\"Component is already closed\");\r\n            return false;\r\n        }\r\n\r\n        this.detachEvent(EVENTS.KEYDOWN, this.#keyCloseEventId);\r\n        if (!this.onBeforeClose()) {\r\n            return false;\r\n        }\r\n        this.isLocked = true;\r\n        return this.performAction(this.#closeAct, this.args.timeout, this.onActionFinish.bind(this, this.onAfterClose.bind(this), EVENTS.CLOSED, args), () => {\r\n            this.helper.removeClass(this.activeClassName, this.element)\r\n            AriaAttributes.setAria(this.element, 'aria-expanded', 'false');\r\n        });;\r\n    }\r\n\r\n\r\n    /**\r\n     * Helper created for elements that animate - perfroms an action *add*, after timeout it performs *remove*.\r\n     * \r\n     * @param action - action to perfrom\r\n     * @param timeout - timeout specified for action removal\r\n     * @param onFinish - callback to be performed after action is finished after removal\r\n     * @param callback - optional - callback to be executed in mutation on action removal, e.g. additional DOM changes on element\r\n     */\r\n    async performAction(actions: ICuiComponentAction[], timeout: number, onFinish: () => void, callback?: () => void): Promise<boolean> {\r\n        if (await this.actionsHelper.performActions(this.element, actions, timeout, callback)) {\r\n            onFinish();\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    private openFromEvent(args: any) {\r\n        this.open(args);\r\n    }\r\n\r\n    private closeFromEvent(args: any) {\r\n        this.close(args);\r\n    }\r\n\r\n    private onActionFinish(callback: () => void, event: string, args: any) {\r\n        callback();\r\n        this.emitEvent(event, {\r\n            timestamp: Date.now(),\r\n            state: args\r\n        })\r\n        this.isLocked = false;\r\n    }\r\n\r\n    private async onKeyClose(ev: KeyDownEvent) {\r\n        if (this.args.escClose && ev.event.key === \"Escape\" || is(this.args.keyClose) && ev.event.key === this.args.keyClose) {\r\n            await this.close('Closed by key');\r\n        }\r\n    }\r\n    // Abstract\r\n    abstract onInit(): void;\r\n    abstract onUpdate(): void;\r\n    abstract onDestroy(): void;\r\n    abstract onBeforeOpen(): boolean;\r\n    abstract onAfterOpen(): void;\r\n    abstract onAfterClose(): void;\r\n    abstract onBeforeClose(): boolean;\r\n\r\n}\r\n\r\nexport abstract class CuiMutableHandler<T extends ICuiParsable> extends CuiHandlerBase<T> {\r\n    #mutionHandler: ICuiComponentMutationObserver;\r\n    constructor(componentName: string, element: HTMLElement, attribute: string, args: T, utils: CuiUtils) {\r\n        super(componentName, element, attribute, args, utils);\r\n        this.#mutionHandler = new CuiComponentMutationHandler(element);\r\n        this.#mutionHandler.onMutation(this.mutation.bind(this))\r\n    }\r\n\r\n    async onHandle(): Promise<boolean> {\r\n        this.onInit();\r\n        this.#mutionHandler.observe();\r\n        return true;\r\n    }\r\n\r\n\r\n    async onRefresh(): Promise<boolean> {\r\n        this.#mutionHandler.unobserve();\r\n        this.onUpdate();\r\n        this.#mutionHandler.observe();\r\n        return true;\r\n    }\r\n\r\n    async onRemove(): Promise<boolean> {\r\n        this.#mutionHandler.unobserve();\r\n        this.onDestroy();\r\n        return true;\r\n    }\r\n\r\n    setMutationSelector(selector: string) {\r\n        this.#mutionHandler.setSelector(selector);\r\n    }\r\n\r\n    setMutationAttributes(attributes: string[]) {\r\n        this.#mutionHandler.setAttributes(attributes);\r\n    }\r\n\r\n    /**\r\n     * Callback attached to mutation observer set on root element\r\n     * \r\n     * @param record - mutation records\r\n     */\r\n    mutation(records: MutationRecord[]): void {\r\n        this._log.debug(\"Element mutation\", \"mutation\")\r\n        this.onMutation(this.prepareRecords(records));\r\n    }\r\n\r\n    private prepareRecords(records: MutationRecord[]): CuiChildMutation {\r\n        return records.reduce<CuiChildMutation>((result: CuiChildMutation, item: MutationRecord) => {\r\n            if (item.type === \"childList\") {\r\n                if (item.addedNodes.length > 0) {\r\n                    result.added.push(...item.addedNodes)\r\n                }\r\n                if (item.removedNodes.length > 0) {\r\n                    result.removed.push(...item.removedNodes)\r\n                }\r\n                return result;\r\n            }\r\n            if (item.type === \"attributes\") {\r\n                result.changed.push(item.target);\r\n            }\r\n            return result;\r\n        }, {\r\n            added: [],\r\n            removed: [],\r\n            changed: []\r\n        })\r\n    }\r\n\r\n    abstract onMutation(record: CuiChildMutation): void;\r\n    abstract onInit(): void;\r\n    abstract onUpdate(): void;\r\n    abstract onDestroy(): void;\r\n}","import { ICuiParsable } from \"../models/interfaces\";\r\nimport { enumerateObject, isStringTrue, measure } from \"./functions\";\r\n\r\nexport interface ValueCorrectors {\r\n    [name: string]: (value: any) => any;\r\n}\r\n\r\nexport interface CuiArgProp {\r\n    default?: any;\r\n    type?: string;\r\n    corrector?: (value: any) => any;\r\n}\r\n\r\nexport interface CuiArgProps {\r\n    [name: string]: CuiArgProp;\r\n}\r\n\r\nexport interface CuiAutoParseOptions {\r\n    main?: string;\r\n    props?: CuiArgProps;\r\n}\r\n\r\ninterface TypeParserCallbacks {\r\n    [type: string]: (value: any) => string | number | boolean | undefined;\r\n}\r\n\r\nconst parserCallbacks: TypeParserCallbacks = {\r\n    \"string\": (value: any) => value.trim().toLowerCase(),\r\n    'boolean': isStringTrue,\r\n    \"number\": (value: any) => {\r\n        const num = value.includes('.') ? parseFloat(value) : parseInt(value);\r\n        return isNaN(num) ? undefined : num;\r\n    }\r\n}\r\n\r\nexport class CuiAutoParseArgs implements ICuiParsable {\r\n    #parser: TypeParser;\r\n    #defaults: any;\r\n    #defaultsLength: number;\r\n    #options: CuiAutoParseOptions\r\n    constructor(options?: CuiAutoParseOptions) {\r\n        this.#options = options ?? {};\r\n        this.#parser = new TypeParser(this.#options.props);\r\n        this.#defaults = {};\r\n        this.#defaultsLength = 0;\r\n    }\r\n\r\n    parse(args: any): void {\r\n        this.fillDefaultValues();\r\n        if (!args) {\r\n            return;\r\n        }\r\n\r\n        if (typeof args === 'string' && this.#options.main) {\r\n            const currentType: string = typeof (this as any)[this.#options.main];\r\n            (this as any)[this.#options.main] = this.#parser.parseValue(this.#options.main, args, currentType);\r\n            return;\r\n        }\r\n\r\n        enumerateObject(this, (thisProp, thisValue) => {\r\n            const currentType: string = typeof thisValue;\r\n            // In case args doesn't have property, set default value set during object construction\r\n            if (!args[thisProp]) {\r\n                (this as any)[thisProp] = this.#defaults[thisProp];\r\n                return;\r\n            }\r\n            // Case that value is in args, parse and adjust\r\n            const newVal = this.#parser.parseValue(thisProp, args[thisProp], currentType);\r\n            if (newVal) {\r\n                (this as any)[thisProp] = newVal;\r\n            }\r\n        })\r\n    }\r\n\r\n    fillDefaultValues() {\r\n        if (this.#defaultsLength === 0) {\r\n            enumerateObject(this, (prperty, value) => {\r\n                this.#defaults[prperty] = value;\r\n            })\r\n            this.#defaultsLength = Object.keys(this.#defaults).length;\r\n        }\r\n    }\r\n}\r\n\r\n\r\n\r\nclass TypeParser {\r\n    #props: CuiArgProps;\r\n    constructor(props?: CuiArgProps) {\r\n        this.#props = props ?? {};\r\n    }\r\n\r\n    parseValue(name: string, value: any, type: string): string | number | boolean | undefined {\r\n        let prop = this.#props[name];\r\n        let callback = parserCallbacks[prop?.type ?? type];\r\n        let newVal = callback?.(value);\r\n        if (!newVal) {\r\n            return prop?.default;\r\n        }\r\n        return prop?.corrector?.(newVal) ?? newVal;\r\n    }\r\n}","import { CuiClickableArgs } from \"../../../core/models/arguments\";\r\nimport { ICuiHandlerModule } from \"src/core/handlers/modules/interfaces\";\r\n\r\nexport class CuiClickModule<T extends CuiClickableArgs> implements ICuiHandlerModule<T> {\r\n    type: string;\r\n    description: string;\r\n\r\n    #onClick: ((ev: MouseEvent) => void) | undefined;\r\n    element: HTMLElement;\r\n    args: T;\r\n\r\n    constructor(element: HTMLElement, args: T, click?: (ev: MouseEvent) => void | undefined) {\r\n        this.type = 'click';\r\n        this.description = \"\";\r\n\r\n\r\n        this.#onClick = click;\r\n        this.element = element;\r\n        this.onElementClick = this.onElementClick.bind(this);\r\n        this.args = args;\r\n\r\n    }\r\n\r\n    async init(args: T): Promise<boolean> {\r\n        this.args = args;\r\n        this.element.addEventListener('click', this.onElementClick)\r\n        return true;\r\n    }\r\n    async update?(args: T): Promise<boolean> {\r\n        this.args = args;\r\n        return true;\r\n    }\r\n    async destroy(): Promise<boolean> {\r\n        this.element.removeEventListener('click', this.onElementClick)\r\n        return true;\r\n    }\r\n\r\n    onClick(callback: (ev: MouseEvent) => void) {\r\n        this.#onClick = callback;\r\n    }\r\n\r\n    onElementClick(ev: MouseEvent) {\r\n        if (!this.#onClick) {\r\n            return;\r\n        }\r\n        this.#onClick(ev);\r\n        if (this.args.prevent) {\r\n            ev.preventDefault();\r\n        }\r\n        if (this.args.stopPropagation) {\r\n            ev.stopPropagation();\r\n        }\r\n    }\r\n}\r\n","import { ICuiComponent, ICuiComponentHandler, ICuiSwitchable } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiHandlerBase } from \"../../core/handlers/base\";\r\nimport { getIntOrDefault, replacePrefix, joinWithScopeSelector, is, getChildSelectorFromScoped } from \"../../core/utils/functions\";\r\nimport { EVENTS } from \"../../core/utils/statics\";\r\nimport { CuiAutoParseArgs } from \"../../core/utils/arguments\";\r\nimport { CuiAccordionEvent } from \"src/core/models/events\";\r\nimport { CuiClickModule } from \"../modules/click/click\";\r\nimport { CuiClickableArgs } from \"../../core/models/arguments\";\r\n\r\nconst ACCORDION_TITLE_CLS = '> * > .{prefix}-accordion-title';\r\nconst ACCORDION_ITEMS_CLS = '> *';\r\n\r\n\r\nexport class CuiAccordionArgs extends CuiAutoParseArgs implements CuiClickableArgs {\r\n    single: boolean;\r\n    selector: string;\r\n    items: string;\r\n    timeout: number;\r\n    animation: boolean;\r\n    prevent: boolean;\r\n    stopPropagation: boolean;\r\n\r\n    constructor(prefix: string, timeout?: number) {\r\n        super({\r\n            props: {\r\n                \"selector\": { corrector: joinWithScopeSelector },\r\n                \"items\": { corrector: joinWithScopeSelector },\r\n            }\r\n        });\r\n        this.animation = false;\r\n        this.single = false;\r\n        this.selector = joinWithScopeSelector(replacePrefix(ACCORDION_TITLE_CLS, prefix));\r\n        this.items = joinWithScopeSelector(replacePrefix(ACCORDION_ITEMS_CLS, prefix));\r\n        this.timeout = timeout ?? 300;\r\n        this.prevent = false;\r\n        this.stopPropagation = false;\r\n    }\r\n}\r\n\r\nexport class CuiAccordionComponent implements ICuiComponent {\r\n    attribute: string;\r\n    #prefix: string;\r\n    constructor(prefix?: string) {\r\n        this.#prefix = prefix ?? 'cui';\r\n        this.attribute = `${this.#prefix}-accordion`;\r\n    }\r\n\r\n    getStyle(): string | null {\r\n        return null;\r\n    }\r\n\r\n    get(element: HTMLElement, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiAccordionHandler(element, utils, this.attribute, this.#prefix);\r\n    }\r\n}\r\n\r\nexport class CuiAccordionHandler extends CuiHandlerBase<CuiAccordionArgs> implements ICuiSwitchable {\r\n\r\n    #items: Element[];\r\n    #switchEventId: string | null;\r\n    #targetSelector: string;\r\n\r\n    constructor(element: HTMLElement, utils: CuiUtils, attribute: string, prefix: string) {\r\n        super(\"CuiAccordionHandler\", element, attribute, new CuiAccordionArgs(prefix, utils.setup.animationTime), utils);\r\n        this.#switchEventId = null;\r\n        this.#items = [];\r\n        this.#switchEventId = null;\r\n        this.#targetSelector = \"\";\r\n        this.addModule(new CuiClickModule(element, this.args, this.onElementClick.bind(this)))\r\n    }\r\n\r\n    async onHandle(): Promise<boolean> {\r\n        this.#switchEventId = this.onEvent(EVENTS.SWITCH, this.onSwitch.bind(this));\r\n        this.#targetSelector = getChildSelectorFromScoped(this.args.selector);\r\n        return true;\r\n    }\r\n\r\n    async onRefresh(): Promise<boolean> {\r\n        this.#targetSelector = getChildSelectorFromScoped(this.args.selector);\r\n        return true;\r\n    }\r\n\r\n    async onRemove(): Promise<boolean> {\r\n        this.detachEvent(EVENTS.SWITCH, this.#switchEventId);\r\n        return true;\r\n    }\r\n\r\n    async switch(index: number): Promise<boolean> {\r\n        this._log.debug(\"Switch to: \" + index);\r\n        if (index < 0 || this.isLocked || !this.isInitialized) {\r\n            return false;\r\n        }\r\n\r\n        this.#items = this.queryItems();\r\n        if (this.#items.length <= index) {\r\n            return false;\r\n        }\r\n        this.isLocked = true;\r\n        const current = this.#items[index]\r\n        this.openCloseTarget(index, current);\r\n        this.emitEvent<CuiAccordionEvent>(EVENTS.SWITCHED, {\r\n            index: index,\r\n            currentTarget: current,\r\n            previousTarget: null,\r\n            previous: -1\r\n        })\r\n        this.isLocked = false;\r\n        return true;\r\n    }\r\n\r\n    private openCloseTarget(index: number, target: Element) {\r\n        if (this.helper.hasClass(this.activeClassName, target)) {\r\n            this.helper.removeClassesAs(target, this.activeClassName)\r\n        } else {\r\n            this.mutate(() => {\r\n                if (this.args.single) {\r\n                    this.closeAllExcept(index)\r\n                }\r\n                this.helper.setClass(this.activeClassName, target)\r\n            })\r\n        }\r\n    }\r\n\r\n    private onSwitch(index: any): void {\r\n        this.switch(getIntOrDefault(index, -1)).then(() => {\r\n            this._log.debug(\"Switch from event to \" + index);\r\n        });\r\n    }\r\n\r\n    private closeAllExcept(current: number) {\r\n        this.#items.forEach((item: Element, index: number) => {\r\n            if (current !== index && this.helper.hasClass(this.activeClassName, item)) {\r\n                item.classList.remove(this.activeClassName)\r\n            }\r\n        })\r\n    }\r\n\r\n    private onElementClick(ev: MouseEvent) {\r\n        let target = ev.target as HTMLElement;\r\n        if (target.matches(this.#targetSelector)) {\r\n            this.fetch(() => {\r\n                let triggers = [...this.element.querySelectorAll(this.args.selector)];\r\n                if (!is(triggers)) {\r\n                    return;\r\n                }\r\n                let foundIndex = triggers.findIndex(trigger => trigger === target);\r\n                if (foundIndex >= 0) {\r\n                    this.switch(foundIndex);\r\n                }\r\n            })\r\n        }\r\n    }\r\n\r\n    private queryItems(): Element[] {\r\n        return [...this.element.querySelectorAll(this.args.items)]\r\n    }\r\n}","import { AnimatorError } from \"../models/errors\";\r\nimport { enumerateObject, getRangeValueOrDefault, is } from \"../utils/functions\";\r\nimport { ICuiPropertyAnimator, AnimatorPropertyValue, ComplexAnimatorProperty, ColorProperty, ColorAnimatorProperty } from \"./interfaces\";\r\n\r\n/**\r\n * Changes the opacity of the element from 0 to 1\r\n */\r\nexport class OpacityAnimator implements ICuiPropertyAnimator<AnimatorPropertyValue> {\r\n    prop: AnimatorPropertyValue\r\n\r\n    constructor() {\r\n        this.prop = { from: 0, to: 0 }\r\n    }\r\n\r\n    setProperty(prop: AnimatorPropertyValue): void {\r\n        if (!prop || !is(prop.from) || !is(prop.to)) {\r\n            throw new AnimatorError(\"[OpacityAnimator] Property has incorrect format\");\r\n        }\r\n        this.prop = prop;\r\n\r\n    }\r\n\r\n    perform(element: any, progress: number, factor: number) {\r\n        if (this.prop.to < 0) {\r\n            return;\r\n        }\r\n        if (element[\"style\"]) {\r\n            element.style.opacity = calcUnitValue(this.prop, progress);\r\n        }\r\n\r\n    }\r\n}\r\n\r\n/**\r\n * Changes any style property of the element\r\n */\r\nexport class PropertyAnimator implements ICuiPropertyAnimator<AnimatorPropertyValue> {\r\n    property: string;\r\n    prop: AnimatorPropertyValue\r\n    constructor(property: string) {\r\n        if (!is(property)) {\r\n            throw new AnimatorError(\"[PropertyAnimator] Valid property is required\");\r\n        }\r\n        this.property = property;\r\n        this.prop = {\r\n            from: 0,\r\n            to: 0\r\n        }\r\n    }\r\n\r\n    setProperty(prop: AnimatorPropertyValue) {\r\n        if (!prop || !is(prop.from) || !is(prop.to)) {\r\n            throw new AnimatorError(\"[PropertyAnimator] Property has incorrect format\");\r\n        }\r\n        this.prop = prop;\r\n    }\r\n\r\n    perform(element: any, progress: number, factor: number) {\r\n        if (!this.property) {\r\n            return;\r\n        }\r\n        if (element[\"style\"]) {\r\n            element.style[this.property] = calcUnitValue(this.prop, progress)\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * Changes transform property of the element. Supports mulitple properties at the time\r\n */\r\nexport class TransformAnimator implements ICuiPropertyAnimator<ComplexAnimatorProperty> {\r\n    prop: ComplexAnimatorProperty | undefined;\r\n    constructor() {\r\n        this.prop = undefined;\r\n    }\r\n\r\n    setProperty(prop: ComplexAnimatorProperty) {\r\n        if (!prop) {\r\n            throw new AnimatorError(\"[TransformAnimator] Property has incorrect format\");\r\n        }\r\n        this.prop = prop;\r\n    }\r\n\r\n    build(progress: number) {\r\n        let props: string[] = [];\r\n        for (let name in this.prop) {\r\n            let cur = this.prop[name];\r\n            props.push(this.buildSingle(name, calcNewValue(cur.from, cur.to, progress), cur.unit))\r\n        }\r\n        return props.join(\" \");\r\n    }\r\n\r\n    buildSingle(name: string, value: number, unit?: string) {\r\n        return `${name}(${prepUnitValue(value, unit)})`;\r\n    }\r\n\r\n    perform(element: any, progress: number) {\r\n        if (!this.prop) {\r\n            return;\r\n        }\r\n        if (element[\"style\"]) {\r\n            element.style.transform = this.build(progress);\r\n        }\r\n    }\r\n}\r\n\r\nexport class ColorAnimator implements ICuiPropertyAnimator<ColorAnimatorProperty> {\r\n    #from: ColorProperty;\r\n    #to: ColorProperty;\r\n    id: string;\r\n    constructor(id: string) {\r\n        this.#from = { red: 0, green: 0, blue: 0, alpha: 0 };\r\n        this.#to = { red: 0, green: 0, blue: 0, alpha: 0 };\r\n        this.id = id;\r\n    }\r\n\r\n    perform(element: any, progress: number, factor: number): void {\r\n        const newColor = {\r\n            red: calcNewValue(this.#from.red, this.#to.red, progress),\r\n            blue: calcNewValue(this.#from.blue, this.#to.blue, progress),\r\n            green: calcNewValue(this.#from.green, this.#to.green, progress),\r\n            alpha: calcNewValue(this.#from.alpha, this.#to.alpha, progress),\r\n        }\r\n\r\n        element.style[this.id] = `rgba(${newColor.red},${newColor.green},${newColor.blue},${newColor.alpha})`;\r\n    }\r\n\r\n    setProperty(prop: ColorAnimatorProperty): void {\r\n        this.#from = adjustColor(prop.from);\r\n        this.#to = adjustColor(prop.to);\r\n    }\r\n}\r\n\r\nexport class FilterAnimator implements ICuiPropertyAnimator<ComplexAnimatorProperty> {\r\n    property: ComplexAnimatorProperty;\r\n    constructor() {\r\n        this.property = {};\r\n    }\r\n    perform(element: any, progress: number, factor: number): void {\r\n        let filters: string[] = [];\r\n        enumerateObject(this.property, (filterName, setup: AnimatorPropertyValue) => {\r\n            filters.push(`${filterName}(${calcUnitValue(setup, progress)})`)\r\n        })\r\n\r\n        element.style['filter'] = filters.join(' ');\r\n    }\r\n    setProperty(prop: ComplexAnimatorProperty): void {\r\n        this.property = prop;\r\n    }\r\n}\r\n\r\nexport class PositionAnimator implements ICuiPropertyAnimator<ComplexAnimatorProperty> {\r\n    #x: AnimatorPropertyValue;\r\n    #y: AnimatorPropertyValue;\r\n    #id: string;\r\n    constructor(id?: string) {\r\n        this.#x = {\r\n            from: 0,\r\n            to: 0,\r\n        }\r\n        this.#y = {\r\n            from: 0,\r\n            to: 0,\r\n        }\r\n        this.#id = id ?? 'backgroundPosition';\r\n    }\r\n\r\n    perform(element: any, progress: number, factor: number): void {\r\n        let newX = calcUnitValue(this.#x, progress);\r\n        let newY = calcUnitValue(this.#y, progress);\r\n        element.style[this.#id] = newX + \" \" + newY;\r\n    }\r\n\r\n    setProperty(prop: ComplexAnimatorProperty): void {\r\n        const { x, y } = prop;\r\n        if (x) {\r\n            this.#x = x\r\n        }\r\n        if (y) {\r\n            this.#y = y;\r\n        }\r\n    }\r\n\r\n}\r\n\r\nfunction adjustColor(color: ColorProperty): ColorProperty {\r\n    return {\r\n        red: getRangeValueOrDefault(color.red, 0, 255, 0),\r\n        green: getRangeValueOrDefault(color.green, 0, 255, 0),\r\n        blue: getRangeValueOrDefault(color.blue, 0, 255, 0),\r\n        alpha: getRangeValueOrDefault(color.alpha, 0, 1, 1),\r\n    }\r\n}\r\n\r\nfunction calcNewValue(from: number, to: number, progress: number) {\r\n    return from + (to - from) * progress;\r\n}\r\n\r\nfunction prepUnitValue(value: number, unit?: string) {\r\n    return value + (unit ?? \"\");\r\n}\r\n\r\nfunction calcUnitValue(prop: AnimatorPropertyValue, progress: number) {\r\n    return prepUnitValue(calcNewValue(prop.from, prop.to, progress), prop.unit);\r\n}","import { is } from \"../utils/functions\";\r\nimport { OpacityAnimator, TransformAnimator, PropertyAnimator, ColorAnimator, FilterAnimator } from \"./animators\";\r\nimport { ICuiPropertyAnimator, AnimationProperty, AnimatorPropertyValue, ComplexAnimatorProperty, OnAnimationFinishCallback, ColorAnimatorProperty } from \"./interfaces\";\r\n\r\nexport type PropsTypes = AnimatorPropertyValue | ComplexAnimatorProperty;\r\n\r\nexport class CuiAnimation {\r\n    #engine: CuiAnimationEngine;\r\n    #timeout: number;\r\n    #onError: ((e: Error) => void) | undefined;\r\n    constructor(element?: Element) {\r\n        this.#engine = new CuiAnimationEngine(true);\r\n        this.#onError = undefined;\r\n        this.#timeout = 0;\r\n        if (element) {\r\n            this.#engine.setElement(element);\r\n        }\r\n    }\r\n\r\n    setElement(element: Element) {\r\n        this.#engine.setElement(element);\r\n    }\r\n\r\n    setTimeout(timeout: number) {\r\n        this.#timeout = timeout;\r\n    }\r\n\r\n    onError(callback: (e: Error) => void) {\r\n        this.#onError = callback;\r\n        this.#engine.setOnError(callback)\r\n    }\r\n    onFinish(callback: OnAnimationFinishCallback) {\r\n        this.#engine.onFinish(callback);\r\n    }\r\n\r\n    perform(props: AnimationProperty<PropsTypes>, timeout?: number, factor?: number) {\r\n        if (!is(props)) {\r\n            this.reportError(new Error(\"Animation property cannot be empty\"))\r\n            return;\r\n        }\r\n        let animators = [];\r\n        try {\r\n            for (let prop in props) {\r\n                let animator = AnimatorFactory.get(prop);\r\n                if (!animator) return;\r\n                animator.setProperty(props[prop]);\r\n                animators.push(animator);\r\n                this.#engine.setAnimators(animators);\r\n                this.#engine.animate(timeout ?? this.#timeout)\r\n            }\r\n        } catch (e) {\r\n            this.reportError(e);\r\n            return;\r\n        }\r\n    }\r\n\r\n    private reportError(e: Error) {\r\n        if (this.#onError) {\r\n            this.#onError(e)\r\n        } else {\r\n            console.error(e);\r\n        }\r\n    }\r\n}\r\n\r\n\r\nexport class AnimatorFactory {\r\n    static get(id: string): ICuiPropertyAnimator<AnimatorPropertyValue | ComplexAnimatorProperty | ColorAnimatorProperty> | undefined {\r\n        if (!is(id)) {\r\n            return undefined;\r\n        }\r\n        if (id.includes('color')) {\r\n            return new ColorAnimator(id);\r\n        }\r\n        switch (id) {\r\n            case \"opacity\":\r\n                return new OpacityAnimator();\r\n            case \"transform\":\r\n                return new TransformAnimator();\r\n            case \"filter\":\r\n                return new FilterAnimator();\r\n            default:\r\n                return new PropertyAnimator(id);\r\n        }\r\n    }\r\n\r\n}\r\n\r\nexport class CuiAnimationEngine {\r\n    #onFinishCallback: OnAnimationFinishCallback | undefined;\r\n    #animators: ICuiPropertyAnimator<PropsTypes>[];\r\n    #lock: boolean;\r\n    // Needed in animation perform - set on first animation exec, cleaned on end\r\n    #animStartStamp: number | undefined;\r\n    #element: Element | undefined;\r\n    #cleanOnFinish: boolean;\r\n    #errorOccured: boolean;\r\n    #onError: ((e: Error) => void) | undefined;\r\n    constructor(cleanOnFinish?: boolean) {\r\n        this.#animators = [];\r\n        this.#element = undefined;\r\n        this.#animStartStamp = undefined;\r\n        this.#cleanOnFinish = cleanOnFinish ?? false;\r\n        this.#lock = false;\r\n        this.#onFinishCallback = undefined;\r\n        this.#errorOccured = false;\r\n        this.#onError = undefined;\r\n    }\r\n\r\n    onFinish(callback: OnAnimationFinishCallback) {\r\n        this.#onFinishCallback = callback;\r\n    }\r\n\r\n    setAnimators(animators: ICuiPropertyAnimator<PropsTypes>[]) {\r\n        this.#animators = animators;\r\n    }\r\n\r\n    setProps(props: AnimationProperty<PropsTypes>) {\r\n        if (!is(props)) {\r\n            return;\r\n        }\r\n        this.#animators = [];\r\n        try {\r\n            for (let prop in props) {\r\n                let animator = AnimatorFactory.get(prop);\r\n                if (!animator) return;\r\n                animator.setProperty(props[prop]);\r\n                this.#animators.push(animator);\r\n            }\r\n        } catch (e) {\r\n            this.reportError(e);\r\n        }\r\n    }\r\n\r\n    setElement(element: Element) {\r\n        this.#element = element;\r\n    }\r\n\r\n    setOnError(callback: (e: Error) => void) {\r\n        this.#onError = callback;\r\n    }\r\n\r\n    animate(timeout: number, progress?: number, revert?: boolean): void {\r\n        if (this.#lock) {\r\n            return;\r\n        }\r\n        if (!this.#element || this.#animators.length === 0) {\r\n            this.reportError(new Error(\"Animation cannot be performed: element or animators are not set\"));\r\n            return;\r\n        }\r\n        let animationProgress = progress ?? 0;\r\n        let shouldCalcRevert = revert ? revert : false;\r\n        this.#lock = true;\r\n        requestAnimationFrame(this.animateAsync.bind(this, timeout, animationProgress, shouldCalcRevert))\r\n    }\r\n\r\n    isLocked(): boolean {\r\n        return this.#lock;\r\n    }\r\n\r\n    private animateAsync(timeout: number, initialProgress: number, revert: boolean, timestamp: number) {\r\n        if (!this.#animStartStamp) {\r\n            this.#animStartStamp = timestamp;\r\n        }\r\n\r\n        let pr = timestamp - this.#animStartStamp;\r\n        let animationProgress = pr / timeout;\r\n        let currProgress = 0;\r\n        if (initialProgress === 0) {\r\n            currProgress = animationProgress;\r\n        } else {\r\n            currProgress = revert ? initialProgress - (animationProgress * initialProgress) : initialProgress + (animationProgress * initialProgress)\r\n        }\r\n        this.callUpdate(revert ? Math.max(currProgress, 0) : Math.min(currProgress, 1), 1);\r\n        if (pr < timeout && !this.#errorOccured) {\r\n            requestAnimationFrame(this.animateAsync.bind(this, timeout, initialProgress, revert))\r\n        } else {\r\n            this.endAnimation(revert);\r\n        }\r\n    }\r\n\r\n    private endAnimation(reverted: boolean) {\r\n        if (this.#cleanOnFinish && this.#element) {\r\n            this.#element.removeAttribute(\"style\");\r\n        }\r\n        if (this.#onFinishCallback) {\r\n            this.#onFinishCallback(this.#element, reverted, this.#errorOccured);\r\n        }\r\n        this.#errorOccured = false;\r\n        this.#animStartStamp = undefined;\r\n        this.#lock = false;\r\n    }\r\n\r\n    private callUpdate(progress: number, factor: number) {\r\n        try {\r\n            this.#animators.forEach(animator => animator.perform(this.#element, progress, factor));\r\n        } catch (e) {\r\n            this.reportError(e);\r\n            this.#errorOccured = true;\r\n        }\r\n\r\n    }\r\n\r\n    private reportError(e: Error) {\r\n        if (this.#onError) {\r\n            this.#onError(e);\r\n        } else {\r\n            console.error(\"An error occured in CuiAnimtionEngine\");\r\n            console.error(e);\r\n        }\r\n    }\r\n}\r\n\r\n\r\n\r\nexport class CuiSwipeAnimationEngine {\r\n    #element: Element | undefined;\r\n    #animators: ICuiPropertyAnimator<PropsTypes>[];\r\n    #animationEngine: CuiAnimationEngine;\r\n    #onError: ((e: Error) => void) | undefined;\r\n    constructor(shouldCleanOnFinish?: boolean) {\r\n        this.#element = undefined;\r\n        this.#animators = [];\r\n        this.#animationEngine = new CuiAnimationEngine(shouldCleanOnFinish);\r\n        this.#onError = undefined;\r\n    }\r\n\r\n    setElement(element: Element) {\r\n        this.#element = element;\r\n    }\r\n\r\n    setOnFinish(callback: OnAnimationFinishCallback) {\r\n        this.#animationEngine.onFinish(callback);\r\n    }\r\n\r\n    setOnError(callback: (e: Error) => void) {\r\n        this.#onError = callback;\r\n        this.#animationEngine.setOnError(callback);\r\n    }\r\n\r\n    setProps(props: AnimationProperty<PropsTypes>) {\r\n        if (!is(props)) {\r\n            return;\r\n        }\r\n        this.#animators = [];\r\n        try {\r\n            for (let prop in props) {\r\n                let animator = AnimatorFactory.get(prop);\r\n                if (!animator) return;\r\n                animator.setProperty(props[prop]);\r\n                this.#animators.push(animator);\r\n            }\r\n        } catch (e) {\r\n            this.reportError(e);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Perform single update on animators\r\n     * @param progress - progress value to be set to animators 0..1\r\n     */\r\n    update(progress: number) {\r\n        if (!this.#element || this.#animators.length === 0) {\r\n            return;\r\n        }\r\n        this.#animators.forEach(animator => animator.perform(this.#element, Math.min(progress, 1), 1))\r\n    }\r\n\r\n    /**\r\n     * Perform single update on animators in RAF\r\n     * @param progress - progress value to be set to animators 0..1\r\n     */\r\n    updateAsync(progress: number) {\r\n        requestAnimationFrame(this.update.bind(this, progress));\r\n    }\r\n\r\n    /**\r\n     * Finish swipe animation using animation engine\r\n     * @param progress - initial progress value 0..1\r\n     * @param timeout - time for animation to perform\r\n     * @param revert - whether animation should return back to 0 or progress to the end\r\n     */\r\n    finish(progress: number, timeout: number, revert: boolean) {\r\n        if (this.#element)\r\n            this.#animationEngine.setElement(this.#element);\r\n        this.#animationEngine.setAnimators(this.#animators);\r\n        this.#animationEngine.animate(timeout, progress, revert);\r\n    }\r\n\r\n    private reportError(e: Error) {\r\n        if (this.#onError) {\r\n            this.#onError(e);\r\n        } else {\r\n            console.log(e)\r\n        }\r\n    }\r\n\r\n}\r\n","import { AnimationDefinition, SWIPE_ANIMATIONS_DEFINITIONS } from \"../../core/animation/definitions\";\r\nimport { CuiInteractableArgs, CuiInteractableHandler } from \"../../core/handlers/base\";\r\nimport { CuiSwipeAnimationEngine } from \"../../core/animation/engine\";\r\nimport { ICuiMoveData } from \"../../core/listeners/move\";\r\nimport { AriaAttributes } from \"../../core/utils/aria\";\r\nimport { replacePrefix } from \"../../core/utils/functions\";\r\nimport { ICuiComponent, ICuiComponentHandler } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { EVENTS, CLASSES } from \"../../core/utils/statics\";\r\nimport { CuiAutoParseArgs } from \"../../core/utils/arguments\";\r\n\r\nconst BANNER_OPEN_ANIMATION: string = \".{prefix}-animation-fade-in\";\r\nconst BANNER_CLOSE_ANIMATION: string = \".{prefix}-animation-fade-out\";\r\n\r\nexport class CuiBannerArgs extends CuiAutoParseArgs implements CuiInteractableArgs {\r\n    timeout: number;\r\n    openAct: string;\r\n    closeAct: string;\r\n    // Not in use\r\n    escClose: boolean;\r\n    keyClose: string;\r\n\r\n    swipe: boolean;\r\n\r\n    constructor(prefix: string, timeout?: number) {\r\n        super();\r\n        this.escClose = false;\r\n        this.keyClose = \"\";\r\n        this.timeout = timeout ?? 300;\r\n        this.swipe = false;\r\n        this.openAct = replacePrefix(BANNER_OPEN_ANIMATION, prefix);\r\n        this.closeAct = replacePrefix(BANNER_CLOSE_ANIMATION, prefix);\r\n    }\r\n}\r\n\r\n\r\nexport class CuiBanerComponent implements ICuiComponent {\r\n    attribute: string;\r\n    #prefix: string;\r\n\r\n    constructor(prefix?: string) {\r\n        this.#prefix = prefix ?? 'cui';\r\n        this.attribute = `${this.#prefix}-banner`;\r\n\r\n    }\r\n\r\n    getStyle(): string | null {\r\n        return null;\r\n    }\r\n\r\n    get(element: HTMLElement, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiBannerHandler(element, utils, this.attribute, this.#prefix);\r\n    }\r\n}\r\n\r\nexport class CuiBannerHandler extends CuiInteractableHandler<CuiBannerArgs> {\r\n    #swipeEngine: CuiSwipeAnimationEngine;\r\n    #isTracking: boolean;\r\n    #startX: number;\r\n    #ratio: number;\r\n    #swipeAnimation: AnimationDefinition;\r\n    #moveEventId: string | null;\r\n    constructor(element: HTMLElement, utils: CuiUtils, attribute: string, prefix: string) {\r\n        super(\"CuiBannerHandler\", element, attribute, new CuiBannerArgs(prefix, utils.setup.animationTime), utils);\r\n        this.#swipeEngine = new CuiSwipeAnimationEngine(true);\r\n        this.#swipeEngine.setOnFinish(this.onSwipeFinish.bind(this));\r\n        this.#swipeEngine.setElement(this.element)\r\n        this.#startX = -1;\r\n        this.#ratio = 0;\r\n        this.#swipeAnimation = SWIPE_ANIMATIONS_DEFINITIONS[\"fade\"];\r\n        this.#moveEventId = null;\r\n        this.#isTracking = false;\r\n    }\r\n\r\n    onInit(): void {\r\n    }\r\n\r\n    onUpdate(): void {\r\n\r\n    }\r\n\r\n    onDestroy(): void {\r\n        this.detachEvent(EVENTS.GLOBAL_MOVE, this.#moveEventId);\r\n    }\r\n\r\n    onBeforeOpen(): boolean {\r\n        return true;\r\n    }\r\n\r\n    onAfterOpen(): void {\r\n        if (this.args.swipe) {\r\n            this.#moveEventId = this.onEvent(EVENTS.GLOBAL_MOVE, this.onMove.bind(this));\r\n        }\r\n    }\r\n    onAfterClose(): void {\r\n        this.detachEvent(EVENTS.GLOBAL_MOVE, this.#moveEventId);\r\n    }\r\n\r\n    onBeforeClose(): boolean {\r\n        return true;\r\n    }\r\n\r\n    onMove(data: ICuiMoveData) {\r\n        if (this.isLocked) {\r\n            return;\r\n        }\r\n        let current = this.element as HTMLElement;\r\n        switch (data.type) {\r\n            case \"down\":\r\n                if (this.#isTracking || !current.contains((data.target as Node))) {\r\n                    return;\r\n                }\r\n                this.#isTracking = true;\r\n                this.#startX = data.x;\r\n                this.helper.setClassesAs(document.body, CLASSES.swipingOn);\r\n                data.event.preventDefault();\r\n                break;\r\n            case \"up\":\r\n                if (!this.#isTracking && this.#ratio == 0) {\r\n                    break;\r\n                }\r\n\r\n                let absRatio = Math.abs(this.#ratio);\r\n                let timeout = absRatio * this.args.timeout;\r\n                let back = absRatio <= 0.4;\r\n                // Lock component until animation is finished\r\n                this.isLocked = true;\r\n                this.#swipeEngine.finish(absRatio, timeout, back);\r\n                this.helper.removeClassesAs(document.body, CLASSES.swipingOn);\r\n                this.#isTracking = false;\r\n                break;\r\n            case \"move\":\r\n                if (this.#isTracking) {\r\n                    let newRatio = (data.x - this.#startX) / current.offsetWidth;\r\n                    if (this.#ratio >= 0 && newRatio <= 0 || this.#ratio <= 0 && newRatio > 0) {\r\n                        this.#swipeEngine.setProps(newRatio > 0 ? this.#swipeAnimation.current.right : this.#swipeAnimation.current.left);\r\n                    }\r\n                    this.#ratio = newRatio;\r\n                    this.mutate(() => {\r\n                        this.#swipeEngine.update(Math.abs(this.#ratio));\r\n                    })\r\n                    data.event.preventDefault();\r\n                }\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n    }\r\n\r\n    onSwipeFinish(element: Element | undefined, reverted: boolean, error: boolean) {\r\n        this.isLocked = false;\r\n        if (!reverted) {\r\n            this.helper.removeClass(this.activeClassName, this.element)\r\n            AriaAttributes.setAria(this.element, 'aria-expanded', 'false');\r\n        }\r\n        this.#ratio = 0;\r\n        this.#startX = 0;\r\n\r\n    }\r\n}","import { ICuiComponent, ICuiComponentHandler } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiHandlerBase } from \"../../core/handlers/base\";\r\nimport { is, getRangeValue } from \"../../core/utils/functions\";\r\nimport { ICONS, EVENTS } from \"../../core/utils/statics\";\r\nimport { IconBuilder } from \"../../core/builders/icon\";\r\nimport { CuiAutoParseArgs } from \"../../core/utils/arguments\";\r\n\r\nexport interface CuiCircleProgressChnaged {\r\n    timestamp: number;\r\n    progress: number;\r\n}\r\n\r\nexport class CuiCircleArgs extends CuiAutoParseArgs {\r\n    progress: number;\r\n    constructor() {\r\n        super();\r\n        this.progress = 0;\r\n    }\r\n}\r\n\r\nexport class CuiCircleComponent implements ICuiComponent {\r\n    attribute: string;\r\n    constructor(prefix?: string) {\r\n        this.attribute = (prefix ?? 'cui') + '-circle-progress';\r\n        ICONS['special_circle_progress'] = \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\"  class=\\\"circle-progress\\\" viewBox=\\\"0 0 100 100\\\" width=\\\"100\\\" height=\\\"100\\\"><path class=\\\"circle-progress-path\\\" d=\\\"M 50,5.3660047 A 44.867708,44.633994 0 0 1 94.867709,49.999997 44.867708,44.633994 0 0 1 50,94.633995 44.867708,44.633994 0 0 1 5.1322908,50.000001 44.867708,44.633994 0 0 1 50,5.3660047\\\"></path></svg>\";\r\n    }\r\n\r\n    getStyle(): string | null {\r\n        return null;\r\n    }\r\n\r\n    get(element: HTMLElement, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiCircleHandler(element, utils, this.attribute);\r\n    }\r\n}\r\n\r\nexport class CuiCircleHandler extends CuiHandlerBase<CuiCircleArgs> {\r\n    #factor: number;\r\n    #full: number;\r\n    #path: any;\r\n    #attr: string;\r\n    #progressEventId: string | null;\r\n    constructor(element: HTMLElement, utils: CuiUtils, attribute: string) {\r\n        super(\"CuiCircleHandler\", element, attribute, new CuiCircleArgs(), utils);\r\n        this.#factor = this.#full = 0;\r\n        this.#path = null\r\n        this.#attr = attribute;\r\n        this.#progressEventId = null;\r\n    }\r\n\r\n    async onHandle(): Promise<boolean> {\r\n        const iconSvg = new IconBuilder(ICONS['special_circle_progress']).build();\r\n        if (!is(iconSvg)) {\r\n            this.logError(\"SVG circle was not created\", \"onInit\")\r\n            return false;\r\n        }\r\n        const svg = this.element.querySelector('svg')\r\n        if (is(svg)) {\r\n            //@ts-ignore svg checked\r\n            svg.remove();\r\n        }\r\n        //@ts-ignore iconSvg checked\r\n        this.element.appendChild(iconSvg);\r\n        this.#path = this.element.querySelector('.circle-progress-path');\r\n        this.#full = this.#path.getTotalLength();\r\n        this.#factor = this.#full / 100;\r\n        this.fetch(this.readStyle)\r\n        this.#progressEventId = this.onEvent(EVENTS.PROGRESS_CHANGE, this.onSetProgress.bind(this))\r\n        return true;\r\n    }\r\n    async onRefresh(): Promise<boolean> {\r\n        this.fetch(this.readStyle)\r\n        this.emitEvent(EVENTS.PROGRESS_CHANGED, {\r\n            timestamp: Date.now(),\r\n            progress: this.args.progress\r\n        })\r\n        return true;\r\n    }\r\n    async onRemove(): Promise<boolean> {\r\n        this.detachEvent(EVENTS.PROGRESS_CHANGE, this.#progressEventId);\r\n        return true;\r\n    }\r\n\r\n    onSetProgress(val: any) {\r\n        if (is(val)) {\r\n            this.element.setAttribute(this.#attr, val);\r\n        }\r\n    }\r\n\r\n    private updateStyle(value: number) {\r\n        this.#path.style.strokeDashoffset = value;\r\n    }\r\n\r\n    private readStyle(): void {\r\n        if (this.prevArgs && this.args.progress === this.prevArgs.progress) {\r\n            return;\r\n        }\r\n        const progress = getRangeValue(this.args.progress, 0, 100);\r\n\r\n        this.mutate(this.updateStyle, this.#full - this.#factor * progress);\r\n    }\r\n\r\n}","import { ICuiComponent, ICuiComponentHandler } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiHandlerBase } from \"../../core/handlers/base\";\r\nimport { is, getParentCuiElement, are } from \"../../core/utils/functions\";\r\nimport { CuiActionsListFactory } from \"../../core/utils/actions\";\r\nimport { EVENTS } from \"../../core/utils/statics\";\r\nimport { CuiAutoParseArgs } from \"../../core/utils/arguments\";\r\nimport { CuiClickableArgs } from \"src/core/models/arguments\";\r\nimport { CuiClickModule } from \"../modules/click/click\";\r\nimport { InteractionEvent } from \"src/core/models/events\";\r\n\r\nexport class CuiCloseArgs extends CuiAutoParseArgs implements CuiClickableArgs {\r\n    target: string;\r\n    action: string;\r\n    timeout: number;\r\n    state: string;\r\n    prevent: boolean;\r\n    stopPropagation: boolean;\r\n\r\n    constructor(timeout?: number) {\r\n        super({\r\n            main: \"target\"\r\n        });\r\n        this.target = \"\";\r\n        this.action = \"\";\r\n        this.prevent = false;\r\n        this.stopPropagation = false;\r\n        this.state = \"\";\r\n        this.timeout = timeout ?? 300;\r\n    }\r\n\r\n}\r\n\r\nexport class CuiCloseComponent implements ICuiComponent {\r\n    attribute: string;\r\n    #prefix: string;\r\n\r\n    constructor(prefix?: string) {\r\n        this.#prefix = prefix ?? 'cui';\r\n        this.attribute = `${this.#prefix}-close`;\r\n\r\n    }\r\n\r\n    getStyle(): string | null {\r\n        return null;\r\n    }\r\n\r\n    get(element: HTMLElement, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiCloseHandler(element, utils, this.attribute, this.#prefix);\r\n    }\r\n}\r\n\r\nexport class CuiCloseHandler extends CuiHandlerBase<CuiCloseArgs> {\r\n    #eventId: string | null;\r\n    constructor(element: HTMLElement, utils: CuiUtils, attribute: string, prefix: string) {\r\n        super(\"CuiCloseHandler\", element, attribute, new CuiCloseArgs(utils.setup.animationTime), utils);\r\n        this.#eventId = null;\r\n        this.addModule(new CuiClickModule(this.element, this.args, this.onClose.bind(this)));\r\n    }\r\n\r\n    async onHandle(): Promise<boolean> {\r\n        this.#eventId = this.onEvent(EVENTS.CLOSE, this.onClose.bind(this));\r\n        return true;\r\n    }\r\n\r\n    async onRefresh(): Promise<boolean> {\r\n        return true;\r\n    }\r\n    async onRemove(): Promise<boolean> {\r\n        this.detachEvent(EVENTS.CLOSE, this.#eventId);\r\n        return true;\r\n    }\r\n\r\n\r\n    onClose(ev: MouseEvent) {\r\n        if (this.isLocked) {\r\n            return;\r\n        }\r\n        const target = this.getTarget();\r\n        if (!is(target)) {\r\n            this._log.warning(`Target ${this.args.target} not found`, 'onClick')\r\n            return;\r\n        }\r\n        this.isLocked = true;\r\n        //@ts-ignore target is checked\r\n        this.run(target).then((result) => {\r\n            if (result)\r\n                this.emitClose(ev);\r\n        }).catch((e) => {\r\n            this._log.exception(e);\r\n        }).finally(() => {\r\n            this.isLocked = false;\r\n        })\r\n    }\r\n\r\n    private async run(target: Element): Promise<boolean> {\r\n        let cuiId = (target as any).$cuid;\r\n        if (is(cuiId)) {\r\n            await this.utils.bus.emit(EVENTS.CLOSE, cuiId, this.args.state);\r\n            return false;\r\n        } else if (are(this.args.action, this.args.timeout)) {\r\n            let actions = CuiActionsListFactory.get(this.args.action);\r\n            return this.actionsHelper.performActions(target, actions, this.args.timeout, () => {\r\n                this.helper.removeClass(this.activeClassName, target)\r\n            });\r\n        } else {\r\n            this.helper.removeClassesAs(target, this.activeClassName);\r\n            return true;\r\n        }\r\n    }\r\n\r\n    // private removeActiveClass(target: Element) {\r\n    //     if (is(target) && this.helper.hasClass(this.activeClassName, target)) {\r\n    //         this.helper.removeClass(this.activeClassName, target);\r\n    //     }\r\n    // }\r\n\r\n    // private removeActiveClassAsync(target: Element) {\r\n    //     this.fetch(() => {\r\n    //         if (is(target) && this.helper.hasClass(this.activeClassName, target)) {\r\n    //             this.helper.removeClassesAs(target, this.activeClassName);\r\n    //         }\r\n    //     })\r\n\r\n    // }\r\n    // private onActionFinish(ev: MouseEvent, shouldEmit: boolean) {\r\n    //     if (shouldEmit)\r\n    //         this.emitClose(ev);\r\n    // }\r\n\r\n    private getTarget(): Element | undefined {\r\n        if (!is(this.args.target)) {\r\n            return getParentCuiElement(this.element);\r\n        }\r\n        return document.querySelector(this.args.target) ?? getParentCuiElement(this.element);\r\n    }\r\n\r\n    private emitClose(ev: MouseEvent) {\r\n        this.emitEvent<InteractionEvent>(EVENTS.CLOSED, {\r\n            state: this.args.state,\r\n            event: ev\r\n        })\r\n    }\r\n}","import { ICuiComponent, ICuiComponentHandler } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { replacePrefix } from \"../../core/utils/functions\";\r\nimport { AriaAttributes } from \"../../core/utils/aria\";\r\nimport { CuiInteractableArgs, CuiInteractableHandler } from \"../../core/handlers/base\";\r\nimport { CuiAutoParseArgs } from \"../../core/utils/arguments\";\r\n\r\nconst COVER_OPEN_ANIMATION_CLASS = '.{prefix}-dialog-default-in';\r\nconst COVER_CLOSE_ANIMATION_CLASS = '.{prefix}-dialog-default-out';\r\nconst bodyClass = '{prefix}-cover-open';\r\n\r\nexport interface CuiDialogEvent {\r\n    timestamp: number;\r\n}\r\n\r\nexport class CuiCoverArgs extends CuiAutoParseArgs implements CuiInteractableArgs {\r\n    escClose: boolean;\r\n    timeout: number;\r\n    openAct: string;\r\n    closeAct: string;\r\n    keyClose: string;\r\n\r\n    constructor(prefix: string, defTimeout?: number) {\r\n        super();\r\n        this.escClose = false;\r\n        this.timeout = defTimeout ?? 300;\r\n        this.openAct = replacePrefix(COVER_OPEN_ANIMATION_CLASS, prefix);\r\n        this.closeAct = replacePrefix(COVER_CLOSE_ANIMATION_CLASS, prefix);\r\n        this.keyClose = \"\";\r\n    }\r\n\r\n}\r\n\r\nexport class CuiCoverComponent implements ICuiComponent {\r\n    attribute: string;\r\n    #prefix: string;\r\n    constructor(prefix?: string) {\r\n        this.#prefix = prefix ?? 'cui';\r\n        this.attribute = `${this.#prefix}-cover`;\r\n    }\r\n\r\n    getStyle(): string | null {\r\n        return null;\r\n    }\r\n\r\n    get(element: HTMLElement, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiCoverHandler(element, utils, this.attribute, this.#prefix);\r\n    }\r\n}\r\n\r\nexport class CuiCoverHandler extends CuiInteractableHandler<CuiCoverArgs> {\r\n\r\n    #bodyClass: string;\r\n    #scrollY: number;\r\n\r\n    constructor(element: HTMLElement, utils: CuiUtils, attribute: string, prefix: string) {\r\n        super(\"CuiDialogHandler\", element, attribute, new CuiCoverArgs(prefix, utils.setup.animationTimeLong), utils);\r\n        this.#bodyClass = replacePrefix(bodyClass, prefix);\r\n        this.#scrollY = 0;\r\n\r\n        if (!utils.isPlugin(\"click-plugin\")) {\r\n            this.logWarning(\"WindowClick plugin is not available, outClose will not work\")\r\n        }\r\n\r\n        if (!utils.isPlugin(\"keys-plugin\")) {\r\n            this.logWarning(\"KeyObserver plugin is not available, escClose and keyClose will not work\")\r\n        }\r\n    }\r\n\r\n    onInit(): void {\r\n        AriaAttributes.setAria(this.element, 'aria-modal', \"\");\r\n    }\r\n    onUpdate(): void {\r\n\r\n    }\r\n\r\n    onDestroy(): void {\r\n\r\n    }\r\n\r\n    onBeforeOpen(): boolean {\r\n        if (this.isAnyActive()) {\r\n            return false;\r\n        }\r\n        this.#scrollY = window.pageYOffset;\r\n        return true;\r\n    }\r\n\r\n    onAfterOpen(): void {\r\n        this.helper.setClass(this.#bodyClass, document.body)\r\n        document.body.style.top = `-${this.#scrollY}px`;\r\n        AriaAttributes.setAria(this.element, 'aria-hidden', \"false\");\r\n    }\r\n\r\n    onAfterClose(): void {\r\n        document.body.style.top = '';\r\n        window.scrollTo(0, (this.#scrollY || 0) * -1);\r\n        this.#scrollY = 0;\r\n        this.helper.removeClass(this.#bodyClass, document.body);\r\n        AriaAttributes.setAria(this.element, 'aria-hidden', \"true\");\r\n    }\r\n\r\n    onBeforeClose(): boolean {\r\n        return true;\r\n    }\r\n\r\n    private isAnyActive(): boolean {\r\n        return this.helper.hasClass(this.#bodyClass, document.body);\r\n    }\r\n}","import { ICuiComponent, ICuiComponentHandler } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { replacePrefix } from \"../../core/utils/functions\";\r\nimport { EVENTS } from \"../../core/utils/statics\";\r\nimport { AriaAttributes } from \"../../core/utils/aria\";\r\nimport { CuiInteractableArgs, CuiInteractableHandler } from \"../../core/handlers/base\";\r\nimport { CuiAutoParseArgs } from \"../../core/utils/arguments\";\r\nimport { GlobalClickEvent } from \"src/core/models/events\";\r\n\r\nconst DIALOG_OPEN_ANIMATION_CLASS = '.{prefix}-dialog-default-in';\r\nconst DIALOG_CLOSE_ANIMATION_CLASS = '.{prefix}-dialog-default-out';\r\nconst bodyClass = '{prefix}-dialog-open';\r\nconst CONTAINER = '.{prefix}-dialog-container';\r\n\r\nexport interface CuiDialogEvent {\r\n    timestamp: number;\r\n}\r\n\r\nexport class CuiDialogArgs extends CuiAutoParseArgs implements CuiInteractableArgs {\r\n    escClose: boolean;\r\n    outClose: boolean;\r\n    timeout: number;\r\n    openAct: string;\r\n    closeAct: string;\r\n    keyClose: string;\r\n\r\n    constructor(prefix: string, defTimeout?: number) {\r\n        super();\r\n\r\n        this.escClose = false;\r\n        this.outClose = false;\r\n        this.timeout = defTimeout ?? 300;\r\n        this.openAct = replacePrefix(DIALOG_OPEN_ANIMATION_CLASS, prefix);\r\n        this.closeAct = replacePrefix(DIALOG_CLOSE_ANIMATION_CLASS, prefix);\r\n        this.keyClose = \"\";\r\n    }\r\n}\r\n\r\nexport class CuiDialogComponent implements ICuiComponent {\r\n    attribute: string;\r\n    #prefix: string;\r\n    constructor(prefix?: string) {\r\n        this.#prefix = prefix ?? 'cui';\r\n        this.attribute = `${this.#prefix}-dialog`;\r\n    }\r\n\r\n    getStyle(): string | null {\r\n        return null;\r\n    }\r\n\r\n    get(element: HTMLElement, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiDialogHandler(element, utils, this.attribute, this.#prefix);\r\n    }\r\n}\r\n\r\nexport class CuiDialogHandler extends CuiInteractableHandler<CuiDialogArgs> {\r\n    #prefix: string;\r\n    #bodyClass: string;\r\n    #scrollY: number;\r\n    #windowClickEventId: string | null;\r\n\r\n    constructor(element: HTMLElement, utils: CuiUtils, attribute: string, prefix: string) {\r\n        super(\"CuiDialogHandler\", element, attribute, new CuiDialogArgs(prefix, utils.setup.animationTimeLong), utils);\r\n        this.#bodyClass = replacePrefix(bodyClass, prefix);\r\n        this.#prefix = prefix;\r\n        this.#scrollY = 0;\r\n        this.#windowClickEventId = null;\r\n\r\n        if (!utils.isPlugin(\"click-plugin\")) {\r\n            this.logWarning(\"WindowClick plugin is not available, outClose will not work\")\r\n        }\r\n        if (!utils.isPlugin(\"keys-plugin\")) {\r\n            this.logWarning(\"KeyObserver plugin is not available, escClose and keyClose will not work\")\r\n        }\r\n    }\r\n\r\n    onInit(): void {\r\n        AriaAttributes.setAria(this.element, 'aria-modal', \"\");\r\n    }\r\n\r\n    onUpdate(): void {\r\n\r\n    }\r\n\r\n    onDestroy(): void {\r\n\r\n    }\r\n\r\n    onBeforeOpen(): boolean {\r\n        if (this.isAnyActive()) {\r\n            return false;\r\n        }\r\n        this.#scrollY = window.pageYOffset;\r\n        return true;\r\n    }\r\n\r\n    onAfterOpen(): void {\r\n        if (this.args.outClose) {\r\n            this.#windowClickEventId = this.onEvent(EVENTS.WINDOW_CLICK, this.onWindowClick.bind(this));\r\n        }\r\n        this.helper.setClass(this.#bodyClass, document.body)\r\n        document.body.style.top = `-${this.#scrollY}px`;\r\n    }\r\n\r\n    onAfterClose(): void {\r\n        document.body.style.top = '';\r\n        window.scrollTo(0, (this.#scrollY || 0) * -1);\r\n        this.#scrollY = 0;\r\n        this.helper.removeClass(this.#bodyClass, document.body);\r\n        this.detachEvent(EVENTS.WINDOW_CLICK, this.#windowClickEventId);\r\n    }\r\n\r\n    onBeforeClose(): boolean {\r\n        return true;\r\n    }\r\n\r\n    private isAnyActive(): boolean {\r\n        return this.helper.hasClass(this.#bodyClass, document.body);\r\n    }\r\n\r\n    onWindowClick(ev: GlobalClickEvent) {\r\n        let container = this.element.querySelector(replacePrefix(CONTAINER, this.#prefix));\r\n        if (container && !container.contains((ev.ev.target as Node))) {\r\n            this.close('out').then(() => {\r\n                this._log.debug(\"Closed by click outside\")\r\n            });\r\n        }\r\n    }\r\n}","import { ICuiEventListener } from \"../models/interfaces\";\r\nimport { are } from \"../utils/functions\";\r\n\r\nexport interface CuiHoverEvent {\r\n    isHovering: boolean;\r\n    event: MouseEvent;\r\n    timestamp: number;\r\n}\r\nexport class CuiHoverListener implements ICuiEventListener<CuiHoverEvent> {\r\n    #target: Element;\r\n    #callback: ((t: CuiHoverEvent) => void) | undefined;\r\n    #inProgress: boolean;\r\n    #isHovering: boolean;\r\n    #isAttached: boolean;\r\n    #onOverBound: (ev: MouseEvent) => void;\r\n    #onMoveBound: (ev: MouseEvent) => void;\r\n    #onOutBound: (ev: MouseEvent) => void;\r\n\r\n    constructor(target: Element) {\r\n        this.#target = target;\r\n        this.#inProgress = false;\r\n        this.#isHovering = false;\r\n        this.#isAttached = false;\r\n        this.#callback = undefined;\r\n\r\n        this.#onMoveBound = this.onMouseMove.bind(this);\r\n        this.#onOutBound = this.onMouseOut.bind(this);\r\n        this.#onOverBound = this.onMouseOver.bind(this);\r\n\r\n    }\r\n\r\n    setCallback(callback: (t: CuiHoverEvent) => void): void {\r\n        this.#callback = callback;\r\n    }\r\n\r\n    isInProgress(): boolean {\r\n        return this.#inProgress;\r\n    }\r\n    attach(): void {\r\n        // @ts-ignore\r\n        this.#target.addEventListener(\"mouseover\", this.#onOverBound);\r\n        // @ts-ignore\r\n        this.#target.addEventListener(\"mousemove\", this.#onMoveBound);\r\n        // @ts-ignore\r\n        this.#target.addEventListener(\"mouseout\", this.#onOutBound);\r\n        this.#isAttached = true;\r\n    }\r\n\r\n    detach(): void {\r\n        // @ts-ignore\r\n        this.#target.removeEventListener(\"mouseover\", this.#onOverBound);\r\n        // @ts-ignore\r\n        this.#target.removeEventListener(\"mousemove\", this.#onMoveBound);\r\n        // @ts-ignore\r\n        this.#target.removeEventListener(\"mouseout\", this.#onOutBound);\r\n        this.#isAttached = false;\r\n    }\r\n\r\n    private emit(mouseEvent: MouseEvent, force: boolean) {\r\n        if (!are(this.#callback)) {\r\n            return;\r\n        }\r\n        if (!force && this.#inProgress) {\r\n            return;\r\n        }\r\n        this.#inProgress = true;\r\n        window.requestAnimationFrame(this.invoke.bind(this, {\r\n            isHovering: this.#isHovering,\r\n            event: mouseEvent,\r\n            timestamp: Date.now()\r\n        }))\r\n    }\r\n\r\n    isAttached() {\r\n        return this.#isAttached;\r\n    }\r\n    private invoke(ev: CuiHoverEvent) {\r\n        if (this.#callback)\r\n            this.#callback(ev);\r\n        this.#inProgress = false;\r\n    }\r\n\r\n    private onMouseOver(ev: MouseEvent) {\r\n        this.#isHovering = true;\r\n        this.emit(ev, true);\r\n    }\r\n\r\n    private onMouseOut(ev: MouseEvent) {\r\n        this.#isHovering = false;\r\n        this.emit(ev, true);\r\n    }\r\n\r\n    private onMouseMove(ev: MouseEvent) {\r\n        this.emit(ev, false);\r\n    }\r\n}","import { CuiPositionError } from \"../models/errors\";\r\nimport { is } from \"../utils/functions\";\r\nimport { ElementBox, ICuiPositionEvaluator } from \"./interfaces\";\r\n\r\nexport class CuiBasePositionEvaluator implements ICuiPositionEvaluator {\r\n    #box: ElementBox | undefined;\r\n    #targetWidth: number;\r\n    #targetHeight: number;\r\n    #margin: number;\r\n    constructor() {\r\n        this.#targetHeight = -1;\r\n        this.#targetWidth = -1;\r\n        this.#box = undefined;\r\n        this.#margin = 0;\r\n    }\r\n\r\n\r\n    setElementBox(box: ElementBox): void {\r\n        this.#box = box;\r\n    }\r\n\r\n    setTarget(targetBox: ElementBox): void {\r\n        this.#targetWidth = targetBox.width;\r\n        this.#targetHeight = targetBox.height;\r\n    }\r\n\r\n    setMargin(value: number) {\r\n        this.#margin = value;\r\n    }\r\n\r\n    getVerticalPosition(value: string): number {\r\n        switch (value) {\r\n            case 'top':\r\n                return this.getTopPosition();\r\n            case \"bottom\":\r\n                return this.getBottomPosition();\r\n            case \"middle\":\r\n                return this.getMiddlePosition();\r\n            default:\r\n                return -1;\r\n        }\r\n    }\r\n\r\n    getHorizontalPosition(value: string): number {\r\n        switch (value) {\r\n            case 'left':\r\n                return this.getLeftPosition();\r\n            case \"right\":\r\n                return this.getRightPosition();\r\n            case \"center\":\r\n                return this.getCenterPosition();\r\n            default:\r\n                return -1;\r\n        }\r\n    }\r\n\r\n    getAutoVerticalPosition(initial: string): [number, string] {\r\n        let innerHeight = window.innerHeight;\r\n        let number = this.getVerticalPosition(initial);\r\n\r\n        if ((initial === 'top' || initial === \"middle\") && number < 0) {\r\n            return [this.getVerticalPosition(\"bottom\"), \"bottom\"]\r\n        } else if ((initial === \"bottom\" || initial === \"middle\") && number + this.#targetHeight > innerHeight) {\r\n            return [this.getVerticalPosition(\"top\"), \"top\"]\r\n        }\r\n        return [number, initial];\r\n    }\r\n\r\n    getAutoHorizontalPosition(initial: string): [number, string] {\r\n        let innerWidth = window.innerWidth;\r\n        let number = this.getHorizontalPosition(initial);\r\n\r\n        if ((initial === 'right' || initial === \"center\") && number < 0) {\r\n            return [this.getHorizontalPosition(\"left\"), \"left\"]\r\n        } else if ((initial === 'left' || initial === \"center\") && number + this.#targetWidth > innerWidth) {\r\n            return [this.getHorizontalPosition(\"right\"), \"right\"]\r\n        }\r\n        return [number, initial];\r\n    }\r\n\r\n    private getTopPosition(): number {\r\n        this.throwIfNotValid(\"getTopPosition\");\r\n        // @ts-ignore - already checked in validate\r\n        return this.#box.top - this.#margin - this.#targetHeight;\r\n    }\r\n\r\n    private getBottomPosition(): number {\r\n        this.throwIfNotValid(\"getBottomPosition\");\r\n        // @ts-ignore - already checked in validate\r\n        return this.#box.top + this.#box.height + this.#margin;\r\n    }\r\n\r\n    private getMiddlePosition(): number {\r\n        this.throwIfNotValid(\"getMiddlePosition\");\r\n        // @ts-ignore - already checked in validate\r\n        return (this.#box.top + this.#box.height / 2) - this.#targetHeight / 2;\r\n    }\r\n\r\n    private getLeftPosition(): number {\r\n        this.throwIfNotValid(\"getLeftPosition\");\r\n        // @ts-ignore - already checked in validate\r\n        return this.#box.left;\r\n    }\r\n\r\n    private getRightPosition(): number {\r\n        this.throwIfNotValid(\"getRightPosition\");\r\n        // @ts-ignore - already checked in validate\r\n        return this.#box.left + this.#box.width - this.#targetWidth;\r\n    }\r\n\r\n    private getCenterPosition(): number {\r\n        this.throwIfNotValid(\"getCenterPosition\");\r\n        // @ts-ignore - already checked in validate\r\n        return (this.#box.left + this.#box.width / 2) - this.#targetWidth / 2;\r\n    }\r\n\r\n    private validate(): boolean {\r\n        return is(this.#box) && this.#targetHeight > 0 && this.#targetWidth > 0;\r\n    }\r\n\r\n\r\n\r\n    private throwIfNotValid(method: string): void {\r\n        if (!this.validate()) {\r\n            throw new CuiPositionError(`[${method}] Position cannot be calculated: missing data [width: ${this.#targetWidth}][height: ${this.#targetHeight}]`)\r\n        }\r\n    }\r\n}","import { CuiDevtoolFactory } from \"../development/factory\";\r\nimport { ICuiDevelopmentTool } from \"../development/interfaces\";\r\nimport { is } from \"../utils/functions\";\r\nimport { CuiBasePositionEvaluator } from \"./evaluator\";\r\nimport { ElementBox, ICuiPositionCalculator, ICuiPositionEvaluator } from \"./interfaces\";\r\n\r\nexport class CuiBasePositionCalculator implements ICuiPositionCalculator {\r\n    #static: string;\r\n    #preferred: string;\r\n    #evaluator: ICuiPositionEvaluator;\r\n    #log: ICuiDevelopmentTool;\r\n    constructor(evaluator?: ICuiPositionEvaluator) {\r\n        this.#preferred = \"top-center\";\r\n        this.#static = \"\";\r\n        this.#evaluator = evaluator ?? new CuiBasePositionEvaluator();\r\n        this.#log = CuiDevtoolFactory.get(\"CuiBasePositionCalculator\");\r\n    }\r\n\r\n    setMargin(value: number): void {\r\n        this.#evaluator.setMargin(value);\r\n    }\r\n\r\n    setPreferred(position: string): void {\r\n        this.#preferred = position\r\n    }\r\n\r\n    setStatic(position: string): void {\r\n        this.#static = position;\r\n    }\r\n\r\n    //targetWidth: number, targetHeight: number\r\n    calculate(elementBox: ElementBox, targetBox: ElementBox): [number, number, string] {\r\n        this.#evaluator.setElementBox(elementBox)\r\n        this.#evaluator.setTarget(targetBox);\r\n\r\n        if (is(this.#static)) {\r\n            this.#log.debug(\"Evaluating static position\")\r\n            const [vertical, horizontal] = this.parse(this.#static);\r\n            return [this.#evaluator.getHorizontalPosition(horizontal), this.#evaluator.getVerticalPosition(vertical), this.#static];\r\n        }\r\n\r\n        let [vertical, horizontal]: string[] = [\"\", \"\"];\r\n        if (is(this.#preferred)) {\r\n            this.#log.debug(\"Evaluating auto position\");\r\n            [vertical, horizontal] = this.parse(this.#preferred);\r\n        }\r\n        vertical = vertical ?? \"top\";\r\n        horizontal = horizontal ?? \"center\";\r\n        this.#log.debug(\"Calculating position: \" + vertical + \"-\" + horizontal)\r\n        const [outVNum, outVPos] = this.#evaluator.getAutoVerticalPosition(vertical);\r\n        const [outHNum, outHPos] = this.#evaluator.getAutoHorizontalPosition(horizontal);\r\n        this.#log.debug(\"Calculated position: \" + outVPos + \"-\" + outHPos)\r\n        return [outHNum, outVNum, outVPos + \"-\" + outHPos];\r\n    }\r\n\r\n    private parse(position: string): string[] {\r\n        return position.split(\"-\");\r\n    }\r\n}","import { are, is } from \"./functions\";\r\n\r\nexport interface ICuiTask {\r\n    start(): void;\r\n    stop(): void;\r\n    getId(): any;\r\n    setCallback(callback: () => void): void;\r\n    setTimeout(timeout: number): void;\r\n}\r\n\r\nexport class CuiTaskRunner implements ICuiTask {\r\n    #taskId: any;\r\n    #autoRenew: boolean;\r\n    #timeout: number;\r\n    #callback: (() => void) | undefined;\r\n\r\n    constructor(timeout: number, autoRenew: boolean, callback?: () => void) {\r\n        this.#autoRenew = autoRenew;\r\n        this.#timeout = timeout;\r\n        this.#callback = callback;\r\n    }\r\n    start(): void {\r\n        if (!this.canRun()) {\r\n            return;\r\n        }\r\n        this.stop();\r\n        this.#taskId = setTimeout(() => {\r\n            //@ts-ignore - already checked in canRun\r\n            this.#callback();\r\n            this.#taskId = null;\r\n            if (this.#autoRenew) {\r\n                this.start();\r\n            }\r\n        }, this.#timeout);\r\n    }\r\n\r\n    stop(): void {\r\n        if (this.#taskId) {\r\n            clearTimeout(this.#taskId);\r\n            this.#taskId = null\r\n        }\r\n    }\r\n\r\n    getId() {\r\n        return this.#taskId;\r\n    }\r\n\r\n    private canRun(): boolean {\r\n        return is(this.#callback) && this.#timeout > 0;\r\n    }\r\n\r\n    setCallback(callback: () => void) {\r\n        this.#callback = callback;\r\n    }\r\n\r\n    setTimeout(timeout: number) {\r\n        this.#timeout = timeout;\r\n    }\r\n\r\n}","import { ICuiHandlerModule } from \"src/core/handlers/modules/interfaces\";\r\nimport { CuiHoverEvent, CuiHoverListener } from \"../../../core/listeners/hover\";\r\n\r\nexport class CuiHoverModule implements ICuiHandlerModule<any> {\r\n    type: string;\r\n    description: string;\r\n    #hoverListener: CuiHoverListener;\r\n    #onHover: (ev: CuiHoverEvent) => void;\r\n\r\n    constructor(element: HTMLElement, onHover: (ev: CuiHoverEvent) => void) {\r\n        this.type = 'hover';\r\n        this.description = \"\";\r\n        this.#onHover = onHover;\r\n        this.#hoverListener = new CuiHoverListener(element);\r\n        this.#hoverListener.setCallback(this.onHover.bind(this));\r\n    }\r\n\r\n    async init(args: any): Promise<boolean> {\r\n        this.#hoverListener.attach();\r\n        return true;\r\n    }\r\n\r\n    async destroy(): Promise<boolean> {\r\n        this.#hoverListener.detach();\r\n        return true;\r\n    }\r\n\r\n    private onHover(ev: CuiHoverEvent) {\r\n        this.#onHover(ev);\r\n    }\r\n}","import { ICuiComponent, ICuiComponentHandler, ICuiOpenable, ICuiClosable, CuiElement } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiHandlerBase } from \"../../core/handlers/base\";\r\nimport { is, joinWithScopeSelector, replacePrefix } from \"../../core/utils/functions\";\r\nimport { EVENTS } from \"../../core/utils/statics\";\r\nimport { AriaAttributes } from \"../../core/utils/aria\";\r\nimport { CuiHoverListener, CuiHoverEvent } from \"../../core/listeners/hover\";\r\nimport { ICuiPositionCalculator } from \"../../core/position/interfaces\";\r\nimport { CuiBasePositionCalculator } from \"../../core/position/calculator\";\r\nimport { CuiTaskRunner, ICuiTask } from \"../../core/utils/task\";\r\nimport { ICuiComponentAction, CuiActionsListFactory } from \"../../core/utils/actions\";\r\nimport { CuiAutoParseArgs } from \"../../core/utils/arguments\";\r\nimport { GlobalClickEvent } from \"src/core/models/events\";\r\nimport { CuiHoverModule } from \"../modules/hover/hover\";\r\n\r\nconst bodyClass = '{prefix}-drop-open';\r\nconst DROP_POSITION = \"{prefix}-drop-position-\";\r\nconst DROP_TRIGGER = \"{prefix}-drop-trigger\";\r\nconst DROP_DEFAULT_TRIGGER = \"> a, button\";\r\nconst DROP_DEFAULT_ANIMATION_CLS = '{prefix}-drop-animation-in';\r\n\r\n\r\nexport interface CuiDropEvent {\r\n    timestamp: number;\r\n}\r\n\r\nexport class CuiDropArgs extends CuiAutoParseArgs {\r\n    mode: \"click\" | \"hover\";\r\n    trigger: string;\r\n    prevent: boolean;\r\n    autoClose: boolean;\r\n    outClose: boolean;\r\n    pos: string;\r\n    action: string;\r\n    timeout: number;\r\n    margin: number;\r\n\r\n    constructor(prefix: string) {\r\n        super({\r\n            props: {\r\n                'trigger': { corrector: joinWithScopeSelector }\r\n            }\r\n        });\r\n        this.mode = \"click\";\r\n        this.trigger = joinWithScopeSelector(DROP_DEFAULT_TRIGGER);\r\n        this.autoClose = false;\r\n        this.outClose = true;\r\n        this.prevent = false;\r\n        this.pos = \"\";\r\n        this.action = replacePrefix(DROP_DEFAULT_ANIMATION_CLS, prefix);\r\n        this.timeout = 3000;\r\n        this.margin = 8;\r\n    }\r\n}\r\n\r\nexport class CuiDropComponenet implements ICuiComponent {\r\n    attribute: string;\r\n    #prefix: string;\r\n    constructor(prefix?: string) {\r\n        this.#prefix = prefix ?? 'cui';\r\n        this.attribute = `${this.#prefix}-drop`;\r\n    }\r\n\r\n    getStyle(): string | null {\r\n        return null;\r\n    }\r\n\r\n    get(element: HTMLElement, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiDropHandler(element, utils, this.attribute, this.#prefix);\r\n    }\r\n}\r\n\r\nexport class CuiDropHandler extends CuiHandlerBase<CuiDropArgs> implements ICuiOpenable, ICuiClosable {\r\n    #prefix: string;\r\n    #bodyClass: string;\r\n    #attribute: string;\r\n    #triggerHoverListener: CuiHoverListener | undefined;\r\n\r\n    #trigger: Element;\r\n    #windowClickEventId: string | null;\r\n    #openEventId: string | null;\r\n    #closeEventId: string | null;\r\n    #positionCalculator: ICuiPositionCalculator;\r\n    #posClass: string;\r\n    #autoTask: ICuiTask;\r\n    #actions: ICuiComponentAction[];\r\n    constructor(element: HTMLElement, utils: CuiUtils, attribute: string, prefix: string) {\r\n        super(\"CuidropHandler\", element, attribute, new CuiDropArgs(prefix), utils);\r\n        this.#attribute = attribute;\r\n        this.#prefix = prefix;\r\n        this.#bodyClass = replacePrefix(bodyClass, prefix);\r\n        this.#windowClickEventId = null;\r\n        this.#openEventId = null;\r\n        this.#closeEventId = null;\r\n        this.onTriggerClick = this.onTriggerClick.bind(this)\r\n        this.#positionCalculator = new CuiBasePositionCalculator();\r\n        this.#positionCalculator.setMargin(8);\r\n        this.#positionCalculator.setPreferred(\"bottom-left\");\r\n        this.#posClass = \"\"\r\n        this.#triggerHoverListener = undefined;\r\n        this.#trigger = this.element;\r\n        this.#actions = [];\r\n        this.#autoTask = new CuiTaskRunner(this.args.timeout, false, this.close.bind(this));\r\n\r\n        if (!utils.isPlugin(\"click-plugin\")) {\r\n            this.logWarning(\"Window click plugin is not available: outClose will not work\")\r\n        }\r\n\r\n        this.addModule(new CuiHoverModule(this.element, this.onElementHover.bind(this)));\r\n    }\r\n\r\n    async onHandle(): Promise<boolean> {\r\n        this.#trigger = this.acquireTrigger();\r\n        this.#triggerHoverListener = new CuiHoverListener(this.#trigger);\r\n        this.#triggerHoverListener.setCallback(this.onHoverEvent.bind(this));\r\n        this.#triggerHoverListener.attach();\r\n        //@ts-ignore\r\n        this.#trigger.addEventListener('click', this.onTriggerClick)\r\n        // this.setTriggerEvent();\r\n        this.#openEventId = this.onEvent(EVENTS.OPEN, this.open.bind(this));\r\n        this.#closeEventId = this.onEvent(EVENTS.CLOSE, this.close.bind(this));\r\n\r\n        this.setDataFromArgs();\r\n\r\n        this.mutate(() => {\r\n            AriaAttributes.setAria(this.element, 'aria-dropdown', \"\");\r\n        })\r\n\r\n        return true;\r\n    }\r\n    async onRefresh(): Promise<boolean> {\r\n        if (this.prevArgs && this.args.trigger !== this.prevArgs.trigger) {\r\n            if (this.#triggerHoverListener && this.#triggerHoverListener.isAttached()) {\r\n                this.#triggerHoverListener.detach();\r\n            } else if (this.prevArgs && this.prevArgs.mode === 'click') {\r\n                //@ts-ignore \r\n                this.#trigger.removeEventListener('click', this.onTriggerClick)\r\n            }\r\n            this.#trigger = this.acquireTrigger();\r\n            this.#triggerHoverListener = new CuiHoverListener(this.#trigger);\r\n            this.#triggerHoverListener.setCallback(this.onHoverEvent.bind(this));\r\n            this.#triggerHoverListener.attach();\r\n            //@ts-ignore\r\n            this.#trigger.addEventListener('click', this.onTriggerClick)\r\n        }\r\n\r\n\r\n        this.setDataFromArgs();\r\n        return true;\r\n    }\r\n    async onRemove(): Promise<boolean> {\r\n\r\n        this.detachEvent(EVENTS.OPEN, this.#openEventId);\r\n        this.detachEvent(EVENTS.CLOSE, this.#closeEventId);\r\n        return true;\r\n    }\r\n\r\n    private setDataFromArgs() {\r\n        this.#positionCalculator.setStatic(this.args.pos);\r\n        this.#positionCalculator.setMargin(this.args.margin);\r\n        this.#autoTask.setTimeout(this.args.timeout);\r\n        this.#actions = CuiActionsListFactory.get(this.args.action);\r\n    }\r\n    /**\r\n    * Api Method open\r\n    */\r\n    async open(): Promise<boolean> {\r\n        if (this.checkLockAndWarn('open')) {\r\n            return false;\r\n        }\r\n        if (this.isActive()) {\r\n            return this.close();\r\n        }\r\n        if (this.isAnyActive()) {\r\n            await this.findAndCloseOpenedDrop();\r\n        }\r\n\r\n        this._log.debug(`Drop ${this.cuid}`, 'open');\r\n        this.onOpen();\r\n\r\n        return true\r\n    }\r\n\r\n    /**\r\n     * Api Method close\r\n     */\r\n    async close(): Promise<boolean> {\r\n        if (this.checkLockAndWarn(\"close\") || !this.isActive()) {\r\n            return false;\r\n        }\r\n        this.logInfo(`Drop ${this.cuid}`, 'close');\r\n        this.onClose();\r\n        this.emitEvent(EVENTS.CLOSED, {\r\n            timestamp: Date.now()\r\n        })\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Set of actions performed during drop open\r\n     */\r\n    onOpen() {\r\n        this.isLocked = true;\r\n        this.helper.setClass(this.activeClassName, this.element);\r\n        this.mutate(() => {\r\n            const box = this.#trigger.getBoundingClientRect();\r\n            try {\r\n                const [x, y, pos] = this.#positionCalculator.calculate(box, this.element.getBoundingClientRect());\r\n                this.element.style.top = `${y - box.top}px`;\r\n                this.element.style.left = `${x - box.left}px`;\r\n                this.#posClass = replacePrefix(DROP_POSITION + pos, this.#prefix);\r\n                this.toggleActions();\r\n                this.helper.setClass(this.#posClass, this.element);\r\n                this.helper.setClass(this.#bodyClass, document.body)\r\n\r\n                this.emitEvent(EVENTS.OPENED, {\r\n                    timestamp: Date.now()\r\n                })\r\n\r\n                this.runAutoCloseTask();\r\n\r\n                AriaAttributes.setAria(this.element, 'aria-expanded', 'true')\r\n                this.#windowClickEventId = this.onEvent(EVENTS.WINDOW_CLICK, this.onWindowClick.bind(this));\r\n            } catch (e) {\r\n                this._log.exception(e)\r\n            } finally {\r\n                this.isLocked = false;\r\n            }\r\n        })\r\n    }\r\n\r\n    /**\r\n        * Set of actions performed during drop close\r\n        */\r\n    onClose() {\r\n        this.isLocked = true;\r\n        this.mutate(() => {\r\n            this.helper.removeClass(this.activeClassName, this.element)\r\n            this.helper.removeClass(this.#bodyClass, document.body)\r\n            this.toggleActions();\r\n            this.helper.removeClass(this.#posClass, this.element);\r\n            AriaAttributes.setAria(this.element, 'aria-expanded', 'false')\r\n            this.detachEvent(EVENTS.WINDOW_CLICK, this.#windowClickEventId);\r\n            this.isLocked = false;\r\n        })\r\n    }\r\n\r\n    /**\r\n     * Event invoked when window is clicked\r\n     * @param ev \r\n     */\r\n    private onWindowClick(ev: GlobalClickEvent) {\r\n        if (!this.args.outClose) {\r\n            return;\r\n        }\r\n        if (!this.element.contains((ev.ev.target as Node))) {\r\n            this.close();\r\n        }\r\n    }\r\n\r\n    private isAnyActive(): boolean {\r\n        return this.helper.hasClass(this.#bodyClass, document.body);\r\n    }\r\n\r\n    /**\r\n     * Finds and opens other active drop element\r\n     */\r\n    async findAndCloseOpenedDrop(): Promise<boolean> {\r\n        const opened = document.querySelector(`[${this.#attribute}].${this.activeClassName}`);\r\n        if (!is(opened)) {\r\n            this._log.warning(\"Opened drop was not found\");\r\n            return false;\r\n        }\r\n        //@ts-ignore opened checked\r\n        const handler = (<CuiElement>(opened as any)).$handlers[this.#attribute] as any;\r\n        if (!is(handler)) {\r\n            this._log.warning(\"Drop handler was not found in the element\");\r\n            return false;\r\n        }\r\n        return handler.close();\r\n    }\r\n\r\n    /**\r\n     * Invoked when trigger button is clicked\r\n     * @param ev \r\n     */\r\n    private onTriggerClick(ev: MouseEvent) {\r\n        if (this.args.mode !== 'click') {\r\n            return;\r\n        }\r\n        if (this.isActive()) {\r\n            this.close();\r\n        } else {\r\n            this.open();\r\n        }\r\n    }\r\n\r\n    /**\r\n    * Invoked when trigger button is hovered on\r\n    * @param ev\r\n    */\r\n    private onHoverEvent(ev: CuiHoverEvent) {\r\n        if (this.args.mode !== 'hover') {\r\n            return;\r\n        }\r\n        if (ev.isHovering && !this.isActive()) {\r\n            this.open();\r\n        }\r\n    }\r\n\r\n\r\n    /**\r\n     * Method triggered when opened element is hovered on\r\n     * @param ev \r\n     */\r\n    private onElementHover(ev: CuiHoverEvent) {\r\n        if (ev.isHovering) {\r\n            this.#autoTask.stop();\r\n        } else if (!ev.isHovering && this.args.autoClose) {\r\n            this.runAutoCloseTask();\r\n        }\r\n    }\r\n\r\n    // /**\r\n    //  * Sets event on trigger button\r\n    //  */\r\n    // private setTriggerEvent() {\r\n    //     if (this.args.mode === 'hover' && this.#triggerHoverListener) {\r\n    //         this.#triggerHoverListener.setCallback(this.onHoverEvent.bind(this));\r\n    //         this.#triggerHoverListener.attach();\r\n    //     } else {\r\n    //         //@ts-ignore\r\n    //         this.#trigger.addEventListener('click', this.onTriggerClick)\r\n    //     }\r\n    // }\r\n\r\n    /**\r\n     * Runs auto-close task on opened element\r\n     */\r\n    private runAutoCloseTask() {\r\n        if (!this.args.autoClose) {\r\n            return\r\n        }\r\n        this.#autoTask.start();\r\n    }\r\n\r\n    private toggleActions() {\r\n        this.#actions.forEach(action => {\r\n            action.toggle(this.element);\r\n        })\r\n    }\r\n\r\n    private acquireTrigger(): Element {\r\n        let ret = null;\r\n        if (!this.element.parentElement) {\r\n            ret = document.querySelector(this.args.trigger)\r\n        } else\r\n            ret = this.element.parentElement.querySelector(this.args.trigger);\r\n        return ret ?? this.element;\r\n    }\r\n}","export interface ICuiFloatPositionCalculator {\r\n    calculate(x: number, y: number, diffX: number, diffY: number): [number, number];\r\n}\r\n\r\nexport interface ICuiFloatResizeCalculator {\r\n    calculate(x: number, y: number, diffX: number, diffY: number): [number, number];\r\n}\r\n\r\nexport class BasePositionCalculator implements ICuiFloatPositionCalculator {\r\n\r\n    calculate(x: number, y: number, diffX: number, diffY: number): [number, number] {\r\n        return [x, y];\r\n    }\r\n\r\n}\r\n\r\nexport class OptionalPositionCalculator implements ICuiFloatPositionCalculator {\r\n    #element: HTMLElement;\r\n    constructor(element: HTMLElement) {\r\n        this.#element = element;\r\n    }\r\n    calculate(x: number, y: number, diffX: number, diffY: number): [number, number] {\r\n        let newX = this.#element.offsetLeft + diffX;\r\n        let newY = this.#element.offsetTop + diffY;\r\n        return [newX, newY];\r\n    }\r\n\r\n}\r\n\r\nexport class BaseResizeCalculator implements ICuiFloatResizeCalculator {\r\n    #element: HTMLElement;\r\n    constructor(element: HTMLElement) {\r\n        this.#element = element;\r\n    }\r\n    calculate(x: number, y: number, diffX: number, diffY: number): [number, number] {\r\n        let width = x - this.#element.offsetLeft;\r\n        let height = y - this.#element.offsetTop;\r\n        return [width, height];\r\n    }\r\n}\r\n\r\nexport class OptionalResizeCalculator implements ICuiFloatResizeCalculator {\r\n    #element: HTMLElement;\r\n    constructor(element: HTMLElement) {\r\n        this.#element = element;\r\n    }\r\n    calculate(x: number, y: number, diffX: number, diffY: number): [number, number] {\r\n        let width = this.#element.offsetWidth + diffX;\r\n        let height = this.#element.offsetHeight + diffY;\r\n        return [width, height];\r\n    }\r\n}","import { ICuiComponent, ICuiComponentHandler } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { replacePrefix, is } from \"../../core/utils/functions\";\r\nimport { AriaAttributes } from \"../../core/utils/aria\";\r\nimport { CuiInteractableArgs, CuiInteractableHandler } from \"../../core/handlers/base\";\r\nimport { CuiMoveEventListener, ICuiMoveData } from \"../../core/listeners/move\";\r\nimport { BasePositionCalculator, BaseResizeCalculator, ICuiFloatPositionCalculator, ICuiFloatResizeCalculator } from \"./helpers\";\r\nimport { CLASSES, EVENTS } from \"../../core/utils/statics\";\r\nimport { CuiAutoParseArgs } from \"../../core/utils/arguments\";\r\n\r\nconst FLOAT_OPEN_ANIMATION_CLASS = '.{prefix}-float-default-in';\r\nconst FLOAT_CLOSE_ANIMATION_CLASS = '.{prefix}-float-default-out';\r\nconst MOVE = '.{prefix}-float-move';\r\nconst RESIZE = '.{prefix}-float-resize';\r\n\r\n\r\nexport class CuiFloatArgs extends CuiAutoParseArgs implements CuiInteractableArgs {\r\n    escClose: boolean;\r\n    timeout: number;\r\n    openAct: string;\r\n    closeAct: string;\r\n    keyClose: string;\r\n\r\n    constructor(prefix: string, defTimeout?: number) {\r\n        super();\r\n        this.escClose = false;\r\n        this.keyClose = \"\";\r\n        this.openAct = replacePrefix(FLOAT_OPEN_ANIMATION_CLASS, prefix);\r\n        this.closeAct = replacePrefix(FLOAT_CLOSE_ANIMATION_CLASS, prefix);\r\n        this.timeout = defTimeout ?? 300;\r\n    }\r\n}\r\n\r\nexport class CuiFloatComponent implements ICuiComponent {\r\n    attribute: string;\r\n    #prefix: string;\r\n    constructor(prefix?: string) {\r\n        this.#prefix = prefix ?? 'cui';\r\n        this.attribute = `${this.#prefix}-float`;\r\n    }\r\n\r\n    getStyle(): string | null {\r\n        return null;\r\n    }\r\n\r\n    get(element: HTMLElement, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiFloatHandler(element, utils, this.attribute, this.#prefix);\r\n    }\r\n}\r\n\r\nexport class CuiFloatHandler extends CuiInteractableHandler<CuiFloatArgs> {\r\n    #isMoving: boolean;\r\n    #isResizing: boolean;\r\n    #prevX: number;\r\n    #prevY: number;\r\n    #prefix: string;\r\n    #moveListener: CuiMoveEventListener;\r\n    #positionCalculator: ICuiFloatPositionCalculator;\r\n    #resizeCalculator: ICuiFloatResizeCalculator;\r\n    #resizeBtn: HTMLElement | null;\r\n    #moveBtn: HTMLElement | null;\r\n    constructor(element: HTMLElement, utils: CuiUtils, attribute: string, prefix: string) {\r\n        super(\"CuiFloatHandler\", element, attribute, new CuiFloatArgs(prefix, utils.setup.animationTime), utils);\r\n        this.#isMoving = false;\r\n        this.#isResizing = false;\r\n        this.#prevX = 0;\r\n        this.#prevY = 0;\r\n        this.#moveListener = new CuiMoveEventListener();\r\n        this.#moveListener.preventDefault(false);\r\n        this.#positionCalculator = new BasePositionCalculator();\r\n        this.#resizeCalculator = new BaseResizeCalculator(element as HTMLElement)\r\n        this.#prefix = prefix;\r\n        this.move = this.move.bind(this);\r\n        this.resize = this.resize.bind(this);\r\n        this.#moveBtn = null;\r\n        this.#resizeBtn = null;\r\n\r\n        if (!utils.isPlugin(\"click-plugin\")) {\r\n            this.logWarning(\"WindowClick plugin is not available, outClose will not work\")\r\n        }\r\n        if (!utils.isPlugin(\"keys-plugin\")) {\r\n            this.logWarning(\"KeyObserver plugin is not available, escClose and keyClose will not work\")\r\n        }\r\n    }\r\n\r\n    onInit(): void {\r\n        AriaAttributes.setAria(this.element, 'aria-modal', \"\");\r\n        this.#moveBtn = this.element.querySelector(replacePrefix(MOVE, this.#prefix))\r\n        this.#resizeBtn = this.element.querySelector(replacePrefix(RESIZE, this.#prefix))\r\n        this.#moveListener.setCallback(this.onMove.bind(this));\r\n\r\n    }\r\n\r\n    onUpdate(): void {\r\n\r\n    }\r\n\r\n    onDestroy(): void {\r\n    }\r\n\r\n    onBeforeOpen(): boolean {\r\n        return true\r\n    }\r\n\r\n    onAfterOpen(): void {\r\n        this.#moveListener.attach();\r\n    }\r\n\r\n    onAfterClose(): void {\r\n        this.#moveListener.detach();\r\n    }\r\n    onBeforeClose(): boolean {\r\n        return true;\r\n    }\r\n\r\n    onMove(ev: ICuiMoveData) {\r\n        switch (ev.type) {\r\n            case 'down':\r\n                this.onMouseDown(ev);\r\n                break;\r\n            case 'up':\r\n                this.onMouseUp(ev)\r\n                break;\r\n            case 'move':\r\n                this.onMouseMove(ev);\r\n                break;\r\n        }\r\n    }\r\n\r\n\r\n    onMouseDown(ev: ICuiMoveData) {\r\n        if (ev.target === this.#moveBtn) {\r\n            this.#isMoving = true;\r\n            ev.event.preventDefault();\r\n        } else if (ev.target === this.#resizeBtn) {\r\n            this.#isResizing = true;\r\n            ev.event.preventDefault();\r\n            //this.helper.setClass(\"cui-float-resize-shadow\")\r\n        }\r\n        this.#prevX = ev.x;\r\n        this.#prevY = ev.y;\r\n        this.helper.setClassesAs(document.body, CLASSES.swipingOn);\r\n        // Lock global move handler\r\n        this.utils.bus.emit(EVENTS.MOVE_LOCK, null, true);\r\n    }\r\n\r\n    onMouseMove(ev: ICuiMoveData) {\r\n        if (this.#isMoving) {\r\n            this.peform(ev, this.move)\r\n        } else if (this.#isResizing) {\r\n            this.peform(ev, this.resize)\r\n        }\r\n    }\r\n\r\n\r\n    onMouseUp(ev: ICuiMoveData) {\r\n        this.#isMoving = false;\r\n        this.#isResizing = false;\r\n        this.helper.removeClassesAs(document.body, CLASSES.swipingOn);\r\n        // Unlock global handler\r\n        this.utils.bus.emit(EVENTS.MOVE_LOCK, null, false);\r\n\r\n    }\r\n\r\n    peform(ev: ICuiMoveData, callback: (element: HTMLElement, x: number, y: number, diffX: number, diffY: number) => void) {\r\n        this.mutate(() => {\r\n            if (is(callback))\r\n                callback(this.element as HTMLElement, ev.x, ev.y, (ev.x - this.#prevX), (ev.y - this.#prevY));\r\n            this.#prevX = ev.x;\r\n            this.#prevY = ev.y;\r\n        })\r\n        ev.event.preventDefault();\r\n    }\r\n\r\n    resize(element: HTMLElement, x: number, y: number, diffX: number, diffY: number): void {\r\n        let [newWidth, newHeight] = this.#resizeCalculator.calculate(x, y, diffX, diffY);\r\n        if (this.fitsWindow(element.offsetTop, element.offsetLeft, newWidth, newHeight)) {\r\n            this.mutate(() => {\r\n                element.style.width = newWidth + \"px\";\r\n                element.style.height = newHeight + \"px\";\r\n            })\r\n        }\r\n    }\r\n\r\n    move(element: HTMLElement, x: number, y: number, diffX: number, diffY: number): void {\r\n        let [newX, newY] = this.#positionCalculator.calculate(x, y, diffX, diffY)\r\n        if (this.fitsWindow(newY, newX, element.offsetWidth, element.offsetHeight)) {\r\n            this.mutate(() => {\r\n                element.style.left = newX + \"px\";\r\n                element.style.top = newY + \"px\";\r\n            })\r\n        }\r\n    }\r\n\r\n    fitsWindow(top: number, left: number, width: number, height: number) {\r\n        return (top + height < window.innerHeight - 10) &&\r\n            (top > 10) && (left > 10) &&\r\n            (left + width < window.innerWidth - 10);\r\n    }\r\n}","import { ICuiComponent, ICuiComponentHandler, ICuiParsable } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiHandlerBase } from \"../../core/handlers/base\";\r\nimport { ICONS } from \"../../core/utils/statics\";\r\nimport { is } from \"../../core/utils/functions\";\r\nimport { IconBuilder } from \"../../core/builders/icon\";\r\nimport { CuiAutoParseArgs } from \"../../core/utils/arguments\";\r\n\r\nexport class CuiIconArgs extends CuiAutoParseArgs {\r\n    icon: string;\r\n    scale: number;\r\n\r\n    constructor() {\r\n        super({\r\n            main: 'icon'\r\n        });\r\n        this.icon = \"\";\r\n        this.scale = 1;\r\n    }\r\n}\r\n\r\nexport class CuiIconComponent implements ICuiComponent {\r\n    attribute: string;\r\n    constructor(prefix?: string) {\r\n        this.attribute = `${prefix ?? 'cui'}-icon`;\r\n    }\r\n\r\n    getStyle(): string | null {\r\n        return null;\r\n    }\r\n\r\n    get(element: HTMLElement, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiIconHandler(element, utils, this.attribute);\r\n    }\r\n}\r\n\r\n\r\n\r\nexport class CuiIconHandler extends CuiHandlerBase<CuiIconArgs> {\r\n\r\n   \r\n    constructor(element: HTMLElement, utils: CuiUtils, attribute: string) {\r\n        super(\"CuiIconHandler\", element, attribute, new CuiIconArgs(), utils);\r\n   \r\n    }\r\n\r\n    async onHandle(): Promise<boolean> {\r\n        this.addIcon(this.args.icon);\r\n        return true;\r\n    }\r\n\r\n    async onRefresh(): Promise<boolean> {\r\n        if (!this.prevArgs || this.args.icon === this.prevArgs.icon) {\r\n            return false;\r\n        }\r\n   \r\n        this.addIcon(this.args.icon);\r\n        return true;\r\n    }\r\n\r\n    async onRemove(): Promise<boolean> {\r\n        const svg = this.element.querySelector('svg')\r\n        if (is(svg)) {\r\n            //@ts-ignore checked\r\n            svg.remove();\r\n        }\r\n        return true;\r\n    }\r\n\r\n    private addIcon(icon: string) {\r\n        const iconStr = icon ? ICONS[icon] : null;\r\n        if (!iconStr) {\r\n            return;\r\n        }\r\n        const iconSvg = new IconBuilder(iconStr).setScale(this.args.scale).build();\r\n        const svg = this.element.querySelector('svg')\r\n        if (is(svg)) {\r\n            //@ts-ignore checked\r\n            svg.remove();\r\n        }\r\n        if (this.element.childNodes.length > 0) {\r\n            this.mutate(this.insertBefore, iconSvg)\r\n            return;\r\n        }\r\n        this.mutate(this.appendChild, iconSvg)\r\n\r\n    }\r\n\r\n    private insertBefore(iconElement: Element) {\r\n        this.element.insertBefore(iconElement, this.element.firstChild);\r\n    }\r\n\r\n    private appendChild(iconElement: Element) {\r\n        this.element.appendChild(iconElement);\r\n    }\r\n}\r\n","\r\nimport { CuiInteractableArgs, CuiInteractableHandler } from \"../../core/handlers/base\";\r\nimport { AriaAttributes } from \"../../core/utils/aria\";\r\nimport { ICuiComponent, ICuiComponentHandler, ICuiParsable } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { replacePrefix, getName } from \"../../core/utils/functions\";\r\nimport { EVENTS } from \"../../core/utils/statics\";\r\nimport { CuiAutoParseArgs } from \"../../core/utils/arguments\";\r\nimport { GlobalClickEvent } from \"src/core/models/events\";\r\n\r\nconst OFFCANVAS_RIGHT_ANIM_DEFAULT_IN = \".{prefix}-offcanvas-default-right-in\";\r\nconst OFFCANVAS_RIGHT_ANIM_DEFAULT_OUT = \".{prefix}-offcanvas-default-right-out\";\r\nconst OFFCANVAS_LEFT_ANIM_DEFAULT_IN = \".{prefix}-offcanvas-default-left-in\";\r\nconst OFFCANVAS_LEFT_ANIM_DEFAULT_OUT = \".{prefix}-offcanvas-default-left-out\";\r\n\r\nconst OFFCANVAS_BODY = \"{prefix}-off-canvas-open\";\r\nconst OFFCANVAS_CONTAINER_CLS = '.{prefix}-off-canvas-container';\r\n\r\nexport class CuiOffCanvasArgs extends CuiAutoParseArgs implements ICuiParsable, CuiInteractableArgs {\r\n    escClose: boolean;\r\n    outClose: boolean;\r\n    openAct: string;\r\n    closeAct: string;\r\n    keyClose: string;\r\n    position: 'left' | 'right';\r\n    timeout: number;\r\n\r\n    #prefix: string;\r\n    constructor(prefix: string, timeout?: number) {\r\n        super();\r\n        this.#prefix = prefix;\r\n\r\n        this.escClose = false;\r\n        this.position = 'right';\r\n        this.openAct = this.getDefaultOpenClass();\r\n        this.closeAct = this.getDefaultCloseClass();\r\n        this.timeout = timeout ?? 300;\r\n        this.outClose = false;\r\n        this.keyClose = \"\";\r\n    }\r\n\r\n    getDefaultOpenClass(): string {\r\n        return replacePrefix(this.position === 'right' ? OFFCANVAS_RIGHT_ANIM_DEFAULT_IN : OFFCANVAS_LEFT_ANIM_DEFAULT_IN, this.#prefix);\r\n    }\r\n\r\n    getDefaultCloseClass(): string {\r\n        return replacePrefix(this.position === 'right' ? OFFCANVAS_RIGHT_ANIM_DEFAULT_OUT : OFFCANVAS_LEFT_ANIM_DEFAULT_OUT, this.#prefix);\r\n    }\r\n}\r\n\r\nexport class CuiOffCanvasComponent implements ICuiComponent {\r\n    attribute: string;\r\n    #prefix: string;\r\n    constructor(prefix?: string) {\r\n        this.#prefix = prefix ?? 'cui';\r\n        this.attribute = `${this.#prefix}-off-canvas`;\r\n    }\r\n\r\n    getStyle(): string | null {\r\n        return null;\r\n    }\r\n\r\n    get(element: HTMLElement, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiOffCanvasHandler(element, utils, this.attribute, this.#prefix);\r\n    }\r\n}\r\n\r\nexport class CuiOffCanvasHandler extends CuiInteractableHandler<CuiOffCanvasArgs>  {\r\n\r\n    #prefix: string;\r\n    #bodyClass: string;\r\n    #scrollY: number;\r\n    #windowClickEventId: string | null;\r\n\r\n    constructor(element: HTMLElement, utils: CuiUtils, attribute: string, prefix: string) {\r\n        super(\"CuiOffCanvasHandler\", element, attribute, new CuiOffCanvasArgs(prefix, utils.setup.animationTime), utils);\r\n        this.#prefix = prefix;\r\n        this.#bodyClass = replacePrefix(OFFCANVAS_BODY, prefix);\r\n        this.#windowClickEventId = null;\r\n        this.#scrollY = 0;\r\n\r\n        if (!utils.isPlugin(\"click-plugin\")) {\r\n            this.logWarning(\"WindowClick plugin is not available, outClose will not work\")\r\n        }\r\n        if (!utils.isPlugin(\"keys-plugin\")) {\r\n            this.logWarning(\"KeyObserver plugin is not available, escClose and keyClose will not work\")\r\n        }\r\n    }\r\n\r\n    onInit(): void {\r\n        this.mutate(() => {\r\n            this.setPositionLeft();\r\n            AriaAttributes.setAria(this.element, 'aria-modal', \"\");\r\n        })\r\n    }\r\n    onUpdate(): void {\r\n        this.setPositionLeft();\r\n    }\r\n    onDestroy(): void {\r\n\r\n    }\r\n    onBeforeOpen(): boolean {\r\n        if (this.isAnyActive()) {\r\n            return false;\r\n        }\r\n        this.#scrollY = window.pageYOffset;\r\n        return true;\r\n    }\r\n\r\n    onAfterOpen(): void {\r\n        if (this.args.outClose) {\r\n            this.#windowClickEventId = this.onEvent(EVENTS.WINDOW_CLICK, this.onWindowClick.bind(this));\r\n        }\r\n        this.helper.setClass(this.#bodyClass, document.body);\r\n        document.body.style.top = `-${scrollY}px`;\r\n    }\r\n    onAfterClose(): void {\r\n        this.detachEvent(EVENTS.WINDOW_CLICK, this.#windowClickEventId);\r\n        this.helper.removeClass(this.#bodyClass, document.body);\r\n        document.body.style.top = '';\r\n        window.scrollTo(0, this.#scrollY * -1);\r\n    }\r\n    onBeforeClose(): boolean {\r\n        return true;\r\n    }\r\n\r\n    onWindowClick(ev: GlobalClickEvent) {\r\n        const container = this.element.querySelector(replacePrefix(OFFCANVAS_CONTAINER_CLS, this.#prefix));\r\n        if (container && !container.contains((ev.ev.target as Node))) {\r\n            this.close();\r\n        }\r\n    }\r\n\r\n    isAnyActive(): boolean {\r\n        return this.helper.hasClass(this.#bodyClass, document.body);\r\n    }\r\n\r\n    setPositionLeft() {\r\n        let cls = getName(this.#prefix, 'left');\r\n        if (this.args.position === 'left' && !this.helper.hasClass(cls, this.element)) {\r\n            this.helper.setClass(cls, this.element)\r\n        } else if (this.args.position == 'right' && this.helper.hasClass(cls, this.element)) {\r\n            this.helper.removeClass(cls, this.element)\r\n        }\r\n    }\r\n\r\n\r\n}","\r\nexport type CuiElementBoxType = Element | HTMLElement | Window;\r\n\r\nexport interface ICuiElementBox {\r\n    getHeight(): number;\r\n    getWidth(): number;\r\n    getTop(): number;\r\n    getLeft(): number;\r\n    getScrollHeight(): number;\r\n    getScrollWidth(): number;\r\n    getScrollTop(): number;\r\n    getScrollLeft(): number;\r\n    queryAll(selector: string): HTMLElement[];\r\n}\r\n\r\nexport class CuiElementBoxFactory {\r\n    static get(element: CuiElementBoxType): ICuiElementBox {\r\n        if (element instanceof Window) {\r\n            return new WindowElementBox();\r\n        } else if (element instanceof HTMLElement) {\r\n            return new HTMLElementBox(element);\r\n        }\r\n        return new ElementBox(element);\r\n    }\r\n}\r\n\r\nexport class ElementBox implements ICuiElementBox {\r\n    #box: DOMRect;\r\n    #element: Element;\r\n    constructor(element: Element) {\r\n        this.#element = element;\r\n        this.#box = element.getBoundingClientRect();\r\n    }\r\n\r\n    getHeight(): number {\r\n        return this.#box.height;\r\n    }\r\n    getWidth(): number {\r\n        return this.#box.width;\r\n    }\r\n    getTop(): number {\r\n        return this.#box.top;\r\n    }\r\n    getLeft(): number {\r\n        return this.#box.left;\r\n    }\r\n    getScrollHeight(): number {\r\n        return this.#element.scrollHeight;\r\n    }\r\n\r\n    getScrollWidth(): number {\r\n        return this.#element.scrollWidth;\r\n    }\r\n\r\n    getScrollTop(): number {\r\n        return this.#element.scrollTop;\r\n    }\r\n\r\n    getScrollLeft(): number {\r\n        return this.#element.scrollLeft;\r\n    }\r\n\r\n    queryAll(selector: string): HTMLElement[] {\r\n        return [...this.#element.querySelectorAll<HTMLElement>(selector)];\r\n    }\r\n}\r\n\r\nexport class HTMLElementBox implements ICuiElementBox {\r\n    #element: HTMLElement;\r\n    constructor(element: HTMLElement) {\r\n        this.#element = element;\r\n    }\r\n\r\n    getHeight(): number {\r\n        return this.#element.offsetHeight;\r\n    }\r\n    getWidth(): number {\r\n        return this.#element.offsetWidth;\r\n    }\r\n    getTop(): number {\r\n        return this.#element.offsetTop;\r\n    }\r\n    getLeft(): number {\r\n        return this.#element.offsetLeft;\r\n    }\r\n\r\n    getScrollHeight(): number {\r\n        return this.#element.scrollHeight;\r\n    }\r\n\r\n    getScrollWidth(): number {\r\n        return this.#element.scrollWidth;\r\n    }\r\n\r\n    getScrollTop(): number {\r\n        return this.#element.scrollTop;\r\n    }\r\n\r\n    getScrollLeft(): number {\r\n        return this.#element.scrollLeft;\r\n    }\r\n\r\n    queryAll(selector: string): HTMLElement[] {\r\n        return [...this.#element.querySelectorAll<HTMLElement>(selector)];\r\n    }\r\n}\r\n\r\nexport class WindowElementBox implements ICuiElementBox {\r\n    getHeight(): number {\r\n        return window.innerHeight;\r\n    }\r\n    getWidth(): number {\r\n        return window.innerWidth;\r\n    }\r\n    getTop(): number {\r\n        return 0;\r\n    }\r\n    getLeft(): number {\r\n        return 0;\r\n    }\r\n\r\n    getScrollHeight(): number {\r\n        return window.innerHeight;\r\n    }\r\n\r\n    getScrollWidth(): number {\r\n        return window.innerWidth;\r\n    }\r\n\r\n    getScrollTop(): number {\r\n        return window.pageYOffset;\r\n    }\r\n    getScrollLeft(): number {\r\n        return window.pageXOffset;\r\n    }\r\n    queryAll(selector: string): HTMLElement[] {\r\n        return [...document.querySelectorAll(selector)] as any[];\r\n    }\r\n\r\n}","import { CuiElementBoxFactory, CuiElementBoxType, ICuiElementBox } from \"../models/elements\";\r\nimport { ICuiEventListener } from \"../models/interfaces\";\r\nimport { getRangeValueOrDefault, is } from \"../utils/functions\";\r\nimport { CuiTaskRunner, ICuiTask } from \"../utils/task\";\r\n\r\nconst DEFAULT_SCROLL_END_TIMEOUT: number = 50;\r\n\r\nexport interface CuiScrollEvent {\r\n    base: Event | undefined;\r\n    top: number;\r\n    left: number;\r\n    initial: boolean;\r\n    scrolling: boolean;\r\n    source: string;\r\n}\r\n\r\nexport class CuiScrollListener implements ICuiEventListener<CuiScrollEvent> {\r\n    #target: CuiElementBoxType;\r\n    #inProgress: boolean;\r\n    #threshold: number;\r\n    #prevX: number;\r\n    #prevY: number;\r\n    #callback: ((ev: CuiScrollEvent) => void) | undefined;\r\n    #isAttached: boolean;\r\n    #box: ICuiElementBox;\r\n    #task: ICuiTask;\r\n    #listener: (ev: Event) => void;\r\n    constructor(target: CuiElementBoxType, threshold?: number) {\r\n        this.#target = target;\r\n        this.#box = CuiElementBoxFactory.get(target);\r\n        this.#inProgress = false;\r\n        this.#threshold = getRangeValueOrDefault(threshold, 0, 100, 0);\r\n        this.#prevX = this.#prevY = 0;\r\n        this.#isAttached = false;\r\n        this.#callback = undefined;\r\n        this.#task = new CuiTaskRunner(DEFAULT_SCROLL_END_TIMEOUT, false, this.onScrollFinish.bind(this));\r\n\r\n        this.#listener = this.listener.bind(this);\r\n    }\r\n\r\n    setCallback(callback: (ev: CuiScrollEvent) => void) {\r\n        this.#callback = callback;\r\n    }\r\n\r\n    attach() {\r\n        this.#target.addEventListener('scroll', this.#listener)\r\n        this.#isAttached = true;\r\n        this.listener(undefined, true, \"init\");\r\n    }\r\n\r\n    detach() {\r\n        this.#target.removeEventListener('scroll', this.#listener)\r\n        this.#task.stop();\r\n        this.#isAttached = false;\r\n    }\r\n\r\n    setTarget(target: CuiElementBoxType) {\r\n        if (target !== this.#target) {\r\n            this.detach();\r\n            this.#target = target;\r\n            this.attach();\r\n        }\r\n    }\r\n\r\n    setThreshold(threshold: number) {\r\n        this.#threshold = getRangeValueOrDefault(threshold, 0, 100, 0);\r\n    }\r\n\r\n    isInProgress(): boolean {\r\n        return this.#inProgress;\r\n    }\r\n\r\n    isAttached(): boolean {\r\n        return this.#isAttached;\r\n    }\r\n\r\n    private listener(ev?: Event, initial?: boolean, source?: string) {\r\n        if (!is(this.#callback)) {\r\n            return;\r\n        }\r\n        let left = this.#box.getScrollLeft();\r\n        let top = this.#box.getScrollTop();\r\n        this.#prevX += left;\r\n        this.#prevY += top;\r\n        if (this.#inProgress || (!this.passedThreshold() && is(ev))) {\r\n            return;\r\n        }\r\n        this.#inProgress = true;\r\n        // @ts-ignore - callback already checked\r\n        this.#callback({\r\n            base: ev,\r\n            top: top,\r\n            left: left,\r\n            initial: initial ?? false,\r\n            scrolling: is(ev),\r\n            source: source ?? \"event\"\r\n        })\r\n        if (is(ev))\r\n            this.#task.start();\r\n        this.#inProgress = false\r\n        this.#prevX = 0;\r\n        this.#prevY = 0;\r\n    }\r\n\r\n    private passedThreshold() {\r\n        return this.#threshold <= 0 || (this.#prevX >= this.#threshold || this.#prevY >= this.#threshold);\r\n    }\r\n\r\n    private onScrollFinish() {\r\n        this.listener(undefined, false, \"task\");\r\n    }\r\n}","export interface ICuiOffsetMode {\r\n    matches(top: number, left: number, offsetX: number, offsetY: number): boolean;\r\n}\r\n\r\nexport class CuiOffsetStaticMode implements ICuiOffsetMode {\r\n\r\n    matches(top: number, left: number, offsetX: number, offsetY: number): boolean {\r\n        return (offsetX > 0 && left >= offsetX) ||\r\n            (offsetY > 0 && top >= offsetY)\r\n    }\r\n\r\n}\r\n\r\n/**\r\n * Dynamically calculates whether to trigger or untrigger an action.\r\n * If current value exceedes offset and threshold action is triggered.\r\n * If action was triggered and current move is lower than threshold action is untriggered\r\n * \r\n * Example: If offsetY is 100, then first after 100 action is set on. It is kept when scrolling down.\r\n * If user decides to scroll up and difference between turning point and current is bigger than threshold then action is set off.\r\n *  \r\n * Example usage is with navbar - it shall disappear after offset and return back when user scrolls up. \r\n */\r\nexport class CuiOffsetDynamicMode implements ICuiOffsetMode {\r\n    #pointLeft: number;\r\n    #pointTop: number;\r\n    #prevDiffY: number;\r\n    #prevDiffX: number;\r\n    #wasTriggeredX: boolean;\r\n    #wasTriggeredY: boolean;\r\n    #threshold: number;\r\n    constructor() {\r\n        this.#pointLeft = 0;\r\n        this.#pointTop = 0;\r\n        this.#prevDiffX = 0;\r\n        this.#prevDiffY = 0;\r\n        this.#threshold = 100;\r\n        this.#wasTriggeredX = false;\r\n        this.#wasTriggeredY = false;\r\n    }\r\n    matches(top: number, left: number, offsetX: number, offsetY: number): boolean {\r\n        return this.fitsOffsetY(top, offsetY) || this.fitsOffsetX(left, offsetX);\r\n    }\r\n\r\n\r\n    private fitsOffsetX(left: number, offsetX: number) {\r\n        if (offsetX <= 0)\r\n            return false;\r\n        let diffX = left - this.#pointLeft;\r\n        if (left >= offsetX && diffX > this.#threshold) {\r\n            this.#wasTriggeredX = true;\r\n        } else if (this.#wasTriggeredX && diffX < -this.#threshold) {\r\n            this.#wasTriggeredX = false;\r\n        }\r\n        if (diffX < 0 && this.#prevDiffX < diffX || diffX >= 0 && this.#prevDiffX > diffX) {\r\n            this.#pointLeft = left;\r\n        }\r\n        this.#prevDiffX = diffX;\r\n        return this.#wasTriggeredX;\r\n    }\r\n\r\n    private fitsOffsetY(top: number, offsetY: number) {\r\n        if (offsetY <= 0) {\r\n            return false;\r\n        }\r\n        let diffY = top - this.#pointTop;\r\n        if (top >= offsetY && diffY > this.#threshold) {\r\n            this.#wasTriggeredY = true;\r\n        } else if (this.#wasTriggeredY && diffY < -this.#threshold) {\r\n            this.#wasTriggeredY = false;\r\n        }\r\n        if (diffY < 0 && this.#prevDiffY < diffY || diffY >= 0 && this.#prevDiffY > diffY) {\r\n            this.#pointTop = top;\r\n        }\r\n        this.#prevDiffY = diffY;\r\n        return this.#wasTriggeredY;\r\n    }\r\n}\r\n\r\n\r\nexport class CuiOffsetModeFactory {\r\n    static get(mode: string) {\r\n        if (mode === 'dynamic') {\r\n            return new CuiOffsetDynamicMode();\r\n        }\r\n        return new CuiOffsetStaticMode();\r\n    }\r\n}","import { ICuiComponent, ICuiComponentHandler } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiHandlerBase } from \"../../core/handlers/base\";\r\nimport { CuiScrollListener, CuiScrollEvent } from \"../../core/listeners/scroll\";\r\nimport { ICuiComponentAction, CuiActionsListFactory } from \"../../core/utils/actions\";\r\nimport { are, getRangeValue, is } from \"../../core/utils/functions\";\r\nimport { CuiOffsetModeFactory, ICuiOffsetMode } from \"./modes\";\r\nimport { EVENTS } from \"../../core/utils/statics\";\r\nimport { CuiAutoParseArgs } from \"../../core/utils/arguments\";\r\n\r\n/**\r\n * Toggles an action after specified offset is reached in relation to the element or document\r\n * \r\n * target?: string - target which action shall be triggered on\r\n * action?: string - action to trigger\r\n * offsetY?: number - vertical offset\r\n * offsetX?: number - horizontal offset\r\n * root?: boolean - set true if scroll listener shall be set on document element\r\n * mode?: string - static/dynamic \r\n */\r\n\r\nexport interface CuiOffsetEvent {\r\n    matches: boolean;\r\n    offsetX: number;\r\n    offsetY: number;\r\n    ratioY: number;\r\n    ratioX: number;\r\n    scrolling: boolean;\r\n\r\n    timestamp: number;\r\n}\r\n\r\nexport interface CuiOffsetAttribute {\r\n    target?: string;\r\n    action?: string;\r\n    offsetY?: number;\r\n    offsetX?: number;\r\n    root?: boolean;\r\n}\r\n\r\nexport class CuiOffsetArgs extends CuiAutoParseArgs {\r\n    target: string;\r\n    action: string;\r\n    offsetY: number;\r\n    offsetX: number\r\n    root: boolean;\r\n    mode: \"static\" | \"dynamic\";\r\n    constructor() {\r\n        super();\r\n        this.offsetX = -1;\r\n        this.offsetY = -1;\r\n        this.target = \"\";\r\n        this.root = false;\r\n        this.action = \"\";\r\n        this.mode = 'static';\r\n    }\r\n}\r\nexport class CuiOffsetComponent implements ICuiComponent {\r\n    attribute: string;\r\n    constructor(prefix?: string) {\r\n        this.attribute = `${prefix ?? 'cui'}-offset`;\r\n    }\r\n\r\n    getStyle(): string | null {\r\n        return null;\r\n    }\r\n\r\n    get(element: HTMLElement, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiOffsetHandler(element, utils, this.attribute);\r\n    }\r\n}\r\n\r\nexport class CuiOffsetHandler extends CuiHandlerBase<CuiOffsetArgs> {\r\n    #listener: CuiScrollListener | undefined;\r\n    #target: Element;\r\n    #utils: CuiUtils;\r\n    #matched: boolean;\r\n    #action: ICuiComponentAction[];\r\n    #prevX: number;\r\n    #prevY: number;\r\n    #threshold: number;\r\n    #root: Element;\r\n    #modeHandler: ICuiOffsetMode | null;\r\n    constructor(element: HTMLElement, utils: CuiUtils, attribute: string) {\r\n        super(\"CuiOffsetHandler\", element, attribute, new CuiOffsetArgs(), utils);\r\n        this.element = element as HTMLElement;\r\n\r\n        this.#target = this.element;\r\n        this.#utils = utils;\r\n        this.#matched = false;\r\n        this.#action = [];\r\n        this.#prevX = 0;\r\n        this.#prevY = 0;\r\n        this.#threshold = 20;\r\n        this.#root = this.element;\r\n        this.#modeHandler = null;\r\n        this.#listener = undefined;\r\n\r\n    }\r\n\r\n    async onHandle(): Promise<boolean> {\r\n        this.parseAttribute();\r\n        this.#listener = new CuiScrollListener(this.args.root ? (window as any) : this.element, this.utils.setup.scrollThreshold);\r\n        this.#listener.setCallback(this.onScroll.bind(this));\r\n        this.#listener.attach();\r\n        return true;\r\n    }\r\n    async onRefresh(): Promise<boolean> {\r\n        this.parseAttribute();\r\n        return true;\r\n    }\r\n    async onRemove(): Promise<boolean> {\r\n        if (this.#listener)\r\n            this.#listener.detach();\r\n        return true;\r\n    }\r\n\r\n    private onScroll(ev: CuiScrollEvent): void {\r\n        this.checkAndPerformActions(ev);\r\n    }\r\n\r\n    private parseAttribute() {\r\n        this.#root = this.getRoot();\r\n        this.#target = this.getTarget();\r\n        this.#action = CuiActionsListFactory.get(this.args.action);\r\n        this.#modeHandler = CuiOffsetModeFactory.get(this.args.mode);\r\n\r\n    }\r\n\r\n    private checkAndPerformActions(ev: CuiScrollEvent) {\r\n        if (!is(this.#modeHandler)) {\r\n            this.logError(\"Cannot perform - mode handler not initialized\", \"checkAndPerformActions\")\r\n        }\r\n        // @ts-ignore modehandler\r\n        let matchesOffset = this.#modeHandler.matches(ev.top, ev.left, this.args.offsetX, this.args.offsetY);\r\n        /**\r\n         * Act and emit event when offset has been reached\r\n         */\r\n        if (matchesOffset !== this.#matched) {\r\n            this.act(matchesOffset);\r\n            this.#matched = matchesOffset;\r\n            this.callEvent(this.#matched, ev.left, ev.top, ev.scrolling, ev.source, ...this.calcaRatio(ev.left, ev.top));\r\n            return;\r\n        }\r\n        /**\r\n         * Emit event periodically\r\n         */\r\n        if (this.exceededThreshold(ev.left, ev.top)) {\r\n            this.callEvent(this.#matched, ev.left, ev.top, ev.scrolling, ev.source, ...this.calcaRatio(ev.left, ev.top));\r\n            this.#prevX = ev.left;\r\n            this.#prevY = ev.top;\r\n        }\r\n    }\r\n\r\n\r\n    private act(matching: boolean) {\r\n        if (!are(this.#action, this.#target)) {\r\n            return;\r\n        }\r\n        this.isLocked = true;\r\n        this.#action.forEach(action => {\r\n            if (matching) {\r\n                action.add(this.#target, this.#utils)\r\n            } else {\r\n                action.remove(this.#target, this.#utils)\r\n            }\r\n        });\r\n        this.isLocked = false;\r\n    }\r\n\r\n    private callEvent(matches: boolean, x: number, y: number, scrolling: boolean, source: string, ratioX: number, ratioY: number) {\r\n        this.emitEvent(EVENTS.OFFSET, {\r\n            matches: this.#matched,\r\n            offsetX: x,\r\n            offsetY: y,\r\n            ratioX: ratioX,\r\n            ratioY: ratioY,\r\n            scrolling: scrolling,\r\n            source: source,\r\n            timestamp: Date.now()\r\n        })\r\n    }\r\n\r\n    private getRoot(): Element {\r\n        return this.args.root ? document.body : this.element;\r\n    }\r\n\r\n    private exceededThreshold(x: number, y: number): boolean {\r\n        return Math.abs(x - this.#prevX) > this.#threshold || Math.abs(y - this.#prevY) > this.#threshold;\r\n    }\r\n\r\n    private calcaRatio(x: number, y: number): [number, number] {\r\n        let ratY = parseFloat(((this.#root.clientHeight + y) / this.#root.scrollHeight).toFixed(2))\r\n        let ratX = parseFloat(((this.#root.clientWidth + x) / this.#root.scrollWidth).toFixed(2))\r\n        return [getRangeValue(ratX, 0, 1), getRangeValue(ratY, 0, 1)];\r\n    }\r\n\r\n    private getTarget(): Element {\r\n        let target = this.args.target ? this.#root.querySelector(this.args.target) : null;\r\n        return target ?? this.element;\r\n    }\r\n}","import { ICuiComponent, ICuiComponentHandler, ICuiOpenable } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiHandlerBase } from \"../../core/handlers/base\";\r\nimport { is, are, getFirstMatching, getParentCuiElement } from \"../../core/utils/functions\";\r\nimport { CuiActionsListFactory } from \"../../core/utils/actions\";\r\nimport { CUID_ATTRIBUTE, EVENTS } from \"../../core/utils/statics\";\r\nimport { CuiAutoParseArgs } from \"../../core/utils/arguments\";\r\nimport { CuiClickableArgs } from \"src/core/models/arguments\";\r\nimport { CuiClickModule } from \"../modules/click/click\";\r\nimport { InteractionEvent } from \"src/core/models/events\";\r\n\r\nexport class CuiOpenArgs extends CuiAutoParseArgs implements CuiClickableArgs {\r\n    target: string;\r\n    action: string;\r\n    timeout: number;\r\n    prevent: boolean;\r\n    state: string;\r\n    stopPropagation: boolean;\r\n\r\n    constructor(timeout?: number) {\r\n        super({\r\n            main: \"target\"\r\n        });\r\n        this.target = \"\";\r\n        this.action = \"\";\r\n        this.timeout = timeout ?? 300;\r\n        this.prevent = false;\r\n        this.stopPropagation = false;\r\n        this.state = \"\";\r\n\r\n    }\r\n\r\n}\r\n\r\nexport class CuiOpenComponent implements ICuiComponent {\r\n    attribute: string;\r\n    #prefix: string;\r\n    constructor(prefix?: string) {\r\n        this.#prefix = prefix ?? 'cui';\r\n        this.attribute = `${this.#prefix}-open`;\r\n    }\r\n\r\n    getStyle(): string | null {\r\n        return null;\r\n    }\r\n\r\n    get(element: HTMLElement, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiOpenHandler(element, utils, this.attribute, this.#prefix);\r\n    }\r\n}\r\n\r\nexport class CuiOpenHandler extends CuiHandlerBase<CuiOpenArgs> {\r\n    #eventId: string | null;\r\n    constructor(element: HTMLElement, utils: CuiUtils, attribute: string, prefix: string) {\r\n        super(\"CuiOpenHandler\", element, attribute, new CuiOpenArgs(utils.setup.animationTime), utils);\r\n        this.#eventId = null;\r\n        this.addModule(new CuiClickModule(this.element, this.args, this.onOpen.bind(this)))\r\n    }\r\n\r\n    async onHandle(): Promise<boolean> {\r\n        this.#eventId = this.onEvent(EVENTS.OPEN, this.onOpen.bind(this));\r\n        return true;\r\n    }\r\n    async onRefresh(): Promise<boolean> {\r\n        return true;\r\n    }\r\n    async onRemove(): Promise<boolean> {\r\n        this.detachEvent(EVENTS.OPEN, this.#eventId);\r\n        return true;\r\n    }\r\n\r\n    private onOpen(ev: MouseEvent) {\r\n        if (this.isLocked) {\r\n            return;\r\n        }\r\n        const target = this.getTarget();\r\n        if (!is(target)) {\r\n            this._log.warning(`Target ${this.args.target} not found`, 'onClick')\r\n            return;\r\n        }\r\n        this.isLocked = true;\r\n        //@ts-ignore - target checked\r\n        this.run(target).then((result) => {\r\n            //@ts-ignore - target checked\r\n            if (result)\r\n                this.emitOpen(ev);\r\n        }).catch((e) => {\r\n            this._log.exception(e);\r\n        }).finally(() => {\r\n            this.isLocked = false;\r\n        })\r\n    }\r\n\r\n    /**\r\n     * Emits open event or performs an opening action\r\n     * @param target target element\r\n     * @returns whether event opened shall be emitted\r\n     */\r\n    private async run(target: Element): Promise<boolean> {\r\n        let cuiId = (target as any).$cuid;\r\n        if (is(cuiId)) {\r\n            this.handleClickCui(cuiId);\r\n            return false;\r\n        } else {\r\n            this._log.debug(\"Open html component\")\r\n            if (are(this.args.timeout, this.args.action)) {\r\n                this._log.debug(\"Perfrom an action\")\r\n                let actions = CuiActionsListFactory.get(this.args.action)\r\n                return this.actionsHelper.performActions(target, actions, this.args.timeout, () => {\r\n                    this.helper.setClass(this.activeClassName, target);\r\n                });\r\n            }\r\n            this.helper.setClassesAs(target, this.activeClassName);\r\n            return true;\r\n        }\r\n    }\r\n\r\n    handleClickCui(cuid: string) {\r\n        this._log.debug(\"Open cUI component\")\r\n        this.utils.bus.emit(EVENTS.OPEN, cuid, this.args.state);\r\n        return false;\r\n    }\r\n\r\n\r\n    private emitOpen(ev: MouseEvent) {\r\n        this.emitEvent<InteractionEvent>(EVENTS.OPENED, {\r\n            event: ev,\r\n            state: this.args.state\r\n        })\r\n    }\r\n\r\n    // private getTarget(target: string) {\r\n    //     if (is(target)) {\r\n    //         //@ts-ignore - target checked\r\n    //         return document.querySelector(target);\r\n    //     }\r\n    //     let parent = this.element.parentElement;\r\n    //     //@ts-ignore - parent checked\r\n    //     let result = is(parent) ? parent.querySelectorAll(`[${CUID_ATTRIBUTE}]`) : undefined;\r\n    //     if (!result || result.length < 2) {\r\n    //         return undefined;\r\n    //     }\r\n\r\n    //     return getFirstMatching([...result], (el: Element) => {\r\n    //         return el !== this.element;\r\n    //     })\r\n    // }\r\n    private getTarget(): Element | undefined {\r\n        if (!is(this.args.target)) {\r\n            return getParentCuiElement(this.element);\r\n        }\r\n        return document.querySelector(this.args.target) ?? getParentCuiElement(this.element);\r\n    }\r\n}","import { CuiScrollEvent, CuiScrollListener } from \"../listeners/scroll\";\r\nimport { CuiElementBoxFactory, CuiElementBoxType, ICuiElementBox } from \"../models/elements\";\r\nimport { ICuiEventListener } from \"../models/interfaces\";\r\nimport { are, getRangeValue, is } from \"../utils/functions\";\r\nimport { CuiIntersectionCallback, CuiIntersectionListenerOptions, CuiIntersectionResult } from \"./interfaces\";\r\n\r\nconst DEFAULT_OPTION_THRESHOLD: number = 0;\r\n\r\nexport class CuiIntersectionListener implements ICuiEventListener<CuiIntersectionResult> {\r\n    #scrollListener: CuiScrollListener;\r\n    #callback: CuiIntersectionCallback | undefined;\r\n    #children: HTMLElement[];\r\n    #box: ICuiElementBox;\r\n    constructor(element: CuiElementBoxType, options?: CuiIntersectionListenerOptions) {\r\n        this.#box = CuiElementBoxFactory.get(element);\r\n        this.#scrollListener = new CuiScrollListener(element as Element, options?.threshold ?? DEFAULT_OPTION_THRESHOLD);\r\n        this.#scrollListener.setCallback(this.onScroll.bind(this));\r\n        this.#children = [];\r\n        this.#callback = undefined;\r\n    }\r\n\r\n    /**\r\n     * Sets child elements - ratio is calcutalated based on them\r\n     * @param children \r\n     */\r\n    setChildren(children: HTMLElement[]) {\r\n        this.#children = children;\r\n    }\r\n\r\n    setThreshold(threshold: number) {\r\n        this.#scrollListener.setThreshold(threshold)\r\n    }\r\n\r\n    setCallback(callback: (t: CuiIntersectionResult) => void): void {\r\n        this.#callback = callback;\r\n    }\r\n\r\n    setParent(target: CuiElementBoxType) {\r\n        this.#box = CuiElementBoxFactory.get(target);\r\n        this.#scrollListener.setTarget(target);\r\n    }\r\n\r\n    isInProgress(): boolean {\r\n        return this.#scrollListener.isInProgress();\r\n    }\r\n\r\n    attach(): void {\r\n        if (this.isAttached()) {\r\n            return;\r\n        }\r\n        this.#scrollListener.attach();\r\n    }\r\n\r\n    detach(): void {\r\n        if (!this.isAttached()) {\r\n            return;\r\n        }\r\n        this.#scrollListener.detach();\r\n    }\r\n\r\n    isAttached(): boolean {\r\n        return this.#scrollListener && this.#scrollListener.isAttached();\r\n    }\r\n\r\n    private onScroll(ev: CuiScrollEvent): void {\r\n        if (!are(this.#children, this.#callback)) {\r\n            return;\r\n        }\r\n        if (this.#callback)\r\n            this.#callback(this.prepareCallbackResult(ev))\r\n    }\r\n\r\n    private calcChildVerticalRatio(child: HTMLElement, currentTop: number, currentBottom: number): number {\r\n        let childBottom = child.offsetTop + child.offsetHeight;\r\n        // Simulated top if view top is outside of parent then takes parent top\r\n        let symTop = currentTop > child.offsetTop ? currentTop : child.offsetTop;\r\n        // Simulated bottom if view bottom is outside of parent then takes parent bottom\r\n        let symBottom = currentBottom < childBottom ? currentBottom : childBottom;\r\n        // Calculates amount of pixels that are in view\r\n        let diff = symBottom - symTop;\r\n        // Calculates ratio - how much of a child is in parent view\r\n        let ratio = diff / child.offsetHeight;\r\n        return getRangeValue(ratio, 0, 1);\r\n    }\r\n\r\n    private calcChildHorizontalRatio(child: HTMLElement, currentLeft: number, currentRight: number): number {\r\n        let childRight = child.offsetLeft + child.offsetWidth;\r\n        // Simulated top if view left is outside of parent then takes parent left\r\n        let symLeft = currentLeft > child.offsetLeft ? currentLeft : child.offsetLeft;\r\n        // Simulated bottom if view right is outside of parent then takes parent right\r\n        let symRight = currentRight < childRight ? currentRight : childRight;\r\n        // Calculates amount of pixels that are in view\r\n        let diff = symRight - symLeft;\r\n        // Calculates ratio - how much of a child is in parent view\r\n        let ratio = diff / child.offsetWidth;\r\n        return getRangeValue(ratio, 0, 1);\r\n    }\r\n\r\n    private prepareCallbackResult(ev: CuiScrollEvent): CuiIntersectionResult {\r\n        let parentBottom = ev.top + this.#box.getHeight();\r\n        let parentRight = ev.left + this.#box.getWidth();\r\n        let result: CuiIntersectionResult = {\r\n            ev: ev.base,\r\n            top: ev.top,\r\n            left: ev.left,\r\n            scrolling: ev.scrolling ?? false,\r\n            initial: ev.initial ?? false,\r\n            source: ev.source,\r\n            items: this.#children.map((child: HTMLElement, index: number) => {\r\n                let verticalRatio = this.calcChildVerticalRatio(child, ev.top, parentBottom)\r\n                let horizontalRatio = this.calcChildHorizontalRatio(child, ev.left, parentRight);\r\n                return {\r\n                    verticalRatio: verticalRatio,\r\n                    horizontalRatio: horizontalRatio,\r\n                    element: child\r\n                }\r\n            })\r\n        };\r\n\r\n        return result;\r\n    }\r\n}","import { enumerateObject } from \"../../core/utils/functions\";\r\nimport { AnimatorFactory, PropsTypes } from \"../../core/animation/engine\";\r\nimport { AnimationProperty } from \"../../core/animation/interfaces\";\r\n\r\nexport class ParallaxAnimatorsHandler {\r\n    name: string;\r\n    #animators: any[];\r\n    constructor(name: string, setup: AnimationProperty<PropsTypes>) {\r\n        this.name = name;\r\n        this.#animators = [];\r\n        enumerateObject(setup, (propName: string, prop: PropsTypes) => {\r\n            let animator = AnimatorFactory.get(propName);\r\n            if (!animator) {\r\n                return;\r\n            }\r\n            animator.setProperty(prop);\r\n            this.#animators.push(animator);\r\n        })\r\n\r\n    }\r\n\r\n    perform(element: HTMLElement, progress: number) {\r\n        if (this.#animators.length === 0) {\r\n            return;\r\n        }\r\n\r\n        this.#animators.forEach(animator => animator.perform(element, progress, 1));\r\n    }\r\n}","import { CuiChildMutation, CuiMutableHandler } from \"../../core/handlers/base\";\r\nimport { CuiIntersectionResult } from \"../../core/intersection/interfaces\";\r\nimport { CuiIntersectionListener } from \"../../core/intersection/intersection\";\r\nimport { ICuiComponent, ICuiComponentHandler } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiAutoParseArgs } from \"../..//core/utils/arguments\";\r\nimport { getChildSelectorFromScoped, getIntOrDefault, joinWithScopeSelector } from \"../../core/utils/functions\";\r\nimport { ParallaxAnimatorsHandler } from \"./animator\";\r\n\r\nconst PARALLAX_ATTRIBUTE_ANIMATTION = 'data-parallax-animation';\r\nconst PARALLAX_ATTRIBUTE_START = 'data-parallax-start-ratio';\r\nconst PARALLAX_ATTRIBUTE_STOP = 'data-parallax-stop-ratio';\r\n\r\ninterface TargetSetupItem {\r\n    element: HTMLElement;\r\n    animator?: ParallaxAnimatorsHandler;\r\n    start: number;\r\n    stop: number;\r\n}\r\n\r\nexport class CuiParallaxArgs extends CuiAutoParseArgs {\r\n    root: boolean;\r\n    targets: string;\r\n    startRatio: number;\r\n    stopRatio: number;\r\n    animation: string;\r\n    constructor() {\r\n        super({\r\n            props: {\r\n                \"targets\": { corrector: joinWithScopeSelector }\r\n            }\r\n        });\r\n        this.root = false;\r\n        this.targets = joinWithScopeSelector(\"> *\");\r\n        this.startRatio = 0;\r\n        this.stopRatio = 1;\r\n        this.animation = \"\";\r\n\r\n    }\r\n}\r\n\r\nexport class CuiParallaxComponent implements ICuiComponent {\r\n    attribute: string;\r\n    constructor(prefix?: string) {\r\n        this.attribute = `${prefix ?? 'cui'}-parallax`;\r\n    }\r\n    getStyle(): string {\r\n        return \"\";\r\n    }\r\n    get(element: HTMLElement, sutils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiParallaxHandler(element, sutils, this.attribute)\r\n    }\r\n\r\n}\r\n\r\nexport class CuiParallaxHandler extends CuiMutableHandler<CuiParallaxArgs> {\r\n\r\n    #scrollListener: CuiIntersectionListener | undefined;\r\n    #defaultAnimator: ParallaxAnimatorsHandler | undefined;\r\n    #targetSetup: TargetSetupItem[];\r\n    constructor(element: HTMLElement, utils: CuiUtils, attribute: string) {\r\n        super(\"CuiParallaxHandler\", element, attribute, new CuiParallaxArgs(), utils);\r\n        this.#scrollListener = undefined;\r\n        this.#defaultAnimator = undefined;\r\n        this.#targetSetup = [];\r\n    }\r\n\r\n\r\n    onInit(): void {\r\n        this.#defaultAnimator = new ParallaxAnimatorsHandler(this.args.animation, this.utils.setup.parallaxAnimations[this.args.animation])\r\n        this.setMutationSelector(getChildSelectorFromScoped(this.args.targets))\r\n        this.#targetSetup = this.getTargets();\r\n        this.#scrollListener = new CuiIntersectionListener(this.getParent(), { threshold: this.utils.setup.scrollThreshold });\r\n        this.#scrollListener.setCallback(this.onIntersection.bind(this));\r\n        this.#scrollListener.setChildren(this.#targetSetup.map(item => item.element));\r\n        this.#scrollListener.attach();\r\n    }\r\n\r\n    onUpdate(): void {\r\n        if (!this.prevArgs || !this.#scrollListener) {\r\n            return;\r\n        }\r\n        if (this.prevArgs.targets !== this.args.targets) {\r\n            this.clean();\r\n            this.setMutationSelector(getChildSelectorFromScoped(this.args.targets))\r\n            this.#targetSetup = this.getTargets();\r\n            this.#scrollListener.setChildren(this.#targetSetup.map(item => item.element));\r\n        }\r\n        if (this.prevArgs.root !== this.args.root) {\r\n            this.#scrollListener.setParent(this.getParent());\r\n        }\r\n    }\r\n    onDestroy(): void {\r\n        this.clean();\r\n        if (this.#scrollListener) {\r\n            this.#scrollListener.detach();\r\n        }\r\n    }\r\n\r\n    onIntersection(ev: CuiIntersectionResult) {\r\n        this.mutate(() => {\r\n            ev.items.forEach((item, index) => {\r\n                if (index >= this.#targetSetup.length) {\r\n                    return;\r\n                }\r\n                const setup = this.#targetSetup[index];\r\n                if (setup.animator)\r\n                    setup.animator.perform(item.element, calculateRatio(setup.start, setup.stop, item.verticalRatio))\r\n            })\r\n        })\r\n\r\n    }\r\n\r\n    onMutation(record: CuiChildMutation): void {\r\n        if (!this.#scrollListener) {\r\n            return;\r\n        }\r\n        this.#targetSetup = this.getTargets();\r\n        this.#scrollListener.setChildren(this.#targetSetup.map(item => item.element));\r\n    }\r\n\r\n    private getTargets(): TargetSetupItem[] {\r\n        const targetSetup: TargetSetupItem[] = []\r\n        this.element.querySelectorAll(this.args.targets).forEach(target => {\r\n            targetSetup.push({\r\n                element: target as HTMLElement,\r\n                animator: this.getTargetAnimator(target) ?? this.#defaultAnimator,\r\n                start: getIntOrDefault(target.getAttribute(PARALLAX_ATTRIBUTE_START), this.args.startRatio),\r\n                stop: getIntOrDefault(target.getAttribute(PARALLAX_ATTRIBUTE_STOP), this.args.stopRatio),\r\n            })\r\n        })\r\n        return targetSetup;\r\n    }\r\n\r\n    private getParent(): Window | HTMLElement {\r\n        return this.args.root ? window : this.element;\r\n    }\r\n\r\n    private getTargetAnimator(target: Element): ParallaxAnimatorsHandler | undefined {\r\n        if (!target.hasAttribute(PARALLAX_ATTRIBUTE_ANIMATTION)) {\r\n            return undefined;\r\n        }\r\n        const name = target.getAttribute(PARALLAX_ATTRIBUTE_ANIMATTION);\r\n        //@ts-ignore name was checked already\r\n        let setup = this.utils.setup.parallaxAnimations[name];\r\n        if (!setup) {\r\n            return undefined;\r\n        }\r\n        //@ts-ignore name was checked already\r\n        return new ParallaxAnimatorsHandler(name, setup);\r\n    }\r\n\r\n    private clean() {\r\n        this.#targetSetup.forEach(setup => {\r\n            this.utils.interactions.mutate(cleanStyle, null, setup.element);\r\n\r\n        })\r\n    }\r\n}\r\n\r\nfunction cleanStyle(target: HTMLElement) {\r\n    if (target && target.style) {\r\n        target.removeAttribute('style')\r\n    }\r\n}\r\n\r\nfunction calculateRatio(startRatio: number, stopRatio: number, current: number): number {\r\n    let spread = stopRatio - startRatio;\r\n    let start = current - startRatio;\r\n    if (start < 0) {\r\n        start = 0;\r\n\r\n    }\r\n    let curr = start / spread;\r\n    return Math.min(curr, 1);\r\n}","import { ICuiObserver } from \"../models/interfaces\";\r\n\r\nexport interface ICuiIntersectionObserver {\r\n    observe(target: Element): void;\r\n    unobserve(target: Element): void;\r\n    disconnect(): void;\r\n}\r\n\r\nexport class CuiIntersectionEntry {\r\n    isInView: boolean;\r\n    ratio: number;\r\n\r\n    constructor() {\r\n        this.isInView = false;\r\n        this.ratio = 0;\r\n    }\r\n}\r\n\r\nexport interface ICuiIntersectionHandler {\r\n    onIntersection(entry: CuiIntersectionEntry): Promise<boolean>;\r\n}\r\n\r\n/**\r\n * Creates a wrapper for intersection observer\r\n * Constructor gets a root element for observer and optional array of threshold values [0...1]\r\n */\r\nexport class CuiIntersectionObserver implements ICuiObserver {\r\n    #observer: IntersectionObserver | undefined;\r\n    #root: Element;\r\n    #threshold: number[];\r\n    #callback: IntersectionObserverCallback | undefined;\r\n    constructor(root: Element, threshold?: number[]) {\r\n        this.#root = root;\r\n        this.#threshold = threshold ?? [0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1];\r\n        this.#callback = undefined;\r\n        this.#observer = undefined;\r\n    }\r\n\r\n    setCallback(callback: IntersectionObserverCallback) {\r\n        this.#callback = callback;\r\n    }\r\n\r\n    connect(): void {\r\n        if (!this.#callback) {\r\n            return;\r\n        }\r\n        this.#observer = new IntersectionObserver(this.#callback, {\r\n            root: this.#root,\r\n            rootMargin: '0px',\r\n            threshold: this.#threshold\r\n        })\r\n    }\r\n\r\n    observe(target: Element): void {\r\n        if (this.#observer)\r\n            this.#observer.observe(target)\r\n    }\r\n\r\n    unobserve(target: Element): void {\r\n        if (this.#observer)\r\n            this.#observer.unobserve(target)\r\n    }\r\n\r\n    disconnect() {\r\n        if (this.#observer)\r\n            this.#observer.disconnect()\r\n    }\r\n\r\n}","import { ICuiComponent, ICuiComponentHandler } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiHandlerBase } from \"../../core/handlers/base\";\r\nimport { EVENTS } from \"../../core/utils/statics\";\r\nimport { calcWindowSize, is } from \"../../core/utils/functions\";\r\nimport { CuiIntersectionObserver } from \"../../core/observers/intersection\";\r\nimport { CuiWindowSize } from \"../../core/utils/types\";\r\nimport { CuiActionsFatory, ICuiComponentAction } from \"../../core/utils/actions\";\r\nimport { CuiResizeData } from \"../../core/models/events\";\r\nimport { CuiAutoParseArgs } from \"../../core/utils/arguments\";\r\n\r\ntype CuiResizeComponentMode = \"smart\" | \"simple\";\r\n\r\nexport class CuiResizeArgs extends CuiAutoParseArgs {\r\n    mode: CuiResizeComponentMode;\r\n    default: string;\r\n    small?: string;\r\n    medium?: string;\r\n    large?: string;\r\n    xlarge?: string;\r\n    delay: number;\r\n    constructor() {\r\n        super();\r\n        this.mode = \"simple\";\r\n        this.default = \"\";\r\n        this.small = this.medium = this.large = this.xlarge = '';\r\n        this.delay = 0;\r\n    }\r\n}\r\n\r\nexport class CuiResizeComponent implements ICuiComponent {\r\n    attribute: string;\r\n    #prefix: string;\r\n\r\n    constructor(prefix?: string) {\r\n        this.#prefix = prefix ?? 'cui';\r\n        this.attribute = `${this.#prefix}-resize`;\r\n    }\r\n\r\n    getStyle(): string | null {\r\n        return null;\r\n    }\r\n\r\n    get(element: HTMLElement, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiResizeHandler(element, utils, this.attribute);\r\n    }\r\n}\r\n\r\nexport class CuiResizeHandler extends CuiHandlerBase<CuiResizeArgs> {\r\n    #eventId: string | null;\r\n    #intersectionObserver: CuiIntersectionObserver;\r\n    #currentSize: CuiWindowSize;\r\n    #currentValue: string | undefined;\r\n    #lastValue: string;\r\n    #currentAction: ICuiComponentAction | undefined;\r\n    #isIntersecting: boolean;\r\n    #timeoutToken: any | undefined;\r\n    constructor(element: HTMLElement, utils: CuiUtils, attribute: string) {\r\n        super(\"CuiResizeHandler\", element, attribute, new CuiResizeArgs(), utils);\r\n        this.#eventId = null;\r\n        this.#intersectionObserver = new CuiIntersectionObserver(document.documentElement, [0, 0.1])\r\n        this.#intersectionObserver.setCallback(this.onIntersection.bind(this));\r\n        this.#lastValue = \"\";\r\n        this.#currentValue = \"\";\r\n        this.#currentSize = \"none\";\r\n        this.#isIntersecting = false;\r\n        this.#timeoutToken = undefined;\r\n        this.#currentAction = undefined;\r\n    }\r\n\r\n    async onHandle(): Promise<boolean> {\r\n        this.#eventId = this.utils.bus.on(EVENTS.RESIZE, this.resize.bind(this));\r\n        this.#intersectionObserver.connect();\r\n        this.#intersectionObserver.observe(this.element);\r\n        this.#currentSize = calcWindowSize(window.innerWidth);\r\n        this.#isIntersecting = this.isInViewport(this.element);\r\n        this.setNewValue();\r\n        this.updateElement();\r\n        return true;\r\n    }\r\n    async onRefresh(): Promise<boolean> {\r\n        this.setNewValue();\r\n        this.updateElement();\r\n        return true;\r\n    }\r\n    async onRemove(): Promise<boolean> {\r\n        if (this.#eventId !== null) {\r\n            this.utils.bus.detach(EVENTS.RESIZE, this.#eventId);\r\n            this.#eventId = null\r\n        }\r\n        this.#intersectionObserver.unobserve(this.element);\r\n        this.#intersectionObserver.disconnect();\r\n        return true;\r\n    }\r\n\r\n    private resize(data: CuiResizeData) {\r\n        this.#currentSize = data.current;\r\n        this.setNewValue();\r\n        this.updateElement();\r\n    }\r\n\r\n    private onIntersection(entries: IntersectionObserverEntry[]) {\r\n        if (entries.length > 0) {\r\n            this.#isIntersecting = entries[0].isIntersecting;\r\n        }\r\n        this.updateElement();\r\n    }\r\n\r\n    private setNewValue() {\r\n        let newValue = this.isSmartMode() ? this.getSmartValue(this.#currentSize) : this.getValue(this.#currentSize, true);\r\n        if (newValue && newValue !== this.#currentValue) {\r\n            this.#currentValue = newValue;\r\n        }\r\n    }\r\n\r\n    private getValue(size: CuiWindowSize, replace?: boolean): string | undefined {\r\n        let value = undefined;\r\n        switch (size) {\r\n            case \"xlarge\":\r\n                value = this.args.xlarge;\r\n                break;\r\n            case \"large\":\r\n                value = this.args.large;\r\n                break;\r\n            case \"medium\":\r\n                value = this.args.medium;\r\n                break;\r\n            case \"small\":\r\n                value = this.args.small;\r\n                break;\r\n            default:\r\n                value = this.args.default;\r\n        }\r\n        return (replace && !value) ? this.args.default : value;\r\n    }\r\n\r\n    private getSmartValue(size: CuiWindowSize) {\r\n        let value = this.args.default;\r\n        if (size === 'none') {\r\n            return value;\r\n        }\r\n        value = this.args.small ?? value;\r\n        if (size === 'small') {\r\n            return value;\r\n        }\r\n        value = this.args.medium ?? value;\r\n        if (size === 'medium') {\r\n            return value;\r\n        }\r\n        value = this.args.large ?? value;\r\n        if (size === 'large') {\r\n            return value;\r\n        }\r\n        return this.args.xlarge ?? value;\r\n    }\r\n\r\n    private updateElement() {\r\n        if (!this.#isIntersecting && this.isSmartMode()) {\r\n            this.logInfo(\"Not intersecting\")\r\n            return;\r\n        }\r\n        if (!is(this.#currentValue)) {\r\n            this.logWarning(\"Not eligible to set value: \" + this.#currentValue)\r\n            return;\r\n        }\r\n        if (this.#lastValue !== this.#currentValue) {\r\n            this.run(() => {\r\n                //@ts-ignore already checked\r\n                let newAction = CuiActionsFatory.get(this.#currentValue);\r\n                this.mutate(() => {\r\n                    if (this.#currentAction) {\r\n                        this.#currentAction.remove(this.element);\r\n                    }\r\n                    newAction.add(this.element);\r\n                    //@ts-ignore already checked\r\n                    this.#lastValue = this.#currentValue;\r\n                    this.#currentAction = newAction;\r\n\r\n                })\r\n            })\r\n\r\n        }\r\n    }\r\n\r\n    private isSmartMode() {\r\n        return this.args.mode === 'smart';\r\n    }\r\n\r\n    private isInViewport(element: Element): boolean {\r\n        const rect = element.getBoundingClientRect();\r\n        return (\r\n            rect.top >= 0 &&\r\n            rect.left >= 0 &&\r\n            rect.bottom <= (window.innerHeight || document.documentElement.clientHeight) &&\r\n            rect.right <= (window.innerWidth || document.documentElement.clientWidth)\r\n        );\r\n    }\r\n\r\n    private run(callback: () => void) {\r\n        if (this.#timeoutToken) {\r\n            clearTimeout(this.#timeoutToken);\r\n            this.#timeoutToken = undefined;\r\n        }\r\n        this.#timeoutToken = setTimeout(() => {\r\n            callback();\r\n            this.#timeoutToken = undefined;\r\n        }, this.args.delay);\r\n    }\r\n}","import { ICuiComponent, ICuiComponentHandler, ICuiParsable } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiHandlerBase } from \"../../core/handlers/base\";\r\nimport { EVENTS } from \"../../core/utils/statics\";\r\nimport { is, getOffsetTop, are, getEnumOrDefault } from \"../../core/utils/functions\";\r\nimport { CuiAutoParseArgs } from \"../../core/utils/arguments\";\r\nimport { CuiClickModule } from \"../modules/click/click\";\r\nimport { CuiClickableArgs } from \"src/core/models/arguments\";\r\nimport { CuiScrollByEvent } from \"src/core/models/events\";\r\n\r\nexport class CuiScrollArgs extends CuiAutoParseArgs implements CuiClickableArgs {\r\n    target: string;\r\n    parent: string;\r\n    behavior: 'auto' | 'smooth';\r\n    prevent: boolean;\r\n    stopPropagation: boolean;\r\n\r\n    constructor() {\r\n        super({\r\n            props: {\r\n                \"behavior\": { corrector: (value: string) => getEnumOrDefault(value, 'auto', 'smooth') }\r\n            }\r\n        });\r\n        this.target = \"\";\r\n        this.parent = \"\";\r\n        this.behavior = 'auto';\r\n        this.stopPropagation = false;\r\n        this.prevent = false;\r\n    }\r\n\r\n}\r\n\r\n\r\n/**\r\n * Component scrolls to specified target in the document\r\n * Arguments: \r\n * target - selector to target element where page should be scrolled to.\r\n * parent - set parent selector if parent should be different than html parent\r\n * behavior - auto/smooth - choose between step and smooth scrolling\r\n * \r\n */\r\n\r\nexport class CuiScrollComponent implements ICuiComponent {\r\n    attribute: string;\r\n    constructor(prefix?: string) {\r\n        this.attribute = is(prefix) ? prefix + 'scroll' : 'cui-scroll';\r\n    }\r\n\r\n    getStyle(): string | null {\r\n        return null;\r\n    }\r\n\r\n    get(element: HTMLElement, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiScrollHandler(element, utils, this.attribute);\r\n    }\r\n}\r\n\r\nexport interface CuiScrollAttribute {\r\n    target?: string;\r\n    parent?: string;\r\n    behavior?: 'auto' | 'smooth';\r\n}\r\n\r\n\r\n\r\nexport class CuiScrollHandler extends CuiHandlerBase<CuiScrollArgs> {\r\n\r\n    constructor(element: HTMLElement, utils: CuiUtils, attribute: string) {\r\n        super(\"CuiScrollHandler\", element, attribute, new CuiScrollArgs(), utils);\r\n\r\n        this.addModule(new CuiClickModule(this.element, this.args, this.onClick.bind(this)));\r\n    }\r\n\r\n    async onHandle(): Promise<boolean> {\r\n        return true;\r\n    }\r\n    async onRefresh(): Promise<boolean> {\r\n        return true;\r\n    }\r\n    async onRemove(): Promise<boolean> {\r\n        return true;\r\n    }\r\n\r\n    onClick(ev: MouseEvent) {\r\n        const target = this.getTarget();\r\n        const parent = this.getTargetsParent(target);\r\n\r\n        if (!target || !parent) {\r\n            return;\r\n        }\r\n\r\n        let to = getOffsetTop(target) - parent.offsetTop;\r\n        let from = parent.scrollTop;\r\n        let by = to - from;\r\n\r\n        parent.scrollBy({\r\n            top: by,\r\n            behavior: this.args.behavior\r\n        });\r\n\r\n        this.emitEvent<CuiScrollByEvent>(EVENTS.ON_SCROLL, {\r\n            to: to,\r\n            by: by,\r\n            target: target,\r\n            parent: parent\r\n        })\r\n    }\r\n\r\n    private getTarget(): HTMLElement | null {\r\n        return is(this.args.target) ? document.querySelector<HTMLElement>(this.args.target) : null;\r\n    }\r\n\r\n    private getTargetsParent(target: HTMLElement | null): HTMLElement | null {\r\n        return is(this.args.parent) ? document.querySelector(this.args.parent) : target ? target.parentElement : null;\r\n    }\r\n}\r\n\r\n","\r\nimport { CuiIntersectionResultItem } from \"../../core/intersection/interfaces\";\r\nimport { ICuiComponentAction } from \"../../core/utils/actions\";\r\nimport { are, is } from \"../../core/utils/functions\";\r\n\r\nexport interface CuiScrollspyUpdateResult {\r\n    intersecting?: HTMLElement[];\r\n    changed: boolean;\r\n}\r\n\r\nexport interface ICuiScrollspyModeHandler {\r\n    update(items: CuiIntersectionResultItem[], ratio: number, actions: ICuiComponentAction[], links: HTMLElement[], linksActions: ICuiComponentAction[]): CuiScrollspyUpdateResult;\r\n}\r\n\r\nexport class CuiScrollSpyModeHandlerFactory {\r\n    static get(mode: string) {\r\n        if (mode === \"multi\") {\r\n            return new CuiMultiModeHandler();\r\n        }\r\n        return new CuiSingleModeHandler();\r\n    }\r\n}\r\n\r\nabstract class CuiModeHandlerBase<T> {\r\n    previous: T;\r\n    constructor(init: T) {\r\n        this.previous = init;\r\n    }\r\n\r\n\r\n    getMatching(ratio: number, items: CuiIntersectionResultItem[]): number[] {\r\n        return items.reduce((result: number[], item: CuiIntersectionResultItem, index: number) => {\r\n            if (item.verticalRatio > ratio) {\r\n                result.push(index);\r\n            }\r\n            return result;\r\n        }, [])\r\n    }\r\n\r\n    addActions(actions: ICuiComponentAction[], ...elements: HTMLElement[]) {\r\n        this.forEachAction(actions, elements, (action, element) => {\r\n            action.add(element);\r\n        })\r\n    }\r\n\r\n    removeActions(actions: ICuiComponentAction[], ...elements: HTMLElement[]) {\r\n        this.forEachAction(actions, elements, (action, element) => {\r\n            action.remove(element);\r\n        })\r\n    }\r\n\r\n    private forEachAction(actions: ICuiComponentAction[], elements: HTMLElement[], callback: (action: ICuiComponentAction, element: HTMLElement) => void): void {\r\n        if (!are(actions, elements, callback)) {\r\n            return;\r\n        }\r\n        actions.forEach(action => {\r\n            elements.forEach(element => {\r\n                if (is(element))\r\n                    callback(action, element);\r\n            })\r\n        })\r\n    }\r\n\r\n    abstract matches(item: T): boolean;\r\n\r\n}\r\n\r\nexport class CuiSingleModeHandler extends CuiModeHandlerBase<number> implements ICuiScrollspyModeHandler {\r\n\r\n    constructor() {\r\n        super(-1);\r\n    }\r\n\r\n    update(items: CuiIntersectionResultItem[], ratio: number, actions: ICuiComponentAction[], links: HTMLElement[], linksActions: ICuiComponentAction[]): CuiScrollspyUpdateResult {\r\n        let matching = this.getMatching(ratio, items);\r\n        let len = matching.length;\r\n        let last = len > 0 ? matching[len - 1] : -1;\r\n        let result: CuiScrollspyUpdateResult = {\r\n            changed: false\r\n        }\r\n        if (!this.matches(last)) {\r\n            if (this.previous > -1)\r\n                this.removeActions(actions, items[this.previous].element);\r\n            if (last > -1) {\r\n                let lastElement = items[last].element;\r\n                result.intersecting = [lastElement]\r\n                this.addActions(actions, lastElement)\r\n            }\r\n            if (are(links, linksActions)) {\r\n                if (this.previous > -1)\r\n                    this.removeActions(linksActions, links[this.previous]);\r\n                if (last > -1)\r\n                    this.addActions(linksActions, links[last])\r\n            }\r\n            this.previous = last;\r\n            result.changed = true;\r\n            result.intersecting = []\r\n            return result;\r\n        }\r\n        return result;\r\n    }\r\n\r\n    matches(item: number): boolean {\r\n        return item === this.previous;\r\n    }\r\n}\r\n\r\nexport class CuiMultiModeHandler extends CuiModeHandlerBase<number[]> implements ICuiScrollspyModeHandler {\r\n    constructor() {\r\n        super([]);\r\n    }\r\n    update(items: CuiIntersectionResultItem[], ratio: number, actions: ICuiComponentAction[], links: HTMLElement[], linksActions: ICuiComponentAction[]): CuiScrollspyUpdateResult {\r\n        let matching = this.getMatching(ratio, items);\r\n        let result: CuiScrollspyUpdateResult = {\r\n            changed: false\r\n        }\r\n        if (!this.matches(matching)) {\r\n            let intersecting = matching.map(idx => { return items[idx].element })\r\n            this.removeActions(actions, ...this.previous.map(idx => { return items[idx].element }));\r\n            this.addActions(actions, ...intersecting)\r\n            result.intersecting = intersecting;\r\n            if (are(links, linksActions)) {\r\n                this.removeActions(linksActions, ...this.previous.map(idx => { return links[idx] }));\r\n                this.addActions(linksActions, ...matching.map(idx => { return links[idx] }))\r\n            }\r\n            this.previous = matching;\r\n            result.changed = true;\r\n            return result;\r\n        }\r\n        return result;\r\n    }\r\n\r\n    matches(item: number[]): boolean {\r\n        let len = item.length;\r\n        if (len !== this.previous.length) {\r\n            return false;\r\n        }\r\n        let i = 0;\r\n        for (i = 0; i < len; i++) {\r\n            if (!this.previous.includes(item[i])) {\r\n                return false;\r\n            }\r\n        }\r\n        return true;\r\n    }\r\n}","import { ICuiComponent, ICuiComponentHandler } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiHandlerBase } from \"../../core/handlers/base\";\r\nimport { ICuiComponentAction, CuiActionsListFactory } from \"../../core/utils/actions\";\r\nimport { getRangeValueOrDefault, getEnumOrDefault, joinWithScopeSelector } from \"../../core/utils/functions\";\r\nimport { EVENTS } from \"../../core/utils/statics\";\r\nimport { CuiIntersectionListener } from \"../../core/intersection/intersection\";\r\nimport { CuiIntersectionResult } from \"../../core/intersection/interfaces\";\r\nimport { CuiElementBoxFactory, CuiElementBoxType, ICuiElementBox } from \"../../core/models/elements\";\r\nimport { CuiScrollSpyModeHandlerFactory, CuiScrollspyUpdateResult, ICuiScrollspyModeHandler } from \"./mode\";\r\nimport { CuiScrollspyScrollEvent } from \"../../core/models/events\";\r\nimport { CuiAutoParseArgs } from \"../../core/utils/arguments\";\r\n\r\nconst DEFAULT_SELECTOR = \"> *\";\r\n\r\nexport interface CuiScrollspyTargetChangeEvent {\r\n    intersecting: HTMLElement[];\r\n    timestamp: number;\r\n}\r\n\r\nexport interface CuiScrollSpyAttribute {\r\n    selector?: string;\r\n    action?: string;\r\n    link?: string;\r\n    linkAction?: string;\r\n    ratio: number;\r\n    threshold: number;\r\n}\r\n\r\n\r\nexport class CuiScrollSpyArgs extends CuiAutoParseArgs {\r\n    selector: string; // Child selector\r\n    action: string; // Action to be performed on intersecting elements\r\n    link: string; // Link selector\r\n    linkAction: string; //Actions to be triggered on link\r\n    ratio: number; // Value 0..1 telling how much of a child view must be in view to be added to intersecting items\r\n    isRoot: boolean; // Attach to window or element\r\n    mode: \"single\" | \"multi\"; // Action is triggered on single (last) intersecting item or all intersecting items\r\n    threshold: number; // Threshold value (in px) for scroll listener\r\n\r\n    constructor() {\r\n        super({\r\n            props: {\r\n                \"selector\": { corrector: joinWithScopeSelector },\r\n                \"ratio\": { corrector: (value: any) => getRangeValueOrDefault(value, 0, 1, 0) },\r\n                'mode': { corrector: (value: string) => getEnumOrDefault(value, 'single', \"multi\") }\r\n            }\r\n        });\r\n        this.ratio = 0;\r\n        this.mode = \"single\";\r\n        this.threshold = -1;\r\n        this.selector = joinWithScopeSelector(DEFAULT_SELECTOR);\r\n        this.action = \"\";\r\n        this.isRoot = false;\r\n        this.link = \"\";\r\n        this.linkAction = \"\";\r\n    }\r\n}\r\nexport class CuiScrollspyComponent implements ICuiComponent {\r\n    attribute: string;\r\n    constructor(prefix?: string) {\r\n        this.attribute = `${prefix ?? 'cui'}-scrollspy`;\r\n    }\r\n\r\n    getStyle(): string | null {\r\n        return null;\r\n    }\r\n\r\n    get(element: HTMLElement, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiScrollspyHandler(element, utils, this.attribute);\r\n    }\r\n}\r\n\r\nexport class CuiScrollspyHandler extends CuiHandlerBase<CuiScrollSpyArgs> {\r\n    #listener: CuiIntersectionListener;\r\n    #links: HTMLElement[];\r\n    #actions: ICuiComponentAction[];\r\n    #linkActions: ICuiComponentAction[];\r\n    #root: CuiElementBoxType | undefined;\r\n    #rootBox: ICuiElementBox | undefined;\r\n    #modeHandler: ICuiScrollspyModeHandler | undefined;\r\n    constructor(element: HTMLElement, utils: CuiUtils, attribute: string) {\r\n        super(\"CuiScrollspyHandler\", element, attribute, new CuiScrollSpyArgs(), utils);\r\n        this.element = element as HTMLElement;\r\n        this.#listener = new CuiIntersectionListener(this.element, { threshold: this.utils.setup.scrollThreshold });\r\n        this.#links = [];\r\n        this.#actions = [];\r\n        this.#linkActions = [];\r\n        this.#root = undefined;\r\n        this.#rootBox = undefined;\r\n        this.#modeHandler = undefined;\r\n    }\r\n\r\n    async onHandle(): Promise<boolean> {\r\n        this.init();\r\n        this.#listener.setCallback(this.onIntersection.bind(this));\r\n        this.#listener.attach();\r\n        return true;\r\n    }\r\n    async onRefresh(): Promise<boolean> {\r\n        this.update();\r\n        return true;\r\n    }\r\n    async onRemove(): Promise<boolean> {\r\n        this.#listener.detach();\r\n        return true;\r\n    }\r\n\r\n    private onIntersection(ev: CuiIntersectionResult): void {\r\n        if (!this.#modeHandler) {\r\n            this.logError(\"Cannot perform - mode handler not initialized\", \"OnIntersection\")\r\n            return;\r\n        }\r\n        let timestamp = Date.now();\r\n        this.mutate(() => {\r\n            //@ts-ignore - modeHandler checked\r\n            let updateResult: CuiScrollspyUpdateResult = this.#modeHandler.update(ev.items, this.args.ratio, this.#actions, this.#links, this.#linkActions)\r\n            if (updateResult.changed) {\r\n                this.emitEvent(EVENTS.TARGET_CHANGE, {\r\n                    intersecting: updateResult.intersecting,\r\n                    timestamp: timestamp\r\n                })\r\n            }\r\n        })\r\n        this.emitEvent<CuiScrollspyScrollEvent>(EVENTS.ON_SCROLL, {\r\n            top: ev.top,\r\n            left: ev.left,\r\n            scrolling: ev.scrolling,\r\n            initial: ev.initial\r\n        })\r\n    }\r\n\r\n    private init() {\r\n        this.#root = this.args.isRoot ? window : this.element;\r\n        this.#rootBox = CuiElementBoxFactory.get(this.#root);\r\n        let targets = this.args.selector ? this.#rootBox.queryAll(this.args.selector) : [];\r\n        this.#listener.setChildren(targets);\r\n        this.#listener.setThreshold(this.args.threshold);\r\n        this.#links = this.args.link ? [...document.querySelectorAll<HTMLElement>(this.args.link)] : [];\r\n        this.#actions = CuiActionsListFactory.get(this.args.action);\r\n        this.#linkActions = CuiActionsListFactory.get(this.args.linkAction);\r\n        this.#modeHandler = CuiScrollSpyModeHandlerFactory.get(this.args.mode);\r\n\r\n    }\r\n\r\n    private update() {\r\n        if (this.prevArgs && this.args.isRoot !== this.prevArgs.isRoot) {\r\n            this.#root = this.args.isRoot ? window : this.element;\r\n            this.#rootBox = CuiElementBoxFactory.get(this.#root);\r\n            this.#listener.setParent(this.#root);\r\n        }\r\n        if (this.prevArgs && this.#rootBox && this.args.selector !== this.prevArgs.selector) {\r\n            let targets = this.args.selector ? this.#rootBox.queryAll(this.args.selector) : [];\r\n            this.#listener.setChildren(targets);\r\n        }\r\n        this.#listener.setThreshold(this.args.threshold);\r\n        this.#links = this.args.link ? [...document.querySelectorAll<HTMLElement>(this.args.link)] : [];\r\n        this.#actions = CuiActionsListFactory.get(this.args.action);\r\n        this.#linkActions = CuiActionsListFactory.get(this.args.linkAction);\r\n        this.#modeHandler = CuiScrollSpyModeHandlerFactory.get(this.args.mode);\r\n\r\n    }\r\n}","import { is } from \"../../utils/functions\";\r\nimport { ICuiElementDetector } from \"./interfaces\";\r\n\r\nexport class CuiSimpleDragOverDetector implements ICuiElementDetector {\r\n    #elements: Element[];\r\n    #count: number;\r\n    #threshold: number;\r\n    constructor() {\r\n        this.#elements = [];\r\n        this.#count = 0;\r\n        this.#threshold = 5;\r\n    }\r\n\r\n    setElements(elements: Element[]): void {\r\n        this.#elements = elements;\r\n        this.#count = this.#elements.length;\r\n    }\r\n\r\n    setThreshold(value: number) {\r\n        this.#threshold = value\r\n    }\r\n\r\n    detect(x: Number, y: Number): [number, Element | undefined] {\r\n        if (!is(this.#elements)) {\r\n            return [-1, undefined];\r\n        }\r\n\r\n        let idx: number = -1;\r\n        let found: Element | undefined = undefined;\r\n\r\n        for (let i = 0; i < this.#count; i++) {\r\n            if (this.isInBounds(this.#elements[i], x, y)) {\r\n                if (i === 0) {\r\n                    idx = i;\r\n                    found = this.#elements[i];\r\n                    //break;\r\n                } else if (i < this.#count - 1) {\r\n                    idx = i + 1;\r\n                    found = this.#elements[i + 1];\r\n                    //break;\r\n                }\r\n                break;\r\n            }\r\n        }\r\n\r\n        return [idx, found];\r\n    }\r\n\r\n    private isInBounds(element: Element, x: Number, y: Number): boolean {\r\n        const box = element.getBoundingClientRect();\r\n        return x > box.left - this.#threshold && x < box.left + box.width + this.#threshold &&\r\n            y > box.top - this.#threshold && y < box.top + box.height + this.#threshold;\r\n    }\r\n\r\n}","import { CuiMoveEventListener, ICuiMoveData } from \"../../listeners/move\";\r\n\r\nexport class CuiDragHandler {\r\n    #root: Element;\r\n    #moveHandler: CuiMoveEventListener;\r\n    #onDragStart: ((data: ICuiMoveData) => boolean) | undefined;\r\n    #onDragOver: ((data: ICuiMoveData) => void) | undefined;\r\n    #onDragEnd: ((data: ICuiMoveData) => void) | undefined;\r\n    #timeout: number;\r\n    #isTracking: boolean;\r\n    #timeoutId: any;\r\n    constructor(root: HTMLElement) {\r\n        this.#root = root;\r\n        this.#moveHandler = new CuiMoveEventListener();\r\n        this.#timeout = 150;\r\n        this.#isTracking = false;\r\n        this.#timeoutId = undefined;\r\n        this.#moveHandler.setTarget(this.#root);\r\n        this.#moveHandler.preventDefault(false);\r\n        this.#moveHandler.setCallback(this.onMove.bind(this));\r\n\r\n        this.#onDragStart = undefined;\r\n        this.#onDragOver = undefined;\r\n        this.#onDragEnd = undefined;\r\n    }\r\n\r\n    setLongPressTimeout(timeout: number) {\r\n        this.#timeout = timeout;\r\n    }\r\n\r\n    onDragStart(callback: (data: ICuiMoveData) => boolean) {\r\n        this.#onDragStart = callback;\r\n    }\r\n\r\n    onDragOver(callback: (data: ICuiMoveData) => void) {\r\n        this.#onDragOver = callback;\r\n    }\r\n\r\n    onDragEnd(callback: (data: ICuiMoveData) => void) {\r\n        this.#onDragEnd = callback;\r\n    }\r\n\r\n    attach() {\r\n        this.#moveHandler.attach();\r\n    }\r\n\r\n    detach() {\r\n        this.#moveHandler.detach();\r\n    }\r\n\r\n    private onMove(data: ICuiMoveData) {\r\n        switch (data.type) {\r\n            case \"down\":\r\n                if (this.#isTracking) {\r\n                    return;\r\n                }\r\n\r\n                this.#timeoutId = setTimeout(() => {\r\n                    if (this.#onDragStart && this.#onDragStart(data)) {\r\n                        this.#isTracking = true;\r\n                    }\r\n                }, this.#timeout);\r\n\r\n                break;\r\n            case \"move\":\r\n                this.cancelTimeout();\r\n                if (!this.#isTracking) {\r\n                    return;\r\n                }\r\n                if (this.#onDragOver) {\r\n                    this.#onDragOver(data);\r\n                }\r\n                break;\r\n            case \"up\":\r\n                this.cancelTimeout();\r\n                if (!this.#isTracking) {\r\n                    return;\r\n                }\r\n                if (this.#onDragEnd) {\r\n                    this.#onDragEnd(data);\r\n                }\r\n                this.#isTracking = false;\r\n                break;\r\n        }\r\n    }\r\n\r\n    private cancelTimeout() {\r\n        if (this.#timeoutId) {\r\n            clearTimeout(this.#timeoutId);\r\n            this.#timeoutId = undefined;\r\n        }\r\n    }\r\n}","import { ElementBuilder } from \"../../core/builders/element\";\r\nimport { CuiHandlerBase } from \"../../core/handlers/base\";\r\nimport { CuiSimpleDragOverDetector } from \"../../core/handlers/drag/detectors\";\r\nimport { CuiDragHandler } from \"../../core/handlers/drag/drag\";\r\nimport { ICuiElementDetector } from \"../../core/handlers/drag/interfaces\";\r\nimport { CuiSwipeAnimationEngine, PropsTypes } from \"../../core/animation/engine\";\r\nimport { AnimationProperty } from \"../../core/animation/interfaces\";\r\nimport { ICuiMoveData } from \"../../core/listeners/move\";\r\nimport { ICuiParsable, ICuiComponent, ICuiComponentHandler } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { replacePrefix, is, are, joinWithScopeSelector } from \"../../core/utils/functions\";\r\nimport { EVENTS, CLASSES } from \"../../core/utils/statics\";\r\nimport { CuiAutoParseArgs } from \"../../core/utils/arguments\";\r\nimport { SortEvent } from \"src/core/models/events\";\r\n\r\nconst SORTABLE_IS_MOVING = \"{prefix}-moving\";\r\nconst DEFAULT_SELECTOR = \" > *\";\r\nconst SORTABLE_PREVIEW_CLS = \"{prefix}-sortable-preview\";\r\n\r\nexport class CuiSortableArgs extends CuiAutoParseArgs implements ICuiParsable {\r\n    target: string;\r\n    trigger: string;\r\n    timeout: number;\r\n    threshold: number;\r\n\r\n    constructor() {\r\n        super({\r\n            props: {\r\n                \"target\": { corrector: joinWithScopeSelector },\r\n                \"trigger\": { corrector: joinWithScopeSelector }\r\n            }\r\n        });\r\n\r\n        this.target = joinWithScopeSelector(DEFAULT_SELECTOR);\r\n        this.trigger = joinWithScopeSelector(DEFAULT_SELECTOR);\r\n        this.timeout = 150;\r\n        this.threshold = 5;\r\n    }\r\n}\r\n\r\nexport class CuiSortableComponent implements ICuiComponent {\r\n    attribute: string;\r\n    #prefix: string;\r\n    constructor(prefix?: string) {\r\n        this.#prefix = prefix ?? \"cui\";\r\n        this.attribute = this.#prefix + \"-sortable\";\r\n    }\r\n    getStyle(): string | null {\r\n        return null;\r\n    }\r\n    get(element: HTMLElement, sutils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiSortableHandler(element, this.attribute, sutils, this.#prefix);\r\n    }\r\n}\r\n\r\nexport class CuiSortableHandler extends CuiHandlerBase<CuiSortableArgs> {\r\n    #dragHandler: CuiDragHandler;\r\n    #triggers: Element[];\r\n    #targets: Element[];\r\n    #currentTarget: HTMLElement | null;\r\n    #currentIdx: number;\r\n    #preview: HTMLElement | null;\r\n    #movingCls: string;\r\n    #detector: ICuiElementDetector;\r\n    #currentBefore: HTMLElement | null;\r\n    #animation: CuiSwipeAnimationEngine;\r\n\r\n    #previewCls: string;\r\n    constructor(element: HTMLElement, attribute: string, utils: CuiUtils, prefix: string) {\r\n        super(\"CuiSortableHandler\", element, attribute, new CuiSortableArgs(), utils);\r\n        this.#targets = [];\r\n        this.#triggers = [];\r\n        this.#currentIdx = -1;\r\n        this.#currentTarget = null;\r\n        this.#currentBefore = null;\r\n        this.#preview = null;\r\n\r\n        this.#dragHandler = new CuiDragHandler(element);\r\n        this.#dragHandler.onDragStart(this.onDragStart.bind(this));\r\n        this.#dragHandler.onDragOver(this.onDragOver.bind(this));\r\n        this.#dragHandler.onDragEnd(this.onDragEnd.bind(this));\r\n        this.#movingCls = replacePrefix(SORTABLE_IS_MOVING, prefix);\r\n        this.#previewCls = replacePrefix(SORTABLE_PREVIEW_CLS, prefix);\r\n        this.#detector = new CuiSimpleDragOverDetector();\r\n        this.#animation = new CuiSwipeAnimationEngine();\r\n        this.#animation.setOnFinish(this.onSortAnimationFinish.bind(this));\r\n    }\r\n\r\n    async onHandle(): Promise<boolean> {\r\n        this.#dragHandler.attach();\r\n        this.getTargetsAndTrggers();\r\n        this.#detector.setThreshold(this.args.threshold)\r\n        return true;\r\n    }\r\n    async onRefresh(): Promise<boolean> {\r\n        if (this.prevArgs && (this.args.target !== this.prevArgs.target ||\r\n            this.args.trigger !== this.prevArgs.trigger)) {\r\n            this.getTargetsAndTrggers();\r\n        }\r\n        this.#dragHandler.setLongPressTimeout(this.args.timeout);\r\n        return true;\r\n    }\r\n    async onRemove(): Promise<boolean> {\r\n        this.#dragHandler.detach();\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * queries targets and triggers from the element\r\n     * If exception - lists are cleared\r\n     */\r\n    private getTargetsAndTrggers() {\r\n        try {\r\n            this.#targets = [...this.element.querySelectorAll(this.args.target)];\r\n            this.#triggers = [...this.element.querySelectorAll(this.args.trigger)];\r\n            if (this.#triggers.length !== this.#targets.length) {\r\n                throw new Error(`Triggers (count ${this.#triggers.length}) and targets (count ${this.#targets.length}) selector are not correct`)\r\n            }\r\n            this.#detector.setElements(this.#targets);\r\n        } catch (e) {\r\n            this._log.error(\"Incorrect trigger or target selector\")\r\n            this._log.exception(e, \"getTargetsAndTrggers\");\r\n            this.#targets = [];\r\n            this.#triggers = [];\r\n        }\r\n    }\r\n\r\n    private onDragStart(data: ICuiMoveData): boolean {\r\n        this.#currentIdx = this.getPressedElementIdx(data.target as Node);\r\n        this.#currentTarget = this.#currentIdx > -1 ? this.#targets[this.#currentIdx] as HTMLElement : null;\r\n        if (!is(this.#currentTarget)) {\r\n            return false;\r\n        }\r\n        this.utils.bus.emit(EVENTS.MOVE_LOCK, null, true);\r\n        this.startMovementPrep(data);\r\n        this.emitEvent<SortEvent>(EVENTS.SORT_START, {\r\n            target: this.#currentTarget,\r\n            index: this.#currentIdx,\r\n        })\r\n        return true;\r\n    }\r\n\r\n    private onDragOver(data: ICuiMoveData): void {\r\n        this.move(data);\r\n        data.event.preventDefault();\r\n    }\r\n\r\n    private onDragEnd(data: ICuiMoveData): void {\r\n        if (!is(this.#preview)) {\r\n            return;\r\n        }\r\n        //@ts-ignore preview\r\n        this.#animation.setElement(this.#preview);\r\n        this.#animation.setProps(this.getFinishAnimation());\r\n        this.#animation.finish(0, 100, false);\r\n    }\r\n\r\n    private getPressedElementIdx(target: Node) {\r\n        return this.#triggers.findIndex((trigger: Element) => {\r\n            return trigger.contains(target)\r\n        });\r\n    }\r\n\r\n    private startMovementPrep(data: ICuiMoveData) {\r\n        this.mutate(() => {\r\n            this.createPreview();\r\n            if (is(this.#currentTarget))\r\n                //@ts-ignore currentTarget\r\n                this.helper.setClass(this.#movingCls, this.#currentTarget);\r\n            this.helper.setClass(\"cui-locked\", this.element);\r\n            this.helper.setClass(CLASSES.swipingOn, document.body);\r\n            this.setPreviewPosition(data);\r\n            this.setCurrentPosition(data);\r\n        })\r\n    }\r\n\r\n    private stopMovementPrep() {\r\n        this.mutate(() => {\r\n            if (is(this.#currentTarget))\r\n                //@ts-ignore currentTarget\r\n                this.helper.removeClass(this.#movingCls, this.#currentTarget);\r\n            this.helper.removeClass(CLASSES.swipingOn, document.body);\r\n            this.helper.removeClass(\"cui-locked\", this.element);\r\n            this.removePreview();\r\n            this.#currentTarget = null;\r\n            this.#currentBefore = null;\r\n            this.getTargetsAndTrggers();\r\n        })\r\n    }\r\n\r\n    private move(data: ICuiMoveData) {\r\n        this.mutate(() => {\r\n            this.setPreviewPosition(data);\r\n            this.setCurrentPosition(data);\r\n        })\r\n    }\r\n\r\n    private createPreview() {\r\n        if (!is(this.#currentTarget)) {\r\n            this.logError(\"Cannot create preview - current target does not exist\", \"createPreview\")\r\n            return;\r\n        }\r\n\r\n        this.#preview = new ElementBuilder(\"div\").setClasses(this.#previewCls).build();\r\n        //@ts-ignore currentTarget\r\n        this.#preview.style.width = `${this.#currentTarget.offsetWidth}px`;\r\n        //@ts-ignore currentTarget\r\n        this.#preview.style.height = `${this.#currentTarget.offsetHeight}px`;\r\n        document.body.appendChild(this.#preview);\r\n    }\r\n\r\n    private removePreview() {\r\n        if (is(this.#preview)) {\r\n            //@ts-ignore currentTarget\r\n            this.#preview.remove();\r\n            this.#preview = null;\r\n        }\r\n    }\r\n\r\n    private setPreviewPosition(data: ICuiMoveData) {\r\n        if (!is(this.#preview)) {\r\n            return;\r\n        }\r\n        //@ts-ignore preview\r\n        this.#preview.style.top = `${data.y}px`;\r\n        //@ts-ignore preview\r\n        this.#preview.style.left = `${data.x}px`;\r\n    }\r\n\r\n    private setCurrentPosition(data: ICuiMoveData) {\r\n        if (!this.#currentTarget) {\r\n            return;\r\n        }\r\n        let [idx, detected] = this.#detector.detect(data.x, data.y);\r\n        if ((idx !== this.#currentIdx) && detected && this.#currentBefore !== detected) {\r\n            let el = detected;\r\n            this.insertElement(this.#currentTarget, el);\r\n            this.#currentBefore = el as HTMLElement;\r\n            this.getTargetsAndTrggers();\r\n            this.#currentIdx = idx;\r\n        }\r\n    }\r\n\r\n    private insertElement(source: Element, destination: Element) {\r\n        if (is(destination)) {\r\n            this.element.insertBefore(source, destination);\r\n        } else {\r\n            this.element.appendChild(source);\r\n        }\r\n    }\r\n\r\n    private getFinishAnimation(): AnimationProperty<PropsTypes> {\r\n        if (!are(this.#currentTarget, this.#preview)) {\r\n            return {\r\n                opacity: {\r\n                    from: 1,\r\n                    to: 0,\r\n                }\r\n            }\r\n        }\r\n        //@ts-ignore currentTarget\r\n        const box = this.#currentTarget.getBoundingClientRect();\r\n        return {\r\n            opacity: {\r\n                from: 1,\r\n                to: 0,\r\n            },\r\n            top: {\r\n                //@ts-ignore preview\r\n                from: this.#preview.offsetTop,\r\n                //@ts-ignore preview\r\n                to: box.top > 0 ? box.top : this.#preview.offsetTop,\r\n                unit: \"px\"\r\n            },\r\n            left: {\r\n                //@ts-ignore preview\r\n                from: this.#preview.offsetLeft,\r\n                //@ts-ignore preview\r\n                to: box.left > 0 ? box.left : this.#preview.offsetLeft,\r\n                unit: \"px\"\r\n            }\r\n        }\r\n    }\r\n\r\n    private onSortAnimationFinish() {\r\n        this.stopMovementPrep();\r\n\r\n        this.utils.bus.emit(EVENTS.MOVE_LOCK, null, false);\r\n        this.emitEvent<SortEvent>(EVENTS.SORTED, {\r\n            target: this.#currentTarget,\r\n            index: this.#currentIdx,\r\n        })\r\n    }\r\n}","import { ICuiComponent, ICuiComponentHandler, ICuiParsable } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiHandlerBase } from \"../../core/handlers/base\";\r\nimport { EVENTS, ICONS } from \"../../core/utils/statics\";\r\nimport { is, replacePrefix } from \"../../core/utils/functions\";\r\nimport { IconBuilder } from \"../../core/builders/icon\";\r\nimport { CuiAutoParseArgs } from \"../../core/utils/arguments\";\r\nimport { CuiSpinnerEvent } from \"../../core/models/events\";\r\n\r\nexport class CuiSpinnerArgs extends CuiAutoParseArgs implements ICuiParsable {\r\n    spinner: string;\r\n    scale: number;\r\n    constructor() {\r\n        super({\r\n            main: \"spinner\"\r\n        });\r\n        this.spinner = \"circle\";\r\n        this.scale = 1;\r\n    }\r\n}\r\n\r\nexport class CuiSpinnerComponent implements ICuiComponent {\r\n    attribute: string;\r\n    #prefix: string;\r\n    constructor(prefix?: string) {\r\n        this.#prefix = prefix ?? 'cui';\r\n        this.attribute = `${this.#prefix}-spinner`;\r\n        ICONS['spinner_circle'] = \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 20 20\\\" width=\\\"20\\\" height=\\\"20\\\"><path d=\\\"M 7.800378,1.7908996 A 8.4986862,8.4986862 0 0 1 18.2091,7.8003784 8.4986862,8.4986862 0 0 1 12.199621,18.209101 8.4986862,8.4986862 0 0 1 1.7908995,12.199622 8.4986862,8.4986862 0 0 1 7.800378,1.7908996 Z\\\"></path></svg>\";\r\n        ICONS['spinner_circle_double'] = \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 20 20\\\" width=\\\"20\\\" height=\\\"20\\\"><path d=\\\"M 10,1.5000006 A 8.4999997,8.4999997 0 0 1 18.5,10 8.4999997,8.4999997 0 0 1 10,18.499999 8.4999997,8.4999997 0 0 1 1.5000005,10 8.4999997,8.4999997 0 0 1 10,1.5000006 Z\\\"></path><path d=\\\"M 10,3.4999997 A 6.5000002,6.5000002 0 0 1 16.5,10 6.5000002,6.5000002 0 0 1 10,16.5 6.5000002,6.5000002 0 0 1 3.5,9.9999993 6.5000002,6.5000002 0 0 1 10,3.4999997 Z\\\"></path></svg>\";\r\n    }\r\n\r\n    getStyle(): string | null {\r\n        return null;\r\n    }\r\n\r\n    get(element: HTMLElement, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiSpinnerHandler(element, utils, this.attribute, this.#prefix);\r\n    }\r\n}\r\n\r\nexport class CuiSpinnerHandler extends CuiHandlerBase<CuiSpinnerArgs> {\r\n    #pauseEventId: string | null;\r\n    #animationPauseClass: string;\r\n    constructor(element: HTMLElement, utils: CuiUtils, attribute: string, prefix: string) {\r\n        super(\"CuiSpinnerHandler\", element, attribute, new CuiSpinnerArgs(), utils);\r\n        this.#pauseEventId = null;\r\n        this.#animationPauseClass = replacePrefix(\"{prefix}-animation-pause\", prefix);\r\n    }\r\n\r\n    async onHandle(): Promise<boolean> {\r\n        this.#pauseEventId = this.onEvent(EVENTS.PAUSE, this.onPause.bind(this));\r\n        this.add()\r\n        return true;\r\n    }\r\n    async onRefresh(): Promise<boolean> {\r\n        if (this.prevArgs && this.args.spinner !== this.prevArgs.spinner) {\r\n            this.add();\r\n        }\r\n        return true;\r\n    }\r\n    async onRemove(): Promise<boolean> {\r\n        this.removeIfAnyExisists();\r\n        this.detachEvent(EVENTS.PAUSE, this.#pauseEventId);\r\n        return true;\r\n    }\r\n\r\n    private addSpinner(iconElement: Element, name: string) {\r\n        this.element.appendChild(iconElement);\r\n        this.element.classList.add(`animation-spinner-${name}`);\r\n    }\r\n\r\n    private add() {\r\n        const svgIcon = is(this.args.spinner) ? ICONS[`spinner_${this.args.spinner}`] : null;\r\n        if (!is(svgIcon)) {\r\n            this._log.warning(\"Incorrect spinner name: \" + this.args.spinner);\r\n            return;\r\n        }\r\n        this.removeIfAnyExisists();\r\n        const iconElement = new IconBuilder(svgIcon).setScale(this.args.scale).build();\r\n        this.mutate(this.addSpinner, iconElement, this.args.spinner);\r\n    }\r\n\r\n    private removeIfAnyExisists() {\r\n        let existing = this.element.querySelector(\"svg\");\r\n        if (existing) {\r\n            existing.remove();\r\n        }\r\n    }\r\n\r\n\r\n    private onPause(flag: boolean) {\r\n        this.fetch(() => {\r\n            if (flag && !this.helper.hasClass(this.#animationPauseClass, this.element)) {\r\n                this.helper.setClassesAs(this.element, this.#animationPauseClass);\r\n            } else {\r\n                this.helper.removeClassesAs(this.element, this.#animationPauseClass);\r\n            }\r\n        })\r\n        this.emitEvent<CuiSpinnerEvent>(EVENTS.PAUSED, {\r\n            paused: flag\r\n        });\r\n    }\r\n\r\n\r\n}","import { ICuiComponent, ICuiComponentHandler, ICuiParsable, ICuiSwitchable } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiChildMutation, CuiMutableHandler } from \"../../core/handlers/base\";\r\nimport { ICuiTask, CuiTaskRunner } from \"../../core/utils/task\";\r\nimport { ICuiMoveData } from \"../../core/listeners/move\";\r\nimport { CuiSwipeAnimationEngine } from \"../../core/animation/engine\";\r\nimport { AnimationDefinition, SWIPE_ANIMATIONS_DEFINITIONS } from \"../../core/animation/definitions\";\r\nimport { calculateNextIndex, is, getChildrenHeight, isInRange, joinWithScopeSelector } from \"../../core/utils/functions\";\r\nimport { EVENTS, CLASSES } from \"../../core/utils/statics\";\r\nimport { CuiAutoParseArgs } from \"../../core/utils/arguments\";\r\n\r\n/**\r\n * \r\n *   targets: string - slider elements\r\n *   timeout: number - animation timeout\r\n *   links: string; - link to switcher (indicator, tab, etc)\r\n *   autoTimeout: number - if defined, slider will switch item automatically\r\n *   height: 'auto' | string - element height\r\n *   animation: string - animation name\r\n *   loop: boolean - allows to slide elements in loop\r\n */\r\nconst SWITCH_DEFAULT_TARGETS = \" > li\";\r\n\r\nexport class CuiSliderArgs extends CuiAutoParseArgs implements ICuiParsable {\r\n    targets: string;\r\n    timeout: number;\r\n    links: string;\r\n    autoTimeout: number;\r\n    height: 'auto' | string;\r\n    animation: string;\r\n    loop: boolean;\r\n\r\n    constructor(prefix: string, timeout?: number) {\r\n        super({\r\n            props: {\r\n                \"targets\": { corrector: joinWithScopeSelector }\r\n            }\r\n        });\r\n\r\n        this.targets = joinWithScopeSelector(SWITCH_DEFAULT_TARGETS);\r\n        this.links = \"\";\r\n        this.autoTimeout = -1;\r\n        this.height = \"\";\r\n        this.animation = \"slide\";\r\n        this.loop = false;\r\n        this.timeout = timeout ?? 300;\r\n    }\r\n\r\n\r\n}\r\n\r\nexport class CuiSliderComponent implements ICuiComponent {\r\n    attribute: string;\r\n    constructor(prefix?: string) {\r\n        this.attribute = `${prefix ?? 'cui'}-slider`;\r\n    }\r\n\r\n    getStyle(): string | null {\r\n        return null;\r\n    }\r\n\r\n    get(element: HTMLElement, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiSliderHandler(element, utils, this.attribute);\r\n    }\r\n}\r\n\r\nexport class CuiSliderHandler extends CuiMutableHandler<CuiSliderArgs> implements ICuiSwitchable {\r\n    #targets: Element[];\r\n    #currentIdx: number;\r\n    #links: Element[];\r\n    #task: ICuiTask;\r\n    #switchEventId: string | null;\r\n    //  #moveListener: CuiMoveEventListener;\r\n    #isTracking: boolean;\r\n    #startX: number;\r\n    #swipeRatio: number;\r\n    #nextIdx: number;\r\n    #nextElement: HTMLElement | null;\r\n    #ratioThreshold: number;\r\n    #currSlider: CuiSwipeAnimationEngine;\r\n    #nextSlider: CuiSwipeAnimationEngine;\r\n    #animationDef: AnimationDefinition;\r\n    #targetsCount: number;\r\n    #moveEventId: string | null;\r\n    constructor(element: HTMLElement, utils: CuiUtils, attribute: string) {\r\n        super(\"CuiSliderHandler\", element, attribute, new CuiSliderArgs(utils.setup.prefix, utils.setup.animationTime), utils);\r\n        this.#targets = [];\r\n        this.#currentIdx = -1;\r\n        this.#nextIdx = -1;\r\n        this.#links = [];\r\n        this.#switchEventId = null;\r\n        this.#moveEventId = null;\r\n        this.#isTracking = false;\r\n        this.#startX = -1;\r\n        this.#swipeRatio = 0;\r\n        this.#nextElement = null;\r\n        this.#ratioThreshold = 0.4;\r\n        this.#currSlider = new CuiSwipeAnimationEngine();\r\n        this.#nextSlider = new CuiSwipeAnimationEngine();\r\n        this.#currSlider.setOnFinish(this.onAnimationFinish.bind(this));\r\n        this.#targetsCount = 0;\r\n        this.#task = new CuiTaskRunner(this.args.autoTimeout, true, this.switch.bind(this, 'next'));\r\n        this.#animationDef = SWIPE_ANIMATIONS_DEFINITIONS[this.args.animation];\r\n    }\r\n\r\n    onInit(): void {\r\n        this.#switchEventId = this.onEvent(EVENTS.SWITCH, this.onPushSwitch.bind(this))\r\n        this.#moveEventId = this.onEvent(EVENTS.GLOBAL_MOVE, this.onMove.bind(this))\r\n        this.getTargets();\r\n        this.getLinks();\r\n        this.getActiveIndex();\r\n        this.setLinkActive(-1, this.#currentIdx);\r\n\r\n        this.mutate(() => {\r\n            this.helper.setStyle(this.element, 'height', this.getElementHeight(this.#targets[this.#currentIdx]))\r\n        })\r\n        this.#task = new CuiTaskRunner(this.args.autoTimeout, true, this.switch.bind(this, 'next'));\r\n        this.#animationDef = SWIPE_ANIMATIONS_DEFINITIONS[this.args.animation];\r\n        this.startTask();\r\n    }\r\n\r\n    onUpdate(): void {\r\n        this.mutate(() => {\r\n            this.helper.setStyle(this.element, 'height', this.getElementHeight(this.#targets[this.#currentIdx]))\r\n        })\r\n        this.#animationDef = SWIPE_ANIMATIONS_DEFINITIONS[this.args.animation];\r\n\r\n        this.startTask();\r\n    }\r\n\r\n    onDestroy(): void {\r\n        this.#task.stop();\r\n        this.detachEvent(EVENTS.SWITCH, this.#switchEventId)\r\n        this.detachEvent(EVENTS.GLOBAL_MOVE, this.#moveEventId)\r\n    }\r\n\r\n    onMutation(record: CuiChildMutation): void {\r\n\r\n    }\r\n    /**\r\n     * Move listener callback\r\n     * @param data move listener data\r\n     */\r\n    onMove(data: ICuiMoveData) {\r\n        if (this.isLocked || !this.#animationDef) {\r\n            return;\r\n        }\r\n        let current = this.#targets[this.#currentIdx] as HTMLElement;\r\n        switch (data.type) {\r\n            case \"down\":\r\n                if (this.#isTracking || !current.contains((data.target as Node))) {\r\n                    return;\r\n                }\r\n                this.#isTracking = true;\r\n                this.#startX = data.x;\r\n                this.#currSlider.setElement(current);\r\n                this.helper.setClassesAs(document.body, CLASSES.swipingOn);\r\n                if (data.event.cancelable)\r\n                    data.event.preventDefault();\r\n                break;\r\n            case \"up\":\r\n                if (!this.#isTracking) {\r\n                    break;\r\n                }\r\n                // Lock component until animation is finished\r\n                this.isLocked = true;\r\n                let absRatio = Math.abs(this.#swipeRatio);\r\n                let timeout = absRatio * this.args.timeout;\r\n                let back = absRatio <= this.#ratioThreshold;\r\n                this.#currSlider.finish(absRatio, timeout, back);\r\n                this.#nextSlider.finish(absRatio, timeout, back);\r\n                this.helper.removeClassesAs(document.body, CLASSES.swipingOn);\r\n                this.#isTracking = false;\r\n                break;\r\n            case \"move\":\r\n                if (!this.#isTracking) {\r\n                    break;\r\n                }\r\n                let newRatio = (data.x - this.#startX) / current.offsetWidth;\r\n                if (Math.abs(newRatio - this.#swipeRatio) < 0.02) {\r\n                    break;\r\n                }\r\n                let nextIdx = calculateNextIndex(this.#swipeRatio > 0 ? \"next\" : \"prev\", this.#currentIdx, this.#targetsCount);\r\n                this.#swipeRatio = this.adjustMoveRatio(newRatio);\r\n\r\n                if (nextIdx !== this.#nextIdx) {\r\n                    this.#nextElement && this.helper.removeClass(CLASSES.animProgress, this.#nextElement);\r\n                    this.#nextElement = this.#targets[nextIdx] as HTMLElement;\r\n                    this.#nextIdx = nextIdx;\r\n\r\n                    this.#nextSlider.setElement(this.#nextElement)\r\n                    this.#nextSlider.setProps(this.#swipeRatio > 0 ? this.#animationDef.previous.right : this.#animationDef.previous.left);\r\n                    this.#currSlider.setProps(this.#swipeRatio > 0 ? this.#animationDef.current.right : this.#animationDef.current.left);\r\n                    this.mutate(() => {\r\n                        this.#nextElement && this.helper.setClass(CLASSES.animProgress, this.#nextElement);\r\n                    })\r\n                }\r\n                this.mutate(() => {\r\n                    this.#currSlider.update(Math.abs(this.#swipeRatio));\r\n                    this.#nextSlider.update(Math.abs(this.#swipeRatio));\r\n                })\r\n                if (data.event.cancelable)\r\n                    data.event.preventDefault();\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n\r\n    }\r\n\r\n    adjustMoveRatio(ratio: number): number {\r\n        if (this.args.loop) {\r\n            return ratio;\r\n        }\r\n        if (this.#currentIdx === this.#targetsCount - 1 && ratio > 0) {\r\n            return 0;\r\n        }\r\n        if (this.#currentIdx === 0 && ratio < 0) {\r\n            return 0;\r\n        }\r\n        return ratio;\r\n    }\r\n\r\n    /**\r\n     * Api method to switch childrens\r\n     * @param index - index to switch to\r\n     */\r\n    async switch(index: any): Promise<boolean> {\r\n        if (this.isLocked) {\r\n            console.log(\"Locked\")\r\n            return false;\r\n        }\r\n        this.onPushSwitch(index);\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param element element this animation was perfromed on\r\n     * @param reverted - flag inidicating whether animation was performed to the end or reverted back to start\r\n     * @param errorOccured - tells whether animation was finished with error\r\n     */\r\n    onAnimationFinish(element: Element | undefined, reverted: boolean, errorOccured: boolean) {\r\n        this.isLocked = false;\r\n        // If not go back or from push then switch, else was go back\r\n        let next = this.#targets[this.#nextIdx];\r\n        let current = this.#targets[this.#currentIdx];\r\n        if (!reverted) {\r\n            if (this.#nextIdx > -1) {\r\n                this.mutate(() => {\r\n                    this.helper.removeClass(CLASSES.animProgress, next);\r\n                    this.helper.setClass(this.activeClassName, next);\r\n                    this.helper.removeClass(this.activeClassName, current);\r\n                    this.helper.removeAttribute(\"style\", current);\r\n                    this.helper.removeAttribute(\"style\", next);\r\n                    this.setLinkActive(this.#currentIdx, this.#nextIdx);\r\n                    this.emitEvent(EVENTS.SWITCHED, {\r\n                        timestamp: Date.now(),\r\n                        index: this.#nextIdx\r\n                    })\r\n                    this.#currentIdx = this.#nextIdx;\r\n                    this.#nextIdx = -1;\r\n                    this.#nextElement = null;\r\n                    this.#startX = -1;\r\n                    this.#swipeRatio = 0;\r\n                })\r\n            }\r\n        } else {\r\n            if (is(this.#nextElement)) {\r\n                //@ts-ignore\r\n                this.helper.removeClass(CLASSES.animProgress, this.#nextElement);\r\n                //@ts-ignore\r\n                this.helper.removeAttribute(\"style\", this.#nextElement);\r\n            }\r\n\r\n            this.helper.removeAttribute(\"style\", current);\r\n            this.#nextIdx = -1;\r\n            this.#nextElement = null;\r\n            this.#startX = -1;\r\n            this.#swipeRatio = 0;\r\n        }\r\n        this.startTask();\r\n    }\r\n\r\n    onPushSwitch(index: string) {\r\n        if (!is(index) ||\r\n            this.isLocked ||\r\n            !this.#animationDef ||\r\n            (!this.args.loop && this.#currentIdx === 0 && index === 'prev') ||\r\n            (!this.args.loop && this.#currentIdx === this.#targetsCount - 1 && index === 'next')) {\r\n            return;\r\n        }\r\n        this.isLocked = true;\r\n        let nextIdx = calculateNextIndex(index, this.#currentIdx, this.#targetsCount);\r\n        if (nextIdx == this.#currentIdx || nextIdx < 0 || nextIdx >= this.#targets.length) {\r\n            this._log.warning(`Index ${index} is not within the suitable range`);\r\n            return false;\r\n        }\r\n        this.#nextIdx = nextIdx;\r\n        let current = this.#targets[this.#currentIdx];\r\n        let next = this.#targets[this.#nextIdx];\r\n        this.#currSlider.setElement(current);\r\n        this.#nextSlider.setElement(next);\r\n        this.#currSlider.setProps(index === 'prev' ? this.#animationDef.current.left : this.#animationDef.current.right);\r\n        this.#nextSlider.setProps(index === 'prev' ? this.#animationDef.previous.left : this.#animationDef.previous.right);\r\n        this.mutate(() => {\r\n            this.#currSlider.finish(0, this.args.timeout, false);\r\n            this.#nextSlider.finish(0, this.args.timeout, false);\r\n            this.helper.setClass(CLASSES.animProgress, next);\r\n        })\r\n\r\n    }\r\n\r\n    getActiveIndex(): void {\r\n        this.#currentIdx = is(this.#targets) ? this.#targets.findIndex(target => this.helper.hasClass(this.activeClassName, target)) : -1;\r\n    }\r\n\r\n    getElementHeight(current: Element): string {\r\n        if (!is(this.args.height) || this.args.height === 'auto') {\r\n            return getChildrenHeight(current) + \"px\";\r\n        } else {\r\n            return this.args.height;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Queries targets\r\n     */\r\n    getTargets() {\r\n        let t = this.element.querySelectorAll(this.args.targets);\r\n        this.#targets = t.length > 0 ? [...t] : [];\r\n        this.#targetsCount = this.#targets.length;\r\n    }\r\n\r\n    /**\r\n     * Get linked switcher elements\r\n     */\r\n    getLinks() {\r\n        this.#links = is(this.args.links) ? [...document.querySelectorAll(this.args.links)] : []\r\n    }\r\n\r\n    /**\r\n     * Set active class on linked switcher if set\r\n     * @param current - current index (to remove active from)\r\n     * @param next - next index (to set action on)\r\n     */\r\n    setLinkActive(current: number, next: number) {\r\n        if (!is(this.#links)) {\r\n            return\r\n        }\r\n        this.mutate(() => {\r\n            if (isInRange(current, 0, this.#links.length - 1)) {\r\n                this.helper.removeClass(this.activeClassName, this.#links[current])\r\n            }\r\n            if (isInRange(next, 0, this.#links.length - 1)) {\r\n                this.helper.setClass(this.activeClassName, this.#links[next])\r\n            }\r\n        })\r\n\r\n    }\r\n\r\n    /**\r\n     * Runs task if arguments setup allows for it - auto flag must be set to true \r\n     */\r\n    startTask() {\r\n        this.#task.stop();\r\n        if (this.args.autoTimeout) {\r\n            this.#task.start();\r\n        }\r\n    }\r\n}\r\n","import { ICuiComponent, ICuiComponentHandler, ICuiParsable, ICuiSwitchable, CuiElement } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiChildMutation, CuiMutableHandler } from \"../../core/handlers/base\";\r\nimport { ICuiTask, CuiTaskRunner } from \"../../core/utils/task\";\r\nimport { ICuiComponentAction, CuiActionsListFactory } from \"../../core/utils/actions\";\r\nimport { is, replacePrefix, calculateNextIndex, getChildrenHeight, isInRange, joinWithScopeSelector } from \"../../core/utils/functions\";\r\nimport { EVENTS } from \"../../core/utils/statics\";\r\nimport { CuiAutoParseArgs } from \"../../core/utils/arguments\";\r\n\r\nconst SWITCH_DEFAULT_ACTION_IN = \".{prefix}-switch-animation-default-in\";\r\nconst SWITCH_DEFAULT_ACTION_OUT = \".{prefix}-switch-animation-default-out\";\r\nconst SWITCH_DEFAULT_TARGETS = \" > *\";\r\n\r\nexport class CuiSwitchArgs extends CuiAutoParseArgs implements ICuiParsable {\r\n    targets: string;\r\n    in: string;\r\n    out: string;\r\n    timeout: number;\r\n    links: string;\r\n    switch: string;\r\n    autoTimeout: number;\r\n    height: 'auto' | string;\r\n    loop: boolean;\r\n\r\n    constructor(prefix: string, timeout?: number) {\r\n        super({\r\n            props: {\r\n                \"targets\": { corrector: joinWithScopeSelector }\r\n            }\r\n        });\r\n\r\n        this.targets = joinWithScopeSelector(SWITCH_DEFAULT_TARGETS);\r\n        this.in = replacePrefix(SWITCH_DEFAULT_ACTION_IN, prefix);\r\n        this.out = replacePrefix(SWITCH_DEFAULT_ACTION_OUT, prefix);\r\n        this.timeout = timeout ?? 300;\r\n        this.links = \"\";\r\n        this.switch = \"\";\r\n        this.autoTimeout = -1;\r\n        this.height = \"auto\";\r\n        this.loop = false;\r\n    }\r\n}\r\n\r\nexport class CuiSwitchComponent implements ICuiComponent {\r\n    attribute: string;\r\n    constructor(prefix?: string) {\r\n        this.attribute = `${prefix ?? 'cui'}-switch`;\r\n    }\r\n\r\n    getStyle(): string | null {\r\n        return null;\r\n    }\r\n\r\n    get(element: HTMLElement, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiSwitchHandler(element, utils, this.attribute);\r\n    }\r\n}\r\n\r\nexport class CuiSwitchHandler extends CuiMutableHandler<CuiSwitchArgs> implements ICuiSwitchable {\r\n    #targets: Element[];\r\n    #currentIdx: number;\r\n    #links: Element[];\r\n    #switches: CuiElement[];\r\n    #task: ICuiTask;\r\n    #switchEventId: string | null;\r\n    #actionsIn: ICuiComponentAction[];\r\n    #actionsOut: ICuiComponentAction[];\r\n    constructor(element: HTMLElement, utils: CuiUtils, attribute: string) {\r\n        super(\"CuiSwitchHandler\", element, attribute, new CuiSwitchArgs(utils.setup.prefix, utils.setup.animationTime), utils);\r\n        this.#targets = [];\r\n        this.#currentIdx = -1;\r\n        this.#links = [];\r\n        this.#switches = [];\r\n        this.#switchEventId = null;\r\n        this.#actionsIn = this.#actionsOut = [];\r\n        this.#task = new CuiTaskRunner(this.args.autoTimeout, true, this.switch.bind(this, 'next'));\r\n\r\n    }\r\n\r\n    onInit(): void {\r\n        this.#switchEventId = this.onEvent(EVENTS.SWITCH, this.onPushSwitch.bind(this))\r\n        this.parseArguments();\r\n        this.getTargets();\r\n        this.getActiveIndex();\r\n        this.getSwitches();\r\n        this.setSwitchesActive(this.#currentIdx);\r\n        this.setLinkActive(-1, this.#currentIdx);\r\n        this.mutate(() => {\r\n            this.helper.setStyle(this.element, 'height', this.getElementHeight(this.#targets[this.#currentIdx]))\r\n        })\r\n        this.#task = new CuiTaskRunner(this.args.autoTimeout, true, this.switch.bind(this, 'next'));\r\n        this.startTask();\r\n    }\r\n\r\n    onUpdate(): void {\r\n        this.parseArguments();\r\n        this.getTargets();\r\n        this.getSwitches();\r\n        this.setSwitchesActive(this.#currentIdx);\r\n        this.mutate(() => {\r\n            this.helper.setStyle(this.element, 'height', this.getElementHeight(this.#targets[this.#currentIdx]))\r\n        })\r\n        this.startTask();\r\n    }\r\n\r\n    onDestroy(): void {\r\n        this.#task.stop();\r\n        this.detachEvent(EVENTS.SWITCH, this.#switchEventId)\r\n    }\r\n\r\n    onMutation(record: CuiChildMutation): void {\r\n        this.getTargets();\r\n        this.mutate(() => {\r\n            this.helper.setStyle(this.element, 'height', this.getElementHeight(this.#targets[this.#currentIdx]))\r\n        })\r\n\r\n    }\r\n\r\n    async switch(index: any): Promise<boolean> {\r\n        if (this.isLocked) {\r\n            return false;\r\n        }\r\n        this.getSwitches();\r\n        this.getActiveIndex();\r\n        let nextIdx = calculateNextIndex(index, this.#currentIdx, this.#targets.length);\r\n        if (!this.args.loop && ((index === \"next\" && nextIdx === 0) || (index === 'prev' && this.#currentIdx === 0))) {\r\n            this.logInfo(\"Switch blocked by loop settings\", \"switch\");\r\n            return false;\r\n        }\r\n        if (nextIdx == this.#currentIdx || nextIdx < 0 || nextIdx >= this.#targets.length) {\r\n            this.logWarning(`Index ${index} is not within the suitable range`, \"switch\");\r\n            return false;\r\n        }\r\n        this.isLocked = true;\r\n        this.setSwitchesActive(nextIdx);\r\n        let nextItem = this.#targets[nextIdx];\r\n        await this.actionsHelper.performSwitchAction(nextItem,\r\n            this.#currentIdx > -1 ? this.#targets[this.#currentIdx] : null,\r\n            this.#actionsIn,\r\n            this.#actionsOut,\r\n            () => {\r\n                // Set next element active\r\n                nextItem.classList.add(this.activeClassName);\r\n                // Remove active from current element (if current exists)\r\n                if (this.#currentIdx > -1)\r\n                    this.#targets[this.#currentIdx].classList.remove(this.activeClassName);\r\n                // Update linked items\r\n                this.setLinkActive(this.#currentIdx, nextIdx);\r\n                // Update element height - it must be done a parent get height based on current child\r\n                this.helper.setStyle(this.element, 'height', this.getElementHeight(nextItem))\r\n                this.startTask();\r\n                this.isLocked = false;\r\n            },\r\n            this.args.timeout,\r\n        )\r\n        this.emitEvent(EVENTS.SWITCHED, {\r\n            timestamp: Date.now(),\r\n            index: nextIdx\r\n        })\r\n        return true;\r\n    }\r\n\r\n\r\n    private onPushSwitch(index: string) {\r\n        this.switch(index);\r\n    }\r\n\r\n    private getActiveIndex(): void {\r\n        this.#currentIdx = is(this.#targets) ? this.#targets.findIndex(target => this.helper.hasClass(this.activeClassName, target)) : -1;\r\n    }\r\n\r\n    private getElementHeight(current: Element): string {\r\n        if (!is(this.args.height) || this.args.height === 'auto') {\r\n            return getChildrenHeight(current) + \"px\";\r\n        } else {\r\n            return this.args.height;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Gets attributes value and prepares properties\r\n     */\r\n    private parseArguments() {\r\n        this.#actionsIn = CuiActionsListFactory.get(this.args.in);\r\n        this.#actionsOut = CuiActionsListFactory.get(this.args.out);\r\n        this.#links = is(this.args.links) ? [...document.querySelectorAll(this.args.links)] : []\r\n    }\r\n\r\n    /**\r\n     * Query target elements\r\n     */\r\n    private getTargets() {\r\n        let t = this.element.querySelectorAll(this.args.targets);\r\n        this.#targets = t.length > 0 ? [...t] : [];\r\n    }\r\n\r\n    private getSwitches() {\r\n        let switches = is(this.args.switch) ? document.querySelectorAll(this.args.switch) : null;\r\n        this.#switches = [];\r\n        if (switches) {\r\n            switches.forEach(sw => {\r\n                this.#switches.push(<CuiElement>(sw as any))\r\n            })\r\n        }\r\n    }\r\n\r\n    private setLinkActive(current: number, next: number) {\r\n        if (!is(this.#links)) {\r\n            return\r\n        }\r\n        if (isInRange(current, 0, this.#links.length - 1)) {\r\n            this.helper.removeClass(this.activeClassName, this.#links[current])\r\n        }\r\n        if (isInRange(next, 0, this.#links.length - 1)) {\r\n            this.helper.setClass(this.activeClassName, this.#links[next])\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Sets propers active state on attached switches\r\n     * @param index \r\n     */\r\n\r\n    private setSwitchesActive(index: number) {\r\n        this.#switches.forEach(sw => {\r\n            this.emitLinkSwitch(sw.$cuid, index)\r\n        })\r\n    }\r\n\r\n    /**\r\n     * Emits push event to attached switch to set proper index\r\n     * @param id - cuid of element\r\n     * @param index - index to be set on element\r\n     */\r\n    private emitLinkSwitch(id: string | null, index: number) {\r\n        if (is(id))\r\n            this.utils.bus.emit(EVENTS.SWITCH, id, index);\r\n    }\r\n\r\n    /**\r\n     * Runs task if arguments setup allows for it - auto flag must be set to true \r\n     */\r\n    private startTask() {\r\n        this.#task.stop();\r\n        if (this.args.autoTimeout) {\r\n            this.#task.start();\r\n        }\r\n    }\r\n\r\n}","import { ICuiComponent, ICuiComponentHandler, ICuiParsable, CuiElement } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiHandlerBase } from \"../../core/handlers/base\";\r\nimport { getChildSelectorFromScoped, is } from \"../../core/utils/functions\";\r\nimport { EVENTS } from \"../../core/utils/statics\";\r\nimport { CuiAutoParseArgs } from \"../../core/utils/arguments\";\r\nimport { CuiClickableArgs } from \"src/core/models/arguments\";\r\nimport { CuiClickModule } from \"../modules/click/click\";\r\n\r\nconst SWITCHER_LIST_ITEM_SELECTOR = \"li > a\";\r\n\r\nexport class CuiSwitcherArgs extends CuiAutoParseArgs implements CuiClickableArgs {\r\n\r\n    target: string;\r\n    index: string;\r\n    prevent: boolean;\r\n    stopPropagation: boolean;\r\n    targets: string;\r\n    isList: boolean;\r\n\r\n    constructor() {\r\n        super();\r\n        this.index = \"\";\r\n        this.target = \"\";\r\n        this.prevent = false;\r\n        this.stopPropagation = false;\r\n        this.targets = SWITCHER_LIST_ITEM_SELECTOR;\r\n        this.isList = false;\r\n    }\r\n}\r\n\r\nexport class CuiSwitcherComponent implements ICuiComponent {\r\n    attribute: string;\r\n    constructor(prefix?: string) {\r\n        this.attribute = `${prefix ?? 'cui'}-switcher`;\r\n    }\r\n\r\n    getStyle(): string | null {\r\n        return null;\r\n    }\r\n\r\n    get(element: HTMLElement, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiSwitcherHandler(element, utils, this.attribute);\r\n    }\r\n}\r\n\r\nexport class CuiSwitcherHandler extends CuiHandlerBase<CuiSwitcherArgs>  {\r\n\r\n    constructor(element: HTMLElement, utils: CuiUtils, attribute: string) {\r\n        super(\"CuiSwitcherHandler\", element, attribute, new CuiSwitcherArgs(), utils);\r\n        this.onClickEvent = this.onClickEvent.bind(this);\r\n        this.addModule(new CuiClickModule(this.element, this.args, this.onClickEvent.bind(this)))\r\n    }\r\n\r\n    async onHandle(): Promise<boolean> {\r\n\r\n        return true;\r\n    }\r\n    async onRefresh(): Promise<boolean> {\r\n\r\n        return true;\r\n    }\r\n    async onRemove(): Promise<boolean> {\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Sets current switcher target value\r\n     * \r\n     */\r\n    getTargetCuid(): string | null {\r\n        let targetId = null;\r\n        if (!is(this.args.target)) {\r\n            targetId = null;\r\n        }\r\n\r\n        let target = <CuiElement>(document.querySelector(this.args.target) as any);\r\n        if (is(target)) {\r\n            targetId = target.$cuid;\r\n        }\r\n        return targetId\r\n    }\r\n\r\n    onClickEvent(ev: MouseEvent) {\r\n        const targetId = this.getTargetCuid();\r\n        if (!targetId) {\r\n            return;\r\n        }\r\n\r\n        if (this.args.isList || this.element.tagName === 'UL') {\r\n            this.handleListClick(ev, targetId)\r\n            return;\r\n        }\r\n        this.handleItemClick(ev, targetId);\r\n    }\r\n\r\n    handleItemClick(ev: MouseEvent, targetCuid: string) {\r\n        if (!this.args.index) {\r\n            this._log.warning(\"Switch cannot be performed since component doesn't specify index\")\r\n            return;\r\n        }\r\n        this.utils.bus.emit(EVENTS.SWITCH, targetCuid, this.args.index);\r\n    }\r\n\r\n    handleListClick(ev: MouseEvent, targetCuid: string) {\r\n        const currentSelector = getChildSelectorFromScoped(this.args.targets);\r\n        const target = ev.target as HTMLElement;\r\n        if (!target.matches(currentSelector)) {\r\n            return;\r\n        }\r\n        const switcherElements = [...this.element.querySelectorAll(this.args.targets)]\r\n        const targetIndex = switcherElements.findIndex(element => element === ev.target);\r\n        if (targetIndex < 0) {\r\n            return;\r\n        }\r\n\r\n        this.utils.bus.emit(EVENTS.SWITCH, targetCuid, targetIndex);\r\n    }\r\n}\r\n\r\n","import { ICuiComponent, ICuiComponentHandler } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiHandlerBase } from \"../../core/handlers/base\";\r\nimport { ICuiComponentAction, CuiActionsListFactory } from \"../../core/utils/actions\";\r\nimport { EVENTS } from \"../../core/utils/statics\";\r\nimport { CuiAutoParseArgs } from \"../../core/utils/arguments\";\r\nimport { CuiClickModule } from \"../modules/click/click\";\r\nimport { Mixin } from \"../../core/utils/mixins\";\r\nimport { CuiClickableArgs } from \"../../core/models/arguments\";\r\n\r\nexport class CuiToggleArgs extends CuiAutoParseArgs implements CuiClickableArgs {\r\n\r\n    target: string;\r\n    action: string;\r\n    prevent: boolean;\r\n    stopPropagation: boolean;\r\n\r\n    constructor() {\r\n        super({\r\n            main: \"action\"\r\n        });\r\n        this.action = \"\";\r\n        this.target = \"\";\r\n        this.prevent = false;\r\n        this.stopPropagation = false;\r\n    }\r\n\r\n}\r\n\r\nexport class CuiToggleComponent implements ICuiComponent {\r\n    attribute: string;\r\n    constructor(prefix?: string) {\r\n        this.attribute = `${prefix ?? \"cui\"}-toggle`;\r\n    }\r\n\r\n    getStyle(): string | null {\r\n        return null;\r\n    }\r\n\r\n    get(element: HTMLElement, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiToggleHandler(element, utils, this.attribute);\r\n    }\r\n}\r\n\r\nexport class CuiToggleHandler extends CuiHandlerBase<CuiToggleArgs> {\r\n\r\n    #target: Element;\r\n    #utils: CuiUtils;\r\n    #toggleEventId: string | null;\r\n    #actions: ICuiComponentAction[];\r\n    constructor(element: HTMLElement, utils: CuiUtils, attribute: string) {\r\n        super(\"CuiToggleHandler\", element, attribute, new CuiToggleArgs(), utils);\r\n        this.#target = this.element;\r\n        this.#utils = utils;\r\n        this.#toggleEventId = null;\r\n        this.#actions = [];\r\n        this.addModule(new CuiClickModule(element, this.args, this.onClick.bind(this)))\r\n    }\r\n\r\n    async onHandle(): Promise<boolean> {\r\n        this.#target = this.getTarget();\r\n        this.#actions = CuiActionsListFactory.get(this.args.action);\r\n        this.#toggleEventId = this.onEvent(EVENTS.TOGGLE, this.toggle.bind(this));\r\n        return true;\r\n    }\r\n    async onRefresh(): Promise<boolean> {\r\n        this.#target = this.getTarget();\r\n        this.#actions = CuiActionsListFactory.get(this.args.action);\r\n        return true;\r\n    }\r\n    async onRemove(): Promise<boolean> {\r\n        this.detachEvent(EVENTS.TOGGLE, this.#toggleEventId);\r\n        return true;\r\n    }\r\n\r\n    toggle() {\r\n        if (!this.#target) {\r\n            this.logError(\"Target in not provided\", \"toggle\");\r\n            return;\r\n        }\r\n        this.#actions.forEach(action => action.toggle(this.#target, this.#utils));\r\n        this.emitEvent(EVENTS.TOGGLED, {\r\n            action: this.args.action,\r\n            target: this.#target,\r\n            timestamp: Date.now()\r\n        })\r\n    }\r\n\r\n    onClick(ev: MouseEvent) {\r\n        this.toggle();\r\n    }\r\n\r\n    getTarget(): Element {\r\n        if (!this.args.target) {\r\n            return this.element;\r\n        }\r\n        return document.querySelector(this.args.target) ?? this.element;\r\n    }\r\n}","import { ElementBuilder } from \"../../core/builders/element\";\r\nimport { CuiHandlerBase } from \"../../core/handlers/base\";\r\nimport { CuiHoverEvent, CuiHoverListener } from \"../../core/listeners/hover\";\r\nimport { CuiBasePositionCalculator } from \"../../core/position/calculator\";\r\nimport { ICuiPositionCalculator } from \"../../core/position/interfaces\";\r\nimport { CuiTaskRunner, ICuiTask } from \"../../core/utils/task\";\r\nimport { ICuiComponent, ICuiComponentHandler } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { ICuiComponentAction, CuiActionsListFactory } from \"../../core/utils/actions\";\r\nimport { replacePrefix, is } from \"../../core/utils/functions\";\r\nimport { CuiAutoParseArgs } from \"../../core/utils/arguments\";\r\nimport { CuiHoverModule } from \"../modules/hover/hover\";\r\n\r\nconst TOOLTIP_ACTION = \".{prefix}-animation-tooltip-in\";\r\nconst TOOLTIP_DATA = \"{prefix}-tooltip-data\";\r\n\r\nexport class CuiTooltipArgs extends CuiAutoParseArgs {\r\n    content: string;\r\n    width: number;\r\n    pos: string;\r\n    margin: number;\r\n    action: string;\r\n    timeout: number;\r\n    constructor(prefix: string) {\r\n        super({\r\n            main: \"content\"\r\n        });\r\n        this.content = \"\";\r\n        this.width = 150;\r\n        this.margin = 8;\r\n        this.timeout = 2000;\r\n        this.pos = \"\";\r\n        this.action = replacePrefix(TOOLTIP_ACTION, prefix);\r\n    }\r\n}\r\n\r\nexport class CuiTooltipComponent implements ICuiComponent {\r\n    attribute: string;\r\n    #prefix: string;\r\n\r\n    constructor(prefix?: string) {\r\n        this.#prefix = prefix ?? 'cui';\r\n        this.attribute = `${this.#prefix}-tooltip`;\r\n    }\r\n\r\n\r\n    getStyle(): string | null {\r\n        return null;\r\n    }\r\n\r\n    get(element: HTMLElement, sutils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiTooltipHandler(element, this.attribute, sutils, this.#prefix);\r\n    }\r\n}\r\n\r\nexport class CuiTooltipHandler extends CuiHandlerBase<CuiTooltipArgs> {\r\n\r\n    #tooltip: HTMLElement | undefined;\r\n    #margin: number;\r\n    #positionCalculator: ICuiPositionCalculator;\r\n    #tooltipDataCls: string;\r\n    #actions: ICuiComponentAction[];\r\n    #task: ICuiTask;\r\n    constructor(element: HTMLElement, attribute: string, utils: CuiUtils, prefix: string) {\r\n        super(\"CuiTooltipHandler\", element, attribute, new CuiTooltipArgs(prefix), utils);\r\n        this.#tooltip = undefined;\r\n        this.#actions = [];\r\n\r\n        this.#tooltipDataCls = replacePrefix(TOOLTIP_DATA, prefix);\r\n        this.#margin = 8;\r\n        this.#positionCalculator = new CuiBasePositionCalculator();\r\n        this.#positionCalculator.setPreferred(\"top-center\");\r\n        this.#task = new CuiTaskRunner(this.args.timeout, false, this.removeTooltip.bind(this));\r\n        this.addModule(new CuiHoverModule(this.element, this.onHover.bind(this)));\r\n    }\r\n\r\n    async onHandle(): Promise<boolean> {\r\n        this.getDataFromArgs();\r\n        this.#task.setTimeout(this.args.timeout);\r\n        return true;\r\n    }\r\n\r\n    async onRefresh(): Promise<boolean> {\r\n        this.getDataFromArgs();\r\n        this.#task.setTimeout(this.args.timeout);\r\n        return true;\r\n    }\r\n\r\n    async onRemove(): Promise<boolean> {\r\n        this.removeTooltip();\r\n        return true;\r\n    }\r\n\r\n    private onHover(ev: CuiHoverEvent) {\r\n        if (ev.isHovering) {\r\n            this.createTooltip();\r\n        } else {\r\n            this.removeTooltip();\r\n        }\r\n    }\r\n\r\n    private createTooltip() {\r\n        if (is(this.#tooltip) || !is(this.args.content)) {\r\n            return;\r\n        }\r\n        const box = this.element.getBoundingClientRect();\r\n        this.#tooltip = new ElementBuilder(\"div\").setClasses(this.#tooltipDataCls).build();\r\n        this.#tooltip.textContent = this.args.content;\r\n        this.#tooltip.style.maxWidth = `${this.args.width}px`;\r\n        document.body.appendChild(this.#tooltip);\r\n        this.mutate(() => {\r\n            if (!this.#tooltip) {\r\n                return;\r\n            }\r\n            const toolbox = this.#tooltip.getBoundingClientRect();\r\n            this.#positionCalculator.setMargin(this.#margin);\r\n            try {\r\n                let [x, y] = this.#positionCalculator.calculate(box, toolbox);\r\n                this.#tooltip.style.top = `${y}px`;\r\n                this.#tooltip.style.left = `${x}px`;\r\n                this.toggleActions();\r\n                this.#task.start();\r\n            } catch (e) {\r\n                this.logError(e.message, \"createTooltip\", e);\r\n            }\r\n\r\n        })\r\n    }\r\n\r\n    private removeTooltip() {\r\n        this.#task.stop();\r\n        if (!is(this.#tooltip)) {\r\n            return\r\n        }\r\n        this.mutate(() => {\r\n            //@ts-ignore already checked\r\n            this.#tooltip.remove();\r\n            this.#tooltip = undefined;\r\n        })\r\n    }\r\n\r\n    private getDataFromArgs() {\r\n        this.#positionCalculator.setMargin(this.args.margin);\r\n        this.#positionCalculator.setStatic(this.args.pos);\r\n        this.#actions = CuiActionsListFactory.get(this.args.action);\r\n    }\r\n\r\n    private toggleActions() {\r\n        if (!this.#tooltip) {\r\n            return;\r\n        }\r\n        this.#actions.forEach(action => {\r\n            // @ts-ignore\r\n            action.toggle(this.#tooltip);\r\n        })\r\n    }\r\n}","import { CuiInit } from './app/init';\r\n\r\nexport const CUI_LIGHT_VERSION = \"0.4.3\";\r\n\r\ndeclare global {\r\n    interface Window {\r\n        cuiInit: CuiInit;\r\n    }\r\n}\r\n\r\nexport { CuiInstance } from './app/instance';\r\nwindow.cuiInit = new CuiInit();","import { ICuiPlugin, ICuiComponent } from \"../core/models/interfaces\";\r\nimport { is } from \"../core/utils/functions\";\r\nimport { CuiInitData, CuiInitializer } from \"./initializer\";\r\nimport { GetPlugins } from \"../plugins/module\"\r\nimport { GetComponents } from \"../components/module\";\r\n\r\n\r\nexport class CuiInit {\r\n    #isInitialized: boolean;\r\n    constructor() {\r\n        this.#isInitialized = false;\r\n    }\r\n\r\n    async init(data: CuiInitData): Promise<boolean> {\r\n        if (this.#isInitialized) {\r\n            console.log(\"Module is already initialized\")\r\n            return false;\r\n        }\r\n        const initializer = new CuiInitializer();\r\n        let pluginList: ICuiPlugin[] = []\r\n        try {\r\n\r\n            pluginList = GetPlugins({\r\n                autoLight: true,\r\n                autoPrint: true\r\n            });\r\n        } catch (e) {\r\n            console.error(\"An error occured during download plugin module\");\r\n            console.error(e);\r\n            return false;\r\n        }\r\n\r\n        let componentList: ICuiComponent[] = []\r\n        try {\r\n\r\n            componentList = GetComponents({\r\n                prefix: data.setup?.prefix\r\n            })\r\n        } catch (e) {\r\n            console.error(\"An error occured during download components module\");\r\n            console.error(e);\r\n            return false;\r\n        }\r\n\r\n        let appPlugins = pluginList;\r\n        if (data.plugins) {\r\n            appPlugins = { ...pluginList, ...data.plugins }\r\n        }\r\n        let result = await initializer.init({\r\n            ...data,\r\n            plugins: appPlugins,\r\n            // @ts-ignore already checked\r\n            components: is(data.components) ? [...componentList, ...data.components] : componentList,\r\n        })\r\n        if (result.result) {\r\n            this.#isInitialized = true;\r\n            return true;\r\n        } else {\r\n            console.error(`A cUI instance failed to initialize: [${result.message ?? \"#\"}]`);\r\n        }\r\n        console.log(\"Cui Light failed to init\")\r\n        return false;\r\n\r\n    }\r\n}","import { ICuiPlugin } from \"../core/models/interfaces\";\r\nimport { CuiAlertsPlugin } from \"./alert/alert\";\r\nimport { CuiWindowClickPlugin } from \"./click/click\";\r\nimport { CuiLightFocusPlugin, ICuiLightFocusPluginSetup } from \"./focus/focus\";\r\nimport { CuiKeysObserverPlugin } from \"./keys/keys\";\r\nimport { CuiAutoLightModePlugin } from \"./light/light\";\r\nimport { CuiMoveObserverPlugin } from \"./move/move\";\r\nimport { CuiNotificationPlugin } from \"./notification/notification\";\r\nimport { CuiAutoPrintModePlugin } from \"./print/print\";\r\n//import { CuiCSSVariablesPlugin } from \"./properties/properties\";\r\nimport { CuiResizeObserverPlugin } from \"./resize/resize\";\r\nimport { CuiToastPlugin } from \"./toast/toast\";\r\n\r\nexport interface CuiPluginsInit {\r\n    autoLight: boolean;\r\n    autoPrint: boolean;\r\n    notifcationTimeout?: number;\r\n    focusSetup?: ICuiLightFocusPluginSetup;\r\n}\r\n\r\nexport function GetPlugins(init: CuiPluginsInit): ICuiPlugin[] {\r\n    let light: boolean = init ? init.autoLight : true;\r\n    let print: boolean = init ? init.autoPrint : true;\r\n    return [\r\n        new CuiAutoLightModePlugin({ autoLight: light }),\r\n        new CuiAutoPrintModePlugin({ autoPrint: print }),\r\n        new CuiKeysObserverPlugin({}),\r\n        new CuiWindowClickPlugin(),\r\n        //  new CuiCSSVariablesPlugin({}),\r\n        new CuiMoveObserverPlugin(),\r\n        new CuiResizeObserverPlugin({}),\r\n        new CuiToastPlugin({}),\r\n        new CuiAlertsPlugin(),\r\n        new CuiNotificationPlugin({ timeout: init.notifcationTimeout }),\r\n        new CuiLightFocusPlugin(init.focusSetup ?? {})\r\n\r\n    ]\r\n}","import { ICuiComponent } from \"../core/models/interfaces\";\r\nimport { CuiAccordionComponent } from \"./accordion/accordion\";\r\nimport { CuiBanerComponent } from \"./banner/banner\";\r\nimport { CuiCircleComponent } from \"./circle/circle\";\r\nimport { CuiCloseComponent } from \"./close/close\";\r\nimport { CuiCoverComponent } from \"./cover/cover\";\r\nimport { CuiDialogComponent } from \"./dialog/dialog\";\r\nimport { CuiDropComponenet } from \"./drop/drop\";\r\nimport { CuiFloatComponent } from \"./float/float\";\r\nimport { CuiIconComponent } from \"./icon/icon\";\r\n//import { CuiIntersectionComponent } from \"./intersection/intersection\";\r\nimport { CuiOffCanvasComponent } from \"./offcanvas/offcanvas\";\r\nimport { CuiOffsetComponent } from \"./offset/offset\";\r\nimport { CuiOpenComponent } from \"./open/open\";\r\nimport { CuiParallaxComponent } from \"./parallax/parallax\";\r\nimport { CuiResizeComponent } from \"./resize/resize\";\r\nimport { CuiScrollComponent } from \"./scroll/scroll\";\r\nimport { CuiScrollspyComponent } from \"./scrollspy/scrollspy\";\r\nimport { CuiSortableComponent } from \"./sortable/sortable\";\r\nimport { CuiSpinnerComponent } from \"./spinner/spinner\";\r\nimport { CuiSliderComponent } from \"./switch/slider\";\r\nimport { CuiSwitchComponent } from \"./switch/switch\";\r\nimport { CuiSwitcherComponent } from \"./switch/switcher\";\r\nimport { CuiToggleComponent } from \"./toggle/toggle\";\r\nimport { CuiTooltipComponent } from \"./tooltip/tooltip\";\r\n\r\nexport interface ComponentsModuleAttributes {\r\n    prefix?: string;\r\n}\r\n\r\n\r\n/**\r\n * Function that initializes and returns all components available in package\r\n * @param attributes - object holding data needed for components initialization\r\n */\r\nexport function GetComponents(attributes: ComponentsModuleAttributes): ICuiComponent[] {\r\n    let prefix = attributes?.prefix;\r\n    return [\r\n        new CuiIconComponent(prefix),\r\n        new CuiTooltipComponent(prefix),\r\n        new CuiCircleComponent(prefix),\r\n        new CuiSpinnerComponent(prefix),\r\n        new CuiScrollComponent(prefix),\r\n        new CuiScrollspyComponent(prefix),\r\n        //new CuiIntersectionComponent(prefix),\r\n        new CuiOpenComponent(prefix),\r\n        new CuiCloseComponent(prefix),\r\n        new CuiToggleComponent(prefix),\r\n        new CuiDialogComponent(prefix),\r\n        new CuiOffCanvasComponent(prefix),\r\n        new CuiAccordionComponent(prefix),\r\n        new CuiDropComponenet(prefix),\r\n        new CuiOffsetComponent(prefix),\r\n        new CuiSwitchComponent(prefix),\r\n        new CuiSwitcherComponent(prefix),\r\n        new CuiFloatComponent(prefix),\r\n        new CuiSliderComponent(prefix),\r\n        new CuiBanerComponent(prefix),\r\n        new CuiCoverComponent(prefix),\r\n        new CuiSortableComponent(prefix),\r\n        new CuiResizeComponent(prefix),\r\n        new CuiParallaxComponent(prefix)\r\n    ]\r\n}"],"sourceRoot":""}