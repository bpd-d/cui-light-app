{"version":3,"sources":["webpack://cui-light-app/webpack/universalModuleDefinition","webpack://cui-light-app/webpack/bootstrap","webpack://cui-light-app/./src/core/models/errors.ts","webpack://cui-light-app/./src/core/utils/statics.ts","webpack://cui-light-app/./src/core/utils/functions.ts","webpack://cui-light-app/./src/core/models/setup.ts","webpack://cui-light-app/./src/core/utils/logger.ts","webpack://cui-light-app/./src/core/factories/logger.ts","webpack://cui-light-app/./src/core/utils/api.ts","webpack://cui-light-app/./src/core/observers/mutations.ts","webpack://cui-light-app/./src/core/utils/interactions.ts","webpack://cui-light-app/./src/core/utils/dictionary.ts","webpack://cui-light-app/./src/core/managers/cache.ts","webpack://cui-light-app/./src/core/bus/handlers.ts","webpack://cui-light-app/./src/core/bus/executors.ts","webpack://cui-light-app/./src/core/bus/bus.ts","webpack://cui-light-app/./src/core/styles/appender.ts","webpack://cui-light-app/./src/core/handlers/colors.ts","webpack://cui-light-app/./src/core/managers/development.ts","webpack://cui-light-app/./src/core/models/utils.ts","webpack://cui-light-app/./src/core/factories/interactions.ts","webpack://cui-light-app/./src/core/helpers/helpers.ts","webpack://cui-light-app/./src/core/utils/actions.ts","webpack://cui-light-app/./src/app/managers/element.ts","webpack://cui-light-app/./src/app/helpers/collection.ts","webpack://cui-light-app/./src/app/managers/collection.ts","webpack://cui-light-app/./src/app/managers/plugins.ts","webpack://cui-light-app/./src/app/instance.ts","webpack://cui-light-app/./src/core/animation/definitions.ts","webpack://cui-light-app/./src/app/initializer.ts","webpack://cui-light-app/./src/core/utils/aria.ts","webpack://cui-light-app/./src/core/handlers/base.ts","webpack://cui-light-app/./src/components/accordion/accordion.ts","webpack://cui-light-app/./src/core/animation/animators.ts","webpack://cui-light-app/./src/core/animation/engine.ts","webpack://cui-light-app/./src/components/banner/banner.ts","webpack://cui-light-app/./src/core/builders/icon.ts","webpack://cui-light-app/./src/components/circle/circle.ts","webpack://cui-light-app/./src/components/close/close.ts","webpack://cui-light-app/./src/components/cover/cover.ts","webpack://cui-light-app/./src/components/dialog/dialog.ts","webpack://cui-light-app/./src/core/listeners/hover.ts","webpack://cui-light-app/./src/core/position/evaluator.ts","webpack://cui-light-app/./src/core/position/calculator.ts","webpack://cui-light-app/./src/core/utils/task.ts","webpack://cui-light-app/./src/components/drop/drop.ts","webpack://cui-light-app/./src/core/listeners/move.ts","webpack://cui-light-app/./src/components/float/helpers.ts","webpack://cui-light-app/./src/components/float/float.ts","webpack://cui-light-app/./src/components/icon/icon.ts","webpack://cui-light-app/./src/core/observers/intersection.ts","webpack://cui-light-app/./src/components/intersection/intersection.ts","webpack://cui-light-app/./src/components/offcanvas/offcanvas.ts","webpack://cui-light-app/./src/core/models/elements.ts","webpack://cui-light-app/./src/core/listeners/scroll.ts","webpack://cui-light-app/./src/components/offset/modes.ts","webpack://cui-light-app/./src/components/offset/offset.ts","webpack://cui-light-app/./src/components/open/open.ts","webpack://cui-light-app/./src/components/resize/resize.ts","webpack://cui-light-app/./src/components/scroll/scroll.ts","webpack://cui-light-app/./src/core/intersection/intersection.ts","webpack://cui-light-app/./src/components/scrollspy/mode.ts","webpack://cui-light-app/./src/components/scrollspy/scrollspy.ts","webpack://cui-light-app/./src/core/builders/element.ts","webpack://cui-light-app/./src/core/handlers/drag/detectors.ts","webpack://cui-light-app/./src/core/handlers/drag/drag.ts","webpack://cui-light-app/./src/components/sortable/sortable.ts","webpack://cui-light-app/./src/components/spinner/spinner.ts","webpack://cui-light-app/./src/components/switch/slider.ts","webpack://cui-light-app/./src/components/switch/switch.ts","webpack://cui-light-app/./src/components/switch/switcher.ts","webpack://cui-light-app/./src/components/toggle/toggle.ts","webpack://cui-light-app/./src/components/tooltip/tooltip.ts","webpack://cui-light-app/./src/plugins/alert/builder.ts","webpack://cui-light-app/./src/plugins/alert/handler.ts","webpack://cui-light-app/./src/plugins/alert/alert.ts","webpack://cui-light-app/./src/plugins/click/click.ts","webpack://cui-light-app/./src/plugins/focus/focus.ts","webpack://cui-light-app/./src/plugins/keys/listener.ts","webpack://cui-light-app/./src/plugins/keys/observer.ts","webpack://cui-light-app/./src/plugins/keys/keys.ts","webpack://cui-light-app/./src/core/listeners/media.ts","webpack://cui-light-app/./src/plugins/light/light.ts","webpack://cui-light-app/./src/plugins/move/observer.ts","webpack://cui-light-app/./src/plugins/move/move.ts","webpack://cui-light-app/./src/plugins/notification/builder.ts","webpack://cui-light-app/./src/plugins/notification/notification.ts","webpack://cui-light-app/./src/plugins/notification/helpers.ts","webpack://cui-light-app/./src/plugins/print/print.ts","webpack://cui-light-app/./src/core/models/colors.ts","webpack://cui-light-app/./src/plugins/properties/colors.ts","webpack://cui-light-app/./src/plugins/properties/setter.ts","webpack://cui-light-app/./src/plugins/properties/handler.ts","webpack://cui-light-app/./src/plugins/properties/properties.ts","webpack://cui-light-app/./src/plugins/resize/observer.ts","webpack://cui-light-app/./src/plugins/resize/resize.ts","webpack://cui-light-app/./src/plugins/toast/handler.ts","webpack://cui-light-app/./src/plugins/toast/toast.ts","webpack://cui-light-app/./src/index.ts","webpack://cui-light-app/./src/app/init.ts","webpack://cui-light-app/./src/plugins/module.ts","webpack://cui-light-app/./src/components/module.ts"],"names":["root","factory","exports","module","define","amd","window","installedModules","__webpack_require__","moduleId","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","ErrorBase","Error","message","super","setPrototypeOf","this","ItemNotFoundError","ArgumentError","CuiInstanceInitError","RegisterElementError","AnimatorError","CSSVariableError","CuiColorError","CuiPositionError","CLASSES","ICONS","close","accordion","special_menu","special_fail","special_success","CSS_APP_BACKGROUND_COLORS","CSS_COMPONENT_BACKGROUND_COLORS","CSS_COMPONENT_BORDER_COLORS","CSS_THEMES","light","base","muted","active","dark","accent","secondary","success","warning","error","CSS_VARIABLES","fontSize","lineHeight","animationTime","animationTimeLong","animationTimeShort","colorLightAppBackground","colorLightBackground","colorLightBorder","colorLightBase","colorLightActive","colorLightMuted","colorDarkAppBackground","colorDarkBackground","colorDarkBorder","colorDarkBase","colorDarkActive","colorDarkMuted","colorAccent","colorAccentActive","colorAccentMuted","colorAccentShade","colorAccentShadeDark","colorSecondary","colorSecondaryActive","colorSecondaryMuted","colorSecondaryShade","colorSecondaryShadeDark","colorWarning","colorWarningActive","colorWarningMuted","colorWarningShade","colorWarningShadeDark","colorSuccess","colorSuccessActive","colorSuccessMuted","colorSuccessShade","colorSuccessShadeDark","colorError","colorErrorActive","colorErrorMuted","colorErrorShade","colorErrorShadeDark","inputBackground","colorShade","colorShadeDarker","colorShadeLight","colorShadeLighter","outline","borderRadius","padding","margin","scrollbarWidth","componentSpace","accordionIcon","STATICS","logLevel","prefix","EVENTS","COMPONENTS_COUNTER","idx","counter","is","val","typecheck","length","Array","isArray","isEmpty","getName","sleep","timeout","Promise","resolve","setTimeout","getRangeValue","min","max","getRangeValueOrDefault","def","isNaN","joinAttributesForQuery","attributes","join","are","calcWindowSize2","width","size","parseAttributeString","attribute","ret","out","startsWith","endsWith","JSON","parse","jsonify","e","console","component","functionName","Date","toLocaleString","parseJsonString","trim","includes","split","forEach","sp","splitColon","tag","undefined","replace","getIntOrDefault","integer","parseInt","getStyleValue","target","currentStyle","getComputedStyle","getPropertyValue","isInRange","parseAttribute","element","getAttribute","isStringTrue","toLowerCase","boolStringOrDefault","prop","getStringOrDefault","isString","replacePrefix","getRandomInt","Math","ceil","floor","random","getParentCuiElement","parent","parentElement","$cuid","getChildrenHeight","height","from","children","child","getBoundingClientRect","enumerateObject","callback","calculateNextIndex","currentIndex","totalLength","text","shift","CuiSetup","autoLightMode","scrollThreshold","resizeThreshold","plugins","document","body","init","cacheSize","CuiSetupInit","app","interaction","busSetup","development","CuiLogger","level","id","log","prepString","warn","stack","start","now","getMatchingComponents","node","components","filter","hasAttribute","createCuiElement","utils","next","generateCUID","tagName","setAttribute","createComponent","destroyCuiElement","$handlers","destroyComponent","args","handler","handle","destroy","_log","subtree","childList","attributeFilter","debug","MutationObserver","mutationCallback","observe","disconnect","mutations","observer","mutation","type","item","attributeName","handeComponentUpdate","handleChildListMutation","onMutation","then","refresh","updateComponent","result","catch","exception","addedLen","addedNodes","removedLen","removedNodes","handleAddedNodes","handleRemovedNodes","nodes","handleAddedNode","hasChildNodes","querySelectorAll","handleAddedChildren","push","matchingComponents","handleDestroyChildren","CuiComponentMutationHandler","flag","unobserve","FastDom","requestAnimationFrame","ctx","createTask","schedule","tasks","task","recursion","flush","rec","writes","reads","run","SyncInteractions","isRunning","raf","x","add","throwOnEmptyKey","containsKey","index","indexOf","splice","maxSize","has","update","clean","remove","clear","keys","queue","isBusy","emitId","handleId","executor","events","cuid","perform","event","idMatches","execute","promises","all","CuiCallbackExecutor","emitHandler","cui","rand","rand2","generateRandomString","isAttached","getCuid","ev","callbacks","evId","evValue","setup","sort","first","second","priority","initBusInstance","mapEvents","eventsDef","on","detach","detachAll","emit","isSubscribing","detachByCuid","busName","handlerName","reduce","current","interactions","style","head","getElementsByTagName","createElement","createTextNode","appendChild","documentElement","setPropertyIn","toCssString","set","colors","baseColor","mutedColor","clone","lighten","activeColor","darken","mutate","setProperty","factor","propertyName","tool","checkAndCall","pushState","registerElement","unregisterElement","initialSetup","fromInit","errorReport","fastDom","onError","onInteractionError","cache","bus","styleAppender","classes","classList","contains","find","plugin","action","actions","inTarget","outTarget","inAction","outAction","onFinish","className","CuiInboundAction","setLightMode","setDarkMode","getLightMode","removeAttribute","el","DummyAction","substring","map","single","elements","fetch","attr","attributeValue","onClick","addEventListener","eventName","lock","unlock","delay","change","openClass","animationClass","performAction","closeClass","ids","cuiElement","disposeId","currentElement","nextElement","animIn","animOut","count","newIndex","animClassIn","animClassOut","duration","addAnimationClass","setFinalClasses","len","setElements","setToggle","check","newIdx","getCurrentIndex","verifyIndex","setCurrent","setCurrentWithAnimation","description","initElements","setComponents","setAttributes","setPlugins","stop","selector","querySelector","arg","data","cuiArg","argArr","addCuiArgument","SWIPE_ANIMATIONS_DEFINITIONS","left","transform","translateX","to","unit","right","previous","fade","opacity","settings","appPrefix","icons","icon","swipeAnimations","animation","AriaAttributes","label","cls","setClasses","removeClasses","componentName","isLocked","setId","activeClassName","helper","fName","actionsHelper","prevArgs","isInitialized","logInfo","logWarning","registerInDebug","onHandle","assign","pushDebugState","onRefresh","logError","onRemove","detachEmiitedEvents","removeFromDebug","CuiHandler","onInit","onUpdate","onDestroy","performActions","onEvent","openFromEvent","closeFromEvent","openAct","closeAct","detachEvent","checkLockAndWarn","isActive","escClose","keyClose","onKeyClose","onBeforeOpen","onActionFinish","onAfterOpen","setClass","setAria","onBeforeClose","onAfterClose","removeClass","open","emitEvent","timestamp","state","records","added","removed","items","content","CuiAccordionComponent","isValid","initTargets","onSwitch","queryItems","hasClass","removeClassesAs","closeAllExcept","setClassesAs","currentTarget","switch","setListener","listener","removeEventListener","rtl","abs","progress","createValue","props","cur","diff","buildSingle","build","cleanOnFinish","animators","animator","reportError","revert","animationProgress","shouldCalcRevert","animateAsync","initialProgress","pr","currProgress","callUpdate","endAnimation","reverted","shouldCleanOnFinish","setOnError","setElement","setAnimators","animate","swipe","CuiBanerComponent","setOnFinish","onSwipeFinish","onMove","preventDefault","absRatio","back","finish","newRatio","offsetWidth","setProps","svgString","scale","created","htmlString","template","innerHTML","createElementFromString","append","toString","iconSvg","svg","getTotalLength","readStyle","onSetProgress","strokeDashoffset","updateStyle","prevent","CuiCloseComponent","onClose","getTarget","finally","cuiId","removeActiveClass","removeActiveClassAsync","shouldEmit","emitClose","defTimeout","CuiCoverComponent","isPlugin","isAnyActive","pageYOffset","top","scrollTo","outClose","CuiDialogComponent","onWindowClick","container","onMouseMove","onMouseOut","onMouseOver","mouseEvent","force","invoke","isHovering","box","targetBox","getTopPosition","getBottomPosition","getMiddlePosition","getLeftPosition","getRightPosition","getCenterPosition","initial","innerHeight","number","getVerticalPosition","innerWidth","getHorizontalPosition","throwIfNotValid","method","validate","evaluator","setMargin","position","elementBox","setElementBox","setTarget","vertical","horizontal","outVNum","outVPos","getAutoVerticalPosition","outHNum","outHPos","getAutoHorizontalPosition","autoRenew","canRun","clearTimeout","trigger","autoClose","pos","CuiDropComponenet","setCallback","onElementHover","onTriggerClick","setPreferred","acquireTrigger","setTriggerEvent","setStatic","findAndCloseOpenedDrop","onOpen","toggleActions","y","calculate","attach","runAutoCloseTask","opened","onHoverEvent","toggle","onMouseDown","onMouseUp","onTouchStart","onTouchEnd","onTouchMove","passive","publishMouseEvent","publishTouchEvent","cancelable","clientX","clientY","moveX","movementX","moveY","movementY","touch","touches","changedTouches","BasePositionCalculator","diffX","diffY","BaseResizeCalculator","offsetLeft","offsetTop","CuiFloatComponent","move","resize","peform","newWidth","newHeight","fitsWindow","newX","newY","offsetHeight","CuiIconComponent","addIcon","iconStr","setScale","childNodes","insertBefore","iconElement","firstChild","CuiIntersectionObserver","threshold","IntersectionObserver","rootMargin","offset","isRoot","SCOPE_SELECTOR","parseFloat","CuiIntersectionComponent","parseArguments","onIntersection","connect","entries","entry","isIntersecting","intersectionRatio","addActions","removeActions","emitIntersection","getDefaultOpenClass","getDefaultCloseClass","CuiOffCanvasComponent","setPositionLeft","scrollY","CuiElementBoxFactory","Window","WindowElementBox","HTMLElement","HTMLElementBox","ElementBox","scrollHeight","scrollWidth","scrollTop","scrollLeft","pageXOffset","onScrollFinish","source","getScrollLeft","getScrollTop","passedThreshold","scrolling","CuiOffsetStaticMode","offsetX","offsetY","CuiOffsetDynamicMode","fitsOffsetY","fitsOffsetX","CuiOffsetComponent","onScroll","checkAndPerformActions","getRoot","matchesOffset","matches","act","callEvent","calcaRatio","exceededThreshold","matching","ratioX","ratioY","ratY","clientHeight","toFixed","clientWidth","CuiOpenComponent","activateTarget","setActiveClass","setActiveClassAsync","emitOpen","array","getFirstMatching","default","small","medium","large","xlarge","xl","CuiResizeComponent","isInViewport","setNewValue","updateElement","newValue","isSmartMode","getSmartValue","getValue","newAction","rect","bottom","behavior","setTargets","getOffsetTop","by","scrollBy","options","setThreshold","isInProgress","prepareCallbackResult","currentTop","currentBottom","childBottom","currentLeft","currentRight","childRight","parentBottom","getHeight","parentRight","getWidth","verticalRatio","calcChildVerticalRatio","horizontalRatio","calcChildHorizontalRatio","CuiScrollSpyModeHandlerFactory","ratio","forEachAction","links","linksActions","getMatching","last","changed","lastElement","intersecting","link","linkAction","CuiScrollspyComponent","updateAttributes","updateResult","targets","queryAll","setChildren","setParent","textContent","raw","found","isInBounds","cancelTimeout","CuiSortableComponent","sutils","onDragStart","onDragOver","onDragEnd","stopMovementPrep","getTargetsAndTrggers","setLongPressTimeout","getPressedElementIdx","startMovementPrep","getFinishAnimation","findIndex","createPreview","setPreviewPosition","setCurrentPosition","removePreview","detected","detect","insertElement","destination","spinner","onPause","removeIfAnyExisists","svgIcon","addSpinner","existing","autoTimeout","loop","CuiSliderComponent","onAnimationFinish","onPushSwitch","getTargets","getLinks","getActiveIndex","setLinkActive","setStyle","getElementHeight","startTask","record","nextIdx","adjustMoveRatio","errorOccured","in","CuiSwitchComponent","getSwitches","setSwitchesActive","nextItem","performSwitchAction","switches","sw","emitLinkSwitch","CuiSwitcherComponent","onClickEvent","setEvents","removeEvents","list","onListItemClick","CuiToggleComponent","CuiTooltipComponent","onHover","getDataFromArgs","removeTooltip","createTooltip","maxWidth","toolbox","reverse","title","headerBuilder","titleElement","getPrefixedString","appendChildrens","dialog","str","onYes","onNo","onCancel","onOk","closeStr","getElementById","dialogBuilder","createHeader","createBody","createFooter","onAlert","validateEvent","popup","show","CuiLightFocusPlugin","keybordClass","mouseClass","touchClass","onKeyDownEvent","onMouseEvent","onTouchEvent","getClass","prevCls","hasCls","hasPrevCls","singleEmit","onKeyDown","onKeyUp","code","keySetup","CuiMediaQueryListener","mediaQuery","matchMedia","autoLightInit","autoLight","onChange","autoLightSetup","gestures","onMoveLock","getGestureDiff","gesture","calculateGesture","pushGestureEvent","firstEvent","lastEvent","tresholdX","absDiffX","absDiffY","getGestureEventName","timespstamp","changeX","changeY","getNotification","parts","getHeader","NOTIFICATION_BODY_CLS","setRawChildren","setTextContent","getBody","NOTIFICATION_FOOTER_CLS","getActionsList","getFooter","NOTIFICATION_CLS","MARGIN_SMALL_VERTICAL","getClassByType","NOTIFICATION_TITLE_CLS","iconCloseElement","closeElement","ICON_CLS","NOTIFICATION_CLOSE_CLS","NOTIFICATION_HEADER_CLS","createCache","getOrCreateContainer","validateNotificationData","onNotificationClose","notificationEl","addNotificationToTree","timeoutId","auto","setAutoClose","NOTIFICATION_ANIMATION_IN","NOTIFICATION_ACTIVE_CLS","notifiactionElement","notification","fromTimeout","dissmissed","holder","NOTIFICATION_ANIMATION_OUT","autoPrintInit","autoPrint","setPrintMode","red","green","blue","alpha","colorStr","parser","res","amount","shade","percent","self","shadeSingle","round","alphaHex","baseColorSets","background","themeColors","shadeDark","CuiBaseColorsSetter","colorSet","setter","color","setColor","setProperties","CuiThemeColorsSetter","setBaseUnitValue","setAnimationTimeLong","setAnimationTimeShort","setCSSVariable","strVal","onCssChange","accentSetter","isArgNumber","setBaseFontSize","setBaseLineHeight","setAnimationTime","setBaseMargin","setBasePadding","setBaseBorderRadius","setComponentSpace","setScrollbarWidth","setAccordionIcon","setAppBackgroundColor","setDarkAppBackgroundColor","isArgColor","getBaseColorSetter","palette","setBackgroundColor","setBaseColor","setMutedColor","setActiveColor","getAccentColorSetter","setAutoColors","setShadeColor","setShadeDarkColor","pallete","getBaseColorsSetter","getDarkBaseColorsSetter","getAccentThemeColorsSetter","getSecondaryThemeColorsSetter","getErrorThemeColorsSetter","getWarningThemeColorsSetter","getSuccessThemeColorsSetter","resizeData","currentSize","pushUpdateToItems","toastElement","onToastShow","CUI_LIGHT_VERSION","cuiInit","initializer","pluginList","print","notifcationTimeout","focusSetup","GetPlugins","componentList","GetComponents","appPlugins"],"mappings":"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","file":"index.min.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"cui-light-app\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"cui-light-app\"] = factory();\n\telse\n\t\troot[\"cui-light-app\"] = factory();\n})(window, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","export class ErrorBase extends Error {\r\n    constructor(name: string, message?: string,) {\r\n        super(message);\r\n        Object.setPrototypeOf(this, new.target.prototype);\r\n        this.name = name;\r\n    }\r\n}\r\n\r\nexport class ItemNotFoundError extends ErrorBase {\r\n    constructor(message?: string) {\r\n        super(\"ItemNotFoundError\", message);\r\n    }\r\n}\r\n\r\nexport class ArgumentError extends ErrorBase {\r\n    constructor(message?: string) {\r\n        super(\"ArgumentError\", message);\r\n    }\r\n}\r\n\r\nexport class CuiBusError extends ErrorBase {\r\n    constructor(message?: string) {\r\n        super(\"ArgumentError\", message);\r\n    }\r\n}\r\n\r\nexport class CuiInstanceInitError extends ErrorBase {\r\n    constructor(message?: string) {\r\n        super(\"CuiInstanceInitError\", message);\r\n    }\r\n}\r\n\r\nexport class CuiScrollSpyOutOfRangeError extends ErrorBase {\r\n    constructor(message?: string) {\r\n        super(\"CuiScrollSpyOutOfRangeError\", message);\r\n    }\r\n}\r\n\r\n\r\nexport class RegisterElementError extends ErrorBase {\r\n    constructor(message?: string) {\r\n        super(\"RegisterElementError\", message);\r\n    }\r\n}\r\n\r\nexport class AnimatorError extends ErrorBase {\r\n    constructor(message?: string) {\r\n        super(\"AnimatorError\", message);\r\n    }\r\n}\r\n\r\nexport class CSSVariableError extends ErrorBase {\r\n    constructor(message?: string) {\r\n        super(\"CSSVariableError\", message);\r\n    }\r\n}\r\n\r\nexport class CuiColorError extends ErrorBase {\r\n    constructor(message?: string) {\r\n        super(\"CuiColorError\", message);\r\n    }\r\n}\r\n\r\nexport class CuiPositionError extends ErrorBase {\r\n    constructor(message?: string) {\r\n        super(\"CuiPositionError\", message);\r\n    }\r\n}","import { CuiLogLevel } from \"./types\";\r\nimport { CuiColorPair } from \"../models/colors\";\r\nimport { counter } from \"./functions\";\r\nexport const CUID_ATTRIBUTE = \"cuid\";\r\n\r\nexport const CLASSES = {\r\n    dark: 'dark',\r\n    animProgress: 'animation-progress',\r\n    print: 'print',\r\n    active: 'active',\r\n    swipingOn: \"swiping-on\",\r\n    selectionOff: \"selection-off\",\r\n}\r\n\r\nexport const ICONS: any = {\r\n    close: \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 20 20\\\" width=\\\"20\\\" height=\\\"20\\\"><path d=\\\"M 1.9999999,1.9999999 18,18\\\"></path><path d=\\\"M 18,1.9999999 1.9999999,18\\\"></path></svg>\",\r\n    accordion: \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 20 20\\\" width=\\\"20\\\" height=\\\"20\\\"><path d=\\\"M 5.0000475,7.4490018 10.000024,12.551028 15,7.4490018\\\"></path></svg>\",\r\n    special_menu: \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 20 20\\\" width=\\\"20\\\" height=\\\"20\\\"><path class=\\\"menu_handle_2\\\" d=\\\"M 1,10 H 19\\\"></path><path class=\\\"menu_handle_1\\\" d=\\\"M 1,4.8571429 H 19\\\"></path><path  class=\\\"menu_handle_3\\\" d=\\\"M 1,15.142857 H 19\\\"></path></svg>\",\r\n    special_fail: \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" class=\\\"special-fail\\\" viewBox=\\\"0 0 100 100\\\" width=\\\"100\\\" height=\\\"100\\\"><path class=\\\"circle\\\" d=\\\"M 50,7.000001 A 43,43 0 0 1 92.999999,50 43,43 0 0 1 50,92.999999 43,43 0 0 1 7.0000011,50 43,43 0 0 1 50,7.000001 Z\\\"></path><path class=\\\"arm_1\\\" d=\\\"M 28.536809,28.536809 71.342023,71.342023\\\"></path><path class=\\\"arm_2\\\" d=\\\"M 71.342023,28.536809 28.536809,71.342023\\\"></path></svg>\",\r\n    special_success: \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" class=\\\"special-success\\\" viewBox=\\\"0 0 100 100\\\" width=\\\"100\\\" height=\\\"100\\\"><path class=\\\"circle\\\" d=\\\"M 50,7 A 43,43 0 0 1 93,50 43,43 0 0 1 50,93 43,43 0 0 1 7,50 43,43 0 0 1 50,7 Z\\\"></path><path class=\\\"arm\\\" d=\\\"M 22.988405,48.234784 36.946233,72.410453 75.516456,33.84023\\\"></path></svg>\",\r\n};\r\n\r\nexport const COLORS = ['red', 'green', 'blue', 'alpha']\r\n\r\nexport const CSS_APP_BACKGROUND_COLORS: CuiColorPair = {\r\n    light: '--cui-color-light-app-background',\r\n    dark: '--cui-color-dark-app-background'\r\n}\r\n\r\nexport const CSS_COMPONENT_BACKGROUND_COLORS: CuiColorPair = {\r\n    light: '--cui-color-light-background',\r\n    dark: '--cui-color-dark-background '\r\n}\r\n\r\nexport const CSS_COMPONENT_BORDER_COLORS: CuiColorPair = {\r\n    light: '--cui-color-light-border',\r\n    dark: '--cui-color-dark-border'\r\n}\r\n\r\nexport const CSS_THEMES = {\r\n    light: {\r\n        base: '--cui-color-light-base',\r\n        muted: '--cui-color-light-muted',\r\n        active: '--cui-color-light-active'\r\n    },\r\n    dark: {\r\n        base: '--cui-color-dark-base',\r\n        muted: '--cui-color-dark-muted',\r\n        active: '--cui-color-dark-active'\r\n    },\r\n    accent: {\r\n        base: '--cui-color-primary',\r\n        muted: '--cui-color-primary-muted',\r\n        active: '--cui-color-primary-active'\r\n    },\r\n    secondary: {\r\n        base: '--cui-color-secondary',\r\n        muted: '--cui-color-secondary-muted',\r\n        active: '--cui-color-secondary-active'\r\n    },\r\n    success: {\r\n        base: '--cui-color-success',\r\n        muted: '--cui-color-success-muted',\r\n        active: '--cui-color-success-active'\r\n    },\r\n    warning: {\r\n        base: '--cui-color-warning',\r\n        muted: '--cui-color-warning-muted',\r\n        active: '--cui-color-warning-active'\r\n    },\r\n    error: {\r\n        base: '--cui-color-error',\r\n        muted: '--cui-color-error-muted',\r\n        active: '--cui-color-error-active'\r\n    }\r\n}\r\n\r\nexport const SCOPE_SELECTOR = \":scope \";\r\n\r\nexport const CSS_VARIABLES: any = {\r\n    fontSize: \"--{prefix}-font-size\",\r\n    lineHeight: \"--{prefix}-line-height\",\r\n    animationTime: \"--{prefix}-animation-time\",\r\n    animationTimeLong: \"--{prefix}-animation-time-long\",\r\n    animationTimeShort: \"--{prefix}-animation-time-short\",\r\n    colorLightAppBackground: \"--{prefix}-color-light-app-background\",\r\n    colorLightBackground: \"--{prefix}-color-light-background\",\r\n    colorLightBorder: \"--{prefix}-color-light-border\",\r\n    colorLightBase: \"--{prefix}-color-light-base\",\r\n    colorLightActive: \"--{prefix}-color-light-active\",\r\n    colorLightMuted: \"--{prefix}-color-light-muted\",\r\n    colorDarkAppBackground: \"--{prefix}-color-dark-app-background\",\r\n    colorDarkBackground: \"--{prefix}-color-dark-background\",\r\n    colorDarkBorder: \"--{prefix}-color-dark-border\",\r\n    colorDarkBase: \"--{prefix}-color-dark-base\",\r\n    colorDarkActive: \"--{prefix}-color-dark-active\",\r\n    colorDarkMuted: \"--{prefix}-color-dark-muted\",\r\n    colorAccent: \"--{prefix}-color-primary\",\r\n    colorAccentActive: \"--{prefix}-color-primary-active\",\r\n    colorAccentMuted: \"--{prefix}-color-primary-muted\",\r\n    colorAccentShade: \"--{prefix}-color-primary-shade\",\r\n    colorAccentShadeDark: \"--{prefix}-color-primary-shade-dark\",\r\n    colorSecondary: \"--{prefix}-color-secondary\",\r\n    colorSecondaryActive: \"--{prefix}-color-secondary-active\",\r\n    colorSecondaryMuted: \"--{prefix}-color-secondary-muted\",\r\n    colorSecondaryShade: \"--{prefix}-color-secondary-shade\",\r\n    colorSecondaryShadeDark: \"--{prefix}-color-secondary-shade-dark\",\r\n    colorWarning: \"--{prefix}-color-warning\",\r\n    colorWarningActive: \"--{prefix}-color-warning-active\",\r\n    colorWarningMuted: \"--{prefix}-color-warning-muted\",\r\n    colorWarningShade: \"--{prefix}-color-warning-shade\",\r\n    colorWarningShadeDark: \"--{prefix}-color-warning-shade-dark\",\r\n    colorSuccess: \"--{prefix}-color-success\",\r\n    colorSuccessActive: \"--{prefix}-color-success-active\",\r\n    colorSuccessMuted: \"--{prefix}-color-success-muted\",\r\n    colorSuccessShade: \"--{prefix}-color-success-shade\",\r\n    colorSuccessShadeDark: \"--{prefix}-color-success-shade-dark\",\r\n    colorError: \"--{prefix}-color-error\",\r\n    colorErrorActive: \"--{prefix}-color-error-active\",\r\n    colorErrorMuted: \"--{prefix}-color-error-muted\",\r\n    colorErrorShade: \"--{prefix}-color-error-shade\",\r\n    colorErrorShadeDark: \"--{prefix}-color-error-shade-dark\",\r\n    inputBackground: \"--{prefix}-input-background-color\",\r\n    colorShade: \"--{prefix}-color-shade\",\r\n    colorShadeDarker: \"--{prefix}-color-shade-darker\",\r\n    colorShadeLight: \"--{prefix}-color-shade-light\",\r\n    colorShadeLighter: \"--{prefix}-color-shade-light-lighter\",\r\n    outline: \"--{prefix}-outline\",\r\n    borderRadius: \"--{prefix}-border-radius\",\r\n    padding: \"--{prefix}-padding\",\r\n    margin: \"--{prefix}-margin\",\r\n    scrollbarWidth: \"--{prefix}-scrollbar-width\",\r\n    componentSpace: \"--{prefix}-component-space\",\r\n    accordionIcon: \"--{prefix}-accordion-icon\"\r\n}\r\n\r\n\r\nexport class STATICS {\r\n    static logLevel: CuiLogLevel = 'none';\r\n    static prefix: string = 'cui';\r\n}\r\n\r\nexport const EVENTS = {\r\n    INSTANCE_INITIALIZED: 'instance-initialized',\r\n    INSTANCE_FINISHED: 'instance-finished',\r\n    RESIZE: \"resize\",\r\n    OPEN: \"open\",\r\n    OPENED: \"opened\",\r\n    CLOSE: \"close\",\r\n    CLOSED: \"closed\",\r\n    TOGGLE: \"toggle\",\r\n    TOGGLED: 'toggled',\r\n    SWITCH: \"switch\",\r\n    SWITCHED: \"switched\",\r\n    ON_SCROLL: \"scroll\",\r\n    TARGET_CHANGE: 'targetchange',\r\n    INTERSECTION: 'intersection',\r\n    KEYDOWN: 'keydown',\r\n    SCROLLBY: 'scrollby',\r\n    WINDOW_CLICK: 'windowclick',\r\n    OFFSET: 'offset',\r\n    PROGRESS_CHANGE: \"progresschange\",\r\n    PROGRESS_CHANGED: \"progresschanged\",\r\n    CHANGE: \"change\",\r\n    CHANGED: \"changed\",\r\n    GLOBAL_MOVE: \"globalmove\",\r\n    MOVE_LOCK: \"movelock\",\r\n    PAUSE: \"pause\",\r\n    PAUSED: \"paused\",\r\n    SORTED: \"sorted\",\r\n    SORT_START: \"sortstart\",\r\n    TOAST: \"toast\",\r\n    TOAST_SHOW: \"toastshow\",\r\n    TOAST_HIDDEN: \"toasthidden\",\r\n    ALERT: \"alert\",\r\n    GESTURE_DOWN: \"gesture-down\",\r\n    GESTURE_UP: \"gesture-up\",\r\n    GESTURE_LEFT: \"gesture-left\",\r\n    GESTURE_RIGHT: \"gesture-right\",\r\n    NOTIFY: \"notify\",\r\n    NOTIFIED: \"notified\",\r\n}\r\n\r\n// export const GLOBAL_EVENTS = [EVENTS.ALERT, EVENTS.TOAST, EVENTS.KEYDOWN, EVENTS.MOVE_LOCK, EVENTS.GLOBAL_MOVE, EVENTS.RESIZE]\r\n\r\nexport const OBSERVABLE_SCROLL = \"SCROLL\";\r\nexport const OBSERVABLE_INTERSECTION = \"INTERSECTION\";\r\nexport const COMPONENTS_COUNTER = counter();","import { CuiLightMode, CuiWindowSize } from \"./types\";\r\nimport { ArgumentError } from \"../models/errors\";\r\nimport { CuiElement } from \"../models/interfaces\";\r\nimport { COMPONENTS_COUNTER } from \"./statics\";\r\n\r\n/**\r\n * Checks if value is defined an is not null\r\n * Additionally with type check it can check value if it is not empty string or collection or object\r\n * \r\n * @param val - value\r\n * @param typecheck - default true - additional check whether value is not empty (string, collection, object)\r\n * @returns whether value passed all conditions\r\n */\r\nexport function is(val: any, typecheck: boolean = true): boolean {\r\n    if (typeof val !== 'undefined' && val !== null) {\r\n        if (!typecheck) {\r\n            return true;\r\n        } else {\r\n            return !isEmpty(val)\r\n        }\r\n    }\r\n    return false;\r\n}\r\n\r\n/**\r\n * Checks if value is empty string, array or object\r\n *\r\n *\r\n * @param val - value\r\n * @returns whether value passed all conditions\r\n */\r\nexport function isEmpty(val: any): boolean {\r\n    if (typeof val === \"string\") {\r\n        return val.length === 0\r\n    }\r\n    if (typeof val === \"boolean\") {\r\n        return val;\r\n    }\r\n    else if (Array.isArray(val)) {\r\n        return val.length === 0\r\n    }\r\n    return false\r\n}\r\n\r\nexport function getName(prefix: string, name: string) {\r\n    if (!is(prefix) || !is(name)) {\r\n        throw new ArgumentError(\"Missing argument value\")\r\n    }\r\n    return `${prefix}-${name}`\r\n}\r\n\r\nexport function sleep(timeout: number): Promise<boolean> {\r\n    return new Promise(resolve => setTimeout(() => {\r\n        resolve(true)\r\n    }, timeout));\r\n}\r\n\r\n/**\r\n * Creates proper html element from given string\r\n * @param htmlString - string containing html\r\n */\r\nexport function createElementFromString(htmlString: string): Element | null {\r\n    if (!is(htmlString)) {\r\n        return null;\r\n    }\r\n    let template = document.createElement('template')\r\n    template.innerHTML = htmlString\r\n    return template.content.children.length > 0 ? template.content.children[0] : null;\r\n}\r\n\r\nexport function getMatchingAttribute(element: any, attributes: string[]): string | null {\r\n    let attr = null;\r\n    let len = attributes.length;\r\n    for (let i = 0; i < len; i++) {\r\n        let attribute = attributes[i];\r\n        if (element.hasAttribute(attribute)) {\r\n            attr = attribute\r\n            break;\r\n        }\r\n    }\r\n    return attr;\r\n}\r\n\r\n// export function getMatchingAttributes(element: any, attributes: string[]): string[] {\r\n//     if (!element || !is(element.hasAttribute)) {\r\n//         return [];\r\n//     }\r\n//     return attributes.filter(a => {\r\n//         return element.hasAttribute(a);\r\n//     });\r\n// }\r\n\r\nexport function getRangeValue(value: number, min: number, max: number) {\r\n    if (value < min) {\r\n        return min;\r\n    } else if (value > max) {\r\n        return max;\r\n    }\r\n    return value;\r\n}\r\n\r\nexport function getRangeValueOrDefault(value: number | undefined, min: number, max: number, def: number) {\r\n    if (value === null || typeof value === 'undefined' || isNaN(value)) {\r\n        return def;\r\n    }\r\n    return getRangeValue(value, min, max)\r\n}\r\n\r\nexport function increaseValue(value: number, amount: number): number {\r\n    return amount < 0 || amount > 1 ? 0 : value + (value * amount);\r\n}\r\n\r\nexport function decreaseValue(value: number, amount: number): number {\r\n    return amount < 0 || amount > 1 ? 0 : value - (value * amount);\r\n}\r\n\r\nexport function clone(object: any): any {\r\n    if (!is(object)) {\r\n        return null;\r\n    }\r\n    return Object.assign({}, object);\r\n}\r\n\r\nexport function getSingleColorRatio(first: number, second: number, max: number): number {\r\n    return Math.abs(((first - second) / max) * 100)\r\n}\r\n\r\n/**\r\n * Creates string containg css selector for array of attributes\r\n * @param attributes - attributes values\r\n */\r\nexport function joinAttributesForQuery(attributes: string[]): string {\r\n    if (!is(attributes)) {\r\n        return \"\"\r\n    }\r\n    return `[${attributes.join('],[')}]`\r\n}\r\n\r\n/**\r\n * Checks light system light mode\r\n * @returns Light Mode - dark/light\r\n */\r\nexport function getSystemLightMode(): CuiLightMode {\r\n    return window.matchMedia &&\r\n        window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';\r\n}\r\n\r\n/**\r\n * Check print mode in the browser window\r\n * @returns true if window is displayed in print mode\r\n */\r\nexport function getSystemPrintMode(): boolean {\r\n    return window.matchMedia &&\r\n        window.matchMedia('print').matches;\r\n}\r\n\r\n/**\r\n * Verifies whether attributes exist and have some values\r\n * @param attributes attributes list\r\n */\r\nexport function are(...attributes: any[]): boolean {\r\n    if (!is(attributes)) {\r\n        return false\r\n    }\r\n    let c = attributes.length;\r\n    for (let i = 0; i < c; i++) {\r\n        if (!is(attributes[i])) {\r\n            return false;\r\n        }\r\n    }\r\n    return true;\r\n}\r\n\r\nexport function calcWindowSize(width: number): CuiWindowSize {\r\n    if (width <= 640) {\r\n        return 'small';\r\n    } else if (width > 640 && width <= 960) {\r\n        return \"medium\"\r\n    } else if (width > 960 && width <= 1200) {\r\n        return \"large\"\r\n    }\r\n    return 'xlarge';\r\n}\r\n\r\nexport function calcWindowSize2(width: number): CuiWindowSize {\r\n    let size: CuiWindowSize = \"none\";\r\n    if (width >= 640) {\r\n        size = 'small';\r\n    }\r\n    if (width >= 960) {\r\n        size = \"medium\";\r\n    }\r\n    if (width >= 1200) {\r\n        size = \"large\"\r\n    }\r\n\r\n    if (width >= 1600) {\r\n        size = 'xlarge';\r\n    }\r\n    return size;\r\n}\r\n\r\n/**\r\n * Creates object from string.\r\n * Supported syntaxes are:\r\n * - JSON\r\n * - single value\r\n * - key:value,value;key=value\r\n * \r\n * @param attribute - attribute value\r\n */\r\nexport function parseAttributeString(attribute: string | null): any {\r\n    let ret: any = {};\r\n    if (!is(attribute)) {\r\n        return ret;\r\n    }\r\n    //@ts-ignore - null already checked\r\n    ret = parseJsonString(attribute.trim())\r\n    if (!is(ret)) {\r\n        //@ts-ignore - null already checked\r\n        if (!attribute.includes(';') && !attribute.includes(':')) {\r\n            ret = attribute;\r\n        } else {\r\n            ret = {}\r\n            //@ts-ignore - null already checked\r\n            attribute.split(';').forEach(val => {\r\n                let sp = splitColon(val);\r\n                let tag = undefined;\r\n                let value = \"\";\r\n                if (sp.length < 2) {\r\n                    return;\r\n                }\r\n                tag = sp[0].trim();\r\n                value = sp[1].trim();\r\n                if (tag)\r\n                    ret[tag] = value.replace('U+0003B', ';');\r\n            })\r\n        }\r\n    }\r\n    return ret\r\n}\r\n\r\n/**\r\n * Creates object from JSON string\r\n* String must start with { and end with }\r\n *\r\n * @param attribute - attribute value\r\n * @returns object if string passes test, null otherwise\r\n */\r\n\r\nexport function parseJsonString(attribute: string): any | null {\r\n    let out = null;\r\n    if (is(attribute) && attribute.startsWith('{') && attribute.endsWith('}')) {\r\n        try {\r\n            out = jsonify(attribute);\r\n        } catch (e) {\r\n            console.error(prepLogString(\"An exception occured\", 'Functions', 'parseJsonString'), e)\r\n        }\r\n        return out;\r\n    }\r\n    return null;\r\n}\r\n\r\n/**\r\n * Creates object from JSON string\r\n * @param attribute - JSON string\r\n */\r\nexport function jsonify(attribute: string): any {\r\n    return attribute && attribute.length > 0 ? JSON.parse(attribute) : {}\r\n}\r\n\r\nexport function getOffsetTop(element: HTMLElement) {\r\n    if (!is(element)) {\r\n        return -1;\r\n    }\r\n    let val = element.offsetTop - parseInt(getStyleValue(element, 'margin-top')) - parseInt(getStyleValue(element, 'padding-top')) - parseInt(getStyleValue(element, 'border-top-width'))\r\n    return val < 0 ? element.offsetTop : val;\r\n}\r\n\r\nexport function getOffsetLeft(element: HTMLElement) {\r\n    if (!is(element)) {\r\n        return -1;\r\n    }\r\n    let val = element.offsetLeft - parseInt(getStyleValue(element, 'margin-left')) - parseInt(getStyleValue(element, 'padding-left')) - parseInt(getStyleValue(element, 'border-left-width'))\r\n    return val < 0 ? element.offsetLeft : val;\r\n}\r\n\r\nexport function getIntOrDefault(value: any, def: number): number {\r\n    let integer = parseInt(value);\r\n    return isNaN(integer) ? def : integer;\r\n}\r\n\r\nexport function getStyleValue(target: any, property: string): any {\r\n    if (!is(target) || !is(property)) {\r\n        return null;\r\n    }\r\n    if (target.currentStyle) {\r\n        return target.currentStyle[property];\r\n    } else if (window.getComputedStyle) {\r\n        return window.getComputedStyle(target, null).getPropertyValue(property)\r\n    }\r\n    return null;\r\n}\r\n\r\nexport function prepLogString(message: string, component: string, functionName?: string) {\r\n    return `[${new Date().toLocaleString()}][${component ?? \"-\"}][${functionName ?? '-'}][${message}]`\r\n}\r\n\r\nexport function isInRange(value: number, min: number, max: number): boolean {\r\n    return is(value) && value >= min && value <= max;\r\n}\r\n\r\nexport function getActiveClass(prefix: string) {\r\n    return `${prefix ?? \"\"}-active`;\r\n}\r\n\r\nexport function parseAttribute(element: Element, attribute: string): any {\r\n    return are(element, attribute) ? parseAttributeString(element.getAttribute(attribute)) : null;\r\n}\r\n\r\n\r\n/**\r\n *  Checks whether string value contains synonym of true\r\n * @param value - string to check\r\n */\r\nexport function isStringTrue(value: string): boolean {\r\n    return is(value) ? ['y', 't', 'true', 'yes'].includes(value.toLowerCase()) : false\r\n}\r\n\r\nexport function boolStringOrDefault(prop: any, def: boolean): boolean {\r\n    return is(prop) ? isStringTrue(prop) : def;\r\n}\r\n\r\nexport function getStringOrDefault(value: any, def: string) {\r\n    return is(value) ? value.toLowerCase() : def;\r\n}\r\n\r\n/**\r\n * Checks whether device supports touch\r\n */\r\nexport function isTouchSupported(): boolean {\r\n    return ('ontouchstart' in window) ||\r\n        (navigator.maxTouchPoints > 0) ||\r\n        (navigator.msMaxTouchPoints > 0);\r\n}\r\n\r\n/**\r\n * Checks whether value is type of string\r\n * @param {any} value - value to be checked\r\n */\r\nexport function isString(value: any): boolean {\r\n    return typeof value === 'string';\r\n}\r\n\r\n\r\n/**\r\n * Replaces mask {prefix} with actual value in the string\r\n * @param {string} value - text containg a mask\r\n * @param {string} prefix - value to be put in place of mask\r\n */\r\nexport function replacePrefix(value: string, prefix: string): string {\r\n    return !is(value) ? value : value.replace(\"{prefix}\", prefix ?? \"\");\r\n}\r\n\r\n/**\r\n * Generates identifier for Cui element\r\n * \r\n * @param element - Cui element selector\r\n * @returns generated identifier\r\n */\r\nexport function generateCUID(element?: string) {\r\n    let starter = is(element) ? element : \"cui-element\"\r\n    return `${starter}-${COMPONENTS_COUNTER.next().value}`;\r\n}\r\n\r\n/**\r\n * Generates random string\r\n */\r\nexport function generateRandomString(): string {\r\n    let rand = getRandomInt(1, 1000)\r\n    let rand2 = getRandomInt(1, 100)\r\n    return `${Math.floor(Math.random() * rand2)}-${Math.floor(rand)}`;\r\n}\r\n/**\r\n * Generates random integer\r\n * @param min - min number\r\n * @param max - max number\r\n * @returns random integer\r\n */\r\nexport function getRandomInt(min: number, max: number): number {\r\n    min = Math.ceil(min);\r\n    max = Math.floor(max);\r\n    return Math.floor(Math.random() * (max - min + 1)) + min;\r\n}\r\n\r\n\r\n\r\nexport function* counter() {\r\n    let idx = 0;\r\n    while (true) {\r\n        let reset = yield idx++;\r\n        if (reset || idx > 200000) {\r\n            idx = 0\r\n        }\r\n    }\r\n}\r\n\r\nexport function all<T>(array: T[], condition: (t: T) => boolean) {\r\n    return array.find((t: T) => !condition(t)) === null;\r\n}\r\n\r\nexport function getHandlerExtendingOrNull<T>(target: CuiElement, fName: string): T | null {\r\n    if (!is(target.$handlers)) {\r\n        return null;\r\n    }\r\n\r\n    for (let handler in target.$handlers) {\r\n\r\n        if (target.$handlers.hasOwnProperty(handler)) {\r\n            let h: any = target.$handlers[handler];\r\n            if (hasFunction(h, fName))\r\n                return h;\r\n        }\r\n    }\r\n    return null;\r\n}\r\n\r\n/**\r\n * Checks whether property exists on the object and it is a function\r\n * @param obj - object\r\n * @param fName - property name\r\n */\r\nexport function hasFunction(obj: any, fName: string) {\r\n    return is(obj[fName]) && typeof obj[fName] === 'function'\r\n}\r\n\r\n/**\r\n * Gets closest parent element which is a cUI element\r\n * @param element \r\n */\r\nexport function getParentCuiElement(element: Element): Element | undefined {\r\n    if (!is(element)) {\r\n        return undefined;\r\n    }\r\n    let parent = element.parentElement as any;\r\n    return is(parent) && is(parent.$cuid) ? parent : getParentCuiElement(parent);\r\n}\r\n\r\n/**\r\n * Calculates element height by calculating childerns heights\r\n * @param element\r\n */\r\nexport function getChildrenHeight(element: Element): number {\r\n    let height: number = 0;\r\n    if (!element) {\r\n        return -1;\r\n    }\r\n    Array.from(element.children).forEach((child: Element) => {\r\n        height += child.getBoundingClientRect().height;\r\n    })\r\n    return height > 0 ? height + 4 : height;\r\n}\r\n\r\nexport function enumerateObject<T extends object>(object: T, callback: (property: string, value: any) => void) {\r\n    if (!are(object, callback)) {\r\n        return;\r\n    }\r\n    for (let prop in object) {\r\n        if (object.hasOwnProperty(prop)) {\r\n            callback(prop, object[prop]);\r\n        }\r\n    }\r\n}\r\n\r\nexport function round(value: number, decimalPlaces: number): number {\r\n    const multiplier = 10 ** decimalPlaces;\r\n    return Math.floor(value) / multiplier;\r\n}\r\n\r\nexport function calculateNextIndex(val: any, currentIndex: number, totalLength: number): number {\r\n    let idx = -1;\r\n    switch (val) {\r\n        case 'prev':\r\n            idx = currentIndex <= 0 ? totalLength - 1 : currentIndex - 1;\r\n            break;\r\n        case 'next':\r\n            idx = currentIndex < totalLength - 1 ? currentIndex + 1 : 0\r\n            break;\r\n        case 'first':\r\n            idx = 0;\r\n            break;\r\n        case 'last':\r\n            idx = totalLength - 1;\r\n        default:\r\n            idx = getIntOrDefault(val, -1);\r\n            break;\r\n    }\r\n    return idx;\r\n}\r\n\r\nexport function getFirstMatching<T>(array: T[], callback: (t: T, index: number) => boolean): T | undefined {\r\n    let count = array.length;\r\n    if (!array || count === 0) {\r\n        return undefined;\r\n    }\r\n\r\n    for (let idx = 0; idx < count; idx++) {\r\n        if (callback(array[idx], idx)) {\r\n            return array[idx];\r\n        }\r\n    }\r\n    return undefined;\r\n}\r\n\r\nexport function mapObject<T, V>(input: T, callback: (t: T) => V): V {\r\n    return callback(input);\r\n}\r\n\r\nexport function mapObjectArray<T, V>(input: T[], callback: (t: T) => V): V[] {\r\n    return input.map((item: T) => {\r\n        return mapObject(item, callback);\r\n    })\r\n}\r\n\r\n/**\r\n * Delays callback execution by specific time. Callback cannot be called again until previous execution finishes or was cancelled\r\n * @param callback - callback to execute\r\n * @param delayTime - time in ms that execution shall be delayed by\r\n * @returns Cancel callback\r\n */\r\nexport function delay(callback: (...args: any[]) => void, delayTime: number) {\r\n    if (!are(callback, delayTime)) {\r\n        throw new Error(\"[delay]: Input arguments are not correct\")\r\n    }\r\n    let id: any = null;\r\n    return function (...args: any[]) {\r\n        if (id === null) {\r\n            id = setTimeout(() => {\r\n                callback(...args);\r\n                id = null;\r\n            }, delayTime)\r\n        }\r\n        return function () {\r\n            if (id !== null) {\r\n                clearTimeout(id);\r\n                id = null;\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nexport function splitColon(text: string): string[] {\r\n    let ret: string[] = [];\r\n    if (!is(text)) {\r\n        return ret;\r\n    }\r\n    let split = text.split(\":\");\r\n    if (split.length === 1) {\r\n        return split;\r\n    }\r\n    let tag = split.shift();\r\n    // @ts-ignore tag is always defined\r\n    return [tag, split.join(\":\")];\r\n}","import { ICuiEventBusQueueSetup } from \"../bus/interfaces\";\r\nimport { CuiLogLevel, CuiInteractionsType } from \"../utils/types\";\r\nimport { ICuiDevelopmentTool } from \"./interfaces\";\r\n\r\ninterface CuiSetupCommon {\r\n    prefix?: string;\r\n    logLevel?: CuiLogLevel;\r\n    cacheSize?: number;\r\n    autoLightMode?: boolean;\r\n    animationTime?: number;\r\n    animationTimeShort?: number;\r\n    animationTimeLong?: number;\r\n    scrollThreshold?: number;\r\n    resizeThreshold?: number;\r\n    root: HTMLElement;\r\n}\r\n\r\nexport class CuiSetup implements CuiSetupCommon {\r\n    prefix: string;\r\n    logLevel?: CuiLogLevel;\r\n    cacheSize?: number;\r\n    autoLightMode?: boolean;\r\n    animationTime?: number;\r\n    animationTimeShort?: number;\r\n    animationTimeLong?: number;\r\n    scrollThreshold: number;\r\n    resizeThreshold: number;\r\n    plugins: any;\r\n    root: HTMLElement;\r\n\r\n    constructor() {\r\n        this.autoLightMode = false;\r\n        this.scrollThreshold = 20;\r\n        this.resizeThreshold = 20;\r\n        this.prefix = \"cui\";\r\n        this.plugins = {};\r\n        this.root = document.body\r\n    }\r\n\r\n    fromInit(init: CuiSetupInit): CuiSetup {\r\n        this.prefix = init.prefix ?? \"cui\";\r\n        this.logLevel = init.logLevel;\r\n        this.cacheSize = init.cacheSize;\r\n        this.autoLightMode = init.autoLightMode;\r\n        this.animationTime = init.animationTime;\r\n        this.animationTimeShort = init.animationTimeShort;\r\n        this.animationTimeLong = init.animationTimeLong;\r\n        this.scrollThreshold = init.scrollThreshold;\r\n        this.resizeThreshold = init.resizeThreshold;\r\n        this.root = init.root;\r\n\r\n        return this;\r\n    }\r\n}\r\n\r\n\r\nexport class CuiSetupInit implements CuiSetupCommon {\r\n    prefix: string;\r\n    app: string;\r\n    interaction: CuiInteractionsType;\r\n    logLevel: CuiLogLevel;\r\n    cacheSize: number;\r\n    autoLightMode?: boolean;\r\n    animationTime: number;\r\n    animationTimeShort: number;\r\n    animationTimeLong: number;\r\n    scrollThreshold: number;\r\n    resizeThreshold: number;\r\n    busSetup?: ICuiEventBusQueueSetup[];\r\n    development: ICuiDevelopmentTool | undefined;\r\n    root: HTMLElement;\r\n    constructor() {\r\n        this.prefix = 'cui';\r\n        this.app = '$cui';\r\n        this.logLevel = 'warning';\r\n        this.interaction = 'async';\r\n        this.animationTime = 300;\r\n        this.animationTimeShort = 150;\r\n        this.animationTimeLong = 500;\r\n        this.cacheSize = 500;\r\n        this.autoLightMode = false;\r\n        this.scrollThreshold = 20;\r\n        this.resizeThreshold = 20;\r\n        this.root = document.body;\r\n        this.busSetup = undefined;\r\n        this.development = undefined;\r\n    }\r\n}","import { CuiLogLevel } from \"./types\";\r\nimport { ICuiLogger } from \"../models/interfaces\";\r\n\r\nexport class CuiLogger implements ICuiLogger {\r\n    level: CuiLogLevel\r\n    component: string;\r\n    id: string;\r\n    constructor(name: string, level: CuiLogLevel) {\r\n        this.level = level\r\n        this.component = name\r\n        this.id = \"-\";\r\n    }\r\n\r\n    setLevel(level: CuiLogLevel) {\r\n        this.level = level\r\n    }\r\n\r\n    setId(id: string) {\r\n        this.id = id\r\n    }\r\n    debug(message: string, functionName?: string): void {\r\n        if (this.level === 'debug') {\r\n            console.log(this.prepString(message, \"debug\", functionName))\r\n        }\r\n    }\r\n    error(message: string, functionName?: string): void {\r\n        if (this.level === 'error' || this.level === 'debug' || this.level === 'warning')\r\n            console.error(this.prepString(message, \"error\", functionName))\r\n    }\r\n\r\n    warning(message: string, functionName?: string): void {\r\n        if (this.level === 'warning' || this.level === 'debug')\r\n            console.warn(this.prepString(message, \"warning\", functionName))\r\n    }\r\n\r\n    exception(e: Error, functionName?: string): void {\r\n        console.error(this.prepString(`An exception occured: ${e.name}: ${e.message}`, \"exception\", functionName))\r\n        if (this.level === 'debug')\r\n            console.error(e.stack)\r\n    }\r\n\r\n    performance(callback: () => void, functionName?: string): void {\r\n        if (this.level !== 'debug') {\r\n            return;\r\n        }\r\n        let start = Date.now();\r\n        callback();\r\n        console.log(this.prepString(`Performance measure: ${Date.now() - start}ms`, \"performance\", functionName))\r\n    }\r\n\r\n    private prepString(message: string, level: string, functionName?: string) {\r\n        return `[${new Date().toLocaleString()}][${level}][${this.component}][${functionName ?? '-'}][${this.id}][${message}]`\r\n    }\r\n}","import { CuiLogger } from \"../utils/logger\";\r\nimport { CuiLogLevel } from \"../utils/types\";\r\nimport { ICuiLogger } from \"../models/interfaces\";\r\nimport { STATICS } from \"../utils/statics\";\r\n\r\n/**\r\n * \r\n */\r\nexport class CuiLoggerFactory {\r\n    /**\r\n     * Gets new instance of component focused logger\r\n     * @param name - component name\r\n     */\r\n    public static get(name: string, logLevel?: CuiLogLevel): ICuiLogger {\r\n        return new CuiLogger(name, logLevel ?? STATICS.logLevel)\r\n    }\r\n}","import { RegisterElementError } from \"../models/errors\";\r\nimport { ICuiComponent, CuiElement, CuiHTMLElement } from \"../models/interfaces\";\r\nimport { CuiUtils } from \"../models/utils\";\r\nimport { is, generateCUID, are, enumerateObject, parseAttribute } from \"./functions\";\r\nimport { CUID_ATTRIBUTE } from \"./statics\";\r\n\r\nexport async function getMatchingComponents(node: any, components: ICuiComponent[]): Promise<ICuiComponent[]> {\r\n    return components.filter(component => {\r\n        return node.hasAttribute(component.attribute);\r\n    })\r\n}\r\n\r\nexport async function createCuiElement(node: any, components: ICuiComponent[], utils: CuiUtils): Promise<boolean> {\r\n    if (!are(node, components, utils)) {\r\n        return false;\r\n    }\r\n    let element = node as CuiHTMLElement;\r\n    if (!element.$cuid) {\r\n        element.$cuid = node.hasAttribute(CUID_ATTRIBUTE) ? node.getAttribute(CUID_ATTRIBUTE) : generateCUID(node.tagName);\r\n        node.setAttribute(CUID_ATTRIBUTE, element.$cuid);\r\n    }\r\n    for (let component of components) {\r\n        await createComponent(element, component, utils, parseAttribute(element, component.attribute))\r\n    }\r\n    return true;\r\n}\r\n\r\nexport async function destroyCuiElement(node: any): Promise<boolean> {\r\n    const element = node as CuiHTMLElement;\r\n    if (!element.$handlers) {\r\n        return false;\r\n    }\r\n    for (let name in element.$handlers) {\r\n        await destroyComponent(element, name);\r\n    }\r\n\r\n    return true;\r\n}\r\n\r\nexport function addCuiArgument<T extends object>(element: HTMLElement, cuiArg: string, args: T): boolean {\r\n    if (!are(cuiArg, args, element)) {\r\n        return false;\r\n    }\r\n    if (element.hasAttribute(cuiArg)) {\r\n        return false;\r\n    }\r\n    let argArr: string[] = [];\r\n    enumerateObject(args, (arg: string, value: string) => {\r\n        argArr.push(`${arg}: ${value}`);\r\n    })\r\n    element.setAttribute(cuiArg, argArr.join(\"; \"));\r\n    return true;\r\n\r\n}\r\n\r\n\r\nexport async function createComponent(node: CuiHTMLElement, component: ICuiComponent, utils: CuiUtils, args?: any): Promise<boolean> {\r\n    if (!node.$handlers) {\r\n        node.$handlers = {};\r\n    }\r\n    try {\r\n        let handler = component.get(node, utils);\r\n        node.$handlers[component.attribute] = handler;\r\n        node.$handlers[component.attribute].handle(args);\r\n    } catch (e) {\r\n        throw new RegisterElementError(`An error occured during [${component.attribute}] initialization: ${e.message}`);\r\n    }\r\n    return true;\r\n}\r\n\r\nexport async function updateComponent(node: CuiHTMLElement, component: string, args?: any): Promise<boolean> {\r\n    if (!node || !node.$handlers) {\r\n        return false;\r\n    }\r\n\r\n    let handler = node.$handlers[component];\r\n    if (!handler) {\r\n        return false;\r\n    }\r\n    try {\r\n        handler.refresh(args);\r\n    } catch (e) {\r\n        throw new RegisterElementError(`An error occured during [${component}] update: ${e.message}`);\r\n    }\r\n    return true;\r\n}\r\n\r\nasync function destroyComponent(node: CuiHTMLElement, component: string): Promise<boolean> {\r\n    if (!node || !node.$handlers) {\r\n        return false;\r\n    }\r\n\r\n    let handler = node.$handlers[component];\r\n    if (!handler) {\r\n        return false;\r\n    }\r\n    try {\r\n        handler.destroy();\r\n    } catch (e) {\r\n        throw new RegisterElementError(`An error occured during [${component}] destroy: ${e.message}`);\r\n    }\r\n    return true;\r\n}","import { ICuiLogger, ICuiComponent, ICuiPluginManager, CuiElement, CuiHTMLElement } from \"../models/interfaces\";\r\nimport { CuiLoggerFactory } from \"../factories/logger\";\r\nimport { is, are, joinAttributesForQuery, parseAttribute } from \"../utils/functions\";\r\nimport { CuiUtils } from \"../models/utils\";\r\nimport { createCuiElement, destroyCuiElement, getMatchingComponents, updateComponent } from \"../utils/api\";\r\n\r\nexport interface ICuiMutionObserver {\r\n    // setOptions(options: MutationObserverInit): ICuiMutionObserver;\r\n    setPlugins(plugins: ICuiPluginManager): ICuiMutionObserver;\r\n    setComponents(components: ICuiComponent[]): ICuiMutionObserver;\r\n    setAttributes(attributes: string[]): ICuiMutionObserver;\r\n    start(): ICuiMutionObserver;\r\n    stop(): ICuiMutionObserver;\r\n}\r\n\r\nexport interface ICuiComponentMutationObserver {\r\n    observe(): void;\r\n    unobserve(): void;\r\n    isObserving(): boolean;\r\n    onMutation(callback: (record: MutationRecord[]) => void): void;\r\n    disable(flag: boolean): void;\r\n}\r\n\r\n\r\nexport class CuiMutationObserver implements ICuiMutionObserver {\r\n    _log: ICuiLogger;\r\n    #observer: MutationObserver | undefined;\r\n    #options: MutationObserverInit | undefined;\r\n    #element: HTMLElement;\r\n    plugins: ICuiPluginManager | undefined;\r\n    #components: ICuiComponent[];\r\n    #attributes: string[];\r\n    #utils: CuiUtils;\r\n    #queryString: string;\r\n    constructor(element: HTMLElement, utils: CuiUtils) {\r\n        this.#observer = undefined;\r\n        this.plugins = undefined;\r\n        this.#options = undefined;\r\n        this.#element = element\r\n        this._log = CuiLoggerFactory.get('CuiMutationObserver')\r\n        this.#components = [];\r\n        this.#attributes = [];\r\n        this.#utils = utils;\r\n        this.#queryString = \"\";\r\n\r\n    }\r\n\r\n    setPlugins(plugins: ICuiPluginManager): ICuiMutionObserver {\r\n        this.plugins = plugins;\r\n        return this;\r\n    }\r\n\r\n    setComponents(components: ICuiComponent[]): ICuiMutionObserver {\r\n        this.#components = components;\r\n        return this;\r\n    }\r\n\r\n    setAttributes(attributes: string[]): ICuiMutionObserver {\r\n        this.#options = {\r\n            attributes: true,\r\n            subtree: true,\r\n            childList: true,\r\n            attributeFilter: attributes\r\n        }\r\n        this.#attributes = attributes;\r\n        this.#queryString = joinAttributesForQuery(attributes);\r\n        return this;\r\n    }\r\n\r\n    start(): ICuiMutionObserver {\r\n        this._log.debug(\"Starting\")\r\n        if (!this.#options) {\r\n            this._log.error(\"Cannot start - options are not defined\")\r\n            return this;\r\n        }\r\n        this.#observer = new MutationObserver(this.mutationCallback.bind(this));\r\n        this.#observer.observe(this.#element, this.#options)\r\n        this._log.debug(\"Started\")\r\n        return this;\r\n    }\r\n\r\n    stop(): ICuiMutionObserver {\r\n        this._log.debug(\"Stopping\")\r\n        if (!this.#observer) {\r\n            this._log.debug(\"Observer not available\")\r\n            return this;\r\n        }\r\n        this.#observer.disconnect()\r\n        this.#observer = undefined;\r\n        this._log.debug(\"Stopped\")\r\n        return this;\r\n    }\r\n\r\n    private mutationCallback(mutations: MutationRecord[], observer: MutationObserver) {\r\n        mutations.forEach((mutation: MutationRecord) => {\r\n            switch (mutation.type) {\r\n                case 'attributes':\r\n                    const item = mutation.target as CuiHTMLElement;\r\n                    if (!are(mutation.attributeName, item)) {\r\n                        this._log.error(\"Mutation attribute doesn't not exisist\");\r\n                        break;\r\n                    }\r\n                    // @ts-ignore attribute is defined\r\n                    this.handeComponentUpdate(mutation.attributeName, item);\r\n                    break;\r\n\r\n                case 'childList':\r\n                    this.handleChildListMutation(mutation);\r\n                    break;\r\n            }\r\n            if (is(this.plugins)) {\r\n                // @ts-ignore plugins is defined here\r\n                this.plugins.onMutation(mutation).then(() => {\r\n                    //\r\n                })\r\n            }\r\n        })\r\n    }\r\n\r\n    private handeComponentUpdate(attributeName: string, item: CuiHTMLElement) {\r\n        let args = parseAttribute(item, attributeName);\r\n        updateComponent(item, attributeName, args)\r\n            .then((result) => {\r\n                this._log.debug(\"Component: \" + attributeName + \" updated with: \" + result, \"handeComponentUpdate\")\r\n            })\r\n            .catch((e) => {\r\n                this._log.exception(e);\r\n            })\r\n    }\r\n\r\n    private handleChildListMutation(mutation: MutationRecord) {\r\n        const addedLen = mutation.addedNodes.length;\r\n        const removedLen = mutation.removedNodes.length;\r\n        if (addedLen > 0) {\r\n            this._log.debug(\"Registering added nodes: \" + addedLen)\r\n            this.handleAddedNodes(mutation.addedNodes).then((result) => {\r\n                this._log.debug(\"Added nodes: \" + addedLen + \" with status: \" + result)\r\n            }).catch((e) => {\r\n                this._log.exception(e);\r\n            });\r\n        } else if (removedLen > 0) {\r\n            this._log.debug(\"Removing nodes: \" + removedLen);\r\n            this.handleRemovedNodes(mutation.removedNodes).then((result) => {\r\n                this._log.debug(\"Removed nodes: \" + removedLen + \" with status: \" + result)\r\n            }).catch((e) => {\r\n                this._log.exception(e);\r\n            });\r\n        }\r\n    }\r\n\r\n    private async handleAddedNodes(nodes: NodeList): Promise<boolean> {\r\n        for (let node of nodes) {\r\n            let mainresult = await this.handleAddedNode(node);\r\n            if (!mainresult) {\r\n                return false;\r\n            }\r\n            let element = node as Element\r\n            let children = element.hasChildNodes() ? element.querySelectorAll(this.#queryString) : null;\r\n            if (is(children)) {\r\n                // @ts-ignore children is defined\r\n                this._log.debug(\"Additional nodes to add: \" + children.length);\r\n                // @ts-ignore children is defined\r\n                await this.handleAddedChildren(children);\r\n            }\r\n        }\r\n        return true;\r\n    }\r\n\r\n\r\n    private async handleAddedChildren(nodes: NodeList): Promise<boolean[]> {\r\n        let result: boolean[] = [];\r\n        for (let node of nodes) {\r\n            result.push(await this.handleAddedNode(node));\r\n        }\r\n        return result;\r\n    }\r\n\r\n    private async handleAddedNode(node: any): Promise<boolean> {\r\n        let matchingComponents = await getMatchingComponents(node, this.#components)\r\n        return createCuiElement(node, matchingComponents, this.#utils);\r\n    }\r\n\r\n    private async handleRemovedNodes(nodes: NodeList): Promise<boolean> {\r\n        for (let node of nodes) {\r\n            let result = await destroyCuiElement(node);\r\n            if (result) {\r\n                let element = node as Element;\r\n                let children = node.hasChildNodes() ? element.querySelectorAll(this.#queryString) : null;\r\n                if (is(children)) {\r\n                    // @ts-ignore children is defined\r\n                    this._log.debug(\"Additional nodes to remove: \" + children.length)\r\n                    // @ts-ignore children is defined\r\n                    await this.handleDestroyChildren(children);\r\n                }\r\n            }\r\n        }\r\n        return true;\r\n    }\r\n\r\n    private async handleDestroyChildren(nodes: NodeList): Promise<boolean[]> {\r\n        let result = [];\r\n        for (let child of nodes) {\r\n            result.push(await destroyCuiElement(child));\r\n        }\r\n        return result;\r\n    }\r\n}\r\n\r\n\r\nexport class CuiComponentMutationHandler implements ICuiComponentMutationObserver {\r\n    #isObserving: boolean;\r\n    #observer: MutationObserver | undefined;\r\n    #element: Element;\r\n    #disabled: boolean;\r\n    #options: MutationObserverInit = {\r\n        childList: true,\r\n        subtree: true\r\n    }\r\n    constructor(target: Element) {\r\n        this.#observer = undefined;\r\n        this.#disabled = false;\r\n        this.#isObserving = false;\r\n        this.#element = target;\r\n    }\r\n\r\n    observe(): void {\r\n        if (!this.#isObserving && !this.#disabled && this.#observer) {\r\n            this.#observer.observe(this.#element, this.#options);\r\n            this.#isObserving = true;\r\n        }\r\n    }\r\n    unobserve(): void {\r\n        if (this.#isObserving && this.#observer) {\r\n            this.#observer.disconnect();\r\n            this.#isObserving = false;\r\n        }\r\n    }\r\n\r\n    isObserving(): boolean {\r\n        return this.#isObserving;\r\n    }\r\n\r\n    disable(flag: boolean): void {\r\n        this.#disabled = flag;\r\n        if (this.#disabled) {\r\n            this.unobserve();\r\n        }\r\n    }\r\n\r\n    onMutation(callback: (record: MutationRecord[]) => void): void {\r\n        if (this.#isObserving)\r\n            this.unobserve();\r\n        this.#observer = new MutationObserver(callback)\r\n    }\r\n\r\n}","import { IUIInteractionProvider } from \"../models/interfaces\";\r\n\r\nexport class FastDom implements IUIInteractionProvider {\r\n    #writes: any[];\r\n    #reads: any[];\r\n    #raf: any;\r\n    #isScheduled: boolean = false;\r\n    #limit: number;\r\n    #reportCallback: ((e: Error) => void) | undefined;\r\n\r\n    constructor() {\r\n        this.#raf = window.requestAnimationFrame.bind(window)\r\n        this.#writes = []\r\n        this.#reads = []\r\n        this.#limit = 5;\r\n        this.#reportCallback = undefined;\r\n\r\n    }\r\n\r\n    onError(callback: (e: Error) => void) {\r\n        this.#reportCallback = callback;\r\n    }\r\n\r\n    mutate(callback: any, ctx: any, ...args: any[]): void {\r\n        this.#reads.push(this.createTask(callback, ctx, ...args))\r\n        this.schedule()\r\n    }\r\n\r\n    fetch(callback: any, ctx: any, ...args: any[]): void {\r\n        this.#writes.push(this.createTask(callback, ctx, ...args))\r\n        this.schedule()\r\n    }\r\n\r\n    private createTask(callback: any, ctx: any, ...args: any[]): any {\r\n        return ctx || args ? callback.bind(ctx, ...args) : callback;\r\n    }\r\n\r\n    private run(tasks: any[]) {\r\n        let task = null\r\n        while (task = tasks.shift()) {\r\n            task()\r\n        }\r\n    }\r\n\r\n    private schedule(recursion?: number) {\r\n        if (!this.#isScheduled) {\r\n            this.#isScheduled = true;\r\n            if (recursion && recursion >= this.#limit) {\r\n                throw new Error(\"Fast Dom limit reached\")\r\n            } else {\r\n                this.#raf(this.flush.bind(this, recursion));\r\n            }\r\n\r\n        }\r\n    }\r\n\r\n    private flush(recursion?: number) {\r\n        let rec: number = recursion ?? 0;\r\n        let error = null;\r\n        let writes = this.#writes;\r\n        let reads = this.#reads;\r\n\r\n        try {\r\n            this.run(reads);\r\n            this.run(writes);\r\n        } catch (e) {\r\n            if (this.#reportCallback) {\r\n                this.#reportCallback(e);\r\n            } else {\r\n                console.error(`An error has been captured in interactions: ${e.message}`);\r\n                //console.error(e)\r\n            }\r\n            error = e\r\n        }\r\n        this.#isScheduled = false;\r\n        if (error || this.#writes.length || this.#reads.length) {\r\n            this.schedule(rec + 1);\r\n        }\r\n    }\r\n}\r\n\r\nexport class SyncInteractions implements IUIInteractionProvider {\r\n    tasks: any[];\r\n    raf: any;\r\n    isRunning: boolean = false;\r\n    constructor() {\r\n        this.tasks = [];\r\n        this.raf = window.requestAnimationFrame.bind(window)\r\n    }\r\n\r\n    mutate(callback: any, ctx: any, ...args: any[]): void {\r\n        this.tasks.push(this.createTask(callback, ctx, ...args))\r\n        this.schedule()\r\n    }\r\n\r\n    fetch(callback: any, ctx: any, ...args: any[]): void {\r\n        this.tasks.push(this.createTask(callback, ctx, ...args))\r\n        this.schedule()\r\n    }\r\n\r\n    private schedule() {\r\n        if (!this.isRunning) {\r\n            this.isRunning = true;\r\n            this.raf(this.flush.bind(this))\r\n        }\r\n    }\r\n\r\n    private flush() {\r\n        let task = null\r\n        while (task = this.tasks.shift()) {\r\n            try {\r\n                task()\r\n            }\r\n            catch (e) {\r\n            }\r\n        }\r\n        this.isRunning = false\r\n    }\r\n\r\n    private createTask(callback: any, ctx: any, ...args: any[]): any {\r\n        return ctx || args ? callback.bind(ctx, ...args) : callback;\r\n    }\r\n\r\n}","import { ICuiDictionary, ICuiDictionaryItem } from \"../models/interfaces\";\r\nimport { ItemNotFoundError, ArgumentError } from \"../models/errors\";\r\nimport { is } from \"./functions\";\r\n\r\nexport class CuiDictionary<T> implements ICuiDictionary<T> {\r\n\r\n    #keys: string[];\r\n    #values: T[];\r\n\r\n    constructor(init?: ICuiDictionaryItem<T>[]) {\r\n        this.#keys = []\r\n        this.#values = []\r\n\r\n        if (init) {\r\n            init.forEach(x => {\r\n                if (!is(x.key)) {\r\n                    this.#keys = []\r\n                    this.#values = []\r\n                    throw new ArgumentError(\"Key is empty\");\r\n                }\r\n                this.add(x.key, x.value)\r\n            })\r\n        }\r\n    }\r\n\r\n    add(key: string, value: T): void {\r\n        this.throwOnEmptyKey(key)\r\n        if (this.containsKey(key))\r\n            throw new Error(\"Key already exists\");\r\n        this.#keys.push(key)\r\n        this.#values.push(value)\r\n    }\r\n\r\n    remove(key: string): void {\r\n        if (!is(key)) {\r\n            return\r\n        }\r\n        let index = this.#keys.indexOf(key);\r\n        if (index >= 0) {\r\n            this.#keys.splice(index, 1)\r\n            this.#values.splice(index, 1)\r\n        }\r\n    }\r\n    get(key: string): T | undefined {\r\n        this.throwOnEmptyKey(key)\r\n        let index = this.indexOf(key)\r\n        if (index < 0) {\r\n            return undefined;\r\n        }\r\n        return this.#values[index];\r\n    }\r\n    containsKey(key: string): boolean {\r\n        return is(key) && this.indexOf(key) >= 0\r\n    }\r\n    keys(): string[] {\r\n        return this.#keys\r\n    }\r\n    values(): T[] {\r\n        return this.#values;\r\n    }\r\n\r\n    indexOf(key: string): number {\r\n        return is(key) ? this.#keys.indexOf(key) : -1;\r\n    }\r\n\r\n    update(key: string, value: T): void {\r\n        this.throwOnEmptyKey(key)\r\n        let index = this.indexOf(key)\r\n        if (index < 0) {\r\n            throw new ItemNotFoundError(`Item with key [${key}] not found`)\r\n        }\r\n        this.#values[index] = value\r\n    }\r\n\r\n    clear() {\r\n        this.#values = [];\r\n        this.#keys = [];\r\n    }\r\n\r\n    private throwOnEmptyKey(key: string) {\r\n        if (!is(key)) {\r\n            throw new ArgumentError(\"Key is empty\");\r\n        }\r\n    }\r\n}","import { ICuiDictionary, CuiCachable, ICuiManager } from \"../models/interfaces\";\r\nimport { CuiDictionary } from \"../utils/dictionary\";\r\nimport { is } from \"../utils/functions\";\r\n\r\nexport class CuiCacheManager implements ICuiManager<CuiCachable> {\r\n    #cache: ICuiDictionary<CuiCachable>;\r\n    #maxSize: number;\r\n    constructor(maxSize?: number) {\r\n        this.#cache = new CuiDictionary<CuiCachable>();\r\n        this.#maxSize = maxSize ?? 500;\r\n    }\r\n    put(key: string, element: CuiCachable): void {\r\n        if (!is(key)) return;\r\n        if (this.has(key)) {\r\n            this.#cache.update(key, element);\r\n            return;\r\n        }\r\n        this.clean();\r\n        this.#cache.add(key, element);\r\n    }\r\n\r\n    get(key: string): CuiCachable | undefined {\r\n        if (!this.has(key)) return undefined;\r\n        let item = this.#cache.get(key);\r\n        if (item && item.refresh()) {\r\n            return item;\r\n        }\r\n        this.#cache.remove(key);\r\n        return undefined;\r\n    }\r\n\r\n    has(key: string): boolean {\r\n        return is(key) ? this.#cache.containsKey(key) : false;\r\n    }\r\n\r\n    remove(key: string): boolean {\r\n        if (!is(key)) return false;\r\n        if (this.has(key)) {\r\n            this.#cache.remove(key);\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    clear(): void {\r\n        this.#cache.clear();\r\n    }\r\n\r\n    private clean() {\r\n        if (this.#cache.keys().length >= this.#maxSize) {\r\n            this.#cache.remove(this.#cache.keys()[0]);\r\n        }\r\n    }\r\n}\r\n\r\n","import { ICuiLogger, CuiEventReceiver } from \"../models/interfaces\";\r\nimport { is } from \"../utils/functions\";\r\nimport { CuiLoggerFactory } from \"../factories/logger\";\r\nimport { ICuiCallbackExecutor, ICuiEventEmitHandler } from \"./interfaces\";\r\n\r\ninterface EmitHandlerData {\r\n    events: CuiEventReceiver;\r\n    cuid: string | null;\r\n    args: any[];\r\n}\r\n\r\nclass EmitHandlerBase {\r\n    isBusy: boolean;\r\n    queue: EmitHandlerData[];\r\n    constructor() {\r\n        this.queue = [];\r\n        this.isBusy = false;\r\n    }\r\n    idMatches(emitId: string | null | undefined, handleId: string | null | undefined) {\r\n        return !is(emitId) || (is(emitId) && emitId == handleId);\r\n    }\r\n}\r\n\r\nexport class SimpleEventEmitHandler extends EmitHandlerBase implements ICuiEventEmitHandler {\r\n    #log: ICuiLogger;\r\n    #executor: ICuiCallbackExecutor;\r\n    constructor(executor: ICuiCallbackExecutor) {\r\n        super();\r\n        this.#executor = executor;\r\n        this.#log = CuiLoggerFactory.get(\"SimpleEventEmitHandler\");\r\n    }\r\n\r\n    async handle(events: CuiEventReceiver, cuid: string, args: any[]): Promise<boolean> {\r\n        if (!is(events)) {\r\n            this.#log.warning(\"No events provided\")\r\n            return false;\r\n        }\r\n        this.queue.push({\r\n            events: events,\r\n            cuid: cuid,\r\n            args: args\r\n        })\r\n        if (!this.isBusy) {\r\n            if (!this.isBusy) {\r\n                this.isBusy = true;\r\n                if (this.queue.length > 0) {\r\n                    await this.perform();\r\n                }\r\n                this.isBusy = false;\r\n            }\r\n        }\r\n        return true;\r\n    }\r\n\r\n    private async perform() {\r\n        let task = this.queue.shift();\r\n        if (!task) {\r\n            return;\r\n        }\r\n        for (let id in task.events) {\r\n            let event = task.events[id]\r\n            try {\r\n                if (this.idMatches(task.cuid, event.$cuid))\r\n                    await this.#executor.execute(event.callback, task.args)\r\n            }\r\n            catch (e) {\r\n                this.#log.error(e)\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nexport class TaskedEventEmitHandler extends EmitHandlerBase implements ICuiEventEmitHandler {\r\n    #executor: ICuiCallbackExecutor;\r\n    constructor(executor: ICuiCallbackExecutor) {\r\n        super();\r\n        this.#executor = executor;\r\n    }\r\n\r\n    async handle(events: CuiEventReceiver, cuid: string | null, args: any[]): Promise<boolean> {\r\n        if (!is(events)) {\r\n            return false;\r\n        }\r\n        this.queue.push({\r\n            events: events,\r\n            cuid: cuid,\r\n            args: args\r\n        })\r\n        if (!this.isBusy) {\r\n            this.isBusy = true;\r\n            await this.perform();\r\n            if (this.queue.length > 0) {\r\n                await this.perform();\r\n            }\r\n\r\n            this.isBusy = false;\r\n        }\r\n        return true;\r\n    }\r\n\r\n    private async perform(): Promise<boolean[]> {\r\n        let task = this.queue.shift();\r\n        let promises: Promise<boolean>[] = []\r\n        if (!task) {\r\n            return Promise.all(promises);\r\n        }\r\n        for (let id in task.events) {\r\n            let event = task.events[id]\r\n            if (this.idMatches(task.cuid, event.$cuid))\r\n                promises.push(this.#executor.execute(event.callback, task.args))\r\n        }\r\n        return Promise.all(promises)\r\n    }\r\n}\r\n\r\n\r\nexport class CuiEventEmitHandlerFactory {\r\n    static get(name: string, executor: ICuiCallbackExecutor): ICuiEventEmitHandler {\r\n        switch (name) {\r\n            case \"tasked\":\r\n                return new TaskedEventEmitHandler(executor);\r\n            default:\r\n                return new SimpleEventEmitHandler(executor);\r\n        }\r\n    }\r\n}","import { ICuiCallbackExecutor } from \"./interfaces\";\r\n\r\n\r\nexport class CuiCallbackExecutor implements ICuiCallbackExecutor {\r\n    async execute(callback: any, args: any[]): Promise<boolean> {\r\n        args = args ?? [];\r\n        try {\r\n            callback(...args)\r\n            return true;\r\n        } catch (e) {\r\n\r\n        }\r\n\r\n        return false;\r\n    }\r\n}","import { ICuiEventBus, CuiEventReceiver, ICuiLogger, CuiElement, CuiEventObj } from \"../models/interfaces\";\r\nimport { is, are, generateRandomString, enumerateObject } from \"../utils/functions\";\r\nimport { ArgumentError } from \"../models/errors\";\r\nimport { CuiLoggerFactory } from \"../factories/logger\";\r\nimport { CuiEventEmitHandlerFactory, TaskedEventEmitHandler } from \"./handlers\";\r\nimport { CuiCallbackExecutor } from \"./executors\";\r\nimport { CuiBusExtStatistics, ICuiEventBusQueueSetup, ICuiEventEmitHandler } from \"./interfaces\";\r\n\r\ninterface ICuiBusMapping {\r\n    [name: string]: number;\r\n}\r\n\r\n\r\n\r\n\r\nexport class CuiEventBus implements ICuiEventBus {\r\n    #events: { [event: string]: CuiEventReceiver }\r\n    #log: ICuiLogger;\r\n    #eventHandler: ICuiEventEmitHandler;\r\n    #name: string;\r\n    constructor(emitHandler: ICuiEventEmitHandler, name?: string) {\r\n        this.#events = {};\r\n        this.#eventHandler = emitHandler;\r\n        this.#name = name ?? \"CuiEventBus\"\r\n        this.#log = CuiLoggerFactory.get(this.#name);\r\n    }\r\n\r\n    /**\r\n     * Attaches event to event bus\r\n     * \r\n     * @param {string} name - Event name\r\n     * @param {any} callback - callback function\r\n     * @param {CuiContext} ctx - callback context with id\r\n     * @param {CuiElement} cui - optional - cui element which event shall be attached to \r\n     */\r\n    on(name: string, callback: any, cui?: CuiElement): string | null {\r\n        if (!are(name, callback)) {\r\n            throw new ArgumentError(\"Missing argument\")\r\n        }\r\n        // When context is not provided (e.g. anonymous function) then generate random\r\n        let id = this.#name + \"-\" + generateRandomString();\r\n\r\n\r\n        if (!this.#events[name]) {\r\n            this.#events[name] = {}\r\n        }\r\n        if (this.isAttached(this.#events[name], id, cui)) {\r\n            return null;\r\n        }\r\n        this.#log.debug(`Attaching new event: [${name}] for: [${id}]`)\r\n\r\n        this.#events[name][id] = { callback: callback, $cuid: this.getCuid(cui) }\r\n        return id;\r\n    }\r\n\r\n    /**\r\n    * Detaches specific event from event bus\r\n    *\r\n    * @param {string} name - Event name\r\n    * @param {CuiContext} ctx - callback context with id\r\n    * @param {CuiElement} cui - optional - cui element which event shall be attached to\r\n    */\r\n    detach(name: string, id: string): void {\r\n        if (!are(name, id)) {\r\n            throw new ArgumentError(\"Missing argument\")\r\n        }\r\n        let ev = this.#events[name]\r\n        this.#log.debug(`Detaching item: [${id}] from [${name}]`)\r\n        if (this.isAttached(ev, id)) {\r\n            delete ev[id];\r\n        }\r\n    }\r\n\r\n    /**\r\n    * Detaches all callbacks from event\r\n    *\r\n    * @param {string} name - Event name\r\n    */\r\n    detachAll(name: string): void {\r\n        if (is(name) && this.#events[name]) {\r\n            delete this.#events[name]\r\n        } else {\r\n            this.#log.error(`Event name is missing or incorrect`, \"detachAll\")\r\n        }\r\n    }\r\n\r\n    /**\r\n    * Emits event call to event bus\r\n    *\r\n    * @param {string} name - Event name\r\n    * @param {string} cuid - id of component which emits the event\r\n    * @param {any[]} args  - event arguments\r\n    */\r\n    async emit(event: string, cuid: string | null, ...args: any[]): Promise<boolean> {\r\n        if (!is(event)) {\r\n            throw new ArgumentError(\"Event name is incorrect\");\r\n        }\r\n\r\n        let callbacks = this.#events[event];\r\n        if (is(callbacks)) {\r\n            this.#log.debug(`Emit: [${event}]`)\r\n            await this.#eventHandler.handle(callbacks, cuid, args)\r\n        }\r\n        return true;\r\n    }\r\n\r\n    /**\r\n    * Checks whether given context is already attached to specific event\r\n    *\r\n    * @param {string} name - Event name\r\n    * @param {CuiContext} ctx - callback context with id\r\n    * @param {CuiElement} cui - optional - cui element which event shall be attached to\r\n    */\r\n    isSubscribing(name: string, id: string, cui?: CuiElement) {\r\n        let ev = this.#events[name]\r\n        return this.isAttached(ev, id, cui)\r\n    }\r\n\r\n    /**\r\n     * Detaches callbacks by component cuid - this is used to clean up attachments on component deletion\r\n     * @param {string} event - event name\r\n     * @param {string} cuid - cuid of the component\r\n     */\r\n    detachByCuid(event: string, cuid: string): void {\r\n        if (!are(event, cuid)) {\r\n            return;\r\n        }\r\n        let ev = this.#events[event];\r\n        if (!is(ev)) {\r\n            return;\r\n        }\r\n        enumerateObject({ ...ev }, (evId: string, evValue: CuiEventObj) => {\r\n            if (evValue.$cuid === cuid) {\r\n                delete ev[evId]\r\n            }\r\n        })\r\n    }\r\n\r\n    private isAttached(ev: CuiEventReceiver, id: string, cui?: CuiElement): boolean {\r\n        if (is(cui)) {\r\n            // @ts-ignore\r\n            return is(ev) && is(id) && is(ev[id]) && ev[id].$cuid == cui.$cuid;\r\n        }\r\n        return is(ev) && is(id) && is(ev[id]);\r\n    }\r\n\r\n    private getCuid(cui?: CuiElement) {\r\n        // @ts-ignore\r\n        return is(cui) ? cui.$cuid : null;\r\n    }\r\n\r\n\r\n}\r\n\r\n\r\nexport class CuiEventExtBus implements ICuiEventBus {\r\n    #events: { [event: string]: number };\r\n    #log: ICuiLogger;\r\n    #buses: ICuiEventBus[];\r\n    #last: number;\r\n    constructor(setup: ICuiEventBusQueueSetup[]) {\r\n        this.#log = CuiLoggerFactory.get(\"CuiEventBus\");\r\n        this.#buses = [];\r\n        this.#events = {};\r\n        this.#last = 0;\r\n        if (is(setup)) {\r\n            this.#log.debug(\"Initiating buses\")\r\n            let sorted = setup.length === 1 ? setup : setup.sort((first, second) => {\r\n                return first.priority - second.priority\r\n            })\r\n            sorted.forEach((item, index) => {\r\n                this.#buses.push(this.initBusInstance(item.name, item.handler))\r\n                this.#events = {\r\n                    ...this.#events,\r\n                    ...this.mapEvents(item.eventsDef, index),\r\n                }\r\n                this.#log.debug(`Bus ${item.name} has been initialized with number: ${index}`)\r\n            })\r\n\r\n            this.#buses.push(this.initBusInstance(\"DefaultEventBus\", 'tasked'))\r\n            this.#last = this.#buses.length - 1;\r\n            this.#log.debug(`Bus initialization finished`);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Attaches event to event bus\r\n     * \r\n     * @param {string} name - Event name\r\n     * @param {any} callback - callback function\r\n     * @param {CuiContext} ctx - callback context with id\r\n     * @param {CuiElement} cui - optional - cui element which event shall be attached to \r\n     */\r\n    on(name: string, callback: any, cui?: CuiElement): string | null {\r\n\r\n        if (!are(name, callback)) {\r\n            throw new ArgumentError(\"Missing argument\")\r\n        }\r\n        return this.get(name).on(name, callback, cui);\r\n    }\r\n\r\n    /**\r\n    * Detaches specific event from event bus\r\n    *\r\n    * @param {string} name - Event name\r\n    * @param {CuiContext} ctx - callback context with id\r\n    * @param {CuiElement} cui - optional - cui element which event shall be attached to\r\n    */\r\n    detach(name: string, id: string, cui?: CuiElement): void {\r\n        if (!are(name, id)) {\r\n            throw new ArgumentError(\"Missing argument\")\r\n        }\r\n        this.get(name).detach(name, id, cui);\r\n    }\r\n\r\n    /**\r\n    * Detaches all callbacks from event\r\n    *\r\n    * @param {string} name - Event name\r\n    */\r\n    detachAll(name: string): void {\r\n        this.get(name).detachAll(name);\r\n    }\r\n\r\n    /**\r\n    * Emits event call to event bus\r\n    *\r\n    * @param {string} name - Event name\r\n    * @param {string} cuid - id of component which emits the event\r\n    * @param {any[]} args  - event arguments\r\n    */\r\n    async emit(event: string, cuid: string | null, ...args: any[]): Promise<boolean> {\r\n        if (!is(event)) {\r\n            throw new ArgumentError(\"Event name is incorrect\");\r\n        }\r\n        return this.get(event).emit(event, cuid, ...args);\r\n    }\r\n\r\n    /**\r\n    * Checks whether given context is already attached to specific event\r\n    *\r\n    * @param {string} name - Event name\r\n    * @param {CuiContext} ctx - callback context with id\r\n    * @param {CuiElement} cui - optional - cui element which event shall be attached to\r\n    */\r\n    isSubscribing(name: string, id: string, cui?: CuiElement) {\r\n        return this.get(name).isSubscribing(name, id, cui);\r\n    }\r\n\r\n    /**\r\n    * Detaches callbacks by component cuid - this is used to clean up attachments on component deletion\r\n    * @param {string} event - event name\r\n    * @param {string} cuid - cuid of the component\r\n    */\r\n    detachByCuid(event: string, cuid: string): void {\r\n        if (!are(event, cuid)) {\r\n            return\r\n        }\r\n        this.get(event).detachByCuid(event, cuid);\r\n    }\r\n\r\n\r\n    /**\r\n     * Creates and initializes event bus instance\r\n     * @param busName Event bus name for logger\r\n     * @param handlerName handler name to create proper handler instance\r\n     */\r\n    private initBusInstance(busName: string, handlerName: string): ICuiEventBus {\r\n        if (!are(busName, handlerName)) {\r\n            throw new ArgumentError(\"Bus name or handler name is incorrect\");\r\n        }\r\n        let executor = new CuiCallbackExecutor();\r\n        let handler = CuiEventEmitHandlerFactory.get(handlerName, executor);\r\n        return new CuiEventBus(handler, busName);\r\n    }\r\n\r\n    /**\r\n     * Creates mapping object from events array\r\n     * @param events events array\r\n     * @param index queue number\r\n     */\r\n    private mapEvents(events: string[], index: number): ICuiBusMapping {\r\n        return events.reduce((result: ICuiBusMapping, current: string) => {\r\n            if (!result[current]) {\r\n                return {\r\n                    ...result,\r\n                    [current]: index\r\n                }\r\n            }\r\n            return result;\r\n        }, {})\r\n    }\r\n\r\n    /**\r\n     * Retrives porper event bus based on event name\r\n     * @param event \r\n     */\r\n    private get(event: string): ICuiEventBus {\r\n        let idx = this.#events[event];\r\n        return this.#buses[idx ?? this.#last];\r\n    }\r\n}\r\n\r\nexport class CuiEventBusFactory {\r\n    static get(setup?: ICuiEventBusQueueSetup[]): ICuiEventBus {\r\n        //@ts-ignore - setup is underfined check is perfromed\r\n        return is(setup) ? new CuiEventExtBus(setup) : new CuiEventBus(new TaskedEventEmitHandler(new CuiCallbackExecutor));\r\n    }\r\n}\r\n\r\nexport class CuiBusExtStatisticsHandler {\r\n    #isOn: boolean;\r\n    #statistics: CuiBusExtStatistics;\r\n    constructor(gather: boolean, queueCount: number) {\r\n        this.#isOn = gather;\r\n        this.#statistics = {\r\n            queueCount: queueCount,\r\n            events: {}\r\n        }\r\n    }\r\n\r\n    addEvent(event: string, queueNumber: number, emitCount?: number) {\r\n        this.#statistics.events[event] = {\r\n            name: event,\r\n            queueNumber: queueNumber,\r\n            emits: emitCount ?? 0\r\n        }\r\n    }\r\n\r\n    addQueue() {\r\n        this.#statistics.queueCount += 1;\r\n    }\r\n\r\n    addEmit(event: string, queueNumber?: number) {\r\n        if (!this.#isOn) {\r\n            return;\r\n        }\r\n\r\n        if (this.#statistics.events[event]) {\r\n            this.#statistics.events[event].emits += 1;\r\n        } else {\r\n            this.addEvent(event, queueNumber ?? -1, 1);\r\n        }\r\n\r\n    }\r\n\r\n    getStatistics(): CuiBusExtStatistics {\r\n        return this.#statistics;\r\n    }\r\n\r\n}","import { is } from \"../utils/functions\";\r\nimport { IUIInteractionProvider } from \"../models/interfaces\";\r\n\r\nexport interface ICuiDocumentStyleAppender {\r\n    append(style: string): boolean;\r\n}\r\n\r\nexport class CuiDocumentStyleAppender implements ICuiDocumentStyleAppender {\r\n    constructor(interactions: IUIInteractionProvider) {\r\n    }\r\n\r\n    append(style: string): boolean {\r\n        if (is(style)) {\r\n            const head = document.head || document.getElementsByTagName('head')[0]\r\n            const node = document.createElement('style');\r\n            const text = document.createTextNode(style);\r\n            // node.type = 'text/css';\r\n            node.appendChild(text);\r\n            head.appendChild(node);\r\n        }\r\n        return true;\r\n    }\r\n\r\n}","import { CuiColorSetType } from \"../utils/types\";\r\nimport { is, getRangeValue, are } from \"../utils/functions\";\r\nimport { IUIInteractionProvider } from \"../models/interfaces\";\r\nimport { CuiColor, CuiColorSet } from \"../models/colors\";\r\nimport { CSS_APP_BACKGROUND_COLORS, CSS_COMPONENT_BACKGROUND_COLORS, CSS_COMPONENT_BORDER_COLORS, CSS_THEMES } from \"../utils/statics\";\r\n\r\nexport class CuiInstanceColorHandler {\r\n    #root: HTMLElement;\r\n    #interactions: IUIInteractionProvider;\r\n    #LIGHTEN_FACTOR: number = 15;\r\n    #DARKEN_FACTOR: number = 15;\r\n\r\n    constructor(interactions: IUIInteractionProvider) {\r\n        this.#root = document.documentElement;\r\n        this.#interactions = interactions;\r\n    }\r\n\r\n    setAppBackground(light: CuiColor, dark: CuiColor) {\r\n        this.setPropertyIn(CSS_APP_BACKGROUND_COLORS.light, light.toCssString());\r\n        this.setPropertyIn(CSS_APP_BACKGROUND_COLORS.dark, dark.toCssString());\r\n    }\r\n\r\n    setComponentBackground(light: CuiColor, dark: CuiColor) {\r\n        this.setPropertyIn(CSS_COMPONENT_BACKGROUND_COLORS.light, light.toCssString());\r\n        this.setPropertyIn(CSS_COMPONENT_BACKGROUND_COLORS.dark, dark.toCssString());\r\n    }\r\n\r\n    setBordersColors(light: CuiColor, dark: CuiColor) {\r\n        this.setPropertyIn(CSS_COMPONENT_BORDER_COLORS.light, light.toCssString());\r\n        this.setPropertyIn(CSS_COMPONENT_BORDER_COLORS.dark, dark.toCssString());\r\n    }\r\n\r\n    setColor(type: CuiColorSetType, set: CuiColorSet) {\r\n        const colors = CSS_THEMES[type];\r\n        const baseColor = set.base;\r\n        if (!is(colors) || !is(baseColor)) {\r\n            return\r\n        }\r\n        const mutedColor = set.muted ?? baseColor.clone().lighten(this.#LIGHTEN_FACTOR);\r\n        const activeColor = set.active ?? baseColor.clone().darken(this.#DARKEN_FACTOR);\r\n\r\n        this.#interactions.mutate(() => {\r\n            this.setProperty(colors.base, baseColor.toCssString());\r\n            this.setProperty(colors.active, activeColor.toCssString());\r\n            this.setProperty(colors.muted, mutedColor.toCssString());\r\n        }, this)\r\n\r\n    }\r\n\r\n    setLightenFactor(factor: number) {\r\n        this.#LIGHTEN_FACTOR = getRangeValue(factor, 0, 100);\r\n    }\r\n\r\n    setDarkenFactor(factor: number) {\r\n        this.#DARKEN_FACTOR = getRangeValue(factor, 0, 100);\r\n    }\r\n\r\n    setProperty(propertyName: string, value: string) {\r\n        this.#root.style.setProperty(propertyName, value);\r\n    }\r\n\r\n    setPropertyIn(propertyName: string, value: string) {\r\n        if (!are(value, propertyName)) {\r\n            return;\r\n        }\r\n        this.#interactions.mutate(this.setProperty, this, propertyName, value)\r\n    }\r\n}","\r\nimport { CuiDevelopmentStateType, ICuiDevelopmentTool } from \"../models/interfaces\";\r\nimport { is } from \"../utils/functions\";\r\n\r\nexport class CuiDevelopmentToolManager implements ICuiDevelopmentTool {\r\n\r\n    #tool: ICuiDevelopmentTool | undefined;\r\n    constructor(tool?: ICuiDevelopmentTool) {\r\n        this.#tool = tool;\r\n    }\r\n\r\n    pushState(cuid: string, component: string, type: CuiDevelopmentStateType, message: string, functionName?: string): void {\r\n        this.checkAndCall(() => {\r\n            // @ts-ignore - tool already checked\r\n            this.#tool.pushState(cuid, component, type, message, functionName);\r\n        })\r\n\r\n    }\r\n\r\n    registerElement(element: HTMLElement, cuid: string, component: string): void {\r\n        this.checkAndCall(() => {\r\n            // @ts-ignore - tool already checked\r\n            this.#tool.registerElement(element, cuid, component);\r\n        })\r\n    }\r\n\r\n    unregisterElement(cuid: string, component: string): void {\r\n        this.checkAndCall(() => {\r\n            // @ts-ignore - tool already checked\r\n            this.#tool.unregisterElement(cuid, component);\r\n        })\r\n    }\r\n\r\n    setProperty<T>(cuid: string, component: string, name: string, t: T): void {\r\n        this.checkAndCall(() => {\r\n            // @ts-ignore - tool already checked\r\n            this.#tool.setProperty(cuid, component, name, t);\r\n        })\r\n    }\r\n\r\n    log(type: CuiDevelopmentStateType, message: string, functionName?: string): void {\r\n        this.checkAndCall(() => {\r\n            // @ts-ignore - tool already checked\r\n            this.#tool.log(type, message, functionName);\r\n        })\r\n    }\r\n\r\n    private checkAndCall(callback: any) {\r\n        if (!is(this.#tool)) {\r\n            return;\r\n        }\r\n\r\n        callback();\r\n    }\r\n}","import { IUIInteractionProvider, ICuiEventBus, ICuiManager, CuiCachable } from \"./interfaces\";\r\nimport { CuiSetup, CuiSetupInit } from \"./setup\";\r\nimport { CuiLightMode } from \"../utils/types\";\r\nimport { CuiInteractionsFactory } from \"../factories/interactions\";\r\nimport { CuiCacheManager } from \"../managers/cache\";\r\nimport { CuiEventBusFactory } from \"../bus/bus\";\r\nimport { are, getName, is, replacePrefix } from \"../utils/functions\";\r\nimport { CLASSES } from \"../utils/statics\";\r\nimport { ICuiDocumentStyleAppender, CuiDocumentStyleAppender } from \"../styles/appender\";\r\nimport { CuiInstanceColorHandler } from \"../handlers/colors\";\r\nimport { CSSVariableError } from \"./errors\";\r\nimport { CuiDevelopmentToolManager } from \"../managers/development\";\r\n\r\nexport class CuiUtils {\r\n    interactions: IUIInteractionProvider;\r\n    bus: ICuiEventBus;\r\n    setup: CuiSetup;\r\n    cache: ICuiManager<CuiCachable>;\r\n    colors: CuiInstanceColorHandler;\r\n    styleAppender: ICuiDocumentStyleAppender;\r\n    development: CuiDevelopmentToolManager;\r\n    #plugins: string[];\r\n    constructor(initialSetup: CuiSetupInit, plugins?: string[]) {\r\n        this.setup = new CuiSetup().fromInit(initialSetup);\r\n        this.interactions = CuiInteractionsFactory.get(initialSetup.interaction, this.onInteractionError.bind(this));\r\n        this.cache = new CuiCacheManager(this.setup.cacheSize);\r\n        this.bus = CuiEventBusFactory.get(initialSetup.busSetup);\r\n        this.colors = new CuiInstanceColorHandler(this.interactions);\r\n        this.development = new CuiDevelopmentToolManager(initialSetup.development);\r\n        this.styleAppender = new CuiDocumentStyleAppender(this.interactions);\r\n        this.#plugins = plugins ?? [];\r\n    }\r\n\r\n    setLightMode(mode: CuiLightMode) {\r\n        const name: string = getName(this.setup.prefix, CLASSES.dark);\r\n        const classes = document.body.classList;\r\n        if (mode === 'dark' && !classes.contains(name)) {\r\n            this.interactions.mutate(() => {\r\n                classes.add(name);\r\n            }, this)\r\n\r\n        } else if (mode === 'light' && classes.contains(name)) {\r\n            this.interactions.mutate(() => {\r\n                classes.remove(name);\r\n            }, this)\r\n        }\r\n    }\r\n\r\n    getLightMode(): CuiLightMode {\r\n        const name: string = getName(this.setup.prefix, CLASSES.dark);\r\n        return document.body.classList.contains(name) ? 'dark' : 'light';\r\n    }\r\n\r\n    setPrintMode(flag: boolean) {\r\n        const name: string = getName(this.setup.prefix, CLASSES.print);\r\n        const classes = document.body.classList;\r\n        if (flag && !classes.contains(name)) {\r\n            classes.add(name);\r\n\r\n        } else if (!flag && classes.contains(name)) {\r\n            classes.remove(name);\r\n        }\r\n    }\r\n\r\n    isPrintMode(): boolean {\r\n        const name: string = getName(this.setup.prefix, CLASSES.print);\r\n        return document.body.classList.contains(name);\r\n    }\r\n\r\n    setProperty(name: string, value: string) {\r\n        if (!are(name, value)) {\r\n            throw new CSSVariableError(\"Property or value was not provided\");\r\n        }\r\n        let prop = replacePrefix(name, this.setup.prefix);\r\n        document.documentElement.style.setProperty(prop, value);\r\n    }\r\n\r\n    isPlugin(name: string) {\r\n        return is(name) && this.#plugins.find(plugin => plugin === name);\r\n    }\r\n\r\n    private onInteractionError(e: Error) {\r\n        console.error(\"An error has been captured from interactions\");\r\n        console.error(e);\r\n    }\r\n}","import { IUIInteractionProvider } from \"../models/interfaces\";\r\nimport { CuiInteractionsType } from \"../utils/types\";\r\nimport { FastDom, SyncInteractions } from \"../utils/interactions\";\r\n\r\nexport class CuiInteractionsFactory {\r\n    /**\r\n     * Gets new instance of component focused logger\r\n     * @param type - Interactions type\r\n     */\r\n    public static get(type: CuiInteractionsType, errorReport?: (e: Error) => void): IUIInteractionProvider {\r\n        const interactionType = type;\r\n        switch (interactionType) {\r\n            case 'async':\r\n                const fastDom = new FastDom();\r\n                if (errorReport)\r\n                    fastDom.onError(errorReport);\r\n                return fastDom;\r\n            default:\r\n                return new SyncInteractions();\r\n        }\r\n    }\r\n}","import { IUIInteractionProvider } from \"../models/interfaces\";\r\nimport { ICuiComponentAction } from \"../utils/actions\";\r\nimport { CLASSES } from \"../utils/statics\";\r\nimport { is } from \"../utils/functions\";\r\n\r\nexport class CuiActionsHelper {\r\n    #interactions: IUIInteractionProvider;\r\n    constructor(interactions: IUIInteractionProvider) {\r\n        this.#interactions = interactions;\r\n    }\r\n\r\n    async performAction(target: Element, action: ICuiComponentAction, timeout: number, callback?: () => void): Promise<boolean> {\r\n        return new Promise((resolve) => {\r\n            this.#interactions.mutate(() => {\r\n                action.add(target);\r\n                target.classList.add(CLASSES.animProgress);\r\n                setTimeout(() => {\r\n                    this.#interactions.mutate(() => {\r\n                        action.remove(target);\r\n                        target.classList.remove(CLASSES.animProgress);\r\n                        if (callback)\r\n                            callback();\r\n                        resolve(true)\r\n                    }, null)\r\n                }, timeout)\r\n            }, null)\r\n        })\r\n    }\r\n\r\n    async performActions(target: Element, actions: ICuiComponentAction[], timeout: number, callback?: () => void): Promise<boolean> {\r\n        return new Promise((resolve) => {\r\n            this.#interactions.mutate(() => {\r\n                actions.forEach(x => x.add(target));\r\n                target.classList.add(CLASSES.animProgress);\r\n                setTimeout(() => {\r\n                    this.#interactions.mutate(() => {\r\n                        actions.forEach(x => x.remove(target));\r\n                        target.classList.remove(CLASSES.animProgress);\r\n                        if (callback)\r\n                            callback();\r\n                        resolve(true)\r\n                    }, null)\r\n                }, timeout)\r\n            }, null)\r\n        })\r\n    }\r\n\r\n    async performSwitchAction(inTarget: Element, outTarget: Element | null, inAction: ICuiComponentAction[], outAction: ICuiComponentAction[], onFinish: () => void, timeout: number): Promise<boolean> {\r\n        return new Promise((resolve) => {\r\n            this.#interactions.mutate(() => {\r\n                inAction.forEach(x => x.add(inTarget));\r\n                inTarget.classList.add(CLASSES.animProgress);\r\n                if (is(outTarget)) {\r\n                    //@ts-ignore\r\n                    outAction.forEach(x => x.add(outTarget));\r\n                    //@ts-ignore\r\n                    outTarget.classList.add(CLASSES.animProgress);\r\n                }\r\n                setTimeout(() => {\r\n                    this.#interactions.mutate(() => {\r\n                        inAction.forEach(x => x.remove(inTarget));\r\n                        inTarget.classList.remove(CLASSES.animProgress);\r\n                        if (is(outTarget)) {\r\n                            //@ts-ignore\r\n                            outAction.forEach(x => x.remove(outTarget));\r\n                            //@ts-ignore\r\n                            outTarget.classList.remove(CLASSES.animProgress);\r\n                        }\r\n                        onFinish();\r\n                        resolve(true)\r\n                    }, null)\r\n                }, timeout)\r\n            }, null)\r\n        })\r\n    }\r\n}","import { is, are, splitColon } from \"./functions\";\r\nimport { CuiUtils } from \"../models/utils\";\r\n\r\nexport interface ICuiComponentAction {\r\n    add(element: Element, utils?: CuiUtils): void;\r\n    remove(element: Element, utils?: CuiUtils): void;\r\n    toggle(element: Element, utils?: CuiUtils): void;\r\n}\r\n\r\nexport class CuiClassAction implements ICuiComponentAction {\r\n    #class: string;\r\n\r\n    constructor(className: string) {\r\n        this.#class = className;\r\n    }\r\n\r\n    add(element: Element, utils?: CuiUtils): void {\r\n        if (are(element, this.#class) && !element.classList.contains(this.#class)) {\r\n            element.classList.add(this.#class);\r\n        }\r\n    }\r\n\r\n    remove(element: Element, utils?: CuiUtils): void {\r\n        if (are(element, this.#class) && element.classList.contains(this.#class)) {\r\n            element.classList.remove(this.#class);\r\n        }\r\n    }\r\n\r\n    toggle(element: Element, utils?: CuiUtils): void {\r\n        if (are(element, this.#class)) {\r\n            if (element.classList.contains(this.#class)) {\r\n                element.classList.remove(this.#class);\r\n            } else {\r\n                element.classList.add(this.#class);\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nexport class CuiInboundAction implements ICuiComponentAction {\r\n    #name: string;\r\n\r\n    constructor(name: string) {\r\n        this.#name = name;\r\n    }\r\n    add(element: Element, utils?: CuiUtils): void {\r\n        if (!utils) {\r\n            return;\r\n        }\r\n        switch (this.#name) {\r\n            case 'dark-mode':\r\n                utils.setLightMode('dark')\r\n                break;\r\n            case 'light-mode':\r\n                utils.setLightMode('light')\r\n                break;\r\n        }\r\n    }\r\n\r\n    remove(element: Element, utils?: CuiUtils): void {\r\n        if (!utils) {\r\n            return;\r\n        }\r\n        switch (this.#name) {\r\n            case 'dark-mode':\r\n                utils.setLightMode('light')\r\n                break;\r\n            case 'light-mode':\r\n                utils.setLightMode('dark')\r\n                break;\r\n        }\r\n    }\r\n\r\n    toggle(element: Element, utils?: CuiUtils): void {\r\n        if (!utils) {\r\n            return;\r\n        }\r\n        switch (this.#name) {\r\n            case 'dark-mode':\r\n                this.setDarkMode(utils)\r\n                break;\r\n            case 'light-mode':\r\n                this.setDarkMode(utils)\r\n                break;\r\n        }\r\n    }\r\n\r\n    private setDarkMode(utils: CuiUtils) {\r\n        if (utils.getLightMode() === 'dark') {\r\n            utils.setLightMode('light')\r\n        } else {\r\n            utils.setLightMode('dark')\r\n        }\r\n    }\r\n}\r\n\r\nexport class AttributeAction implements ICuiComponentAction {\r\n    #attributeName: string;\r\n    #attributeValue: string;\r\n    constructor(attribute: string) {\r\n        [this.#attributeName, this.#attributeValue] = splitColon(attribute);// attribute.split(',')\r\n    }\r\n\r\n    add(element: Element, utils?: CuiUtils): void {\r\n        if (!are(element, this.#attributeName, this.#attributeValue)) {\r\n            return;\r\n        }\r\n        element.setAttribute(this.#attributeName, this.#attributeValue)\r\n    }\r\n\r\n    remove(element: Element, utils?: CuiUtils): void {\r\n        if (!are(element, this.#attributeName, this.#attributeValue)) {\r\n            return;\r\n        }\r\n        if (element.hasAttribute(this.#attributeName)) {\r\n            element.removeAttribute(this.#attributeName)\r\n        }\r\n\r\n    }\r\n\r\n    toggle(element: Element, utils?: CuiUtils): void {\r\n        if (!are(element, this.#attributeName, this.#attributeValue)) {\r\n            return;\r\n        }\r\n        if (element.hasAttribute(this.#attributeName)) {\r\n            element.removeAttribute(this.#attributeName)\r\n        } else {\r\n            element.setAttribute(this.#attributeName, this.#attributeValue)\r\n        }\r\n    }\r\n}\r\n\r\n\r\nexport class StyleAction implements ICuiComponentAction {\r\n    #attributeName: string;\r\n    #attributeValue: string;\r\n    constructor(attribute: string) {\r\n        [this.#attributeName, this.#attributeValue] = splitColon(attribute);\r\n    }\r\n\r\n    add(element: Element, utils?: CuiUtils): void {\r\n        if (!are(element, this.#attributeName, this.#attributeValue)) {\r\n            return;\r\n        }\r\n        let el = element as any;\r\n        if (el.style && !el.style[this.#attributeName]) {\r\n            el.style[this.#attributeName] = this.#attributeValue;\r\n        }\r\n\r\n    }\r\n\r\n    remove(element: Element, utils?: CuiUtils): void {\r\n        if (!are(element, this.#attributeName, this.#attributeValue)) {\r\n            return;\r\n        }\r\n        let el = element as any;\r\n        if (el.style && el.style[this.#attributeName]) {\r\n            el.style[this.#attributeName] = \"\";\r\n        }\r\n\r\n    }\r\n\r\n    toggle(element: Element, utils?: CuiUtils): void {\r\n        if (!are(element, this.#attributeName, this.#attributeValue)) {\r\n            return;\r\n        }\r\n        let el = element as any;\r\n        if (!el.style) {\r\n            return;\r\n        }\r\n        if (!el.style[this.#attributeName]) {\r\n            el.style[this.#attributeName] = this.#attributeValue;\r\n        } else {\r\n            delete el.style[this.#attributeName];\r\n        }\r\n    }\r\n}\r\n\r\nexport class DummyAction implements ICuiComponentAction {\r\n    constructor() {\r\n    }\r\n\r\n    add(element: Element, utils?: CuiUtils): void {\r\n\r\n    }\r\n\r\n    remove(element: Element, utils?: CuiUtils): void {\r\n    }\r\n\r\n    toggle(element: Element, utils?: CuiUtils): void {\r\n    }\r\n}\r\n\r\nexport class CuiActionsFatory {\r\n    public static get(value: string): ICuiComponentAction {\r\n        if (!is(value)) {\r\n            return new DummyAction();\r\n        }\r\n        let indicator = value[0];\r\n        switch (indicator) {\r\n            case '.':\r\n                return new CuiClassAction(value.substring(1));\r\n            case '~':\r\n                return new CuiInboundAction(value.substring(1));\r\n            case \"&\":\r\n                return new AttributeAction(value.substring(1));\r\n            case \"^\":\r\n                return new StyleAction(value.substring(1));\r\n            default:\r\n                return new CuiClassAction(value);\r\n        }\r\n    }\r\n}\r\n\r\nexport class CuiActionsListFactory {\r\n    public static get(value: string): ICuiComponentAction[] {\r\n        if (!is(value)) {\r\n            return [];\r\n        }\r\n        const split = value.split(',');\r\n        return split.map(single => {\r\n            return CuiActionsFatory.get(single.trim());\r\n        })\r\n    }\r\n}","import { is, are } from \"../../core/utils/functions\";\r\nimport { ICuiLogger, CuiCachable, CuiElement } from \"../../core/models/interfaces\";\r\nimport { CuiLoggerFactory } from \"../../core/factories/logger\";\r\nimport { CLASSES } from \"../../core/utils/statics\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiActionsHelper } from \"../../core/helpers/helpers\";\r\nimport { CuiClassAction } from \"../../core/utils/actions\";\r\n\r\nexport class ElementManager implements CuiCachable {\r\n    #elements: Element[];\r\n    #isLocked: boolean;\r\n    #logger: ICuiLogger;\r\n    #cDt: number;\r\n    #utils: CuiUtils;\r\n    #actionsHelper: CuiActionsHelper;\r\n    constructor(elements: Element[], utils: CuiUtils) {\r\n        this.#elements = elements;\r\n        this.#isLocked = false;\r\n        this.#logger = CuiLoggerFactory.get(\"ElementManager\");\r\n        this.#utils = utils;\r\n        this.#cDt = Date.now();\r\n        this.#actionsHelper = new CuiActionsHelper(utils.interactions);\r\n    }\r\n\r\n    async toggleClass(className: string): Promise<boolean> {\r\n        if (!is(className)) {\r\n            return false;\r\n        }\r\n        return this.call((element) => {\r\n            if (!element.classList.contains(className)) {\r\n                element.classList.add(className);\r\n            } else {\r\n                element.classList.remove(className);\r\n            }\r\n        }, 'toggleClass');\r\n    }\r\n\r\n    async toggleClassAs(className: string): Promise<boolean> {\r\n        if (!is(className)) {\r\n            return false;\r\n        }\r\n        return this.call((element) => {\r\n            let classes = element.classList;\r\n            this.#utils.interactions.fetch(() => {\r\n                if (!classes.contains(className)) {\r\n                    this.#utils.interactions.mutate(classes.add, classes, className);\r\n                } else {\r\n                    this.#utils.interactions.mutate(classes.remove, classes, className);\r\n                }\r\n            }, this)\r\n\r\n        }, 'toggleClassAs');\r\n    }\r\n\r\n    async setClass(className: string): Promise<boolean> {\r\n        if (!is(className)) {\r\n            return false;\r\n        }\r\n        return this.call((element) => {\r\n            if (!element.classList.contains(className)) {\r\n                element.classList.add(className)\r\n            }\r\n        }, 'setClass');\r\n    }\r\n\r\n    async setClassAs(className: string): Promise<boolean> {\r\n        if (!is(className)) {\r\n            return false;\r\n        }\r\n\r\n        return this.call((element) => {\r\n            let classes = element.classList;\r\n            this.#utils.interactions.fetch(() => {\r\n                if (!classes.contains(className)) {\r\n                    this.#utils.interactions.mutate(classes.add, classes, className);\r\n                }\r\n            }, this)\r\n\r\n        }, 'setClassAs');\r\n    }\r\n\r\n    async removeClass(className: string): Promise<boolean> {\r\n        if (!is(className)) {\r\n            return false;\r\n        }\r\n        return this.call((element) => {\r\n            if (element.classList.contains(className)) {\r\n                element.classList.remove(className)\r\n            }\r\n        }, 'removeClass');\r\n    }\r\n\r\n    async removeClassAs(className: string): Promise<boolean> {\r\n        if (!is(className)) {\r\n            return false;\r\n        }\r\n        return this.call((element) => {\r\n            let classes = element.classList;\r\n            this.#utils.interactions.fetch(() => {\r\n                if (classes.contains(className)) {\r\n                    this.#utils.interactions.mutate(classes.remove, classes, className);\r\n                }\r\n            }, this)\r\n        }, 'removeClass');\r\n    }\r\n\r\n    getAttribute(attributeName: string): string[] {\r\n        if (!is(attributeName)) {\r\n            return [];\r\n        }\r\n        return this.#elements.reduce<string[]>((val: string[], current: Element) => {\r\n            let attr = current.getAttribute(attributeName);\r\n            if (attr != null) {\r\n                val.push(attr)\r\n            }\r\n            return val;\r\n        }, []);\r\n    }\r\n\r\n    async setAttribute(attributeName: string, attributeValue?: string): Promise<boolean> {\r\n        if (!is(attributeName)) {\r\n            return false;\r\n        }\r\n        return this.call((element) => {\r\n            element.setAttribute(attributeName, attributeValue ?? \"\")\r\n        }, 'setAttribute');\r\n    }\r\n\r\n    async setAttributeAs(attributeName: string, attributeValue?: string): Promise<boolean> {\r\n        if (!is(attributeName)) {\r\n            return false;\r\n        }\r\n        return this.call((element) => {\r\n            this.#utils.interactions.mutate(element.setAttribute, element, attributeName, attributeValue ?? \"\")\r\n        }, 'setAttributeAs');\r\n    }\r\n\r\n    async removeAttribute(attributeName: string): Promise<boolean> {\r\n        if (!is(attributeName)) {\r\n            return false;\r\n        }\r\n        return this.call((element) => {\r\n            element.removeAttribute(attributeName)\r\n        }, 'removeAttribute');\r\n    }\r\n\r\n    async removeAttributeAs(attributeName: string): Promise<boolean> {\r\n        if (!is(attributeName)) {\r\n            return false;\r\n        }\r\n        return this.call((element) => {\r\n            this.#utils.interactions.mutate(element.removeAttribute, element, attributeName);\r\n        }, 'removeAttributeAs');\r\n    }\r\n\r\n    async toggleAttribute(attributeName: string, attributeValue?: string): Promise<boolean> {\r\n        if (!is(attributeName)) {\r\n            return false;\r\n        }\r\n        return this.call((element) => {\r\n            if (element.hasAttribute(attributeName)) {\r\n                element.removeAttribute(attributeName)\r\n            } else {\r\n                element.setAttribute(attributeName, attributeValue ?? \"\")\r\n            }\r\n        }, 'toggleAttribute');\r\n    }\r\n\r\n    async toggleAttributeAs(attributeName: string, attributeValue?: string): Promise<boolean> {\r\n        if (!is(attributeName)) {\r\n            return false;\r\n        }\r\n        return this.call((element) => {\r\n            this.#utils.interactions.fetch(() => {\r\n                if (element.hasAttribute(attributeName)) {\r\n                    this.#utils.interactions.mutate(element.removeAttribute, element, attributeName);\r\n                } else {\r\n                    this.#utils.interactions.mutate(element.setAttribute, element, attributeName, attributeValue ?? \"\")\r\n                }\r\n            }, this)\r\n\r\n        }, 'toggleAttributeAs');\r\n    }\r\n\r\n    async click(onClick: (ev: MouseEvent) => void): Promise<boolean> {\r\n        if (!is(onClick)) {\r\n            return false;\r\n        }\r\n        return this.call((element) => {\r\n            //@ts-ignore\r\n            element.addEventListener('click', onClick);\r\n        }, 'click');\r\n    }\r\n\r\n    async event(eventName: string, callback: any): Promise<boolean> {\r\n        if (!is(eventName) || !is(callback)) {\r\n            return false;\r\n        }\r\n        return this.call((element) => {\r\n            element.addEventListener(eventName, callback);\r\n        }, 'event');\r\n    }\r\n\r\n    async call(callback: (element: Element, index: Number) => void, functionName?: string): Promise<boolean> {\r\n        if (this.#isLocked) {\r\n            this.#logger.error(\"Element is locked\", functionName)\r\n        }\r\n        this.lock();\r\n        this.#elements.forEach((element, index) => {\r\n            callback(element, index)\r\n        })\r\n        this.unlock();\r\n        return true;\r\n    }\r\n\r\n    async animate(className: string, timeout?: number): Promise<boolean> {\r\n        if (!is(className)) {\r\n            return false;\r\n        }\r\n        const delay = timeout ?? this.#utils.setup.animationTime;\r\n        return this.call((element) => {\r\n            this.change(() => {\r\n                element.classList.add(className);\r\n                element.classList.add(CLASSES.animProgress);\r\n                setTimeout(() => {\r\n                    this.change(() => {\r\n                        element.classList.remove(className);\r\n                        element.classList.remove(CLASSES.animProgress);\r\n                    })\r\n                }, delay)\r\n            })\r\n        });\r\n    }\r\n\r\n    async open(openClass: string, animationClass: string, timeout?: number): Promise<boolean> {\r\n        if (!are(openClass, animationClass)) {\r\n            return false\r\n        }\r\n        const delay = timeout ?? this.#utils.setup.animationTime;\r\n        const action = new CuiClassAction(animationClass);\r\n        return this.call((element) => {\r\n            this.#actionsHelper.performAction(element, action, delay ?? 0).then(() => {\r\n                element.classList.add(openClass);\r\n            })\r\n        });\r\n    }\r\n\r\n    async close(closeClass: string, animationClass: string, timeout?: number): Promise<boolean> {\r\n        if (!are(closeClass, animationClass)) {\r\n            return false\r\n        }\r\n        const delay = timeout ?? this.#utils.setup.animationTime;\r\n        const action = new CuiClassAction(animationClass);\r\n        return this.call((element) => {\r\n            this.#actionsHelper.performAction(element, action, delay ?? 0).then(() => {\r\n                element.classList.remove(closeClass);\r\n            })\r\n        });\r\n    }\r\n\r\n    emit(event: string, ...args: any[]): void {\r\n        if (!is(event)) {\r\n            this.#logger.warning(\"Not enough data to emit event\", \"emit\")\r\n            return;\r\n        }\r\n        this.call((element: Element) => {\r\n            let cuid = (<CuiElement>(element as any)).$cuid;\r\n            if (is(cuid)) {\r\n                this.#logger.debug(`Emitting event ${event} to ${cuid}`)\r\n                this.#utils.bus.emit(event, cuid, ...args);\r\n            }\r\n        }, \"emit\")\r\n    }\r\n\r\n    on(event: string, callback: any): string[] {\r\n        let ids: string[] = []\r\n        if (!are(event, callback)) {\r\n            this.#logger.error(\"Incorrect arguments\", \"on\")\r\n            return ids;\r\n        }\r\n\r\n        this.call((element: Element) => {\r\n            let cuiElement = (<CuiElement>(element as any));\r\n            if (is(cuiElement)) {\r\n                let disposeId = this.#utils.bus.on(event, callback, cuiElement);\r\n                if (disposeId != null)\r\n                    ids.push(disposeId);\r\n            }\r\n        }, \"on\")\r\n        return ids;\r\n    }\r\n\r\n    detach(event: string, id: string): void {\r\n        if (!are(event, id)) {\r\n            this.#logger.error(\"Incorrect arguments\", \"detach\")\r\n        }\r\n        this.call((element: Element) => {\r\n            let cuiElement = (<CuiElement>(element as any));\r\n            if (is(cuiElement)) {\r\n                this.#utils.bus.detach(event, id, cuiElement);\r\n            }\r\n        }, \"detach\")\r\n    }\r\n\r\n    read(callback: any, ...args: any[]): void {\r\n        this.#utils.interactions.fetch(callback, this, ...args)\r\n    }\r\n\r\n    change(callback: any, ...args: any[]): void {\r\n        this.#utils.interactions.mutate(callback, this, ...args)\r\n    }\r\n\r\n    elements(): Element[] {\r\n        return this.#elements;\r\n    }\r\n\r\n    count() {\r\n        return this.#elements.length;\r\n    }\r\n\r\n    lock() {\r\n        this.#isLocked = true;\r\n    }\r\n\r\n    unlock() {\r\n        this.#isLocked = false;\r\n    }\r\n\r\n    isLocked(): boolean {\r\n        return this.#isLocked;\r\n    }\r\n\r\n    refresh(): boolean {\r\n        return (Date.now() - this.#cDt) < 360000;\r\n    }\r\n}","import { CLASSES } from \"../../core/utils/statics\";\r\nimport { ICuiLogger, IUIInteractionProvider } from \"../../core/models/interfaces\";\r\nimport { CuiLoggerFactory } from \"../../core/factories/logger\";\r\nimport { is } from \"../../core/utils/functions\";\r\n\r\nexport class CollectionManagerHelper {\r\n    #elements: Element[];\r\n    #log: ICuiLogger;\r\n    #isLocked: boolean;\r\n    #toggleClass: string;\r\n    #interactions: IUIInteractionProvider;\r\n    constructor(interactions: IUIInteractionProvider) {\r\n        this.#interactions = interactions;\r\n        this.#log = CuiLoggerFactory.get('CollectionManager');\r\n        this.#elements = [];\r\n        this.#isLocked = false;\r\n        this.#toggleClass = \"\";\r\n    }\r\n\r\n    setElements(elements: Element[]) {\r\n        this.#elements = elements;\r\n    }\r\n\r\n    setToggle(className: string) {\r\n        this.#toggleClass = className;\r\n    }\r\n\r\n    addAnimationClass(currentElement: Element, nextElement: Element, animIn: string, animOut: string,): void {\r\n        nextElement.classList.add(CLASSES.animProgress);\r\n        currentElement.classList.add(animOut);\r\n        nextElement.classList.add(animIn);\r\n    }\r\n\r\n    setFinalClasses(currentElement: Element, nextElement: Element, animIn: string, animOut: string): void {\r\n        nextElement.classList.remove(CLASSES.animProgress);\r\n        currentElement.classList.remove(animOut);\r\n        nextElement.classList.remove(animIn);\r\n        currentElement.classList.remove(this.#toggleClass);\r\n        nextElement.classList.add(this.#toggleClass);\r\n    }\r\n\r\n    verifyIndex(index: number, current: number, count: number): boolean {\r\n        return index >= 0 && index !== current && index < count\r\n    }\r\n\r\n    async setCurrent(newIndex: number, current: number): Promise<boolean> {\r\n        this.lock();\r\n        this.#log.debug(`Switching index from: ${current} to ${newIndex}`)\r\n        if (current > -1)\r\n            this.#elements[current].classList.remove(this.#toggleClass);\r\n        this.#elements[newIndex].classList.add(this.#toggleClass);\r\n        this.unlock();\r\n        return true;\r\n    }\r\n\r\n    async setCurrentWithAnimation(newIndex: number, animClassIn: string, animClassOut: string, duration: number, current: number): Promise<boolean> {\r\n        this.lock()\r\n        this.#log.debug(`Switching index from: ${current} to ${newIndex}`)\r\n\r\n        const currentElement = this.#elements[current];\r\n        const nextElement = this.#elements[newIndex];\r\n        this.#interactions.mutate(this.addAnimationClass, this, currentElement, nextElement, animClassIn, animClassOut);\r\n        setTimeout(() => {\r\n            this.#interactions.mutate(this.setFinalClasses, this, currentElement, nextElement, animClassIn, animClassOut)\r\n            this.unlock();\r\n        }, duration)\r\n        return true;\r\n    }\r\n\r\n    getCurrentIndex(): number {\r\n        if (!is(this.#toggleClass)) {\r\n            return -1;\r\n        }\r\n        let len = this.count();\r\n        for (let i = 0; i < len; i++) {\r\n            if (this.#elements[i].classList.contains(this.#toggleClass)) {\r\n                return i;\r\n            }\r\n        }\r\n        return -1;\r\n    }\r\n\r\n    elements(): Element[] {\r\n        return this.#elements;\r\n    }\r\n\r\n    check(): boolean {\r\n        if (this.#isLocked) {\r\n            this.#log.warning(\"Object locked. Operation in progress\", \"Check\");\r\n            return false;\r\n        } else if (!is(this.#toggleClass)) {\r\n            this.#log.warning(\"Toggle is not set. Call setToggleClass\", \"Check\");\r\n            return false;\r\n        } else if (this.count() <= 0) {\r\n            this.#log.warning(\"Elements list is empty\", \"Check\");\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n\r\n    count(): number {\r\n        return this.#elements ? this.#elements.length : -1;\r\n    }\r\n\r\n    lock() {\r\n        this.#isLocked = true;\r\n    }\r\n\r\n    unlock() {\r\n        this.#isLocked = false\r\n    }\r\n\r\n\r\n}","import { IUIInteractionProvider, ICuiLogger, CuiCachable } from \"../../core/models/interfaces\";\r\nimport { CuiLoggerFactory } from \"../../core/factories/logger\";\r\nimport { CollectionManagerHelper } from \"../helpers/collection\";\r\n\r\nexport class CollectionManager implements CuiCachable {\r\n    #log: ICuiLogger;\r\n    #cDt: number;\r\n    #helper: CollectionManagerHelper;\r\n\r\n    constructor(elements: Element[], interactions: IUIInteractionProvider) {\r\n        this.#log = CuiLoggerFactory.get('CollectionManager');\r\n        this.#helper = new CollectionManagerHelper(interactions);\r\n        this.#helper.setElements(elements);\r\n        this.#cDt = Date.now();\r\n    }\r\n\r\n    setToggle(className: string) {\r\n        this.#helper.setToggle(className)\r\n    }\r\n\r\n    setElements(elements: Element[]) {\r\n        this.#helper.setElements(elements);\r\n    }\r\n\r\n    click(callback: (element: Element, index: number) => void): void {\r\n        this.#helper.elements().forEach((element, index) => {\r\n            element.addEventListener('click', () => {\r\n                this.set(index).then(() => {\r\n                    if (callback) {\r\n                        callback(element, index)\r\n                    }\r\n                })\r\n            })\r\n        })\r\n    }\r\n\r\n    async next(): Promise<boolean> {\r\n        if (!this.#helper.check()) {\r\n            return false;\r\n        }\r\n        let newIdx = this.#helper.getCurrentIndex() + 1;\r\n        return this.set(newIdx >= this.length() ? 0 : newIdx);\r\n    }\r\n\r\n    async previous(): Promise<boolean> {\r\n        if (!this.#helper.check()) {\r\n            return false;\r\n        }\r\n        let newIdx = this.#helper.getCurrentIndex() - 1;\r\n        return this.set(newIdx < 0 ? this.length() - 1 : newIdx)\r\n    }\r\n\r\n    async set(index: number): Promise<boolean> {\r\n        let current = this.#helper.getCurrentIndex();\r\n        if (!this.#helper.check() || !this.#helper.verifyIndex(index, current, this.length())) {\r\n            return false;\r\n        }\r\n        return this.#helper.setCurrent(index, current)\r\n    }\r\n\r\n    async setWithAnimation(index: number, animClassIn: string, animClassOut: string, duration: number): Promise<boolean> {\r\n        let current = this.#helper.getCurrentIndex();\r\n        if (!this.#helper.check() || !this.#helper.verifyIndex(index, current, this.length())) {\r\n            return false;\r\n        }\r\n        return this.#helper.setCurrentWithAnimation(index, animClassIn, animClassOut, duration, current)\r\n    }\r\n\r\n    getCurrentIndex(): number {\r\n        return this.#helper.getCurrentIndex();\r\n    }\r\n\r\n    length() {\r\n        return this.#helper.count();\r\n    }\r\n\r\n    refresh(): boolean {\r\n        return this.length() > 0 && Date.now() - this.#cDt > 360000;\r\n    }\r\n}","import { ICuiPlugin, ICuiLogger, ICuiMutiationPlugin, ICuiPluginManager } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiLoggerFactory } from \"../../core/factories/logger\";\r\nimport { is } from \"../../core/utils/functions\";\r\n\r\n\r\n\r\nexport class CuiPluginManager implements ICuiPluginManager {\r\n    #plugins: ICuiPlugin[];\r\n    #mutated: ICuiMutiationPlugin[];\r\n    #log: ICuiLogger;\r\n    constructor(plugins: ICuiPlugin[]) {\r\n        this.#plugins = plugins ?? [];\r\n        this.#log = CuiLoggerFactory.get(\"CuiPluginManager\")\r\n        this.#mutated = [];\r\n    }\r\n\r\n    init(utils: CuiUtils): void {\r\n        this.#log.debug(\"Plugins initialization started: \" + this.#plugins.length)\r\n        this.#mutated = this.#plugins.filter((plugin: any) => {\r\n            return is(plugin.mutation);\r\n        }) as any;\r\n        this.#plugins.forEach(plugin => {\r\n            plugin.init(utils);\r\n            utils.setup.plugins[plugin.description] = plugin.setup;\r\n        })\r\n        this.#log.debug(\"Plugins have been initialized\");\r\n    }\r\n\r\n    get(name: string): ICuiPlugin | undefined {\r\n        if (!is(name)) {\r\n            return undefined;\r\n        }\r\n        return this.#plugins.find(p => p.name === name);\r\n    }\r\n\r\n    has(name: string): boolean {\r\n        return is(this.get(name))\r\n    }\r\n\r\n    async onMutation(mutation: MutationRecord): Promise<boolean> {\r\n        let tasks: Promise<boolean>[] = [];\r\n        this.#mutated.forEach((plugin: any) => {\r\n            tasks.push(plugin.mutation(mutation))\r\n        })\r\n        let result: boolean[] = await Promise.all(tasks);\r\n        return result.find(val => {\r\n            val === false\r\n        }) ? false : true;\r\n    }\r\n\r\n}","import { CuiSetupInit } from \"../core/models/setup\";\r\nimport { is, joinAttributesForQuery, are } from \"../core/utils/functions\";\r\nimport { STATICS, EVENTS, CSS_VARIABLES } from \"../core/utils/statics\";\r\nimport { ICuiLogger, ICuiPlugin, ICuiComponent, ICuiPluginManager, CuiElement } from \"../core/models/interfaces\";\r\nimport { ICuiMutionObserver, CuiMutationObserver } from \"../core/observers/mutations\";\r\nimport { CuiLoggerFactory } from \"../core/factories/logger\";\r\nimport { CuiUtils } from \"../core/models/utils\";\r\nimport { CuiInstanceInitError } from \"../core/models/errors\";\r\nimport { ElementManager } from \"./managers/element\";\r\nimport { CollectionManager } from \"./managers/collection\";\r\nimport { CuiPluginManager } from \"./managers/plugins\";\r\nimport { addCuiArgument, createCuiElement, getMatchingComponents } from \"../core/utils/api\";\r\n\r\n\r\nexport class CuiInstance {\r\n    #log: ICuiLogger;\r\n    #mutationObserver: ICuiMutionObserver | undefined;\r\n    #utils: CuiUtils;\r\n    #plugins: ICuiPluginManager;\r\n    #components: ICuiComponent[];\r\n    #rootElement: HTMLElement;\r\n    #mutatedAttributes: string[];\r\n    constructor(setup: CuiSetupInit, plugins: ICuiPlugin[], components: ICuiComponent[]) {\r\n        STATICS.prefix = setup.prefix;\r\n        STATICS.logLevel = setup.logLevel;\r\n        this.#log = CuiLoggerFactory.get('CuiInstance')\r\n        this.#plugins = new CuiPluginManager(plugins);\r\n        this.#components = components ?? [];\r\n        this.#utils = new CuiUtils(setup, plugins.map(plugin => { return plugin.name; }));\r\n        this.#rootElement = setup.root;\r\n        this.#mutationObserver = undefined;\r\n        this.#mutatedAttributes = [];\r\n    }\r\n\r\n    async init(): Promise<CuiInstance> {\r\n        this.#log.debug(\"Instance started\", \"init\")\r\n        // Init elements\r\n        if (!is(window.MutationObserver)) {\r\n            throw new CuiInstanceInitError(\"Mutation observer does not exists\");\r\n        }\r\n        this.#mutatedAttributes = this.#components.map(x => { return x.attribute }); // MUTATED_ATTRIBUTES; \r\n        const initElements = is(this.#mutatedAttributes) ? this.#rootElement.querySelectorAll(joinAttributesForQuery(this.#mutatedAttributes)) : null;\r\n        if (is(initElements)) {\r\n            //@ts-ignore initElements already checked\r\n            this.#log.debug(`Initiating ${initElements.length} elements`)\r\n            let promises = [];\r\n            //@ts-ignore initElements already checked\r\n            for (let element of initElements) {\r\n                try {\r\n                    let matchingComponents = await getMatchingComponents(element, this.#components)\r\n                    promises.push(createCuiElement(element, matchingComponents, this.#utils));\r\n                } catch (e) {\r\n                    this.#log.exception(e);\r\n                }\r\n            }\r\n            await Promise.all(promises);\r\n        }\r\n        this.#log.debug(\"Init plugins\", \"init\")\r\n        // Init plugins\r\n        this.#plugins.init(this.#utils);\r\n\r\n        if (are(this.#components, this.#mutatedAttributes)) {\r\n            this.#log.debug(\"Init mutation observer\", \"init\")\r\n            this.#mutationObserver = new CuiMutationObserver(this.#rootElement, this.#utils)\r\n            this.#mutationObserver.setComponents(this.#components).setAttributes(this.#mutatedAttributes)\r\n            this.#mutationObserver.setPlugins(this.#plugins);\r\n            this.#mutationObserver.start();\r\n        }\r\n\r\n        this.#log.debug(\"Setting CSS globals\", 'init')\r\n        this.#utils.interactions.mutate(() => {\r\n            this.#utils.setProperty(CSS_VARIABLES.animationTimeLong, `${this.#utils.setup.animationTimeLong}ms`)\r\n            this.#utils.setProperty(CSS_VARIABLES.animationTime, `${this.#utils.setup.animationTime}ms`);\r\n            this.#utils.setProperty(CSS_VARIABLES.animationTimeShort, `${this.#utils.setup.animationTimeShort}ms`);\r\n        }, null)\r\n\r\n        this.#utils.bus.emit(EVENTS.INSTANCE_INITIALIZED, null)\r\n        return this;\r\n    }\r\n\r\n    finish(): void {\r\n        if (this.#mutationObserver)\r\n            this.#mutationObserver.stop();\r\n        this.#utils.bus.emit(EVENTS.INSTANCE_FINISHED, null)\r\n    }\r\n\r\n    get(selector: string): ElementManager | undefined {\r\n        const elements = this.all(selector);\r\n        if (!elements) {\r\n            return undefined;\r\n        }\r\n        const newElement = new ElementManager(elements, this.#utils);\r\n        return newElement\r\n    }\r\n\r\n    collection(selector: string): CollectionManager | undefined {\r\n        const elements = this.all(selector);\r\n        if (!is(elements)) {\r\n            return undefined;\r\n        }\r\n        // @ts-ignore already checked\r\n        let manager = new CollectionManager(elements, this.#utils.interactions);\r\n        return manager;\r\n    }\r\n\r\n    select(selector: string): Element | null {\r\n        return document.querySelector(selector)\r\n    }\r\n\r\n    all(selector: string): Element[] | undefined {\r\n        const nodes: NodeListOf<Element> = document.querySelectorAll(selector);\r\n        if (!is(nodes)) {\r\n            return undefined;\r\n        }\r\n        return [...nodes];\r\n    }\r\n\r\n    getUtils(): CuiUtils {\r\n        return this.#utils;\r\n    }\r\n\r\n    on(event: string, callback: any, element?: CuiElement): void {\r\n        if (!are(event, callback)) {\r\n            this.#log.error(\"Incorrect arguments\", \"on\")\r\n        }\r\n        this.#utils.bus.on(event, callback, element);\r\n    }\r\n\r\n    detach(event: string, id: string): void {\r\n        if (!are(event, id)) {\r\n            this.#log.error(\"Incorrect arguments\", \"detach\")\r\n        }\r\n        this.#utils.bus.detach(event, id);\r\n    }\r\n\r\n    detachAll(event: string): void {\r\n        if (!is(event)) {\r\n            this.#log.error(\"Incorrect arguments\", \"detachAll\")\r\n        }\r\n        this.#utils.bus.detachAll(event);\r\n    }\r\n\r\n    emit(event: string, element: Element | string, ...args: any[]): void {\r\n        if (!are(event, element)) {\r\n            this.#log.warning(\"Not enough data to emit event\", \"emit\")\r\n            return;\r\n        }\r\n        let cuid = null\r\n        if (typeof element === 'string' && element.startsWith('~')) {\r\n            cuid = element.substring(1);\r\n        } else {\r\n            let el = typeof element === 'string' ? document.querySelector(element) : element;\r\n            cuid = (<CuiElement>(el as any)).$cuid;\r\n        }\r\n        if (!is(cuid)) {\r\n            this.#log.warning(\"Element is not a cUI element\", \"emit\")\r\n            return\r\n        }\r\n        this.#utils.bus.emit(event, cuid, ...args);\r\n    }\r\n\r\n    getPlugin(name: string): ICuiPlugin | undefined {\r\n        return this.#plugins.get(name);\r\n    }\r\n\r\n\r\n    /**\r\n     * Creates cUI element outside of cUI root scope\r\n     * @param element \r\n     * @param arg \r\n     * @param data \r\n     */\r\n    async createCuiElement<T extends object>(element: HTMLElement, arg: string, data: T): Promise<boolean> {\r\n        if (!is(arg) || !this.#mutatedAttributes.includes(arg)) {\r\n            this.#log.error(\"Element cannot be created: Unknown attribute\")\r\n            return false;\r\n        }\r\n        let component = this.#components.find(component => component.attribute === arg);\r\n\r\n        if (!component)\r\n            return false;\r\n\r\n        if (addCuiArgument(element, arg, data)) {\r\n            return createCuiElement(element, [component], this.#utils);\r\n        }\r\n\r\n        return false;\r\n    }\r\n}","import { PropsTypes } from \"./engine\";\r\nimport { AnimationProperty } from \"./interfaces\";\r\n\r\nexport interface AnimationDefinition {\r\n    previous: DefinitionItem;\r\n    current: DefinitionItem;\r\n}\r\n\r\nexport interface DefinitionItem {\r\n    left: AnimationProperty<PropsTypes>;\r\n    right: AnimationProperty<PropsTypes>\r\n}\r\n\r\nexport interface CuiAnimationsDefinition {\r\n    [id: string]: AnimationDefinition;\r\n}\r\n\r\nexport const SWIPE_ANIMATIONS_DEFINITIONS: CuiAnimationsDefinition = {\r\n    \"slide\": {\r\n        current: {\r\n            left: {\r\n                transform: {\r\n                    translateX: {\r\n                        from: 0,\r\n                        to: -100,\r\n                        unit: \"%\"\r\n                    }\r\n                }\r\n            },\r\n            right: {\r\n                transform: {\r\n                    translateX: {\r\n                        from: 0,\r\n                        to: 100,\r\n                        unit: \"%\"\r\n                    }\r\n                }\r\n            }\r\n        },\r\n        previous: {\r\n            left: {\r\n                transform: {\r\n                    translateX: {\r\n                        from: 100,\r\n                        to: 0,\r\n                        unit: \"%\"\r\n                    }\r\n                }\r\n            },\r\n            right: {\r\n                transform: {\r\n                    translateX: {\r\n                        from: -100,\r\n                        to: 0,\r\n                        unit: \"%\"\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    },\r\n    fade: {\r\n        current: {\r\n            left: {\r\n                opacity: {\r\n                    from: 1,\r\n                    to: 0\r\n                }\r\n            },\r\n            right: {\r\n                opacity: {\r\n                    from: 1,\r\n                    to: 0\r\n                }\r\n            }\r\n        },\r\n        previous: {\r\n            left: {\r\n                opacity: {\r\n                    from: 0,\r\n                    to: 1\r\n                }\r\n            },\r\n            right: {\r\n                opacity: {\r\n                    from: 0,\r\n                    to: 1\r\n                }\r\n            }\r\n        }\r\n    },\r\n    push: {\r\n        current: {\r\n            left: {\r\n                transform: {\r\n                    translateX: {\r\n                        from: 0,\r\n                        to: -10,\r\n                        unit: \"%\"\r\n                    }\r\n                }\r\n            },\r\n            right: {\r\n                transform: {\r\n                    translateX: {\r\n                        from: 0,\r\n                        to: 10,\r\n                        unit: \"%\"\r\n                    }\r\n                }\r\n            }\r\n        },\r\n        previous: {\r\n            left: {\r\n                transform: {\r\n                    translateX: {\r\n                        from: 100,\r\n                        to: 0,\r\n                        unit: \"%\"\r\n                    }\r\n                }\r\n            },\r\n            right: {\r\n                transform: {\r\n                    translateX: {\r\n                        from: -100,\r\n                        to: 0,\r\n                        unit: \"%\"\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n","import { CuiSetupInit } from \"../core/models/setup\";\r\nimport { is } from \"../core/utils/functions\";\r\nimport { CuiInstance } from \"./instance\";\r\nimport { ICONS } from \"../core/utils/statics\";\r\nimport { ICuiComponent, ICuiPlugin } from \"../core/models/interfaces\";\r\nimport { CuiAnimationsDefinition, SWIPE_ANIMATIONS_DEFINITIONS } from \"../core/animation/definitions\";\r\n\r\nexport interface CuiInitData {\r\n    plugins?: ICuiPlugin[];\r\n    components?: ICuiComponent[];\r\n    setup?: CuiSetupInit;\r\n    icons?: any;\r\n    swipeAnimations?: CuiAnimationsDefinition;\r\n}\r\n\r\nexport interface CuiInitResult {\r\n    result: boolean;\r\n    message?: string;\r\n}\r\n\r\nexport class CuiInitializer {\r\n    #window: any;\r\n    constructor() {\r\n        this.#window = window;\r\n    }\r\n\r\n    async init(setup: CuiInitData): Promise<CuiInitResult> {\r\n        let settings: CuiSetupInit = { ... new CuiSetupInit(), ...setup.setup }\r\n        const appPrefix: string = settings.app;\r\n        const result: CuiInitResult = {\r\n            result: false\r\n        }\r\n        if (is(this.#window[appPrefix])) {\r\n            result.message = \"Instance is already initialized\";\r\n            return result;\r\n        }\r\n        if (is(setup.icons)) {\r\n            for (let icon in setup.icons) {\r\n                ICONS[icon] = setup.icons[icon];\r\n            }\r\n        }\r\n        if (is(setup.swipeAnimations)) {\r\n            for (let animation in setup.swipeAnimations) {\r\n                SWIPE_ANIMATIONS_DEFINITIONS[animation] = setup.swipeAnimations[animation];\r\n            }\r\n\r\n        }\r\n        try {\r\n            this.#window[appPrefix] = new CuiInstance(settings, setup.plugins ?? [], setup.components ?? [])\r\n            this.#window[appPrefix].init();\r\n        } catch (e) {\r\n            console.error(e);\r\n            result.message = \"An error occured during initialization\";\r\n            return result;\r\n        }\r\n        result.result = true;\r\n        return result;\r\n    }\r\n}","export class AriaAttributes {\r\n    public static setLabel(element: Element, label: string): void {\r\n        if (!element.hasAttribute('aria-label')) {\r\n            element.setAttribute('aria-label', label);\r\n        }\r\n    }\r\n\r\n    public static setAria(element: Element, attr: string, value: string) {\r\n        if (!element.hasAttribute(attr)) {\r\n            element.setAttribute(attr, value);\r\n        }\r\n    }\r\n\r\n    public static removeAria(element: Element, attr: string) {\r\n        if (element.hasAttribute(attr)) {\r\n            element.removeAttribute(attr);\r\n        }\r\n    }\r\n}","import { ICuiLogger, IUIInteractionProvider, CuiContext, ICuiComponentHandler, ICuiParsable, ICuiOpenable, ICuiClosable, CuiDevelopmentStateType, KeyDownEvent } from \"../models/interfaces\";\r\nimport { CuiLoggerFactory } from \"../factories/logger\";\r\nimport { CuiUtils } from \"../models/utils\";\r\nimport { ICuiComponentMutationObserver, CuiComponentMutationHandler } from \"../observers/mutations\";\r\nimport { AriaAttributes } from \"../utils/aria\";\r\nimport { CuiActionsHelper } from \"../helpers/helpers\";\r\nimport { ICuiComponentAction, CuiActionsListFactory } from \"../utils/actions\";\r\nimport { is, getActiveClass, clone } from \"../utils/functions\";\r\nimport { EVENTS } from \"../utils/statics\";\r\n\r\nexport interface CuiChildMutation {\r\n    removed: Node[];\r\n    added: Node[];\r\n}\r\n\r\nexport class ComponentHelper {\r\n    #interactions: IUIInteractionProvider;\r\n    constructor(interactions: IUIInteractionProvider) {\r\n        this.#interactions = interactions;\r\n    }\r\n\r\n    hasClass(cls: string, element: Element): boolean {\r\n        return cls && element.classList.contains(cls) ? true : false;\r\n    }\r\n\r\n    setClass(cls: string, element: Element): void {\r\n        this.setClasses([cls], element);\r\n    }\r\n\r\n    setClasses(classes: string[], element?: Element) {\r\n        if (element) {\r\n            element.classList.add(...classes)\r\n        }\r\n    }\r\n\r\n    setClassesAs(element: Element, ...classes: string[]) {\r\n        this.#interactions.mutate(this.setClasses, this, classes, element);\r\n    }\r\n\r\n    removeClass(cls: string, element: Element) {\r\n        this.removeClasses([cls], element);\r\n    }\r\n\r\n    removeClasses(classes: string[], element?: Element) {\r\n        if (element) {\r\n            element.classList.remove(...classes)\r\n        }\r\n    }\r\n\r\n    removeClassesAs(element: Element, ...classes: string[]) {\r\n        this.#interactions.mutate(this.removeClasses, this, classes, element);\r\n    }\r\n\r\n    removeAttribute(attributeName: string, element: Element) {\r\n        if (element && element.hasAttribute(attributeName))\r\n            element.removeAttribute(attributeName);\r\n    }\r\n\r\n    setStyle(element: any, property: string, value: string) {\r\n        if (element && element[\"style\"] && is(value)) {\r\n            element.style[property] = value\r\n        }\r\n    }\r\n\r\n\r\n}\r\n\r\nexport class CuiComponentBase implements CuiContext {\r\n    _log: ICuiLogger;\r\n    utils: CuiUtils;\r\n    element: HTMLElement;\r\n    cuid: string;\r\n    isLocked: boolean;\r\n    activeClassName: string;\r\n    helper: ComponentHelper;\r\n    #emittedEvents: string[];\r\n    componentName: string;\r\n    constructor(componentName: string, element: HTMLElement, utils: CuiUtils) {\r\n        this._log = CuiLoggerFactory.get(componentName);\r\n        this.utils = utils;\r\n        this.element = element;\r\n        this.cuid = (<any>element).$cuid;\r\n        this.isLocked = false;\r\n        this._log.setId(this.cuid);\r\n        this.activeClassName = getActiveClass(utils.setup.prefix);\r\n        this.helper = new ComponentHelper(utils.interactions);\r\n        this.#emittedEvents = [];\r\n        this.componentName = componentName;\r\n    }\r\n\r\n\r\n    mutate(callback: any, ...args: any[]): void {\r\n        this.utils.interactions.mutate(callback, this, ...args)\r\n    }\r\n\r\n    fetch(callback: any, ...args: any[]): void {\r\n        this.utils.interactions.fetch(callback, this, ...args)\r\n    }\r\n\r\n    getEventName(name: string) {\r\n        return [name, this.cuid].join('-');\r\n    }\r\n\r\n    /**\r\n     * Emits event using passed data and cuid of the element\r\n     * NOTE: Don't use it to emit global events\r\n     * @param event Event name\r\n     * @param data Data to emit\r\n     */\r\n    emitEvent(event: string, ...data: any[]) {\r\n        if (!this.#emittedEvents.includes(event))\r\n            this.#emittedEvents.push(event);\r\n        this.utils.bus.emit(event, this.cuid, ...data)\r\n    }\r\n\r\n    onEvent(event: string, callback: any): string | null {\r\n        return this.utils.bus.on(event, callback, this.element as any)\r\n    }\r\n\r\n    detachEvent(event: string, id: string | null) {\r\n        if (id != null) {\r\n            this.utils.bus.detach(event, id);\r\n            id = \"\";\r\n        }\r\n    }\r\n\r\n    getId(): string {\r\n        return this.cuid;\r\n    }\r\n\r\n    checkLockAndWarn(fName?: string): boolean {\r\n        if (this.isLocked) {\r\n            this._log.warning(\"Component is locked\", fName)\r\n            return true\r\n        }\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * Helper which checks whether element has an active flag set\r\n     */\r\n    isActive(): boolean {\r\n        return this.element.classList.contains(this.activeClassName);\r\n    }\r\n\r\n    detachEmiitedEvents() {\r\n        this.#emittedEvents.forEach(event => {\r\n            this.utils.bus.detachByCuid(event, this.cuid);\r\n            this._log.debug(\"Detaching event: \" + event + \" on component delete\");\r\n        })\r\n    }\r\n\r\n    registerInDebug(): void {\r\n        this.utils.development.registerElement(this.element, this.cuid, this.componentName);\r\n    }\r\n\r\n    removeFromDebug(): void {\r\n        this.utils.development.unregisterElement(this.cuid, this.componentName);\r\n    }\r\n\r\n    setDebugProperty<T>(name: string, value: T): void {\r\n        this.utils.development.setProperty(this.cuid, this.componentName, name, value);\r\n    }\r\n\r\n    logInfo(message: string, functionName?: string) {\r\n        this._log.debug(message, functionName);\r\n        this.utils.development.pushState(this.cuid, this.componentName, \"info\", message, functionName);\r\n    }\r\n\r\n    logWarning(message: string, functionName?: string) {\r\n        this._log.warning(message, functionName);\r\n        this.utils.development.pushState(this.cuid, this.componentName, \"warning\", message, functionName);\r\n    }\r\n\r\n    pushDebugState(type: CuiDevelopmentStateType, message: string, functionName?: string) {\r\n        this.utils.development.pushState(this.cuid, this.componentName, type, message, functionName);\r\n    }\r\n\r\n\r\n    logError(message: string, functionName?: string, error?: Error) {\r\n        this._log.error(message, functionName);\r\n        if (error) {\r\n            this._log.exception(error, functionName)\r\n        }\r\n        this.utils.development.pushState(this.cuid, this.componentName, \"error\", message, functionName);\r\n    }\r\n\r\n}\r\n\r\nexport abstract class CuiHandlerBase<T extends ICuiParsable> extends CuiComponentBase implements ICuiComponentHandler {\r\n    args: T;\r\n    prevArgs: T | undefined;\r\n    isInitialized: boolean;\r\n    actionsHelper: CuiActionsHelper;\r\n    #attribute: string;\r\n    constructor(componentName: string, element: HTMLElement, attribute: string, args: T, utils: CuiUtils) {\r\n        super(componentName, element, utils);\r\n        this.args = args;\r\n        this.actionsHelper = new CuiActionsHelper(utils.interactions)\r\n        this.prevArgs = undefined;\r\n        this.isInitialized = false;\r\n        this.#attribute = attribute;\r\n    }\r\n\r\n    handle(args: any): void {\r\n        this.logInfo(\"Init\", 'handle');\r\n        if (this.isInitialized) {\r\n            this.logWarning(\"Trying to initialize component again\", 'handle');\r\n            return;\r\n        }\r\n        this.args.parse(args);\r\n        if (!this.element.classList.contains(this.#attribute)) {\r\n            this.element.classList.add(this.#attribute);\r\n        }\r\n        this.registerInDebug();\r\n        this.onHandle();\r\n        this.isInitialized = true;\r\n    }\r\n\r\n    refresh(args: any): void {\r\n        this.logInfo(\"Update\", 'refresh')\r\n        if (!this.isInitialized) {\r\n            this.logError(\"Cannot update not initialized component\", 'refresh');\r\n            return;\r\n        }\r\n        this.prevArgs = clone(this.args);\r\n        this.args.parse(args);\r\n        this.pushDebugState(\"info\", \"Component update\", 'refresh');\r\n        this.onRefresh();\r\n    }\r\n\r\n    destroy(): void {\r\n        this.logInfo(\"Destroy\", \"destroy\");\r\n        this.onRemove();\r\n        this.detachEmiitedEvents();\r\n        this.removeFromDebug();\r\n        this.isInitialized = false;\r\n    }\r\n\r\n    // Abstract\r\n    abstract onHandle(): void;\r\n    abstract onRefresh(): void;\r\n    abstract onRemove(): void;\r\n}\r\n\r\n\r\nexport abstract class CuiHandler<T extends ICuiParsable> extends CuiHandlerBase<T> {\r\n    constructor(componentName: string, element: HTMLElement, attribute: string, args: T, utils: CuiUtils) {\r\n        super(componentName, element, attribute, args, utils);\r\n    }\r\n\r\n    onHandle() {\r\n        this.onInit();\r\n    }\r\n\r\n\r\n    onRefresh() {\r\n        this.onUpdate();\r\n    }\r\n\r\n    onRemove() {\r\n        this.onDestroy();\r\n    }\r\n\r\n    /**\r\n     * Helper created for elements that animate - perfroms an action *add*, after timeout it performs *remove*.\r\n     * \r\n     * @param action - action to perfrom\r\n     * @param timeout - timeout specified for action removal\r\n     * @param onFinish - callback to be performed after action is finished after removal\r\n     * @param callback - optional - callback to be executed in mutation on action removal, e.g. additional DOM changes on element\r\n     */\r\n    async performAction(actions: ICuiComponentAction[], timeout: number, onFinish: () => void, callback?: () => void): Promise<boolean> {\r\n        if (await this.actionsHelper.performActions(this.element, actions, timeout, callback)) {\r\n            onFinish();\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    // Abstract\r\n    abstract onInit(): void;\r\n    abstract onUpdate(): void;\r\n    abstract onDestroy(): void;\r\n\r\n}\r\nexport interface CuiInteractableArgs {\r\n    timeout: number;\r\n    openAct: string;\r\n    closeAct: string;\r\n    escClose: boolean;\r\n    keyClose: string;\r\n}\r\n\r\nexport abstract class CuiInteractableHandler<T extends ICuiParsable & CuiInteractableArgs> extends CuiHandlerBase<T> implements ICuiOpenable, ICuiClosable {\r\n    #openEventId: string | null;\r\n    #closeEventId: string | null;\r\n    #keyCloseEventId: string | null;\r\n    #openAct: ICuiComponentAction[];\r\n    #closeAct: ICuiComponentAction[];\r\n    constructor(componentName: string, element: HTMLElement, attribute: string, args: T, utils: CuiUtils) {\r\n        super(componentName, element, attribute, args, utils);\r\n        this.#openEventId = null;\r\n        this.#closeEventId = null;\r\n        this.#keyCloseEventId = null;\r\n        this.#closeAct = [];\r\n        this.#openAct = [];\r\n\r\n    }\r\n\r\n\r\n    onHandle() {\r\n        this.#openEventId = this.onEvent(EVENTS.OPEN, this.openFromEvent.bind(this))\r\n        this.#closeEventId = this.onEvent(EVENTS.CLOSE, this.closeFromEvent.bind(this))\r\n        this.#openAct = CuiActionsListFactory.get(this.args.openAct)\r\n        this.#closeAct = CuiActionsListFactory.get(this.args.closeAct)\r\n        this.onInit();\r\n    }\r\n\r\n\r\n    onRefresh() {\r\n        if (!this.prevArgs || this.args.openAct !== this.prevArgs.openAct) {\r\n            this.#openAct = CuiActionsListFactory.get(this.args.openAct)\r\n        }\r\n        if (!this.prevArgs || this.args.closeAct !== this.prevArgs.closeAct) {\r\n            this.#closeAct = CuiActionsListFactory.get(this.args.closeAct)\r\n        }\r\n        this.onUpdate();\r\n    }\r\n\r\n    onRemove() {\r\n        this.detachEvent(EVENTS.CLOSE, this.#closeEventId);\r\n        this.detachEvent(EVENTS.OPEN, this.#openEventId)\r\n        this.onDestroy();\r\n    }\r\n\r\n    async open(args?: any): Promise<boolean> {\r\n        if (this.checkLockAndWarn(\"open\")) {\r\n            return false;\r\n        }\r\n        if (this.isActive()) {\r\n            this.logWarning(\"Component is already opened\");\r\n            return false;\r\n        }\r\n        if (this.args.escClose || is(this.args.keyClose)) {\r\n            this.#keyCloseEventId = this.onEvent(EVENTS.KEYDOWN, this.onKeyClose.bind(this))\r\n        }\r\n\r\n        if (!this.onBeforeOpen()) {\r\n            return false;\r\n        }\r\n        this.isLocked = true;\r\n        return this.performAction(this.#openAct, this.args.timeout, this.onActionFinish.bind(this, this.onAfterOpen.bind(this), EVENTS.OPENED, args), () => {\r\n            this.helper.setClass(this.activeClassName, this.element)\r\n            AriaAttributes.setAria(this.element, 'aria-expanded', 'true');\r\n        });;\r\n    }\r\n\r\n    async close(args?: any): Promise<boolean> {\r\n        if (this.checkLockAndWarn(\"close\")) {\r\n            return false;\r\n        }\r\n        if (!this.isActive()) {\r\n            this.logWarning(\"Component is already closed\");\r\n            return false;\r\n        }\r\n\r\n        this.detachEvent(EVENTS.KEYDOWN, this.#keyCloseEventId);\r\n        if (!this.onBeforeClose()) {\r\n            return false;\r\n        }\r\n        this.isLocked = true;\r\n        return this.performAction(this.#closeAct, this.args.timeout, this.onActionFinish.bind(this, this.onAfterClose.bind(this), EVENTS.CLOSED, args), () => {\r\n            this.helper.removeClass(this.activeClassName, this.element)\r\n            AriaAttributes.setAria(this.element, 'aria-expanded', 'false');\r\n        });;\r\n    }\r\n\r\n\r\n    /**\r\n     * Helper created for elements that animate - perfroms an action *add*, after timeout it performs *remove*.\r\n     * \r\n     * @param action - action to perfrom\r\n     * @param timeout - timeout specified for action removal\r\n     * @param onFinish - callback to be performed after action is finished after removal\r\n     * @param callback - optional - callback to be executed in mutation on action removal, e.g. additional DOM changes on element\r\n     */\r\n    async performAction(actions: ICuiComponentAction[], timeout: number, onFinish: () => void, callback?: () => void): Promise<boolean> {\r\n        if (await this.actionsHelper.performActions(this.element, actions, timeout, callback)) {\r\n            onFinish();\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    private openFromEvent(args: any) {\r\n        this.open(args);\r\n    }\r\n\r\n    private closeFromEvent(args: any) {\r\n        this.close(args);\r\n    }\r\n\r\n    private onActionFinish(callback: () => void, event: string, args: any) {\r\n        callback();\r\n        this.emitEvent(event, {\r\n            timestamp: Date.now(),\r\n            state: args\r\n        })\r\n        this.isLocked = false;\r\n    }\r\n\r\n    private async onKeyClose(ev: KeyDownEvent) {\r\n        if (this.args.escClose && ev.event.key === \"Escape\" || is(this.args.keyClose) && ev.event.key === this.args.keyClose) {\r\n            await this.close('Closed by key');\r\n        }\r\n    }\r\n    // Abstract\r\n    abstract onInit(): void;\r\n    abstract onUpdate(): void;\r\n    abstract onDestroy(): void;\r\n    abstract onBeforeOpen(): boolean;\r\n    abstract onAfterOpen(): void;\r\n    abstract onAfterClose(): void;\r\n    abstract onBeforeClose(): boolean;\r\n\r\n}\r\n\r\nexport abstract class CuiMutableHandler<T extends ICuiParsable> extends CuiHandlerBase<T> {\r\n    #mutionHandler: ICuiComponentMutationObserver;\r\n    constructor(componentName: string, element: HTMLElement, attribute: string, args: T, utils: CuiUtils) {\r\n        super(componentName, element, attribute, args, utils);\r\n        this.#mutionHandler = new CuiComponentMutationHandler(element);\r\n        this.#mutionHandler.onMutation(this.mutation.bind(this))\r\n    }\r\n\r\n    onHandle() {\r\n        this.onInit();\r\n        this.#mutionHandler.observe();\r\n    }\r\n\r\n\r\n    onRefresh() {\r\n        this.#mutionHandler.unobserve();\r\n        this.onUpdate();\r\n        this.#mutionHandler.observe();\r\n    }\r\n\r\n    onRemove() {\r\n        this.#mutionHandler.unobserve();\r\n        this.onDestroy();\r\n    }\r\n\r\n    /**\r\n     * Callback attached to mutation observer set on root element\r\n     * \r\n     * @param record - mutation records\r\n     */\r\n    mutation(records: MutationRecord[]): void {\r\n        this._log.debug(\"Element mutation\", \"mutation\")\r\n        this.onMutation(records.reduce<CuiChildMutation>((result: CuiChildMutation, item: MutationRecord) => {\r\n            if (item.type !== \"childList\") {\r\n                return result;\r\n            }\r\n            if (item.addedNodes.length > 0) {\r\n                result.added.push(...item.addedNodes)\r\n            }\r\n            if (item.removedNodes.length > 0) {\r\n                result.removed.push(...item.removedNodes)\r\n            }\r\n            return result;\r\n        }, {\r\n            added: [],\r\n            removed: []\r\n        }));\r\n    }\r\n\r\n    abstract onMutation(record: CuiChildMutation): void;\r\n    abstract onInit(): void;\r\n    abstract onUpdate(): void;\r\n    abstract onDestroy(): void;\r\n}","import { ICuiComponent, ICuiComponentHandler, ICuiSwitchable } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiChildMutation, CuiMutableHandler } from \"../../core/handlers/base\";\r\nimport { getIntOrDefault, is, isStringTrue, replacePrefix, getStringOrDefault } from \"../../core/utils/functions\";\r\nimport { EVENTS, SCOPE_SELECTOR } from \"../../core/utils/statics\";\r\n\r\n\r\n/**\r\n * \r\n */\r\n\r\nexport interface CuiAccordionEvent {\r\n    index: number;\r\n    previous: number;\r\n    currentTarget: Element;\r\n    previousTarget: Element;\r\n    timestamp: number;\r\n}\r\n\r\ninterface CuiAccordionTarget {\r\n    element: Element,\r\n    listener?: any\r\n}\r\n\r\nconst ACCORDION_TITLE_CLS = '> * > .{prefix}-accordion-title';\r\nconst ACCORDION_ITEMS_CLS = '> *';\r\n\r\nexport class CuiAccordionArgs {\r\n    single: boolean;\r\n    selector: string;\r\n    items: string;\r\n    timeout: number;\r\n    animation: boolean;\r\n\r\n    #defTitleSelector: string;\r\n    #defItemsSelector: string;\r\n    #defTimeout: number;\r\n    constructor(prefix: string, timeout: number | undefined) {\r\n        this.#defTitleSelector = replacePrefix(ACCORDION_TITLE_CLS, prefix);\r\n        this.#defItemsSelector = replacePrefix(ACCORDION_ITEMS_CLS, prefix);\r\n        this.animation = false;\r\n        this.#defTimeout = timeout ?? 300;\r\n        this.single = false;\r\n        this.selector = SCOPE_SELECTOR + this.#defTitleSelector;\r\n        this.items = SCOPE_SELECTOR + this.#defItemsSelector;\r\n        this.timeout = this.#defTimeout;\r\n    }\r\n\r\n    parse(args: any) {\r\n        if (is(args)) {\r\n            this.single = isStringTrue(args.single);\r\n            this.selector = SCOPE_SELECTOR + getStringOrDefault(args.selector, this.#defTitleSelector);\r\n            this.items = SCOPE_SELECTOR + getStringOrDefault(args.content, this.#defItemsSelector);\r\n            this.timeout = getIntOrDefault(args.timeout, this.#defTimeout);\r\n            this.animation = isStringTrue(args.animation);\r\n            return;\r\n        }\r\n\r\n    }\r\n\r\n    isValid(): boolean {\r\n        return true;\r\n    }\r\n}\r\n\r\nexport class CuiAccordionComponent implements ICuiComponent {\r\n    attribute: string;\r\n    #prefix: string;\r\n    constructor(prefix?: string) {\r\n        this.#prefix = prefix ?? 'cui';\r\n        this.attribute = `${this.#prefix}-accordion`;\r\n    }\r\n\r\n    getStyle(): string | null {\r\n        return null;\r\n    }\r\n\r\n    get(element: HTMLElement, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiAccordionHandler(element, utils, this.attribute, this.#prefix);\r\n    }\r\n}\r\n\r\nexport class CuiAccordionHandler extends CuiMutableHandler<CuiAccordionArgs> implements ICuiSwitchable {\r\n    #items: Element[];\r\n    #targets: CuiAccordionTarget[];\r\n    #switchEventId: string | null;\r\n    constructor(element: HTMLElement, utils: CuiUtils, attribute: string, prefix: string) {\r\n        super(\"CuiAccordionHandler\", element, attribute, new CuiAccordionArgs(prefix, utils.setup.animationTime), utils);\r\n        this.#switchEventId = null;\r\n        this.#items = [];\r\n        this.#targets = [];\r\n        this.#switchEventId = null;\r\n    }\r\n\r\n    onInit(): void {\r\n        if (this.args.isValid()) {\r\n            try {\r\n                this.initTargets();\r\n                this.#switchEventId = this.onEvent(EVENTS.SWITCH, this.onSwitch.bind(this))\r\n            } catch (e) {\r\n                this._log.exception(e, 'handle')\r\n            }\r\n            this._log.debug(\"Initialized\", \"handle\")\r\n        }\r\n    }\r\n\r\n    onUpdate(): void {\r\n        try {\r\n            this.initTargets();\r\n        } catch (e) {\r\n            this._log.exception(e, 'handle')\r\n        }\r\n    }\r\n\r\n    onDestroy(): void {\r\n        this.detachEvent(EVENTS.SWITCH, this.#switchEventId)\r\n    }\r\n\r\n    onMutation(mutations: CuiChildMutation) {\r\n        if (mutations.added.length > 0 || mutations.removed.length > 0)\r\n            this.initTargets();\r\n    }\r\n\r\n    async switch(index: number): Promise<boolean> {\r\n        this._log.debug(\"Switch to: \" + index);\r\n        if (index < 0 || this.isLocked || !this.isInitialized) {\r\n            return false;\r\n        }\r\n\r\n        this.#items = this.queryItems();\r\n        if (this.#items.length <= index) {\r\n            return false;\r\n        }\r\n        this.isLocked = true;\r\n        const current = this.#items[index]\r\n        if (this.helper.hasClass(this.activeClassName, current)) {\r\n            this.helper.removeClassesAs(current, this.activeClassName)\r\n        } else {\r\n            if (this.args.single) {\r\n                this.closeAllExcept(index)\r\n            }\r\n            this.helper.setClassesAs(current, this.activeClassName)\r\n\r\n        }\r\n        this.emitEvent(EVENTS.SWITCHED, {\r\n            index: index,\r\n            currentTarget: current,\r\n            timestamp: Date.now()\r\n        })\r\n        this.isLocked = false;\r\n        return true;\r\n    }\r\n\r\n    onSwitch(index: any): void {\r\n        this.switch(getIntOrDefault(index, -1)).then(() => {\r\n            this._log.debug(\"Switch from event to \" + index);\r\n        });\r\n    }\r\n\r\n    initTargets() {\r\n        this.#items = this.queryItems();\r\n        const t = this.element.querySelectorAll(this.args.selector);\r\n        this.#targets = [];\r\n        t.forEach((item: Element, index: number) => {\r\n            let target: CuiAccordionTarget = { element: item };\r\n            this.setListener(target, index)\r\n            this.#targets.push(target);\r\n        })\r\n    }\r\n\r\n    closeAllExcept(current: number) {\r\n        this.mutate(() => {\r\n            this.#items.forEach((item: Element, index: number) => {\r\n                if (current !== index && this.helper.hasClass(this.activeClassName, item)) {\r\n                    item.classList.remove(this.activeClassName)\r\n                }\r\n            })\r\n        })\r\n    }\r\n\r\n    setListener(target: CuiAccordionTarget, index: number) {\r\n        target.listener = () => {\r\n            this.switch(index);\r\n        }\r\n        target.element.addEventListener('click', target.listener)\r\n    }\r\n\r\n    removeListener(target: CuiAccordionTarget) {\r\n        if (target.listener) {\r\n            target.element.removeEventListener('click', target.listener);\r\n        }\r\n    }\r\n\r\n    queryItems(): Element[] {\r\n        return [...this.element.querySelectorAll(this.args.items)]\r\n    }\r\n}","import { AnimatorError } from \"../models/errors\";\r\nimport { is } from \"../utils/functions\";\r\nimport { ICuiPropertyAnimator, AnimatorPropertyValue, TransformAnimatorProperty } from \"./interfaces\";\r\n\r\n/**\r\n * Changes the opacity of the element from 0 to 1\r\n */\r\nexport class OpacityAnimator implements ICuiPropertyAnimator<AnimatorPropertyValue> {\r\n    length: number;\r\n    from: number;\r\n    to: number;\r\n    rtl: boolean;\r\n    constructor() {\r\n        this.length = this.to = this.from = -1;\r\n        this.rtl = false;\r\n    }\r\n\r\n    setProperty(prop: AnimatorPropertyValue): void {\r\n        if (!prop || !is(prop.from) || !is(prop.to)) {\r\n            throw new AnimatorError(\"[OpacityAnimator] Property has incorrect format\");\r\n        }\r\n        this.from = prop.from;\r\n        this.to = prop.to;\r\n        this.length = Math.abs(this.to - this.from);\r\n        this.rtl = this.from > this.to;\r\n    }\r\n\r\n    perform(element: any, progress: number, factor: number) {\r\n        if (this.to < 0) {\r\n            return;\r\n        }\r\n        let current = this.length * progress\r\n        if (element[\"style\"]) {\r\n            element.style.opacity = this.rtl ? Math.max(this.from - current, 0) : Math.min(this.from + current, 1);\r\n        }\r\n\r\n    }\r\n}\r\n\r\n/**\r\n * Changes any style property of the element\r\n */\r\nexport class PropertyAnimator implements ICuiPropertyAnimator<AnimatorPropertyValue> {\r\n    length: number;\r\n    from: number;\r\n    to: number;\r\n    rtl: boolean;\r\n    property: string;\r\n    #unit: string | undefined;\r\n    constructor(property: string) {\r\n        if (!is(property)) {\r\n            throw new AnimatorError(\"[PropertyAnimator] Valid property is required\");\r\n        }\r\n        this.property = property;\r\n        this.length = this.to = this.from = -1;\r\n        this.rtl = false;\r\n        this.#unit = \"\";\r\n    }\r\n\r\n    setProperty(prop: AnimatorPropertyValue) {\r\n        if (!prop || !is(prop.from) || !is(prop.to)) {\r\n            throw new AnimatorError(\"[PropertyAnimator] Property has incorrect format\");\r\n        }\r\n        this.from = prop.from;\r\n        this.to = prop.to;\r\n        this.length = Math.abs(this.to - this.from);\r\n        this.rtl = this.from > this.to;\r\n        this.#unit = prop.unit;\r\n    }\r\n\r\n    perform(element: any, progress: number, factor: number) {\r\n        if (!this.property) {\r\n            return;\r\n        }\r\n        let current = this.length * progress\r\n        if (element[\"style\"]) {\r\n            element.style[this.property] = this.createValue(this.rtl ? this.from - current : this.from + current, this.#unit);\r\n        }\r\n    }\r\n\r\n    private createValue(value: number, unit?: string) {\r\n        return `${value}${unit ?? \"\"}`;\r\n    }\r\n}\r\n\r\n/**\r\n * Changes transform property of the element. Supports mulitple properties at the time\r\n */\r\nexport class TransformAnimator implements ICuiPropertyAnimator<TransformAnimatorProperty> {\r\n    prop: TransformAnimatorProperty | undefined;\r\n    constructor() {\r\n        this.prop = undefined;\r\n    }\r\n\r\n    setProperty(prop: TransformAnimatorProperty) {\r\n        if (!prop) {\r\n            throw new AnimatorError(\"[TransformAnimator] Property has incorrect format\");\r\n        }\r\n        this.prop = prop;\r\n    }\r\n\r\n    build(progress: number) {\r\n        let props: string[] = [];\r\n        for (let name in this.prop) {\r\n            let cur = this.prop[name];\r\n            let diff = Math.abs(cur.to - cur.from);\r\n            let rtl = cur.from > cur.to;\r\n            let val = rtl ? cur.from - (diff * progress) : cur.from + (diff * progress)\r\n            props.push(this.buildSingle(name, val, cur.unit))\r\n        }\r\n\r\n        return props.join(\" \");\r\n    }\r\n\r\n    buildSingle(name: string, value: number, unit?: string) {\r\n        return `${name}(${value}${unit})`;\r\n    }\r\n\r\n    perform(element: any, progress: number) {\r\n        if (!this.prop) {\r\n            return;\r\n        }\r\n        if (element[\"style\"]) {\r\n            element.style.transform = this.build(progress);\r\n        }\r\n\r\n    }\r\n}\r\n","import { is } from \"../utils/functions\";\r\nimport { OpacityAnimator, TransformAnimator, PropertyAnimator } from \"./animators\";\r\nimport { ICuiPropertyAnimator, AnimationProperty, AnimatorPropertyValue, TransformAnimatorProperty, OnAnimationFinishCallback } from \"./interfaces\";\r\n\r\nexport type PropsTypes = AnimatorPropertyValue | TransformAnimatorProperty;\r\n\r\nexport class CuiAnimation {\r\n    #engine: CuiAnimationEngine;\r\n    #timeout: number;\r\n    #factory: AnimatorFactory;\r\n    #onError: ((e: Error) => void) | undefined;\r\n    constructor(element?: Element) {\r\n        this.#engine = new CuiAnimationEngine(true);\r\n        this.#onError = undefined;\r\n        this.#timeout = 0;\r\n        this.#factory = new AnimatorFactory();\r\n        if (element) {\r\n            this.#engine.setElement(element);\r\n        }\r\n    }\r\n\r\n    setElement(element: Element) {\r\n        this.#engine.setElement(element);\r\n    }\r\n\r\n    setTimeout(timeout: number) {\r\n        this.#timeout = timeout;\r\n    }\r\n\r\n    onError(callback: (e: Error) => void) {\r\n        this.#onError = callback;\r\n        this.#engine.setOnError(callback)\r\n    }\r\n    onFinish(callback: OnAnimationFinishCallback) {\r\n        this.#engine.onFinish(callback);\r\n    }\r\n\r\n    perform(props: AnimationProperty<PropsTypes>, timeout?: number, factor?: number) {\r\n        if (!is(props)) {\r\n            this.reportError(new Error(\"Animation property cannot be empty\"))\r\n            return;\r\n        }\r\n        let animators = [];\r\n        try {\r\n            for (let prop in props) {\r\n                let animator = this.#factory.get(prop);\r\n                if (!animator) return;\r\n                animator.setProperty(props[prop]);\r\n                animators.push(animator);\r\n                this.#engine.setAnimators(animators);\r\n                this.#engine.animate(timeout ?? this.#timeout)\r\n            }\r\n        } catch (e) {\r\n            this.reportError(e);\r\n            return;\r\n        }\r\n    }\r\n\r\n    private reportError(e: Error) {\r\n        if (this.#onError) {\r\n            this.#onError(e)\r\n        } else {\r\n            console.error(e);\r\n        }\r\n    }\r\n}\r\n\r\n\r\n\r\nclass AnimatorFactory {\r\n    get(id: string): ICuiPropertyAnimator<AnimatorPropertyValue | TransformAnimatorProperty> | undefined {\r\n        if (!is(id)) {\r\n            return undefined;\r\n        }\r\n        switch (id) {\r\n            case \"opacity\":\r\n                return new OpacityAnimator();\r\n            case \"transform\":\r\n                return new TransformAnimator();\r\n            default:\r\n                return new PropertyAnimator(id);\r\n        }\r\n    }\r\n\r\n}\r\n\r\nexport class CuiAnimationEngine {\r\n    #onFinishCallback: OnAnimationFinishCallback | undefined;\r\n    #animators: ICuiPropertyAnimator<PropsTypes>[];\r\n    #lock: boolean;\r\n    // Needed in animation perform - set on first animation exec, cleaned on end\r\n    #animStartStamp: number | undefined;\r\n    #element: Element | undefined;\r\n    #cleanOnFinish: boolean;\r\n    #errorOccured: boolean;\r\n    #factory: AnimatorFactory;\r\n    #onError: ((e: Error) => void) | undefined;\r\n    constructor(cleanOnFinish?: boolean) {\r\n        this.#animators = [];\r\n        this.#element = undefined;\r\n        this.#animStartStamp = undefined;\r\n        this.#cleanOnFinish = cleanOnFinish ?? false;\r\n        this.#factory = new AnimatorFactory();\r\n        this.#lock = false;\r\n        this.#onFinishCallback = undefined;\r\n        this.#errorOccured = false;\r\n        this.#onError = undefined;\r\n    }\r\n\r\n    onFinish(callback: OnAnimationFinishCallback) {\r\n        this.#onFinishCallback = callback;\r\n    }\r\n\r\n    setAnimators(animators: ICuiPropertyAnimator<PropsTypes>[]) {\r\n        this.#animators = animators;\r\n    }\r\n\r\n    setProps(props: AnimationProperty<PropsTypes>) {\r\n        if (!is(props)) {\r\n            return;\r\n        }\r\n        this.#animators = [];\r\n        try {\r\n            for (let prop in props) {\r\n                let animator = this.#factory.get(prop);\r\n                if (!animator) return;\r\n                animator.setProperty(props[prop]);\r\n                this.#animators.push(animator);\r\n            }\r\n        } catch (e) {\r\n            this.reportError(e);\r\n        }\r\n    }\r\n\r\n    setElement(element: Element) {\r\n        this.#element = element;\r\n    }\r\n\r\n    setOnError(callback: (e: Error) => void) {\r\n        this.#onError = callback;\r\n    }\r\n\r\n    animate(timeout: number, progress?: number, revert?: boolean): void {\r\n        if (this.#lock) {\r\n            return;\r\n        }\r\n        if (!this.#element || this.#animators.length === 0) {\r\n            this.reportError(new Error(\"Animation cannot be performed: element or animators are not set\"));\r\n            return;\r\n        }\r\n        let animationProgress = progress ?? 0;\r\n        let shouldCalcRevert = revert ? revert : false;\r\n        this.#lock = true;\r\n        requestAnimationFrame(this.animateAsync.bind(this, timeout, animationProgress, shouldCalcRevert))\r\n    }\r\n\r\n    isLocked(): boolean {\r\n        return this.#lock;\r\n    }\r\n\r\n    private animateAsync(timeout: number, initialProgress: number, revert: boolean, timestamp: number) {\r\n        if (!this.#animStartStamp) {\r\n            this.#animStartStamp = timestamp;\r\n        }\r\n\r\n        let pr = timestamp - this.#animStartStamp;\r\n        let animationProgress = pr / timeout;\r\n        let currProgress = 0;\r\n        if (initialProgress === 0) {\r\n            currProgress = animationProgress;\r\n        } else {\r\n            currProgress = revert ? initialProgress - (animationProgress * initialProgress) : initialProgress + (animationProgress * initialProgress)\r\n        }\r\n        this.callUpdate(revert ? Math.max(currProgress, 0) : Math.min(currProgress, 1), 1);\r\n        if (pr < timeout && !this.#errorOccured) {\r\n            requestAnimationFrame(this.animateAsync.bind(this, timeout, initialProgress, revert))\r\n        } else {\r\n            this.endAnimation(revert);\r\n        }\r\n    }\r\n\r\n    private endAnimation(reverted: boolean) {\r\n        if (this.#cleanOnFinish && this.#element) {\r\n            this.#element.removeAttribute(\"style\");\r\n        }\r\n        if (this.#onFinishCallback) {\r\n            this.#onFinishCallback(this.#element, reverted, this.#errorOccured);\r\n        }\r\n        this.#errorOccured = false;\r\n        this.#animStartStamp = undefined;\r\n        this.#lock = false;\r\n    }\r\n\r\n    private callUpdate(progress: number, factor: number) {\r\n        try {\r\n            this.#animators.forEach(animator => animator.perform(this.#element, progress, factor));\r\n        } catch (e) {\r\n            this.reportError(e);\r\n            this.#errorOccured = true;\r\n        }\r\n\r\n    }\r\n\r\n    private reportError(e: Error) {\r\n        if (this.#onError) {\r\n            this.#onError(e);\r\n        } else {\r\n            console.error(\"An error occured in CuiAnimtionEngine\");\r\n            console.error(e);\r\n        }\r\n    }\r\n}\r\n\r\n\r\n\r\nexport class CuiSwipeAnimationEngine {\r\n    #element: Element | undefined;\r\n    #animators: ICuiPropertyAnimator<PropsTypes>[];\r\n    #animationEngine: CuiAnimationEngine;\r\n    #factory: AnimatorFactory;\r\n    #onError: ((e: Error) => void) | undefined;\r\n    constructor(shouldCleanOnFinish?: boolean) {\r\n        this.#element = undefined;\r\n        this.#animators = [];\r\n        this.#animationEngine = new CuiAnimationEngine(shouldCleanOnFinish);\r\n        this.#factory = new AnimatorFactory();\r\n        this.#onError = undefined;\r\n    }\r\n\r\n    setElement(element: Element) {\r\n        this.#element = element;\r\n    }\r\n\r\n    setOnFinish(callback: OnAnimationFinishCallback) {\r\n        this.#animationEngine.onFinish(callback);\r\n    }\r\n\r\n    setOnError(callback: (e: Error) => void) {\r\n        this.#onError = callback;\r\n        this.#animationEngine.setOnError(callback);\r\n    }\r\n\r\n    setProps(props: AnimationProperty<PropsTypes>) {\r\n        if (!is(props)) {\r\n            return;\r\n        }\r\n        this.#animators = [];\r\n        try {\r\n            for (let prop in props) {\r\n                let animator = this.#factory.get(prop);\r\n                if (!animator) return;\r\n                animator.setProperty(props[prop]);\r\n                this.#animators.push(animator);\r\n            }\r\n        } catch (e) {\r\n            this.reportError(e);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Perform single update on animators\r\n     * @param progress - progress value to be set to animators 0..1\r\n     */\r\n    update(progress: number) {\r\n        if (!this.#element || this.#animators.length === 0) {\r\n            return;\r\n        }\r\n        this.#animators.forEach(animator => animator.perform(this.#element, Math.min(progress, 1), 1))\r\n    }\r\n\r\n    /**\r\n     * Perform single update on animators in RAF\r\n     * @param progress - progress value to be set to animators 0..1\r\n     */\r\n    updateAsync(progress: number) {\r\n        requestAnimationFrame(this.update.bind(this, progress));\r\n    }\r\n\r\n    /**\r\n     * Finish swipe animation using animation engine\r\n     * @param progress - initial progress value 0..1\r\n     * @param timeout - time for animation to perform\r\n     * @param revert - whether animation should return back to 0 or progress to the end\r\n     */\r\n    finish(progress: number, timeout: number, revert: boolean) {\r\n        if (this.#element)\r\n            this.#animationEngine.setElement(this.#element);\r\n        this.#animationEngine.setAnimators(this.#animators);\r\n        this.#animationEngine.animate(timeout, progress, revert);\r\n    }\r\n\r\n    private reportError(e: Error) {\r\n        if (this.#onError) {\r\n            this.#onError(e);\r\n        } else {\r\n            console.log(e)\r\n        }\r\n    }\r\n\r\n}","import { AnimationDefinition, SWIPE_ANIMATIONS_DEFINITIONS } from \"../../core/animation/definitions\";\r\nimport { CuiInteractableArgs, CuiInteractableHandler } from \"../../core/handlers/base\";\r\nimport { CuiSwipeAnimationEngine } from \"../../core/animation/engine\";\r\nimport { ICuiMoveEvent } from \"../../core/listeners/move\";\r\nimport { AriaAttributes } from \"../../core/utils/aria\";\r\nimport { boolStringOrDefault, getIntOrDefault, getStringOrDefault, replacePrefix } from \"../../core/utils/functions\";\r\nimport { ICuiParsable, ICuiComponent, ICuiComponentHandler } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { EVENTS, CLASSES } from \"../../core/utils/statics\";\r\n\r\nconst BANNER_OPEN_ANIMATION: string = \".{prefix}-animation-fade-in\";\r\nconst BANNER_CLOSE_ANIMATION: string = \".{prefix}-animation-fade-out\";\r\n\r\nexport class CuiBannerArgs implements ICuiParsable, CuiInteractableArgs {\r\n    timeout: number;\r\n    swipe: boolean;\r\n\r\n    openAct: string;\r\n    closeAct: string;\r\n    // Not in use\r\n    escClose: boolean;\r\n    keyClose: string;\r\n\r\n    #defTimeout: number;\r\n    #prefix: string;\r\n    constructor(prefix: string, timeout: number | undefined) {\r\n        this.#defTimeout = timeout ?? 300;\r\n        this.#prefix = prefix;\r\n\r\n        this.escClose = false;\r\n        this.keyClose = \"\";\r\n        this.timeout = this.#defTimeout;\r\n        this.swipe = false;\r\n        this.openAct = \"\";\r\n        this.closeAct = \"\";\r\n    }\r\n\r\n\r\n    parse(args: any) {\r\n        this.swipe = boolStringOrDefault(args.swipe, false);\r\n        this.escClose = false;\r\n        this.keyClose = \"\";\r\n        this.timeout = getIntOrDefault(args.timeout, this.#defTimeout);\r\n        this.openAct = getStringOrDefault(args.openAct, replacePrefix(BANNER_OPEN_ANIMATION, this.#prefix))\r\n        this.closeAct = getStringOrDefault(args.closeAct, replacePrefix(BANNER_CLOSE_ANIMATION, this.#prefix))\r\n    }\r\n}\r\n\r\nexport class CuiBanerComponent implements ICuiComponent {\r\n    attribute: string;\r\n    #prefix: string;\r\n\r\n    constructor(prefix?: string) {\r\n        this.#prefix = prefix ?? 'cui';\r\n        this.attribute = `${this.#prefix}-banner`;\r\n\r\n    }\r\n\r\n    getStyle(): string | null {\r\n        return null;\r\n    }\r\n\r\n    get(element: HTMLElement, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiBannerHandler(element, utils, this.attribute, this.#prefix);\r\n    }\r\n}\r\n\r\nexport class CuiBannerHandler extends CuiInteractableHandler<CuiBannerArgs> {\r\n    #swipeEngine: CuiSwipeAnimationEngine;\r\n    #isTracking: boolean;\r\n    #startX: number;\r\n    #ratio: number;\r\n    #swipeAnimation: AnimationDefinition;\r\n    #moveEventId: string | null;\r\n    constructor(element: HTMLElement, utils: CuiUtils, attribute: string, prefix: string) {\r\n        super(\"CuiBannerHandler\", element, attribute, new CuiBannerArgs(prefix, utils.setup.animationTime), utils);\r\n        this.#swipeEngine = new CuiSwipeAnimationEngine(true);\r\n        this.#swipeEngine.setOnFinish(this.onSwipeFinish.bind(this));\r\n        this.#swipeEngine.setElement(this.element)\r\n        this.#startX = -1;\r\n        this.#ratio = 0;\r\n        this.#swipeAnimation = SWIPE_ANIMATIONS_DEFINITIONS[\"fade\"];\r\n        this.#moveEventId = null;\r\n        this.#isTracking = false;\r\n    }\r\n\r\n    onInit(): void {\r\n        //   this.#moveEventId = this.onEvent(EVENTS.GLOBAL_MOVE, this.onMove.bind(this));\r\n        if (!this.isActive()) {\r\n            this.open();\r\n        }\r\n    }\r\n    onUpdate(): void {\r\n\r\n    }\r\n\r\n    onDestroy(): void {\r\n        this.detachEvent(EVENTS.GLOBAL_MOVE, this.#moveEventId);\r\n    }\r\n\r\n    onBeforeOpen(): boolean {\r\n        return true;\r\n    }\r\n\r\n    onAfterOpen(): void {\r\n        if (this.args.swipe) {\r\n            this.#moveEventId = this.onEvent(EVENTS.GLOBAL_MOVE, this.onMove.bind(this));\r\n        }\r\n    }\r\n    onAfterClose(): void {\r\n        this.detachEvent(EVENTS.GLOBAL_MOVE, this.#moveEventId);\r\n    }\r\n\r\n    onBeforeClose(): boolean {\r\n        return true;\r\n    }\r\n\r\n    onMove(data: ICuiMoveEvent) {\r\n        if (this.isLocked) {\r\n            return;\r\n        }\r\n        let current = this.element as HTMLElement;\r\n        switch (data.type) {\r\n            case \"down\":\r\n                if (this.#isTracking || !current.contains((data.target as Node))) {\r\n                    return;\r\n                }\r\n                this.#isTracking = true;\r\n                this.#startX = data.x;\r\n                this.helper.setClassesAs(document.body, CLASSES.swipingOn);\r\n                data.event.preventDefault();\r\n                break;\r\n            case \"up\":\r\n                if (!this.#isTracking && this.#ratio == 0) {\r\n                    break;\r\n                }\r\n\r\n                let absRatio = Math.abs(this.#ratio);\r\n                let timeout = absRatio * this.args.timeout;\r\n                let back = absRatio <= 0.4;\r\n                // Lock component until animation is finished\r\n                this.isLocked = true;\r\n                this.#swipeEngine.finish(absRatio, timeout, back);\r\n                this.helper.removeClassesAs(document.body, CLASSES.swipingOn);\r\n                this.#isTracking = false;\r\n                break;\r\n            case \"move\":\r\n                if (this.#isTracking) {\r\n                    let newRatio = (data.x - this.#startX) / current.offsetWidth;\r\n                    if (this.#ratio >= 0 && newRatio <= 0 || this.#ratio <= 0 && newRatio > 0) {\r\n                        this.#swipeEngine.setProps(newRatio > 0 ? this.#swipeAnimation.current.right : this.#swipeAnimation.current.left);\r\n                    }\r\n                    this.#ratio = newRatio;\r\n                    this.mutate(() => {\r\n                        this.#swipeEngine.update(Math.abs(this.#ratio));\r\n                    })\r\n                    data.event.preventDefault();\r\n                }\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n    }\r\n\r\n    onSwipeFinish(element: Element | undefined, reverted: boolean, error: boolean) {\r\n        this.isLocked = false;\r\n        if (!reverted) {\r\n            this.helper.removeClass(this.activeClassName, this.element)\r\n            AriaAttributes.setAria(this.element, 'aria-expanded', 'false');\r\n        }\r\n        this.#ratio = 0;\r\n        this.#startX = 0;\r\n\r\n    }\r\n}","import { createElementFromString, getIntOrDefault, is } from \"../utils/functions\";\r\n\r\nexport class IconBuilder {\r\n    #element: string;\r\n    #scale: number;\r\n    #appender: IconScaleAppender;\r\n\r\n    constructor(svgString: string) {\r\n        this.#element = svgString;\r\n        this.#scale = 1;\r\n        this.#appender = new IconScaleAppender();\r\n    }\r\n\r\n    setScale(scale: number): IconBuilder {\r\n        this.#scale = scale\r\n        return this\r\n    }\r\n\r\n    build(): Element | null {\r\n        let created = createElementFromString(this.#element)\r\n        if (is(created) && this.#scale) {\r\n            // @ts-ignore created is checked already\r\n            this.#appender.append(created, this.#scale)\r\n        }\r\n        return created\r\n    }\r\n}\r\n\r\nexport class IconScaleAppender {\r\n    append(element: Element, value: number): void {\r\n        let width = getIntOrDefault(element.getAttribute(\"width\"), 20)\r\n        let height = getIntOrDefault(element.getAttribute(\"height\"), 20);\r\n        element.setAttribute(\"width\", (width * value).toString())\r\n        element.setAttribute(\"height\", (height * value).toString())\r\n    }\r\n}","import { ICuiComponent, ICuiComponentHandler, ICuiParsable } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiHandler } from \"../../core/handlers/base\";\r\nimport { is, getRangeValue, isString, getIntOrDefault } from \"../../core/utils/functions\";\r\nimport { ICONS, EVENTS } from \"../../core/utils/statics\";\r\nimport { IconBuilder } from \"../../core/builders/icon\";\r\n\r\nexport interface CuiCircleProgressChnaged {\r\n    timestamp: number;\r\n    progress: number;\r\n}\r\n\r\nexport class CuiCircleArgs implements ICuiParsable {\r\n    progress: number;\r\n    constructor() {\r\n        this.progress = 0;\r\n    }\r\n\r\n    parse(val: any): void {\r\n        if (!is(val)) {\r\n            this.progress = 0;\r\n        }\r\n        else if (isString(val)) {\r\n            this.progress = getIntOrDefault(val, 0);\r\n        } else {\r\n            this.progress = getIntOrDefault(val.progress, 0);\r\n        }\r\n\r\n    }\r\n\r\n}\r\n\r\nexport class CuiCircleComponent implements ICuiComponent {\r\n    attribute: string;\r\n    constructor(prefix?: string) {\r\n        this.attribute = (prefix ?? 'cui') + '-circle-progress';\r\n        ICONS['special_circle_progress'] = \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\"  class=\\\"circle-progress\\\" viewBox=\\\"0 0 100 100\\\" width=\\\"100\\\" height=\\\"100\\\"><path class=\\\"circle-progress-path\\\" d=\\\"M 50,5.3660047 A 44.867708,44.633994 0 0 1 94.867709,49.999997 44.867708,44.633994 0 0 1 50,94.633995 44.867708,44.633994 0 0 1 5.1322908,50.000001 44.867708,44.633994 0 0 1 50,5.3660047\\\"></path></svg>\";\r\n    }\r\n\r\n    getStyle(): string | null {\r\n        return null;\r\n    }\r\n\r\n    get(element: HTMLElement, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiCircleHandler(element, utils, this.attribute);\r\n    }\r\n}\r\n\r\nexport class CuiCircleHandler extends CuiHandler<CuiCircleArgs> {\r\n    #factor: number;\r\n    #full: number;\r\n    #path: any;\r\n    #attr: string;\r\n    #progressEventId: string | null;\r\n    constructor(element: HTMLElement, utils: CuiUtils, attribute: string) {\r\n        super(\"CuiCircleHandler\", element, attribute, new CuiCircleArgs(), utils);\r\n        this.#factor = this.#full = 0;\r\n        this.#path = null\r\n        this.#attr = attribute;\r\n        this.#progressEventId = null;\r\n    }\r\n\r\n    onInit(): void {\r\n        const iconSvg = new IconBuilder(ICONS['special_circle_progress']).build();\r\n        if (!is(iconSvg)) {\r\n            this.logError(\"SVG circle was not created\", \"onInit\")\r\n            return;\r\n        }\r\n        const svg = this.element.querySelector('svg')\r\n        if (is(svg)) {\r\n            //@ts-ignore svg checked\r\n            svg.remove();\r\n        }\r\n        //@ts-ignore iconSvg checked\r\n        this.element.appendChild(iconSvg);\r\n        this.#path = this.element.querySelector('.circle-progress-path');\r\n        this.#full = this.#path.getTotalLength();\r\n        this.#factor = this.#full / 100;\r\n        this.fetch(this.readStyle)\r\n        this.#progressEventId = this.onEvent(EVENTS.PROGRESS_CHANGE, this.onSetProgress.bind(this))\r\n    }\r\n\r\n    onUpdate(): void {\r\n        this.fetch(this.readStyle)\r\n        this.emitEvent(EVENTS.PROGRESS_CHANGED, {\r\n            timestamp: Date.now(),\r\n            progress: this.args.progress\r\n        })\r\n    }\r\n\r\n    onDestroy(): void {\r\n        this.detachEvent(EVENTS.PROGRESS_CHANGE, this.#progressEventId);\r\n    }\r\n\r\n    onSetProgress(val: any) {\r\n        if (is(val)) {\r\n            this.element.setAttribute(this.#attr, val);\r\n        }\r\n    }\r\n\r\n    private updateStyle(value: number) {\r\n        this.#path.style.strokeDashoffset = value;\r\n    }\r\n\r\n    private readStyle(): void {\r\n        if (this.prevArgs && this.args.progress === this.prevArgs.progress) {\r\n            return;\r\n        }\r\n        const progress = getRangeValue(this.args.progress, 0, 100);\r\n\r\n        this.mutate(this.updateStyle, this.#full - this.#factor * progress);\r\n    }\r\n\r\n}","import { ICuiComponent, ICuiComponentHandler } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiHandler } from \"../../core/handlers/base\";\r\nimport { getStringOrDefault, getIntOrDefault, is, isString, isStringTrue, getParentCuiElement, are } from \"../../core/utils/functions\";\r\nimport { CuiActionsListFactory } from \"../../core/utils/actions\";\r\nimport { EVENTS } from \"../../core/utils/statics\";\r\n\r\nexport class CuiCloseArgs {\r\n    target: string;\r\n    action: string;\r\n    timeout: number;\r\n    prevent: boolean;\r\n    state: string;\r\n    #defTimeout: number;\r\n\r\n    constructor(timeout?: number) {\r\n        this.target = \"\";\r\n        this.action = \"\";\r\n        this.prevent = false;\r\n        this.state = \"\";\r\n        this.#defTimeout = timeout ?? 300;\r\n        this.timeout = this.#defTimeout;\r\n    }\r\n\r\n    parse(args: any) {\r\n        if (is(args) && isString(args)) {\r\n            this.target = args\r\n            this.action = \"\"\r\n            this.timeout = this.#defTimeout;\r\n            this.prevent = false\r\n            this.state = \"\";\r\n            return;\r\n        }\r\n        this.target = getStringOrDefault(args.target, \"\");\r\n        this.action = args.action;\r\n        this.timeout = getIntOrDefault(args.timeout, this.#defTimeout);\r\n        this.prevent = args.prevent && isStringTrue(args.prevent)\r\n        this.state = args.state;\r\n    }\r\n}\r\n\r\nexport class CuiCloseComponent implements ICuiComponent {\r\n    attribute: string;\r\n    #prefix: string;\r\n\r\n    constructor(prefix?: string) {\r\n        this.#prefix = prefix ?? 'cui';\r\n        this.attribute = `${this.#prefix}-close`;\r\n\r\n    }\r\n\r\n    getStyle(): string | null {\r\n        return null;\r\n    }\r\n\r\n    get(element: HTMLElement, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiCloseHandler(element, utils, this.attribute, this.#prefix);\r\n    }\r\n}\r\n\r\nexport class CuiCloseHandler extends CuiHandler<CuiCloseArgs> {\r\n    #eventId: string | null;\r\n    constructor(element: HTMLElement, utils: CuiUtils, attribute: string, prefix: string) {\r\n        super(\"CuiCloseHandler\", element, attribute, new CuiCloseArgs(utils.setup.animationTime), utils);\r\n        this.#eventId = null;\r\n        this.onClick = this.onClick.bind(this);\r\n    }\r\n\r\n    onInit(): void {\r\n        this.element.addEventListener('click', this.onClick)\r\n        this.#eventId = this.onEvent(EVENTS.CLOSE, this.onClose.bind(this));\r\n    }\r\n\r\n    onUpdate(): void {\r\n        //\r\n    }\r\n    onDestroy(): void {\r\n        this.element.removeEventListener('click', this.onClick)\r\n        this.detachEvent(EVENTS.CLOSE, this.#eventId);\r\n    }\r\n\r\n    onClick(ev: MouseEvent) {\r\n        this.onClose(ev);\r\n        if (this.args.prevent)\r\n            ev.preventDefault();\r\n    }\r\n\r\n    onClose(ev: MouseEvent) {\r\n        if (this.isLocked) {\r\n            return;\r\n        }\r\n        const target = this.getTarget();\r\n        if (!is(target)) {\r\n            this._log.warning(`Target ${this.args.target} not found`, 'onClick')\r\n            return;\r\n        }\r\n        this.isLocked = true;\r\n        //@ts-ignore target is checked\r\n        this.run(target).then((result) => {\r\n            this.onActionFinish(ev, result);\r\n        }).catch((e) => {\r\n            this._log.exception(e);\r\n        }).finally(() => {\r\n            this.isLocked = false;\r\n        })\r\n    }\r\n\r\n    private async run(target: Element): Promise<boolean> {\r\n        let cuiId = (target as any).$cuid;\r\n        if (is(cuiId)) {\r\n            await this.utils.bus.emit(EVENTS.CLOSE, cuiId, this.args.state);\r\n            return false;\r\n        } else if (are(this.args.action, this.args.timeout)) {\r\n            let actions = CuiActionsListFactory.get(this.args.action);\r\n            return this.actionsHelper.performActions(target, actions, this.args.timeout, () => {\r\n                this.removeActiveClass(target);\r\n            });\r\n        } else {\r\n            this.removeActiveClassAsync(target);\r\n            return true;\r\n        }\r\n    }\r\n    private removeActiveClass(target: Element) {\r\n        if (is(target) && this.helper.hasClass(this.activeClassName, target)) {\r\n            this.helper.removeClass(this.activeClassName, target);\r\n        }\r\n    }\r\n\r\n    private removeActiveClassAsync(target: Element) {\r\n        this.fetch(() => {\r\n            if (is(target) && this.helper.hasClass(this.activeClassName, target)) {\r\n                this.helper.removeClassesAs(target, this.activeClassName);\r\n            }\r\n        })\r\n\r\n    }\r\n    private onActionFinish(ev: MouseEvent, shouldEmit: boolean) {\r\n\r\n        if (shouldEmit)\r\n            this.emitClose(ev);\r\n    }\r\n\r\n    private getTarget(): Element | undefined {\r\n        if (!is(this.args.target)) {\r\n            return getParentCuiElement(this.element);\r\n        }\r\n        return document.querySelector(this.args.target) ?? getParentCuiElement(this.element);\r\n    }\r\n\r\n    private emitClose(ev: MouseEvent) {\r\n        this.emitEvent(EVENTS.CLOSED, {\r\n            timestamp: Date.now(),\r\n            state: this.args.state,\r\n            event: ev\r\n        })\r\n    }\r\n}","import { ICuiComponent, ICuiComponentHandler, ICuiParsable } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { replacePrefix, isStringTrue, getStringOrDefault, getIntOrDefault } from \"../../core/utils/functions\";\r\nimport { AriaAttributes } from \"../../core/utils/aria\";\r\nimport { CuiInteractableArgs, CuiInteractableHandler } from \"../../core/handlers/base\";\r\n\r\nconst COVER_OPEN_ANIMATION_CLASS = '.{prefix}-dialog-default-in';\r\nconst COVER_CLOSE_ANIMATION_CLASS = '.{prefix}-dialog-default-out';\r\nconst bodyClass = '{prefix}-cover-open';\r\n\r\nexport interface CuiDialogEvent {\r\n    timestamp: number;\r\n}\r\n\r\nexport class CuiCoverArgs implements ICuiParsable, CuiInteractableArgs {\r\n    escClose: boolean;\r\n    timeout: number;\r\n    openAct: string;\r\n    closeAct: string;\r\n    keyClose: string;\r\n\r\n    #defTimeout: number;\r\n    #prefix: string;\r\n    constructor(prefix: string, defTimeout?: number) {\r\n        this.#defTimeout = defTimeout ?? 300;\r\n        this.#prefix = prefix;\r\n\r\n        this.escClose = false;\r\n        this.timeout = this.#defTimeout;\r\n        this.openAct = \"\";\r\n        this.closeAct = \"\";\r\n        this.keyClose = \"\";\r\n\r\n\r\n    }\r\n\r\n\r\n    parse(args: any) {\r\n        this.escClose = isStringTrue(args.escClose);\r\n        this.keyClose = args.keyClose;\r\n        this.timeout = getIntOrDefault(args.timeout, this.#defTimeout);\r\n        this.openAct = getStringOrDefault(args.openAct, replacePrefix(COVER_OPEN_ANIMATION_CLASS, this.#prefix))\r\n        this.closeAct = getStringOrDefault(args.closeAct, replacePrefix(COVER_CLOSE_ANIMATION_CLASS, this.#prefix))\r\n    }\r\n}\r\n\r\nexport class CuiCoverComponent implements ICuiComponent {\r\n    attribute: string;\r\n    #prefix: string;\r\n    constructor(prefix?: string) {\r\n        this.#prefix = prefix ?? 'cui';\r\n        this.attribute = `${this.#prefix}-cover`;\r\n    }\r\n\r\n    getStyle(): string | null {\r\n        return null;\r\n    }\r\n\r\n    get(element: HTMLElement, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiCoverHandler(element, utils, this.attribute, this.#prefix);\r\n    }\r\n}\r\n\r\nexport class CuiCoverHandler extends CuiInteractableHandler<CuiCoverArgs> {\r\n\r\n    #bodyClass: string;\r\n    #scrollY: number;\r\n\r\n    constructor(element: HTMLElement, utils: CuiUtils, attribute: string, prefix: string) {\r\n        super(\"CuiDialogHandler\", element, attribute, new CuiCoverArgs(prefix, utils.setup.animationTimeLong), utils);\r\n        this.#bodyClass = replacePrefix(bodyClass, prefix);\r\n        this.#scrollY = 0;\r\n\r\n        if (!utils.isPlugin(\"click-plugin\")) {\r\n            this.logWarning(\"WindowClick plugin is not available, outClose will not work\")\r\n        }\r\n        if (!utils.isPlugin(\"keys-plugin\")) {\r\n            this.logWarning(\"KeyObserver plugin is not available, escClose and keyClose will not work\")\r\n        }\r\n    }\r\n\r\n    onInit(): void {\r\n        AriaAttributes.setAria(this.element, 'aria-modal', \"\");\r\n    }\r\n    onUpdate(): void {\r\n\r\n    }\r\n\r\n    onDestroy(): void {\r\n\r\n    }\r\n\r\n    onBeforeOpen(): boolean {\r\n        if (this.isAnyActive()) {\r\n            return false;\r\n        }\r\n        this.#scrollY = window.pageYOffset;\r\n        return true;\r\n    }\r\n\r\n    onAfterOpen(): void {\r\n        this.helper.setClass(this.#bodyClass, document.body)\r\n        document.body.style.top = `-${this.#scrollY}px`;\r\n        AriaAttributes.setAria(this.element, 'aria-hidden', \"false\");\r\n    }\r\n\r\n    onAfterClose(): void {\r\n        document.body.style.top = '';\r\n        window.scrollTo(0, (this.#scrollY || 0) * -1);\r\n        this.#scrollY = 0;\r\n        this.helper.removeClass(this.#bodyClass, document.body);\r\n        AriaAttributes.setAria(this.element, 'aria-hidden', \"true\");\r\n    }\r\n\r\n    onBeforeClose(): boolean {\r\n        return true;\r\n    }\r\n\r\n    private isAnyActive(): boolean {\r\n        return this.helper.hasClass(this.#bodyClass, document.body);\r\n    }\r\n}","import { ICuiComponent, ICuiComponentHandler, ICuiParsable } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { replacePrefix, isStringTrue, getStringOrDefault, getIntOrDefault } from \"../../core/utils/functions\";\r\nimport { EVENTS } from \"../../core/utils/statics\";\r\nimport { AriaAttributes } from \"../../core/utils/aria\";\r\nimport { CuiInteractableArgs, CuiInteractableHandler } from \"../../core/handlers/base\";\r\n\r\nconst DIALOG_OPEN_ANIMATION_CLASS = '.{prefix}-dialog-default-in';\r\nconst DIALOG_CLOSE_ANIMATION_CLASS = '.{prefix}-dialog-default-out';\r\nconst bodyClass = '{prefix}-dialog-open';\r\nconst CONTAINER = '.{prefix}-dialog-container';\r\n\r\nexport interface CuiDialogEvent {\r\n    timestamp: number;\r\n}\r\n\r\nexport class CuiDialogArgs implements ICuiParsable, CuiInteractableArgs {\r\n    escClose: boolean;\r\n    outClose: boolean;\r\n    timeout: number;\r\n    openAct: string;\r\n    closeAct: string;\r\n    keyClose: string;\r\n\r\n    #defTimeout: number;\r\n    #prefix: string;\r\n    constructor(prefix: string, defTimeout?: number) {\r\n        this.#defTimeout = defTimeout ?? 300;\r\n        this.#prefix = prefix;\r\n\r\n        this.escClose = false;\r\n        this.outClose = false;\r\n        this.timeout = this.#defTimeout;\r\n        this.openAct = \"\";\r\n        this.closeAct = \"\";\r\n        this.keyClose = \"\";\r\n    }\r\n\r\n\r\n    parse(args: any) {\r\n        this.escClose = isStringTrue(args.escClose);\r\n        this.outClose = isStringTrue(args.outClose);\r\n        this.keyClose = args.keyClose;\r\n        this.timeout = getIntOrDefault(args.timeout, this.#defTimeout);\r\n        this.openAct = getStringOrDefault(args.openAct, replacePrefix(DIALOG_OPEN_ANIMATION_CLASS, this.#prefix))\r\n        this.closeAct = getStringOrDefault(args.closeAct, replacePrefix(DIALOG_CLOSE_ANIMATION_CLASS, this.#prefix))\r\n    }\r\n}\r\n\r\nexport class CuiDialogComponent implements ICuiComponent {\r\n    attribute: string;\r\n    #prefix: string;\r\n    constructor(prefix?: string) {\r\n        this.#prefix = prefix ?? 'cui';\r\n        this.attribute = `${this.#prefix}-dialog`;\r\n    }\r\n\r\n    getStyle(): string | null {\r\n        return null;\r\n    }\r\n\r\n    get(element: HTMLElement, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiDialogHandler(element, utils, this.attribute, this.#prefix);\r\n    }\r\n}\r\n\r\nexport class CuiDialogHandler extends CuiInteractableHandler<CuiDialogArgs> {\r\n    #prefix: string;\r\n    #bodyClass: string;\r\n    #scrollY: number;\r\n    #windowClickEventId: string | null;\r\n\r\n    constructor(element: HTMLElement, utils: CuiUtils, attribute: string, prefix: string) {\r\n        super(\"CuiDialogHandler\", element, attribute, new CuiDialogArgs(prefix, utils.setup.animationTimeLong), utils);\r\n        this.#bodyClass = replacePrefix(bodyClass, prefix);\r\n        this.#prefix = prefix;\r\n        this.#scrollY = 0;\r\n        this.#windowClickEventId = null;\r\n\r\n        if (!utils.isPlugin(\"click-plugin\")) {\r\n            this.logWarning(\"WindowClick plugin is not available, outClose will not work\")\r\n        }\r\n        if (!utils.isPlugin(\"keys-plugin\")) {\r\n            this.logWarning(\"KeyObserver plugin is not available, escClose and keyClose will not work\")\r\n        }\r\n    }\r\n\r\n    onInit(): void {\r\n        AriaAttributes.setAria(this.element, 'aria-modal', \"\");\r\n    }\r\n    onUpdate(): void {\r\n\r\n    }\r\n\r\n    onDestroy(): void {\r\n\r\n    }\r\n\r\n    onBeforeOpen(): boolean {\r\n        if (this.isAnyActive()) {\r\n            return false;\r\n        }\r\n        this.#scrollY = window.pageYOffset;\r\n        return true;\r\n    }\r\n\r\n    onAfterOpen(): void {\r\n        if (this.args.outClose) {\r\n            this.#windowClickEventId = this.onEvent(EVENTS.WINDOW_CLICK, this.onWindowClick.bind(this));\r\n        }\r\n        this.helper.setClass(this.#bodyClass, document.body)\r\n        document.body.style.top = `-${this.#scrollY}px`;\r\n    }\r\n\r\n    onAfterClose(): void {\r\n        document.body.style.top = '';\r\n        window.scrollTo(0, (this.#scrollY || 0) * -1);\r\n        this.#scrollY = 0;\r\n        this.helper.removeClass(this.#bodyClass, document.body);\r\n        this.detachEvent(EVENTS.WINDOW_CLICK, this.#windowClickEventId);\r\n    }\r\n\r\n    onBeforeClose(): boolean {\r\n        return true;\r\n    }\r\n\r\n    private isAnyActive(): boolean {\r\n        return this.helper.hasClass(this.#bodyClass, document.body);\r\n    }\r\n\r\n    onWindowClick(ev: MouseEvent) {\r\n        let container = this.element.querySelector(replacePrefix(CONTAINER, this.#prefix));\r\n        if (container && !container.contains((ev.target as Node))) {\r\n            this.close('out').then(() => {\r\n                this._log.debug(\"Closed by click outside\")\r\n            });\r\n        }\r\n    }\r\n}","import { ICuiEventListener } from \"../models/interfaces\";\r\nimport { are } from \"../utils/functions\";\r\n\r\nexport interface CuiHoverEvent {\r\n    isHovering: boolean;\r\n    event: MouseEvent;\r\n    timestamp: number;\r\n}\r\nexport class CuiHoverListener implements ICuiEventListener<CuiHoverEvent> {\r\n    #target: Element;\r\n    #callback: ((t: CuiHoverEvent) => void) | undefined;\r\n    #inProgress: boolean;\r\n    #isHovering: boolean;\r\n    #isAttached: boolean;\r\n    #onOverBound: (ev: MouseEvent) => void;\r\n    #onMoveBound: (ev: MouseEvent) => void;\r\n    #onOutBound: (ev: MouseEvent) => void;\r\n\r\n    constructor(target: Element) {\r\n        this.#target = target;\r\n        this.#inProgress = false;\r\n        this.#isHovering = false;\r\n        this.#isAttached = false;\r\n        this.#callback = undefined;\r\n\r\n        this.#onMoveBound = this.onMouseMove.bind(this);\r\n        this.#onOutBound = this.onMouseOut.bind(this);\r\n        this.#onOverBound = this.onMouseOver.bind(this);\r\n\r\n    }\r\n\r\n    setCallback(callback: (t: CuiHoverEvent) => void): void {\r\n        this.#callback = callback;\r\n    }\r\n\r\n    isInProgress(): boolean {\r\n        return this.#inProgress;\r\n    }\r\n    attach(): void {\r\n        // @ts-ignore\r\n        this.#target.addEventListener(\"mouseover\", this.#onOverBound);\r\n        // @ts-ignore\r\n        this.#target.addEventListener(\"mousemove\", this.#onMoveBound);\r\n        // @ts-ignore\r\n        this.#target.addEventListener(\"mouseout\", this.#onOutBound);\r\n        this.#isAttached = true;\r\n    }\r\n\r\n    detach(): void {\r\n        // @ts-ignore\r\n        this.#target.removeEventListener(\"mouseover\", this.#onOverBound);\r\n        // @ts-ignore\r\n        this.#target.removeEventListener(\"mousemove\", this.#onMoveBound);\r\n        // @ts-ignore\r\n        this.#target.removeEventListener(\"mouseout\", this.#onOutBound);\r\n        this.#isAttached = false;\r\n    }\r\n\r\n    private emit(mouseEvent: MouseEvent, force: boolean) {\r\n        if (!are(this.#callback)) {\r\n            return;\r\n        }\r\n        if (!force && this.#inProgress) {\r\n            return;\r\n        }\r\n        this.#inProgress = true;\r\n        window.requestAnimationFrame(this.invoke.bind(this, {\r\n            isHovering: this.#isHovering,\r\n            event: mouseEvent,\r\n            timestamp: Date.now()\r\n        }))\r\n    }\r\n\r\n    isAttached() {\r\n        return this.#isAttached;\r\n    }\r\n    private invoke(ev: CuiHoverEvent) {\r\n        if (this.#callback)\r\n            this.#callback(ev);\r\n        this.#inProgress = false;\r\n    }\r\n\r\n    private onMouseOver(ev: MouseEvent) {\r\n        this.#isHovering = true;\r\n        this.emit(ev, true);\r\n    }\r\n\r\n    private onMouseOut(ev: MouseEvent) {\r\n        this.#isHovering = false;\r\n        this.emit(ev, true);\r\n    }\r\n\r\n    private onMouseMove(ev: MouseEvent) {\r\n        this.emit(ev, false);\r\n    }\r\n}","import { CuiPositionError } from \"../models/errors\";\r\nimport { is } from \"../utils/functions\";\r\nimport { ElementBox, ICuiPositionEvaluator } from \"./interfaces\";\r\n\r\nexport class CuiBasePositionEvaluator implements ICuiPositionEvaluator {\r\n    #box: ElementBox | undefined;\r\n    #targetWidth: number;\r\n    #targetHeight: number;\r\n    #margin: number;\r\n    constructor() {\r\n        this.#targetHeight = -1;\r\n        this.#targetWidth = -1;\r\n        this.#box = undefined;\r\n        this.#margin = 0;\r\n    }\r\n\r\n\r\n    setElementBox(box: ElementBox): void {\r\n        this.#box = box;\r\n    }\r\n\r\n    setTarget(targetBox: ElementBox): void {\r\n        this.#targetWidth = targetBox.width;\r\n        this.#targetHeight = targetBox.height;\r\n    }\r\n\r\n    setMargin(value: number) {\r\n        this.#margin = value;\r\n    }\r\n\r\n    getVerticalPosition(value: string): number {\r\n        switch (value) {\r\n            case 'top':\r\n                return this.getTopPosition();\r\n            case \"bottom\":\r\n                return this.getBottomPosition();\r\n            case \"middle\":\r\n                return this.getMiddlePosition();\r\n            default:\r\n                return -1;\r\n        }\r\n    }\r\n\r\n    getHorizontalPosition(value: string): number {\r\n        switch (value) {\r\n            case 'left':\r\n                return this.getLeftPosition();\r\n            case \"right\":\r\n                return this.getRightPosition();\r\n            case \"center\":\r\n                return this.getCenterPosition();\r\n            default:\r\n                return -1;\r\n        }\r\n    }\r\n\r\n    getAutoVerticalPosition(initial: string): [number, string] {\r\n        let innerHeight = window.innerHeight;\r\n        let number = this.getVerticalPosition(initial);\r\n\r\n        if ((initial === 'top' || initial === \"middle\") && number < 0) {\r\n            return [this.getVerticalPosition(\"bottom\"), \"bottom\"]\r\n        } else if ((initial === \"bottom\" || initial === \"middle\") && number + this.#targetHeight > innerHeight) {\r\n            return [this.getVerticalPosition(\"top\"), \"top\"]\r\n        }\r\n        return [number, initial];\r\n    }\r\n\r\n    getAutoHorizontalPosition(initial: string): [number, string] {\r\n        let innerWidth = window.innerWidth;\r\n        let number = this.getHorizontalPosition(initial);\r\n\r\n        if ((initial === 'right' || initial === \"center\") && number < 0) {\r\n            return [this.getHorizontalPosition(\"left\"), \"left\"]\r\n        } else if ((initial === 'left' || initial === \"center\") && number + this.#targetWidth > innerWidth) {\r\n            return [this.getHorizontalPosition(\"right\"), \"right\"]\r\n        }\r\n        return [number, initial];\r\n    }\r\n\r\n    private getTopPosition(): number {\r\n        this.throwIfNotValid(\"getTopPosition\");\r\n        // @ts-ignore - already checked in validate\r\n        return this.#box.top - this.#margin - this.#targetHeight;\r\n    }\r\n\r\n    private getBottomPosition(): number {\r\n        this.throwIfNotValid(\"getBottomPosition\");\r\n        // @ts-ignore - already checked in validate\r\n        return this.#box.top + this.#box.height + this.#margin;\r\n    }\r\n\r\n    private getMiddlePosition(): number {\r\n        this.throwIfNotValid(\"getMiddlePosition\");\r\n        // @ts-ignore - already checked in validate\r\n        return (this.#box.top + this.#box.height / 2) - this.#targetHeight / 2;\r\n    }\r\n\r\n    private getLeftPosition(): number {\r\n        this.throwIfNotValid(\"getLeftPosition\");\r\n        // @ts-ignore - already checked in validate\r\n        return this.#box.left;\r\n    }\r\n\r\n    private getRightPosition(): number {\r\n        this.throwIfNotValid(\"getRightPosition\");\r\n        // @ts-ignore - already checked in validate\r\n        return this.#box.left + this.#box.width - this.#targetWidth;\r\n    }\r\n\r\n    private getCenterPosition(): number {\r\n        this.throwIfNotValid(\"getCenterPosition\");\r\n        // @ts-ignore - already checked in validate\r\n        return (this.#box.left + this.#box.width / 2) - this.#targetWidth / 2;\r\n    }\r\n\r\n    private validate(): boolean {\r\n        return is(this.#box) && this.#targetHeight > 0 && this.#targetWidth > 0;\r\n    }\r\n\r\n\r\n\r\n    private throwIfNotValid(method: string): void {\r\n        if (!this.validate()) {\r\n            throw new CuiPositionError(`[${method}] Position cannot be calculated: missing data [width: ${this.#targetWidth}][height: ${this.#targetHeight}]`)\r\n        }\r\n    }\r\n}","import { CuiLoggerFactory } from \"../factories/logger\";\r\nimport { ICuiLogger } from \"../models/interfaces\";\r\nimport { is } from \"../utils/functions\";\r\nimport { CuiBasePositionEvaluator } from \"./evaluator\";\r\nimport { ElementBox, ICuiPositionCalculator, ICuiPositionEvaluator } from \"./interfaces\";\r\n\r\nexport class CuiBasePositionCalculator implements ICuiPositionCalculator {\r\n    #static: string;\r\n    #preferred: string;\r\n    #evaluator: ICuiPositionEvaluator;\r\n    #log: ICuiLogger;\r\n    constructor(evaluator?: ICuiPositionEvaluator) {\r\n        this.#preferred = \"top-center\";\r\n        this.#static = \"\";\r\n        this.#evaluator = evaluator ?? new CuiBasePositionEvaluator();\r\n        this.#log = CuiLoggerFactory.get(\"CuiBasePositionCalculator\");\r\n    }\r\n\r\n    setMargin(value: number): void {\r\n        this.#evaluator.setMargin(value);\r\n    }\r\n\r\n    setPreferred(position: string): void {\r\n        this.#preferred = position\r\n    }\r\n\r\n    setStatic(position: string): void {\r\n        this.#static = position;\r\n    }\r\n\r\n    //targetWidth: number, targetHeight: number\r\n    calculate(elementBox: ElementBox, targetBox: ElementBox): [number, number, string] {\r\n        this.#evaluator.setElementBox(elementBox)\r\n        this.#evaluator.setTarget(targetBox);\r\n\r\n        if (is(this.#static)) {\r\n            this.#log.debug(\"Evaluating static position\")\r\n            const [vertical, horizontal] = this.parse(this.#static);\r\n            return [this.#evaluator.getHorizontalPosition(horizontal), this.#evaluator.getVerticalPosition(vertical), this.#static];\r\n        }\r\n\r\n        let [vertical, horizontal]: string[] = [\"\", \"\"];\r\n        if (is(this.#preferred)) {\r\n            this.#log.debug(\"Evaluating auto position\");\r\n            [vertical, horizontal] = this.parse(this.#preferred);\r\n        }\r\n        vertical = vertical ?? \"top\";\r\n        horizontal = horizontal ?? \"center\";\r\n        this.#log.debug(\"Calculating position: \" + vertical + \"-\" + horizontal)\r\n        const [outVNum, outVPos] = this.#evaluator.getAutoVerticalPosition(vertical);\r\n        const [outHNum, outHPos] = this.#evaluator.getAutoHorizontalPosition(horizontal);\r\n        this.#log.debug(\"Calculated position: \" + outVPos + \"-\" + outHPos)\r\n        return [outHNum, outVNum, outVPos + \"-\" + outHPos];\r\n    }\r\n\r\n    private parse(position: string): string[] {\r\n        return position.split(\"-\");\r\n    }\r\n}","import { are, is } from \"./functions\";\r\n\r\nexport interface ICuiTask {\r\n    start(): void;\r\n    stop(): void;\r\n    getId(): any;\r\n    setCallback(callback: () => void): void;\r\n    setTimeout(timeout: number): void;\r\n}\r\n\r\nexport class CuiTaskRunner implements ICuiTask {\r\n    #taskId: any;\r\n    #autoRenew: boolean;\r\n    #timeout: number;\r\n    #callback: (() => void) | undefined;\r\n\r\n    constructor(timeout: number, autoRenew: boolean, callback?: () => void) {\r\n        this.#autoRenew = autoRenew;\r\n        this.#timeout = timeout;\r\n        this.#callback = callback;\r\n    }\r\n    start(): void {\r\n        if (!this.canRun()) {\r\n            return;\r\n        }\r\n        this.stop();\r\n        this.#taskId = setTimeout(() => {\r\n            //@ts-ignore - already checked in canRun\r\n            this.#callback();\r\n            this.#taskId = null;\r\n            if (this.#autoRenew) {\r\n                this.start();\r\n            }\r\n        }, this.#timeout);\r\n    }\r\n\r\n    stop(): void {\r\n        if (this.#taskId) {\r\n            clearTimeout(this.#taskId);\r\n            this.#taskId = null\r\n        }\r\n    }\r\n\r\n    getId() {\r\n        return this.#taskId;\r\n    }\r\n\r\n    private canRun(): boolean {\r\n        return is(this.#callback) && this.#timeout > 0;\r\n    }\r\n\r\n    setCallback(callback: () => void) {\r\n        this.#callback = callback;\r\n    }\r\n\r\n    setTimeout(timeout: number) {\r\n        this.#timeout = timeout;\r\n    }\r\n\r\n}","import { ICuiComponent, ICuiComponentHandler, ICuiOpenable, ICuiClosable, CuiElement, ICuiParsable } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiHandler } from \"../../core/handlers/base\";\r\nimport { is, replacePrefix, isStringTrue, getStringOrDefault, getIntOrDefault } from \"../../core/utils/functions\";\r\nimport { EVENTS, SCOPE_SELECTOR } from \"../../core/utils/statics\";\r\nimport { AriaAttributes } from \"../../core/utils/aria\";\r\nimport { CuiHoverListener, CuiHoverEvent } from \"../../core/listeners/hover\";\r\nimport { ICuiPositionCalculator } from \"../../core/position/interfaces\";\r\nimport { CuiBasePositionCalculator } from \"../../core/position/calculator\";\r\nimport { CuiTaskRunner, ICuiTask } from \"../../core/utils/task\";\r\nimport { ICuiComponentAction, CuiActionsListFactory } from \"../../core/utils/actions\";\r\n\r\nconst bodyClass = '{prefix}-drop-open';\r\nconst DROP_POSITION = \"{prefix}-drop-position-\";\r\nconst DROP_TRIGGER = \"{prefix}-drop-trigger\";\r\nconst DROP_DEFAULT_TRIGGER = \"> a, button\";\r\nconst DROP_DEFAULT_ANIMATION_CLS = '{prefix}-drop-animation-in';\r\n\r\n\r\nexport interface CuiDropEvent {\r\n    timestamp: number;\r\n}\r\n\r\nexport class CuiDropArgs implements ICuiParsable {\r\n    mode: \"click\" | \"hover\";\r\n    trigger: string;\r\n    prevent: boolean;\r\n    autoClose: boolean;\r\n    outClose: boolean;\r\n    pos: string;\r\n    action: string;\r\n    timeout: number;\r\n    margin: number;\r\n\r\n    #defOpenAct: string\r\n    constructor(prefix: string) {\r\n        this.#defOpenAct = replacePrefix(DROP_DEFAULT_ANIMATION_CLS, prefix);\r\n        this.mode = \"click\";\r\n        this.trigger = DROP_DEFAULT_TRIGGER;\r\n        this.autoClose = false;\r\n        this.outClose = false;\r\n        this.prevent = false;\r\n        this.pos = \"\";\r\n        this.action = this.#defOpenAct;\r\n        this.timeout = 3000;\r\n        this.margin = 8;\r\n    }\r\n\r\n\r\n    parse(args: any) {\r\n        this.mode = getStringOrDefault(args.mode, 'click').toLowerCase();\r\n        this.trigger = SCOPE_SELECTOR + getStringOrDefault(args.trigger, DROP_DEFAULT_TRIGGER);\r\n        this.prevent = isStringTrue(args.prevent);\r\n        this.autoClose = isStringTrue(args.autoClose);\r\n        this.outClose = args.outClose ? isStringTrue(args.outClose) : true;\r\n        this.pos = getStringOrDefault(args.pos, \"\");\r\n        this.action = getStringOrDefault(args.action, this.#defOpenAct);\r\n        this.timeout = getIntOrDefault(args.timeout, 3000);\r\n        this.margin = getIntOrDefault(args.margin, 8);\r\n    }\r\n}\r\n\r\nexport class CuiDropComponenet implements ICuiComponent {\r\n    attribute: string;\r\n    #prefix: string;\r\n    constructor(prefix?: string) {\r\n        this.#prefix = prefix ?? 'cui';\r\n        this.attribute = `${this.#prefix}-drop`;\r\n    }\r\n\r\n    getStyle(): string | null {\r\n        return null;\r\n    }\r\n\r\n    get(element: HTMLElement, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiDropHandler(element, utils, this.attribute, this.#prefix);\r\n    }\r\n}\r\n\r\nexport class CuiDropHandler extends CuiHandler<CuiDropArgs> implements ICuiOpenable, ICuiClosable {\r\n    #prefix: string;\r\n    #bodyClass: string;\r\n    #attribute: string;\r\n    #triggerHoverListener: CuiHoverListener | undefined;\r\n    #hoverListener: CuiHoverListener;\r\n    #trigger: Element;\r\n    #windowClickEventId: string | null;\r\n    #openEventId: string | null;\r\n    #closeEventId: string | null;\r\n    #positionCalculator: ICuiPositionCalculator;\r\n    #posClass: string;\r\n    #autoTask: ICuiTask;\r\n    #actions: ICuiComponentAction[];\r\n    constructor(element: HTMLElement, utils: CuiUtils, attribute: string, prefix: string) {\r\n        super(\"CuidropHandler\", element, attribute, new CuiDropArgs(prefix), utils);\r\n        this.#attribute = attribute;\r\n        this.#prefix = prefix;\r\n        this.#bodyClass = replacePrefix(bodyClass, prefix);\r\n        this.#hoverListener = new CuiHoverListener(this.element);\r\n        this.#hoverListener.setCallback(this.onElementHover.bind(this))\r\n        this.#windowClickEventId = null;\r\n        this.#openEventId = null;\r\n        this.#closeEventId = null;\r\n        this.onTriggerClick = this.onTriggerClick.bind(this)\r\n        this.#positionCalculator = new CuiBasePositionCalculator();\r\n        this.#positionCalculator.setMargin(8);\r\n        this.#positionCalculator.setPreferred(\"bottom-left\");\r\n        this.#posClass = \"\"\r\n        this.#triggerHoverListener = undefined;\r\n        this.#trigger = this.element;\r\n        this.#actions = [];\r\n        this.#autoTask = new CuiTaskRunner(this.args.timeout, false, this.close.bind(this));\r\n\r\n        if (!utils.isPlugin(\"click-plugin\")) {\r\n            this.logWarning(\"Window click plugin is not available: outClose will not work\")\r\n        }\r\n    }\r\n\r\n    onInit(): void {\r\n        this.#trigger = this.acquireTrigger();\r\n        this.#triggerHoverListener = new CuiHoverListener(this.#trigger);\r\n        this.setTriggerEvent();\r\n        this.#openEventId = this.onEvent(EVENTS.OPEN, this.open.bind(this));\r\n        this.#closeEventId = this.onEvent(EVENTS.CLOSE, this.close.bind(this));\r\n        this.#positionCalculator.setStatic(this.args.pos);\r\n        this.#positionCalculator.setMargin(this.args.margin);\r\n        this.#autoTask = new CuiTaskRunner(this.args.timeout, false, this.close.bind(this));\r\n        this.#actions = CuiActionsListFactory.get(this.args.action);\r\n        this.mutate(() => {\r\n            AriaAttributes.setAria(this.element, 'aria-dropdown', \"\");\r\n        })\r\n\r\n        this._log.debug(\"Initialized\", \"handle\")\r\n    }\r\n\r\n    onUpdate(): void {\r\n        if (this.#triggerHoverListener && this.#triggerHoverListener.isAttached()) {\r\n            this.#triggerHoverListener.detach();\r\n        } else if (this.prevArgs && this.prevArgs.mode === 'click') {\r\n            //@ts-ignore \r\n            this.#trigger.removeEventListener('click', this.onTriggerClick)\r\n        }\r\n\r\n        this.#trigger = this.acquireTrigger();\r\n        this.#triggerHoverListener = new CuiHoverListener(this.#trigger);\r\n        this.setTriggerEvent();\r\n        this.#positionCalculator.setStatic(this.args.pos);\r\n        this.#positionCalculator.setMargin(this.args.margin);\r\n        this.#actions = CuiActionsListFactory.get(this.args.action);\r\n        this.#autoTask.setTimeout(this.args.timeout);\r\n    }\r\n\r\n    onDestroy(): void {\r\n        this.detachEvent(EVENTS.OPEN, this.#openEventId);\r\n        this.detachEvent(EVENTS.CLOSE, this.#closeEventId);\r\n    }\r\n\r\n    /**\r\n    * Api Method open\r\n    */\r\n    async open(): Promise<boolean> {\r\n        if (this.checkLockAndWarn('open')) {\r\n            return false;\r\n        }\r\n        if (this.isActive()) {\r\n            return this.close();\r\n        }\r\n        if (this.isAnyActive()) {\r\n            await this.findAndCloseOpenedDrop();\r\n        }\r\n        this.isLocked = true;\r\n        this._log.debug(`Drop ${this.cuid}`, 'open');\r\n        this.onOpen();\r\n        this.isLocked = false;\r\n        return true\r\n    }\r\n\r\n    /**\r\n     * Api Method close\r\n     */\r\n    async close(): Promise<boolean> {\r\n        if (this.checkLockAndWarn(\"close\") || !this.isActive()) {\r\n            return false;\r\n        }\r\n        this.isLocked = true;\r\n        this.logInfo(`Drop ${this.cuid}`, 'close');\r\n        this.onClose();\r\n        this.detachEvent(EVENTS.WINDOW_CLICK, this.#windowClickEventId);\r\n        this.emitEvent(EVENTS.CLOSED, {\r\n            timestamp: Date.now()\r\n        })\r\n        this.#hoverListener.detach();\r\n        this.isLocked = false;\r\n        return true;\r\n    }\r\n\r\n\r\n    onClose() {\r\n        this.mutate(() => {\r\n            this.helper.removeClass(this.activeClassName, this.element)\r\n            this.helper.removeClass(this.#bodyClass, document.body)\r\n            this.toggleActions();\r\n            this.helper.removeClass(this.#posClass, this.element);\r\n            AriaAttributes.setAria(this.element, 'aria-expanded', 'false')\r\n        })\r\n    }\r\n\r\n    onOpen() {\r\n        this.helper.setClass(this.activeClassName, this.element);\r\n        this.mutate(() => {\r\n            const box = this.#trigger.getBoundingClientRect();\r\n            try {\r\n                const [x, y, pos] = this.#positionCalculator.calculate(box, this.element.getBoundingClientRect());\r\n                this.element.style.top = `${y - box.top}px`;\r\n                this.element.style.left = `${x - box.left}px`;\r\n                this.#posClass = replacePrefix(DROP_POSITION + pos, this.#prefix);\r\n                this.toggleActions();\r\n                this.helper.setClass(this.#posClass, this.element);\r\n                this.helper.setClass(this.#bodyClass, document.body)\r\n\r\n                this.emitEvent(EVENTS.OPENED, {\r\n                    timestamp: Date.now()\r\n                })\r\n                this.#hoverListener.attach();\r\n                this.runAutoCloseTask();\r\n\r\n                if (this.args.outClose) {\r\n                    this.#windowClickEventId = this.onEvent(EVENTS.WINDOW_CLICK, this.onWindowClick.bind(this));\r\n                }\r\n\r\n                AriaAttributes.setAria(this.element, 'aria-expanded', 'true')\r\n            } catch (e) {\r\n                this._log.exception(e)\r\n            }\r\n\r\n\r\n        })\r\n    }\r\n\r\n    /**\r\n     * Event invoked when window is clicked\r\n     * @param ev \r\n     */\r\n    private onWindowClick(ev: MouseEvent) {\r\n        if (!this.element.contains((ev.target as Node))) {\r\n            this.close();\r\n        }\r\n    }\r\n\r\n    private isAnyActive(): boolean {\r\n        return this.helper.hasClass(this.#bodyClass, document.body);\r\n    }\r\n\r\n    /**\r\n     * Finds and opens other active drop element\r\n     */\r\n    async findAndCloseOpenedDrop(): Promise<boolean> {\r\n        const opened = document.querySelector(`[${this.#attribute}].${this.activeClassName}`);\r\n        if (!is(opened)) {\r\n            this._log.warning(\"Opened drop was not found\");\r\n            return false;\r\n        }\r\n        //@ts-ignore opened checked\r\n        const handler = (<CuiElement>(opened as any)).$handlers[this.#attribute] as any;\r\n        if (!is(handler)) {\r\n            this._log.warning(\"Drop handler was not found in the element\");\r\n            return false;\r\n        }\r\n        return handler.close();\r\n    }\r\n\r\n    /**\r\n     * Invoked when trigger button is clicked\r\n     * @param ev \r\n     */\r\n    private onTriggerClick(ev: MouseEvent) {\r\n        if (this.isActive()) {\r\n            this.close();\r\n        } else {\r\n            this.open();\r\n        }\r\n        if (this.args.prevent) {\r\n            ev.preventDefault();\r\n        }\r\n    }\r\n\r\n    /**\r\n    * Invoked when trigger button is hovered on\r\n    * @param ev\r\n    */\r\n    private onHoverEvent(ev: CuiHoverEvent) {\r\n        if (ev.isHovering && !this.isActive()) {\r\n            this.open();\r\n        }\r\n        if (this.args.prevent) {\r\n            ev.event.preventDefault();\r\n        }\r\n    }\r\n\r\n\r\n    /**\r\n     * Method triggered when opened element is hovered on\r\n     * @param ev \r\n     */\r\n    private onElementHover(ev: CuiHoverEvent) {\r\n        if (ev.isHovering) {\r\n            this.#autoTask.stop();\r\n        } else if (!ev.isHovering && this.args.autoClose) {\r\n            this.runAutoCloseTask();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Sets event on trigger button\r\n     */\r\n    private setTriggerEvent() {\r\n        if (this.args.mode === 'hover' && this.#triggerHoverListener) {\r\n            this.#triggerHoverListener.setCallback(this.onHoverEvent.bind(this));\r\n            this.#triggerHoverListener.attach();\r\n        } else {\r\n            //@ts-ignore\r\n            this.#trigger.addEventListener('click', this.onTriggerClick)\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Runs auto-close task on opened element\r\n     */\r\n    private runAutoCloseTask() {\r\n        if (!this.args.autoClose) {\r\n            return\r\n        }\r\n        this.#autoTask.start();\r\n    }\r\n\r\n    private toggleActions() {\r\n        this.#actions.forEach(action => {\r\n            action.toggle(this.element);\r\n        })\r\n    }\r\n\r\n    private acquireTrigger(): Element {\r\n        let ret = null;\r\n        if (!this.element.parentElement) {\r\n            ret = document.querySelector(this.args.trigger)\r\n        } else\r\n            ret = this.element.parentElement.querySelector(this.args.trigger);\r\n        return ret ?? this.element;\r\n    }\r\n}","import { TaskedEventEmitHandler } from \"../bus/handlers\";\r\nimport { ICuiEventListener } from \"../models/interfaces\";\r\nimport { is, round } from \"../utils/functions\";\r\n\r\ninterface OnMoveCallback {\r\n    (ev: ICuiMoveEvent): void;\r\n}\r\n\r\ninterface IMoveListener {\r\n    onMove(data: OnMoveCallback): void\r\n    start(): void;\r\n    stop(): void;\r\n}\r\n\r\nexport type CuiMoveEventState = \"down\" | \"up\" | \"move\";\r\nexport interface ICuiMoveEvent {\r\n    x: number;\r\n    y: number;\r\n    moveX: number;\r\n    moveY: number;\r\n    type: CuiMoveEventState;\r\n    target: EventTarget | null;\r\n    event: MouseEvent | TouchEvent;\r\n}\r\n\r\nexport class CuiMoveEventListener implements ICuiEventListener<ICuiMoveEvent> {\r\n    #element: HTMLElement | Document;\r\n    #onEvent: ((t: ICuiMoveEvent) => void) | undefined;\r\n    #isLocked: boolean;\r\n    #isAttached: boolean;\r\n    #preventDefault: boolean;\r\n    #target: Element | undefined;\r\n    constructor(element?: HTMLElement) {\r\n        this.#isLocked = false;\r\n        this.#element = element ?? document.body;\r\n        this.#isAttached = false;\r\n        this.#preventDefault = false;\r\n        this.#onEvent = undefined;\r\n        this.#target = undefined;\r\n\r\n        this.onMouseDown = this.onMouseDown.bind(this);\r\n        this.onMouseUp = this.onMouseUp.bind(this)\r\n        this.onMouseMove = this.onMouseMove.bind(this)\r\n        this.onTouchStart = this.onTouchStart.bind(this)\r\n        this.onTouchEnd = this.onTouchEnd.bind(this)\r\n        this.onTouchMove = this.onTouchMove.bind(this)\r\n    }\r\n\r\n    setCallback(callback: (t: ICuiMoveEvent) => void): void {\r\n        this.#onEvent = callback;\r\n    }\r\n\r\n    setTarget(element: Element) {\r\n        this.#target = element;\r\n    }\r\n    isInProgress(): boolean {\r\n        return this.#isLocked;\r\n    }\r\n    preventDefault(flag: boolean) {\r\n        this.#preventDefault = flag;\r\n    }\r\n    attach(): void {\r\n        if (this.#isAttached) {\r\n            return;\r\n        }\r\n\r\n        //@ts-ignore\r\n        this.#element.addEventListener('mousedown', this.onMouseDown, { passive: false } as any);\r\n        //@ts-ignore\r\n        this.#element.addEventListener('mouseup', this.onMouseUp, { passive: false } as any);\r\n        //@ts-ignore\r\n        this.#element.addEventListener('mousemove', this.onMouseMove, { passive: false } as any);\r\n        //@ts-ignore\r\n        this.#element.addEventListener('touchstart', this.onTouchStart, { passive: false } as any);\r\n        //@ts-ignore\r\n        this.#element.addEventListener('touchend', this.onTouchEnd, { passive: false } as any);\r\n        //@ts-ignore\r\n        this.#element.addEventListener('touchmove', this.onTouchMove, { passive: false } as any);\r\n        this.#isAttached = true;\r\n    }\r\n    detach(): void {\r\n        if (!this.#isAttached) {\r\n            return;\r\n        }\r\n        //@ts-ignore\r\n        this.#element.removeEventListener('mousedown', this.onMouseDown, { passive: false } as any);\r\n        //@ts-ignore\r\n        this.#element.removeEventListener('mouseup', this.onMouseUp, { passive: false } as any);\r\n        //@ts-ignore\r\n        this.#element.removeEventListener('mousemove', this.onMouseMove, { passive: false } as any);\r\n        //@ts-ignore\r\n        this.#element.removeEventListener('touchstart', this.onTouchStart, { passive: false } as any);\r\n        //@ts-ignore\r\n        this.#element.removeEventListener('touchend', this.onTouchEnd, { passive: false } as any);\r\n        //@ts-ignore\r\n        this.#element.removeEventListener('touchmove', this.onTouchMove, { passive: false } as any);\r\n        this.#isAttached = false;\r\n    }\r\n\r\n    isAttached(): boolean {\r\n        return this.#isAttached\r\n    }\r\n\r\n    onMouseDown(ev: MouseEvent) {\r\n        if (this.#isLocked) {\r\n            return;\r\n        }\r\n        if (this.#target && !this.#target.contains(ev.target as Node)) {\r\n            return;\r\n        }\r\n\r\n        this.#isLocked = true;\r\n        this.publishMouseEvent(\"down\", ev)\r\n\r\n    }\r\n\r\n    onMouseUp(ev: MouseEvent) {\r\n        if (!this.#isLocked) {\r\n            return;\r\n        }\r\n        this.#isLocked = false;\r\n        this.publishMouseEvent(\"up\", ev)\r\n\r\n    }\r\n\r\n    onMouseMove(ev: MouseEvent) {\r\n        if (this.#isLocked) {\r\n            this.publishMouseEvent(\"move\", ev)\r\n        }\r\n    }\r\n\r\n    onTouchStart(ev: TouchEvent) {\r\n        if (this.#isLocked) {\r\n            return;\r\n        }\r\n        if (this.#target && !this.#target.contains(ev.target as Node)) {\r\n            return;\r\n        }\r\n        this.#isLocked = true;\r\n        this.publishTouchEvent('down', ev);\r\n    }\r\n\r\n    onTouchEnd(ev: TouchEvent) {\r\n        if (!this.#isLocked) {\r\n            return;\r\n        }\r\n        this.#isLocked = false;\r\n        this.publishTouchEvent('up', ev);\r\n    }\r\n\r\n    onTouchMove(ev: TouchEvent) {\r\n        if (this.#isLocked) {\r\n            this.publishTouchEvent('move', ev);\r\n        }\r\n    }\r\n\r\n    private publishMouseEvent(type: CuiMoveEventState, ev: MouseEvent) {\r\n        if (this.#preventDefault && ev.cancelable) {\r\n            ev.preventDefault();\r\n        }\r\n        if (!is(this.#onEvent)) { return }\r\n        // @ts-ignore\r\n        this.#onEvent({\r\n            type: type,\r\n            x: ev.clientX,\r\n            y: ev.clientY,\r\n            moveX: ev.movementX,\r\n            moveY: ev.movementY,\r\n            target: ev.target,\r\n            event: ev\r\n        })\r\n\r\n    }\r\n\r\n    private publishTouchEvent(type: CuiMoveEventState, ev: TouchEvent) {\r\n        if (this.#preventDefault && ev.cancelable)\r\n            ev.preventDefault();\r\n        if (!is(this.#onEvent)) {\r\n            return;\r\n        }\r\n        let touch = null;\r\n        if (ev.touches.length > 0) {\r\n            touch = ev.touches[0]\r\n        } else if (ev.changedTouches.length > 0) {\r\n            touch = ev.changedTouches[0]\r\n        }\r\n        // @ts-ignore - already checked\r\n        this.#onEvent({\r\n            event: ev,\r\n            type: type,\r\n            target: ev.target,\r\n            //@ts-ignore\r\n            x: is(touch) ? touch.clientX : -1,\r\n            //@ts-ignore\r\n            y: is(touch) ? touch.clientY : -1,\r\n            moveX: -1,\r\n            moveY: -1\r\n        })\r\n\r\n    }\r\n\r\n}\r\n","export interface ICuiFloatPositionCalculator {\r\n    calculate(x: number, y: number, diffX: number, diffY: number): [number, number];\r\n}\r\n\r\nexport interface ICuiFloatResizeCalculator {\r\n    calculate(x: number, y: number, diffX: number, diffY: number): [number, number];\r\n}\r\n\r\nexport class BasePositionCalculator implements ICuiFloatPositionCalculator {\r\n\r\n    calculate(x: number, y: number, diffX: number, diffY: number): [number, number] {\r\n        return [x, y];\r\n    }\r\n\r\n}\r\n\r\nexport class OptionalPositionCalculator implements ICuiFloatPositionCalculator {\r\n    #element: HTMLElement;\r\n    constructor(element: HTMLElement) {\r\n        this.#element = element;\r\n    }\r\n    calculate(x: number, y: number, diffX: number, diffY: number): [number, number] {\r\n        let newX = this.#element.offsetLeft + diffX;\r\n        let newY = this.#element.offsetTop + diffY;\r\n        return [newX, newY];\r\n    }\r\n\r\n}\r\n\r\nexport class BaseResizeCalculator implements ICuiFloatResizeCalculator {\r\n    #element: HTMLElement;\r\n    constructor(element: HTMLElement) {\r\n        this.#element = element;\r\n    }\r\n    calculate(x: number, y: number, diffX: number, diffY: number): [number, number] {\r\n        let width = x - this.#element.offsetLeft;\r\n        let height = y - this.#element.offsetTop;\r\n        return [width, height];\r\n    }\r\n}\r\n\r\nexport class OptionalResizeCalculator implements ICuiFloatResizeCalculator {\r\n    #element: HTMLElement;\r\n    constructor(element: HTMLElement) {\r\n        this.#element = element;\r\n    }\r\n    calculate(x: number, y: number, diffX: number, diffY: number): [number, number] {\r\n        let width = this.#element.offsetWidth + diffX;\r\n        let height = this.#element.offsetHeight + diffY;\r\n        return [width, height];\r\n    }\r\n}","import { ICuiComponent, ICuiComponentHandler, ICuiParsable } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { replacePrefix, isStringTrue, is, getIntOrDefault, getStringOrDefault } from \"../../core/utils/functions\";\r\nimport { AriaAttributes } from \"../../core/utils/aria\";\r\nimport { CuiInteractableArgs, CuiInteractableHandler } from \"../../core/handlers/base\";\r\nimport { CuiMoveEventListener, ICuiMoveEvent } from \"../../core/listeners/move\";\r\nimport { BasePositionCalculator, BaseResizeCalculator, ICuiFloatPositionCalculator, ICuiFloatResizeCalculator } from \"./helpers\";\r\nimport { CLASSES, EVENTS } from \"../../core/utils/statics\";\r\n\r\nconst FLOAT_OPEN_ANIMATION_CLASS = '.{prefix}-float-default-in';\r\nconst FLOAT_CLOSE_ANIMATION_CLASS = '.{prefix}-float-default-out';\r\nconst MOVE = '.{prefix}-float-move';\r\nconst RESIZE = '.{prefix}-float-resize';\r\n\r\n\r\nexport class CuiFloatArgs implements CuiInteractableArgs, ICuiParsable {\r\n    escClose: boolean;\r\n    timeout: number;\r\n    openAct: string;\r\n    closeAct: string;\r\n    keyClose: string;\r\n\r\n    #defTimeout: number;\r\n    #prefix: string;\r\n    constructor(prefix: string, defTimeout?: number) {\r\n        this.#defTimeout = defTimeout ?? 300;\r\n        this.#prefix = prefix;\r\n\r\n        this.escClose = false;\r\n        this.keyClose = \"\";\r\n        this.openAct = \"\";\r\n        this.closeAct = \"\";\r\n        this.timeout = this.#defTimeout;\r\n    }\r\n\r\n\r\n    parse(args: any) {\r\n        this.escClose = isStringTrue(args.escClose);\r\n        this.keyClose = args.keyClose;\r\n        this.timeout = getIntOrDefault(args.timeout, this.#defTimeout);\r\n        this.openAct = getStringOrDefault(args.openAct, replacePrefix(FLOAT_OPEN_ANIMATION_CLASS, this.#prefix))\r\n        this.closeAct = getStringOrDefault(args.closeAct, replacePrefix(FLOAT_CLOSE_ANIMATION_CLASS, this.#prefix))\r\n    }\r\n}\r\n\r\nexport class CuiFloatComponent implements ICuiComponent {\r\n    attribute: string;\r\n    #prefix: string;\r\n    constructor(prefix?: string) {\r\n        this.#prefix = prefix ?? 'cui';\r\n        this.attribute = `${this.#prefix}-float`;\r\n    }\r\n\r\n    getStyle(): string | null {\r\n        return null;\r\n    }\r\n\r\n    get(element: HTMLElement, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiFloatHandler(element, utils, this.attribute, this.#prefix);\r\n    }\r\n}\r\n\r\nexport class CuiFloatHandler extends CuiInteractableHandler<CuiFloatArgs> {\r\n    #isMoving: boolean;\r\n    #isResizing: boolean;\r\n    #prevX: number;\r\n    #prevY: number;\r\n    #prefix: string;\r\n    #moveListener: CuiMoveEventListener;\r\n    #positionCalculator: ICuiFloatPositionCalculator;\r\n    #resizeCalculator: ICuiFloatResizeCalculator;\r\n    #resizeBtn: HTMLElement | null;\r\n    #moveBtn: HTMLElement | null;\r\n    constructor(element: HTMLElement, utils: CuiUtils, attribute: string, prefix: string) {\r\n        super(\"CuiFloatHandler\", element, attribute, new CuiFloatArgs(prefix, utils.setup.animationTime), utils);\r\n        this.#isMoving = false;\r\n        this.#isResizing = false;\r\n        this.#prevX = 0;\r\n        this.#prevY = 0;\r\n        this.#moveListener = new CuiMoveEventListener();\r\n        this.#moveListener.preventDefault(false);\r\n        this.#positionCalculator = new BasePositionCalculator();\r\n        this.#resizeCalculator = new BaseResizeCalculator(element as HTMLElement)\r\n        this.#prefix = prefix;\r\n        this.move = this.move.bind(this);\r\n        this.resize = this.resize.bind(this);\r\n        this.#moveBtn = null;\r\n        this.#resizeBtn = null;\r\n\r\n        if (!utils.isPlugin(\"click-plugin\")) {\r\n            this.logWarning(\"WindowClick plugin is not available, outClose will not work\")\r\n        }\r\n        if (!utils.isPlugin(\"keys-plugin\")) {\r\n            this.logWarning(\"KeyObserver plugin is not available, escClose and keyClose will not work\")\r\n        }\r\n    }\r\n\r\n    onInit(): void {\r\n        AriaAttributes.setAria(this.element, 'aria-modal', \"\");\r\n        this.#moveBtn = this.element.querySelector(replacePrefix(MOVE, this.#prefix))\r\n        this.#resizeBtn = this.element.querySelector(replacePrefix(RESIZE, this.#prefix))\r\n        this.#moveListener.setCallback(this.onMove.bind(this));\r\n\r\n    }\r\n\r\n    onUpdate(): void {\r\n\r\n    }\r\n\r\n    onDestroy(): void {\r\n    }\r\n\r\n    onBeforeOpen(): boolean {\r\n        return true\r\n    }\r\n\r\n    onAfterOpen(): void {\r\n        this.#moveListener.attach();\r\n    }\r\n\r\n    onAfterClose(): void {\r\n        this.#moveListener.detach();\r\n    }\r\n    onBeforeClose(): boolean {\r\n        return true;\r\n    }\r\n\r\n    onMove(ev: ICuiMoveEvent) {\r\n        switch (ev.type) {\r\n            case 'down':\r\n                this.onMouseDown(ev);\r\n                break;\r\n            case 'up':\r\n                this.onMouseUp(ev)\r\n                break;\r\n            case 'move':\r\n                this.onMouseMove(ev);\r\n                break;\r\n        }\r\n    }\r\n\r\n\r\n    onMouseDown(ev: ICuiMoveEvent) {\r\n        if (ev.target === this.#moveBtn) {\r\n            this.#isMoving = true;\r\n            ev.event.preventDefault();\r\n        } else if (ev.target === this.#resizeBtn) {\r\n            this.#isResizing = true;\r\n            ev.event.preventDefault();\r\n            //this.helper.setClass(\"cui-float-resize-shadow\")\r\n        }\r\n        this.#prevX = ev.x;\r\n        this.#prevY = ev.y;\r\n        this.helper.setClassesAs(document.body, CLASSES.swipingOn);\r\n        // Lock global move handler\r\n        this.utils.bus.emit(EVENTS.MOVE_LOCK, null, true);\r\n    }\r\n\r\n    onMouseMove(ev: ICuiMoveEvent) {\r\n        if (this.#isMoving) {\r\n            this.peform(ev, this.move)\r\n        } else if (this.#isResizing) {\r\n            this.peform(ev, this.resize)\r\n        }\r\n    }\r\n\r\n\r\n    onMouseUp(ev: ICuiMoveEvent) {\r\n        this.#isMoving = false;\r\n        this.#isResizing = false;\r\n        this.helper.removeClassesAs(document.body, CLASSES.swipingOn);\r\n        // Unlock global handler\r\n        this.utils.bus.emit(EVENTS.MOVE_LOCK, null, false);\r\n\r\n    }\r\n\r\n    peform(ev: ICuiMoveEvent, callback: (element: HTMLElement, x: number, y: number, diffX: number, diffY: number) => void) {\r\n        this.mutate(() => {\r\n            if (is(callback))\r\n                callback(this.element as HTMLElement, ev.x, ev.y, (ev.x - this.#prevX), (ev.y - this.#prevY));\r\n            this.#prevX = ev.x;\r\n            this.#prevY = ev.y;\r\n        })\r\n        ev.event.preventDefault();\r\n    }\r\n\r\n    resize(element: HTMLElement, x: number, y: number, diffX: number, diffY: number): void {\r\n        let [newWidth, newHeight] = this.#resizeCalculator.calculate(x, y, diffX, diffY);\r\n        if (this.fitsWindow(element.offsetTop, element.offsetLeft, newWidth, newHeight)) {\r\n            this.mutate(() => {\r\n                element.style.width = newWidth + \"px\";\r\n                element.style.height = newHeight + \"px\";\r\n            })\r\n        }\r\n    }\r\n\r\n    move(element: HTMLElement, x: number, y: number, diffX: number, diffY: number): void {\r\n        let [newX, newY] = this.#positionCalculator.calculate(x, y, diffX, diffY)\r\n        if (this.fitsWindow(newY, newX, element.offsetWidth, element.offsetHeight)) {\r\n            this.mutate(() => {\r\n                element.style.left = newX + \"px\";\r\n                element.style.top = newY + \"px\";\r\n            })\r\n        }\r\n    }\r\n\r\n    fitsWindow(top: number, left: number, width: number, height: number) {\r\n        return (top + height < window.innerHeight - 10) &&\r\n            (top > 10) && (left > 10) &&\r\n            (left + width < window.innerWidth - 10);\r\n    }\r\n}","import { ICuiComponent, ICuiComponentHandler, ICuiParsable } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiHandler } from \"../../core/handlers/base\";\r\nimport { ICONS } from \"../../core/utils/statics\";\r\nimport { is, isString, getStringOrDefault, getIntOrDefault } from \"../../core/utils/functions\";\r\nimport { IconBuilder } from \"../../core/builders/icon\";\r\n\r\nexport class CuiIconArgs implements ICuiParsable {\r\n    icon: string;\r\n    scale: number;\r\n\r\n    constructor() {\r\n        this.icon = \"\";\r\n        this.scale = 1;\r\n    }\r\n    parse(val: any) {\r\n        if (isString(val)) {\r\n            this.icon = getStringOrDefault(val, \"\");\r\n        } else {\r\n            this.icon = getStringOrDefault(val.icon, \"\");\r\n            this.scale = getIntOrDefault(val.scale, 1);\r\n        }\r\n\r\n    }\r\n}\r\n\r\nexport class CuiIconComponent implements ICuiComponent {\r\n    attribute: string;\r\n    constructor(prefix?: string) {\r\n        this.attribute = `${prefix ?? 'cui'}-icon`;\r\n    }\r\n\r\n    getStyle(): string | null {\r\n        return null;\r\n    }\r\n\r\n    get(element: HTMLElement, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiIconHandler(element, utils, this.attribute);\r\n    }\r\n}\r\n\r\n\r\n\r\nexport class CuiIconHandler extends CuiHandler<CuiIconArgs> {\r\n\r\n    #currentIcon: string | null;\r\n    constructor(element: HTMLElement, utils: CuiUtils, attribute: string) {\r\n        super(\"CuiIconHandler\", element, attribute, new CuiIconArgs(), utils);\r\n        this.#currentIcon = null;\r\n\r\n    }\r\n\r\n    onInit(): void {\r\n        if (this.isLocked) {\r\n            return;\r\n        }\r\n        if (this.#currentIcon !== null) {\r\n            this._log.debug(\"Icon already initialized\")\r\n            return;\r\n        }\r\n        this.isLocked = true;\r\n        this.#currentIcon = this.args.icon;\r\n        this.addIcon(this.args.icon)\r\n\r\n    }\r\n\r\n    onUpdate(): void {\r\n        if (this.isLocked) {\r\n            return;\r\n        }\r\n        if (this.args.icon === this.#currentIcon) {\r\n            return;\r\n        }\r\n        this.#currentIcon = this.args.icon;\r\n        this.addIcon(this.args.icon);\r\n\r\n    }\r\n\r\n    onDestroy(): void {\r\n        const svg = this.element.querySelector('svg')\r\n        if (is(svg)) {\r\n            //@ts-ignore checked\r\n            svg.remove();\r\n        }\r\n        this.#currentIcon = null;\r\n    }\r\n\r\n    private addIcon(icon: string) {\r\n        const iconStr = icon ? ICONS[icon] : null;\r\n        if (!iconStr) {\r\n            this.isLocked = false;\r\n            return;\r\n        }\r\n        const iconSvg = new IconBuilder(iconStr).setScale(this.args.scale).build();\r\n        const svg = this.element.querySelector('svg')\r\n        if (is(svg)) {\r\n            //@ts-ignore checked\r\n            svg.remove();\r\n        }\r\n\r\n        if (this.element.childNodes.length > 0) {\r\n            this.mutate(this.insertBefore, iconSvg)\r\n        } else {\r\n            this.mutate(this.appendChild, iconSvg)\r\n        }\r\n\r\n    }\r\n\r\n    private insertBefore(iconElement: Element) {\r\n        this.element.insertBefore(iconElement, this.element.firstChild);\r\n        this.isLocked = false;\r\n    }\r\n\r\n    private appendChild(iconElement: Element) {\r\n        this.element.appendChild(iconElement);\r\n        this.isLocked = false;\r\n    }\r\n}\r\n","import { ICuiObserver } from \"../models/interfaces\";\r\n\r\nexport interface ICuiIntersectionObserver {\r\n    observe(target: Element): void;\r\n    unobserve(target: Element): void;\r\n    disconnect(): void;\r\n}\r\n\r\nexport class CuiIntersectionEntry {\r\n    isInView: boolean;\r\n    ratio: number;\r\n\r\n    constructor() {\r\n        this.isInView = false;\r\n        this.ratio = 0;\r\n    }\r\n}\r\n\r\nexport interface ICuiIntersectionHandler {\r\n    onIntersection(entry: CuiIntersectionEntry): Promise<boolean>;\r\n}\r\n\r\n/**\r\n * Creates a wrapper for intersection observer\r\n * Constructor gets a root element for observer and optional array of threshold values [0...1]\r\n */\r\nexport class CuiIntersectionObserver implements ICuiObserver {\r\n    #observer: IntersectionObserver | undefined;\r\n    #root: Element;\r\n    #threshold: number[];\r\n    #callback: IntersectionObserverCallback | undefined;\r\n    constructor(root: Element, threshold?: number[]) {\r\n        this.#root = root;\r\n        this.#threshold = threshold ?? [0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1];\r\n        this.#callback = undefined;\r\n        this.#observer = undefined;\r\n    }\r\n\r\n    setCallback(callback: IntersectionObserverCallback) {\r\n        this.#callback = callback;\r\n    }\r\n\r\n    connect(): void {\r\n        if (!this.#callback) {\r\n            return;\r\n        }\r\n        this.#observer = new IntersectionObserver(this.#callback, {\r\n            root: this.#root,\r\n            rootMargin: '0px',\r\n            threshold: this.#threshold\r\n        })\r\n    }\r\n\r\n    observe(target: Element): void {\r\n        if (this.#observer)\r\n            this.#observer.observe(target)\r\n    }\r\n\r\n    unobserve(target: Element): void {\r\n        if (this.#observer)\r\n            this.#observer.unobserve(target)\r\n    }\r\n\r\n    disconnect() {\r\n        if (this.#observer)\r\n            this.#observer.disconnect()\r\n    }\r\n\r\n}","import { ICuiComponent, ICuiComponentHandler } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiHandler } from \"../../core/handlers/base\";\r\nimport { CuiIntersectionObserver } from \"../../core/observers/intersection\";\r\nimport { CuiActionsListFactory, ICuiComponentAction } from \"../../core/utils/actions\";\r\nimport { is, getRangeValueOrDefault, getStringOrDefault, isStringTrue } from \"../../core/utils/functions\";\r\nimport { EVENTS, SCOPE_SELECTOR } from \"../../core/utils/statics\";\r\n\r\nconst DEFAULT_SELCTOR = \"> *\";\r\n\r\n/**\r\n * Intersection\r\n * Toggles action in/out when target is intersecting with the screen\r\n * \r\n * Set this on scrollable element\r\n * target - children selector\r\n * offset - 0...1 - tells how much target must intersecting with the screen\r\n * action - action to trigger\r\n */\r\n\r\nexport class CuiIntersectionAttributes {\r\n    target: string;\r\n    action: string;\r\n    offset: number;\r\n    isRoot: boolean;\r\n    constructor() {\r\n        this.target = \"div\";\r\n        this.action = \"\";\r\n        this.offset = 0;\r\n        this.isRoot = false;\r\n    }\r\n\r\n    parse(args: any) {\r\n        this.target = is(args.target) ? SCOPE_SELECTOR + args.target : SCOPE_SELECTOR + DEFAULT_SELCTOR;\r\n        this.action = getStringOrDefault(args.action, \"\");\r\n        this.offset = getRangeValueOrDefault(parseFloat(args.offset), 0, 1, 0);\r\n        this.isRoot = isStringTrue(args.isRoot);\r\n    }\r\n}\r\n\r\nexport class CuiIntersectionComponent implements ICuiComponent {\r\n    attribute: string;\r\n    constructor(prefix?: string) {\r\n        this.attribute = `${prefix ?? 'cui'}-intersection`;\r\n    }\r\n\r\n    getStyle(): string | null {\r\n        return null;\r\n    }\r\n\r\n    get(element: HTMLElement, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiIntersectionHandler(element, utils, this.attribute);\r\n    }\r\n}\r\n\r\nexport class CuiIntersectionHandler extends CuiHandler<CuiIntersectionAttributes> {\r\n\r\n    #observer: CuiIntersectionObserver;\r\n    #targets: Element[];\r\n    #actions: ICuiComponentAction[];\r\n    constructor(element: HTMLElement, utils: CuiUtils, attribute: string) {\r\n        super(\"CuiIntersectionHandler\", element, attribute, new CuiIntersectionAttributes(), utils);\r\n        this.#observer = new CuiIntersectionObserver(this.element);\r\n        this.#targets = [];\r\n        this.#actions = [];\r\n    }\r\n\r\n    onInit(): void {\r\n        this.parseArguments();\r\n        this.#observer.setCallback(this.onIntersection.bind(this))\r\n        this.#observer.connect();\r\n        this.#targets.forEach(target => {\r\n            this.#observer.observe(target);\r\n        })\r\n    }\r\n\r\n    onUpdate(): void {\r\n        this.parseArguments();\r\n    }\r\n\r\n    onDestroy(): void {\r\n        this.#observer.disconnect();\r\n    }\r\n\r\n    parseArguments() {\r\n        // @ts-ignore prevArgs is correct\r\n        if (!is(this.prevArgs) || (this.prevArgs.target !== this.args.target)) {\r\n            let el = this.args.isRoot ? document.body : this.element;\r\n            this.#targets = [...el.querySelectorAll(this.args.target)];\r\n        }\r\n        this.#actions = CuiActionsListFactory.get(this.args.action);\r\n    }\r\n\r\n    onIntersection(entries: IntersectionObserverEntry[], observer: IntersectionObserver): void {\r\n        if (!is(this.#targets)) {\r\n            return;\r\n        }\r\n        entries.forEach(entry => {\r\n            if (entry.isIntersecting && entry.intersectionRatio >= this.args.offset) {\r\n                this.addActions(entry.target);\r\n            } else {\r\n                this.removeActions(entry.target);\r\n            }\r\n            this.emitIntersection(entry)\r\n        })\r\n    }\r\n\r\n    emitIntersection(entry: IntersectionObserverEntry) {\r\n        this.emitEvent(EVENTS.INTERSECTION, {\r\n            entry: entry,\r\n            offset: this.args.offset,\r\n            timestamp: Date.now()\r\n        })\r\n    }\r\n\r\n    private addActions(element: Element) {\r\n        this.#actions.forEach(action => action.add(element));\r\n    }\r\n\r\n    private removeActions(element: Element) {\r\n        this.#actions.forEach(action => action.remove(element));\r\n    }\r\n}","\r\nimport { CuiInteractableArgs, CuiInteractableHandler } from \"../../core/handlers/base\";\r\nimport { AriaAttributes } from \"../../core/utils/aria\";\r\nimport { ICuiComponent, ICuiComponentHandler, ICuiParsable } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { is, isStringTrue, getStringOrDefault, getIntOrDefault, replacePrefix, getName } from \"../../core/utils/functions\";\r\nimport { EVENTS } from \"../../core/utils/statics\";\r\n\r\nconst OFFCANVAS_RIGHT_ANIM_DEFAULT_IN = \".{prefix}-offcanvas-default-right-in\";\r\nconst OFFCANVAS_RIGHT_ANIM_DEFAULT_OUT = \".{prefix}-offcanvas-default-right-out\";\r\nconst OFFCANVAS_LEFT_ANIM_DEFAULT_IN = \".{prefix}-offcanvas-default-left-in\";\r\nconst OFFCANVAS_LEFT_ANIM_DEFAULT_OUT = \".{prefix}-offcanvas-default-left-out\";\r\n\r\nconst OFFCANVAS_BODY = \"{prefix}-off-canvas-open\";\r\nconst OFFCANVAS_CONTAINER_CLS = '.{prefix}-off-canvas-container';\r\n\r\nexport class CuiOffCanvasArgs implements ICuiParsable, CuiInteractableArgs {\r\n    escClose: boolean;\r\n    outClose: boolean;\r\n    openAct: string;\r\n    closeAct: string;\r\n    keyClose: string;\r\n    position: 'left' | 'right';\r\n    timeout: number;\r\n\r\n    #prefix: string;\r\n    #defTimeout: number;\r\n    constructor(prefix: string, timeout?: number) {\r\n        this.#defTimeout = timeout ?? 300;\r\n        this.#prefix = prefix;\r\n        this.escClose = false;\r\n        this.position = 'right';\r\n        this.openAct = this.getDefaultOpenClass();\r\n        this.closeAct = this.getDefaultCloseClass();\r\n        this.timeout = this.#defTimeout;\r\n        this.outClose = false;\r\n        this.keyClose = \"\";\r\n    }\r\n\r\n\r\n    parse(args: any) {\r\n        if (is(args)) {\r\n            this.escClose = isStringTrue(args.escClose);\r\n            this.outClose = isStringTrue(args.outClose);\r\n            this.position = getStringOrDefault(args.position, 'right');\r\n            this.openAct = getStringOrDefault(args.openAct, this.getDefaultOpenClass())\r\n            this.closeAct = getStringOrDefault(args.closeAct, this.getDefaultCloseClass());\r\n            this.timeout = getIntOrDefault(args.timeout, this.#defTimeout);\r\n            this.keyClose = args.keyClose;\r\n        }\r\n    }\r\n\r\n    getDefaultOpenClass(): string {\r\n        return replacePrefix(this.position === 'right' ? OFFCANVAS_RIGHT_ANIM_DEFAULT_IN : OFFCANVAS_LEFT_ANIM_DEFAULT_IN, this.#prefix);\r\n    }\r\n\r\n    getDefaultCloseClass(): string {\r\n        return replacePrefix(this.position === 'right' ? OFFCANVAS_RIGHT_ANIM_DEFAULT_OUT : OFFCANVAS_LEFT_ANIM_DEFAULT_OUT, this.#prefix);\r\n    }\r\n}\r\n\r\nexport class CuiOffCanvasComponent implements ICuiComponent {\r\n    attribute: string;\r\n    #prefix: string;\r\n    constructor(prefix?: string) {\r\n        this.#prefix = prefix ?? 'cui';\r\n        this.attribute = `${this.#prefix}-off-canvas`;\r\n    }\r\n\r\n    getStyle(): string | null {\r\n        return null;\r\n    }\r\n\r\n    get(element: HTMLElement, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiOffCanvasHandler(element, utils, this.attribute, this.#prefix);\r\n    }\r\n}\r\n\r\nexport class CuiOffCanvasHandler extends CuiInteractableHandler<CuiOffCanvasArgs>  {\r\n\r\n    #prefix: string;\r\n    #bodyClass: string;\r\n    #scrollY: number;\r\n    #windowClickEventId: string | null;\r\n\r\n    constructor(element: HTMLElement, utils: CuiUtils, attribute: string, prefix: string) {\r\n        super(\"CuiOffCanvasHandler\", element, attribute, new CuiOffCanvasArgs(prefix, utils.setup.animationTime), utils);\r\n        this.#prefix = prefix;\r\n        this.#bodyClass = replacePrefix(OFFCANVAS_BODY, prefix);\r\n        this.#windowClickEventId = null;\r\n        this.#scrollY = 0;\r\n\r\n        if (!utils.isPlugin(\"click-plugin\")) {\r\n            this.logWarning(\"WindowClick plugin is not available, outClose will not work\")\r\n        }\r\n        if (!utils.isPlugin(\"keys-plugin\")) {\r\n            this.logWarning(\"KeyObserver plugin is not available, escClose and keyClose will not work\")\r\n        }\r\n    }\r\n\r\n    onInit(): void {\r\n        this.mutate(() => {\r\n            this.setPositionLeft();\r\n            AriaAttributes.setAria(this.element, 'aria-modal', \"\");\r\n        })\r\n    }\r\n    onUpdate(): void {\r\n        this.setPositionLeft();\r\n    }\r\n    onDestroy(): void {\r\n\r\n    }\r\n    onBeforeOpen(): boolean {\r\n        if (this.isAnyActive()) {\r\n            return false;\r\n        }\r\n        this.#scrollY = window.pageYOffset;\r\n        return true;\r\n    }\r\n\r\n    onAfterOpen(): void {\r\n        if (this.args.outClose) {\r\n            this.#windowClickEventId = this.onEvent(EVENTS.WINDOW_CLICK, this.onWindowClick.bind(this));\r\n        }\r\n        this.helper.setClass(this.#bodyClass, document.body);\r\n        document.body.style.top = `-${scrollY}px`;\r\n    }\r\n    onAfterClose(): void {\r\n        this.detachEvent(EVENTS.WINDOW_CLICK, this.#windowClickEventId);\r\n        this.helper.removeClass(this.#bodyClass, document.body);\r\n        document.body.style.top = '';\r\n        window.scrollTo(0, this.#scrollY * -1);\r\n    }\r\n    onBeforeClose(): boolean {\r\n        return true;\r\n    }\r\n\r\n    onWindowClick(ev: MouseEvent) {\r\n        const container = this.element.querySelector(replacePrefix(OFFCANVAS_CONTAINER_CLS, this.#prefix));\r\n        if (container && !container.contains((ev.target as Node))) {\r\n            this.close();\r\n        }\r\n    }\r\n\r\n    isAnyActive(): boolean {\r\n        return this.helper.hasClass(this.#bodyClass, document.body);\r\n    }\r\n\r\n    setPositionLeft() {\r\n        let cls = getName(this.#prefix, 'left');\r\n        if (this.args.position === 'left' && !this.helper.hasClass(cls, this.element)) {\r\n            this.helper.setClass(cls, this.element)\r\n        } else if (this.args.position == 'right' && this.helper.hasClass(cls, this.element)) {\r\n            this.helper.removeClass(cls, this.element)\r\n        }\r\n    }\r\n\r\n\r\n}","\r\nexport type CuiElementBoxType = Element | HTMLElement | Window;\r\n\r\nexport interface ICuiElementBox {\r\n    getHeight(): number;\r\n    getWidth(): number;\r\n    getTop(): number;\r\n    getLeft(): number;\r\n    getScrollHeight(): number;\r\n    getScrollWidth(): number;\r\n    getScrollTop(): number;\r\n    getScrollLeft(): number;\r\n    queryAll(selector: string): HTMLElement[];\r\n}\r\n\r\nexport class CuiElementBoxFactory {\r\n    static get(element: CuiElementBoxType): ICuiElementBox {\r\n        if (element instanceof Window) {\r\n            return new WindowElementBox();\r\n        } else if (element instanceof HTMLElement) {\r\n            return new HTMLElementBox(element);\r\n        }\r\n        return new ElementBox(element);\r\n    }\r\n}\r\n\r\nexport class ElementBox implements ICuiElementBox {\r\n    #box: DOMRect;\r\n    #element: Element;\r\n    constructor(element: Element) {\r\n        this.#element = element;\r\n        this.#box = element.getBoundingClientRect();\r\n    }\r\n\r\n    getHeight(): number {\r\n        return this.#box.height;\r\n    }\r\n    getWidth(): number {\r\n        return this.#box.width;\r\n    }\r\n    getTop(): number {\r\n        return this.#box.top;\r\n    }\r\n    getLeft(): number {\r\n        return this.#box.left;\r\n    }\r\n    getScrollHeight(): number {\r\n        return this.#element.scrollHeight;\r\n    }\r\n\r\n    getScrollWidth(): number {\r\n        return this.#element.scrollWidth;\r\n    }\r\n\r\n    getScrollTop(): number {\r\n        return this.#element.scrollTop;\r\n    }\r\n\r\n    getScrollLeft(): number {\r\n        return this.#element.scrollLeft;\r\n    }\r\n\r\n    queryAll(selector: string): HTMLElement[] {\r\n        return [...this.#element.querySelectorAll<HTMLElement>(selector)];\r\n    }\r\n}\r\n\r\nexport class HTMLElementBox implements ICuiElementBox {\r\n    #element: HTMLElement;\r\n    constructor(element: HTMLElement) {\r\n        this.#element = element;\r\n    }\r\n\r\n    getHeight(): number {\r\n        return this.#element.offsetHeight;\r\n    }\r\n    getWidth(): number {\r\n        return this.#element.offsetWidth;\r\n    }\r\n    getTop(): number {\r\n        return this.#element.offsetTop;\r\n    }\r\n    getLeft(): number {\r\n        return this.#element.offsetLeft;\r\n    }\r\n\r\n    getScrollHeight(): number {\r\n        return this.#element.scrollHeight;\r\n    }\r\n\r\n    getScrollWidth(): number {\r\n        return this.#element.scrollWidth;\r\n    }\r\n\r\n    getScrollTop(): number {\r\n        return this.#element.scrollTop;\r\n    }\r\n\r\n    getScrollLeft(): number {\r\n        return this.#element.scrollLeft;\r\n    }\r\n\r\n    queryAll(selector: string): HTMLElement[] {\r\n        return [...this.#element.querySelectorAll<HTMLElement>(selector)];\r\n    }\r\n}\r\n\r\nexport class WindowElementBox implements ICuiElementBox {\r\n    getHeight(): number {\r\n        return window.innerHeight;\r\n    }\r\n    getWidth(): number {\r\n        return window.innerWidth;\r\n    }\r\n    getTop(): number {\r\n        return 0;\r\n    }\r\n    getLeft(): number {\r\n        return 0;\r\n    }\r\n\r\n    getScrollHeight(): number {\r\n        return window.innerHeight;\r\n    }\r\n\r\n    getScrollWidth(): number {\r\n        return window.innerWidth;\r\n    }\r\n\r\n    getScrollTop(): number {\r\n        return window.pageYOffset;\r\n    }\r\n    getScrollLeft(): number {\r\n        return window.pageXOffset;\r\n    }\r\n    queryAll(selector: string): HTMLElement[] {\r\n        return [...document.querySelectorAll(selector)] as any[];\r\n    }\r\n\r\n}","import { CuiElementBoxFactory, CuiElementBoxType, ICuiElementBox } from \"../models/elements\";\r\nimport { ICuiEventListener } from \"../models/interfaces\";\r\nimport { getRangeValueOrDefault, is } from \"../utils/functions\";\r\nimport { CuiTaskRunner, ICuiTask } from \"../utils/task\";\r\n\r\nconst DEFAULT_SCROLL_END_TIMEOUT: number = 50;\r\n\r\nexport interface CuiScrollEvent {\r\n    base: Event | undefined;\r\n    top: number;\r\n    left: number;\r\n    initial: boolean;\r\n    scrolling: boolean;\r\n    source: string;\r\n}\r\n\r\nexport class CuiScrollListener implements ICuiEventListener<CuiScrollEvent> {\r\n    #target: CuiElementBoxType;\r\n    #inProgress: boolean;\r\n    #threshold: number;\r\n    #prevX: number;\r\n    #prevY: number;\r\n    #callback: ((ev: CuiScrollEvent) => void) | undefined;\r\n    #isAttached: boolean;\r\n    #box: ICuiElementBox;\r\n    #task: ICuiTask;\r\n    #listener: (ev: Event) => void;\r\n    constructor(target: CuiElementBoxType, threshold?: number) {\r\n        this.#target = target;\r\n        this.#box = CuiElementBoxFactory.get(target);\r\n        this.#inProgress = false;\r\n        this.#threshold = getRangeValueOrDefault(threshold, 0, 100, 0);\r\n        this.#prevX = this.#prevY = 0;\r\n        this.#isAttached = false;\r\n        this.#callback = undefined;\r\n        this.#task = new CuiTaskRunner(DEFAULT_SCROLL_END_TIMEOUT, false, this.onScrollFinish.bind(this));\r\n\r\n        this.#listener = this.listener.bind(this);\r\n    }\r\n\r\n    setCallback(callback: (ev: CuiScrollEvent) => void) {\r\n        this.#callback = callback;\r\n    }\r\n\r\n    attach() {\r\n        this.#target.addEventListener('scroll', this.#listener)\r\n        this.#isAttached = true;\r\n        this.listener(undefined, true, \"init\");\r\n    }\r\n\r\n    detach() {\r\n        this.#target.removeEventListener('scroll', this.#listener)\r\n        this.#task.stop();\r\n        this.#isAttached = false;\r\n    }\r\n\r\n    setTarget(target: CuiElementBoxType) {\r\n        if (target !== this.#target) {\r\n            this.detach();\r\n            this.#target = target;\r\n            this.attach();\r\n        }\r\n    }\r\n\r\n    setThreshold(threshold: number) {\r\n        this.#threshold = getRangeValueOrDefault(threshold, 0, 100, 0);\r\n    }\r\n\r\n    isInProgress(): boolean {\r\n        return this.#inProgress;\r\n    }\r\n\r\n    isAttached(): boolean {\r\n        return this.#isAttached;\r\n    }\r\n\r\n    private listener(ev?: Event, initial?: boolean, source?: string) {\r\n        if (!is(this.#callback)) {\r\n            return;\r\n        }\r\n        let left = this.#box.getScrollLeft();\r\n        let top = this.#box.getScrollTop();\r\n        this.#prevX += left;\r\n        this.#prevY += top;\r\n        if (this.#inProgress || (!this.passedThreshold() && is(ev))) {\r\n            return;\r\n        }\r\n        this.#inProgress = true;\r\n        // @ts-ignore - callback already checked\r\n        this.#callback({\r\n            base: ev,\r\n            top: top,\r\n            left: left,\r\n            initial: initial ?? false,\r\n            scrolling: is(ev),\r\n            source: source ?? \"event\"\r\n        })\r\n        if (is(ev))\r\n            this.#task.start();\r\n        this.#inProgress = false\r\n        this.#prevX = 0;\r\n        this.#prevY = 0;\r\n    }\r\n\r\n    private passedThreshold() {\r\n        return this.#threshold <= 0 || (this.#prevX >= this.#threshold || this.#prevY >= this.#threshold);\r\n    }\r\n\r\n    private onScrollFinish() {\r\n        this.listener(undefined, false, \"task\");\r\n    }\r\n}","export interface ICuiOffsetMode {\r\n    matches(top: number, left: number, offsetX: number, offsetY: number): boolean;\r\n}\r\n\r\nexport class CuiOffsetStaticMode implements ICuiOffsetMode {\r\n\r\n    matches(top: number, left: number, offsetX: number, offsetY: number): boolean {\r\n        return (offsetX > 0 && left >= offsetX) ||\r\n            (offsetY > 0 && top >= offsetY)\r\n    }\r\n\r\n}\r\n\r\n/**\r\n * Dynamically calculates whether to trigger or untrigger an action.\r\n * If current value exceedes offset and threshold action is triggered.\r\n * If action was triggered and current move is lower than threshold action is untriggered\r\n * \r\n * Example: If offsetY is 100, then first after 100 action is set on. It is kept when scrolling down.\r\n * If user decides to scroll up and difference between turning point and current is bigger than threshold then action is set off.\r\n *  \r\n * Example usage is with navbar - it shall disappear after offset and return back when user scrolls up. \r\n */\r\nexport class CuiOffsetDynamicMode implements ICuiOffsetMode {\r\n    #pointLeft: number;\r\n    #pointTop: number;\r\n    #prevDiffY: number;\r\n    #prevDiffX: number;\r\n    #wasTriggeredX: boolean;\r\n    #wasTriggeredY: boolean;\r\n    #threshold: number;\r\n    constructor() {\r\n        this.#pointLeft = 0;\r\n        this.#pointTop = 0;\r\n        this.#prevDiffX = 0;\r\n        this.#prevDiffY = 0;\r\n        this.#threshold = 100;\r\n        this.#wasTriggeredX = false;\r\n        this.#wasTriggeredY = false;\r\n    }\r\n    matches(top: number, left: number, offsetX: number, offsetY: number): boolean {\r\n        return this.fitsOffsetY(top, offsetY) || this.fitsOffsetX(left, offsetX);\r\n    }\r\n\r\n\r\n    private fitsOffsetX(left: number, offsetX: number) {\r\n        if (offsetX <= 0)\r\n            return false;\r\n        let diffX = left - this.#pointLeft;\r\n        if (left >= offsetX && diffX > this.#threshold) {\r\n            this.#wasTriggeredX = true;\r\n        } else if (this.#wasTriggeredX && diffX < -this.#threshold) {\r\n            this.#wasTriggeredX = false;\r\n        }\r\n        if (diffX < 0 && this.#prevDiffX < diffX || diffX >= 0 && this.#prevDiffX > diffX) {\r\n            this.#pointLeft = left;\r\n        }\r\n        this.#prevDiffX = diffX;\r\n        return this.#wasTriggeredX;\r\n    }\r\n\r\n    private fitsOffsetY(top: number, offsetY: number) {\r\n        if (offsetY <= 0) {\r\n            return false;\r\n        }\r\n        let diffY = top - this.#pointTop;\r\n        if (top >= offsetY && diffY > this.#threshold) {\r\n            this.#wasTriggeredY = true;\r\n        } else if (this.#wasTriggeredY && diffY < -this.#threshold) {\r\n            this.#wasTriggeredY = false;\r\n        }\r\n        if (diffY < 0 && this.#prevDiffY < diffY || diffY >= 0 && this.#prevDiffY > diffY) {\r\n            this.#pointTop = top;\r\n        }\r\n        this.#prevDiffY = diffY;\r\n        return this.#wasTriggeredY;\r\n    }\r\n}\r\n\r\n\r\nexport class CuiOffsetModeFactory {\r\n    static get(mode: string) {\r\n        if (mode === 'dynamic') {\r\n            return new CuiOffsetDynamicMode();\r\n        }\r\n        return new CuiOffsetStaticMode();\r\n    }\r\n}","import { ICuiComponent, ICuiComponentHandler } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiHandler } from \"../../core/handlers/base\";\r\nimport { CuiScrollListener, CuiScrollEvent } from \"../../core/listeners/scroll\";\r\nimport { ICuiComponentAction, CuiActionsListFactory } from \"../../core/utils/actions\";\r\nimport { are, getIntOrDefault, getRangeValue, getStringOrDefault, is, isStringTrue } from \"../../core/utils/functions\";\r\nimport { CuiOffsetModeFactory, ICuiOffsetMode } from \"./modes\";\r\nimport { EVENTS } from \"../../core/utils/statics\";\r\n\r\n/**\r\n * Toggles an action after specified offset is reached in relation to the element or document\r\n * \r\n * target?: string - target which action shall be triggered on\r\n * action?: string - action to trigger\r\n * offsetY?: number - vertical offset\r\n * offsetX?: number - horizontal offset\r\n * root?: boolean - set true if scroll listener shall be set on document element\r\n * mode?: string - static/dynamic \r\n */\r\n\r\nexport interface CuiOffsetEvent {\r\n    matches: boolean;\r\n    offsetX: number;\r\n    offsetY: number;\r\n    ratioY: number;\r\n    ratioX: number;\r\n    scrolling: boolean;\r\n\r\n    timestamp: number;\r\n}\r\n\r\nexport interface CuiOffsetAttribute {\r\n    target?: string;\r\n    action?: string;\r\n    offsetY?: number;\r\n    offsetX?: number;\r\n    root?: boolean;\r\n}\r\n\r\nexport class CuiOffsetArgs {\r\n    target: string;\r\n    action: string;\r\n    offsetY: number;\r\n    offsetX: number\r\n    root: boolean;\r\n    mode: \"static\" | \"dynamic\";\r\n    constructor() {\r\n        this.offsetX = 0;\r\n        this.offsetY = 0;\r\n        this.target = \"\";\r\n        this.root = false;\r\n        this.action = \"\";\r\n        this.mode = 'static';\r\n    }\r\n\r\n    parse(args: any) {\r\n        this.target = args.target;\r\n        this.action = args.action;\r\n        this.offsetX = getIntOrDefault(args.offsetX, -1);\r\n        this.offsetY = getIntOrDefault(args.offsetY, -1);\r\n        this.root = isStringTrue(args.root);\r\n        this.mode = getStringOrDefault(args.mode, 'static');\r\n    }\r\n}\r\nexport class CuiOffsetComponent implements ICuiComponent {\r\n    attribute: string;\r\n    constructor(prefix?: string) {\r\n        this.attribute = `${prefix ?? 'cui'}-offset`;\r\n    }\r\n\r\n    getStyle(): string | null {\r\n        return null;\r\n    }\r\n\r\n    get(element: HTMLElement, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiOffsetHandler(element, utils, this.attribute);\r\n    }\r\n}\r\n\r\nexport class CuiOffsetHandler extends CuiHandler<CuiOffsetArgs> {\r\n    #listener: CuiScrollListener | undefined;\r\n    #target: Element;\r\n    #utils: CuiUtils;\r\n    #matched: boolean;\r\n    #action: ICuiComponentAction[];\r\n    #prevX: number;\r\n    #prevY: number;\r\n    #threshold: number;\r\n    #root: Element;\r\n    #modeHandler: ICuiOffsetMode | null;\r\n    constructor(element: HTMLElement, utils: CuiUtils, attribute: string) {\r\n        super(\"CuiOffsetHandler\", element, attribute, new CuiOffsetArgs(), utils);\r\n        this.element = element as HTMLElement;\r\n\r\n        this.#target = this.element;\r\n        this.#utils = utils;\r\n        this.#matched = false;\r\n        this.#action = [];\r\n        this.#prevX = 0;\r\n        this.#prevY = 0;\r\n        this.#threshold = 20;\r\n        this.#root = this.element;\r\n        this.#modeHandler = null;\r\n        this.#listener = undefined;\r\n\r\n    }\r\n\r\n    onInit(): void {\r\n        this.parseAttribute();\r\n        this.#listener = new CuiScrollListener(this.args.root ? (window as any) : this.element, this.utils.setup.scrollThreshold);\r\n        this.#listener.setCallback(this.onScroll.bind(this));\r\n        this.#listener.attach();\r\n    }\r\n    onUpdate(): void {\r\n        this.parseAttribute();\r\n    }\r\n    onDestroy(): void {\r\n        if (this.#listener)\r\n            this.#listener.detach();\r\n    }\r\n\r\n    private onScroll(ev: CuiScrollEvent): void {\r\n        this.checkAndPerformActions(ev);\r\n    }\r\n\r\n    private parseAttribute() {\r\n        this.#root = this.getRoot();\r\n        this.#target = this.getTarget();\r\n        this.#action = CuiActionsListFactory.get(this.args.action);\r\n        this.#modeHandler = CuiOffsetModeFactory.get(this.args.mode);\r\n\r\n    }\r\n\r\n    private checkAndPerformActions(ev: CuiScrollEvent) {\r\n        if (!is(this.#modeHandler)) {\r\n            this.logError(\"Cannot perform - mode handler not initialized\", \"checkAndPerformActions\")\r\n        }\r\n        // @ts-ignore modehandler\r\n        let matchesOffset = this.#modeHandler.matches(ev.top, ev.left, this.args.offsetX, this.args.offsetY);\r\n        /**\r\n         * Act and emit event when offset has been reached\r\n         */\r\n        if (matchesOffset !== this.#matched) {\r\n            this.act(matchesOffset);\r\n            this.#matched = matchesOffset;\r\n            this.callEvent(this.#matched, ev.left, ev.top, ev.scrolling, ev.source, ...this.calcaRatio(ev.left, ev.top));\r\n            return;\r\n        }\r\n        /**\r\n         * Emit event periodically\r\n         */\r\n        if (this.exceededThreshold(ev.left, ev.top)) {\r\n            this.callEvent(this.#matched, ev.left, ev.top, ev.scrolling, ev.source, ...this.calcaRatio(ev.left, ev.top));\r\n            this.#prevX = ev.left;\r\n            this.#prevY = ev.top;\r\n        }\r\n    }\r\n\r\n\r\n    private act(matching: boolean) {\r\n        if (!are(this.#action, this.#target)) {\r\n            return;\r\n        }\r\n        this.isLocked = true;\r\n        this.#action.forEach(action => {\r\n            if (matching) {\r\n                action.add(this.#target, this.#utils)\r\n            } else {\r\n                action.remove(this.#target, this.#utils)\r\n            }\r\n        });\r\n        this.isLocked = false;\r\n    }\r\n\r\n    private callEvent(matches: boolean, x: number, y: number, scrolling: boolean, source: string, ratioX: number, ratioY: number) {\r\n        this.emitEvent(EVENTS.OFFSET, {\r\n            matches: this.#matched,\r\n            offsetX: x,\r\n            offsetY: y,\r\n            ratioX: ratioX,\r\n            ratioY: ratioY,\r\n            scrolling: scrolling,\r\n            source: source,\r\n            timestamp: Date.now()\r\n        })\r\n    }\r\n\r\n    private getRoot(): Element {\r\n        return this.args.root ? document.body : this.element;\r\n    }\r\n\r\n    private exceededThreshold(x: number, y: number): boolean {\r\n        return Math.abs(x - this.#prevX) > this.#threshold || Math.abs(y - this.#prevY) > this.#threshold;\r\n    }\r\n\r\n    private calcaRatio(x: number, y: number): [number, number] {\r\n        let ratY = parseFloat(((this.#root.clientHeight + y) / this.#root.scrollHeight).toFixed(2))\r\n        let ratX = parseFloat(((this.#root.clientWidth + x) / this.#root.scrollWidth).toFixed(2))\r\n        return [getRangeValue(ratX, 0, 1), getRangeValue(ratY, 0, 1)];\r\n    }\r\n\r\n    private getTarget(): Element {\r\n        let target = this.args.target ? this.#root.querySelector(this.args.target) : null;\r\n        return target ?? this.element;\r\n    }\r\n}","import { ICuiComponent, ICuiComponentHandler, ICuiOpenable } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiHandler } from \"../../core/handlers/base\";\r\nimport { getStringOrDefault, getIntOrDefault, is, isString, isStringTrue, are, getFirstMatching } from \"../../core/utils/functions\";\r\nimport { CuiActionsListFactory } from \"../../core/utils/actions\";\r\nimport { CUID_ATTRIBUTE, EVENTS } from \"../../core/utils/statics\";\r\n\r\nexport class CuiOpenArgs {\r\n    target: string;\r\n    action: string;\r\n    timeout: number;\r\n    prevent: boolean;\r\n    state: string;\r\n\r\n    #defTimeout: number;\r\n    constructor(timeout?: number) {\r\n        this.#defTimeout = timeout ?? 300;\r\n        this.target = \"\";\r\n        this.action = \"\";\r\n        this.timeout = 0;\r\n        this.prevent = false;\r\n        this.state = \"\";\r\n\r\n    }\r\n\r\n    parse(args: any) {\r\n        if (is(args) && isString(args)) {\r\n            this.target = args;\r\n            this.action = \"\";\r\n            this.timeout = this.#defTimeout;\r\n            this.prevent = false;\r\n            this.state = \"\";\r\n            return;\r\n        }\r\n        this.target = getStringOrDefault(args.target, \"\");\r\n        this.action = args.action;\r\n        this.timeout = getIntOrDefault(args.timeout, this.#defTimeout);\r\n        this.prevent = isStringTrue(args.prevent)\r\n        this.state = args.state;\r\n    }\r\n}\r\n\r\nexport class CuiOpenComponent implements ICuiComponent {\r\n    attribute: string;\r\n    #prefix: string;\r\n    constructor(prefix?: string) {\r\n        this.#prefix = prefix ?? 'cui';\r\n        this.attribute = `${this.#prefix}-open`;\r\n    }\r\n\r\n    getStyle(): string | null {\r\n        return null;\r\n    }\r\n\r\n    get(element: HTMLElement, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiOpenHandler(element, utils, this.attribute, this.#prefix);\r\n    }\r\n}\r\n\r\nexport class CuiOpenHandler extends CuiHandler<CuiOpenArgs> {\r\n    #eventId: string | null;\r\n    constructor(element: HTMLElement, utils: CuiUtils, attribute: string, prefix: string) {\r\n        super(\"CuiOpenHandler\", element, attribute, new CuiOpenArgs(utils.setup.animationTime), utils);\r\n        this.#eventId = null;\r\n        this.onClick = this.onClick.bind(this);\r\n    }\r\n\r\n    onInit(): void {\r\n        this.element.addEventListener('click', this.onClick)\r\n        this.#eventId = this.onEvent(EVENTS.OPEN, this.onOpen.bind(this));\r\n    }\r\n\r\n    onUpdate(): void {\r\n        //\r\n    }\r\n\r\n    onDestroy(): void {\r\n        this.element.removeEventListener('click', this.onClick)\r\n        this.detachEvent(EVENTS.OPEN, this.#eventId);\r\n    }\r\n\r\n    onClick(ev: MouseEvent) {\r\n        this.onOpen(ev);\r\n        if (this.args.prevent) {\r\n            ev.preventDefault();\r\n        }\r\n    }\r\n\r\n    onOpen(ev: MouseEvent) {\r\n        if (this.isLocked) {\r\n            return;\r\n        }\r\n        const target = this.getTarget(this.args.target);\r\n        if (!is(target)) {\r\n            this._log.warning(`Target ${this.args.target} not found`, 'onClick')\r\n            return;\r\n        }\r\n        this.isLocked = true;\r\n        //@ts-ignore - target checked\r\n        this.run(target).then((result) => {\r\n            //@ts-ignore - target checked\r\n            this.activateTarget(ev, target, result);\r\n        }).catch((e) => {\r\n            this._log.exception(e);\r\n        }).finally(() => {\r\n            this.isLocked = false;\r\n        })\r\n    }\r\n    /**\r\n     * Emits open event or performs an opening action\r\n     * @param target target element\r\n     * @returns whether event opened shall be emitted\r\n     */\r\n    private async run(target: Element): Promise<boolean> {\r\n        let cuiId = (target as any).$cuid;\r\n        if (is(cuiId)) {\r\n            this._log.debug(\"Open cUI component\")\r\n            await this.utils.bus.emit(EVENTS.OPEN, cuiId, this.args.state);\r\n            return false;\r\n        } else {\r\n            this._log.debug(\"Open html component\")\r\n            if (are(this.args.timeout, this.args.action)) {\r\n                this._log.debug(\"Perfrom an action\")\r\n                let actions = CuiActionsListFactory.get(this.args.action)\r\n                await this.actionsHelper.performActions(target, actions, this.args.timeout, () => {\r\n                    this.setActiveClass(target)\r\n                });\r\n                return true;\r\n            }\r\n            this.setActiveClassAsync(target);\r\n            return true;\r\n        }\r\n    }\r\n\r\n    private setActiveClass(target: Element) {\r\n        if (is(target) && !this.helper.hasClass(this.activeClassName, target)) {\r\n            this.helper.setClass(this.activeClassName, target);\r\n        }\r\n    }\r\n\r\n    private setActiveClassAsync(target: Element) {\r\n        this.fetch(() => {\r\n            if (is(target) && !this.helper.hasClass(this.activeClassName, target)) {\r\n                this.helper.setClassesAs(target, this.activeClassName);\r\n            }\r\n        })\r\n\r\n    }\r\n\r\n    private activateTarget(ev: MouseEvent, target: Element, shouldEmit: boolean): void {\r\n        if (is(target) && !this.helper.hasClass(this.activeClassName, target)) {\r\n            this.helper.setClassesAs(target, this.activeClassName);\r\n        }\r\n        if (shouldEmit)\r\n            this.emitOpen(ev);\r\n    }\r\n\r\n    private emitOpen(ev: MouseEvent) {\r\n        this.emitEvent(EVENTS.OPENED, {\r\n            event: ev,\r\n            state: this.args.state,\r\n            timestamp: Date.now()\r\n        })\r\n    }\r\n\r\n    private getTarget(target: string) {\r\n        if (is(target)) {\r\n            //@ts-ignore - target checked\r\n            return document.querySelector(target);\r\n        }\r\n        let parent = this.element.parentElement;\r\n        //@ts-ignore - parent checked\r\n        let result = is(parent) ? parent.querySelectorAll(`[${CUID_ATTRIBUTE}]`) : undefined;\r\n        if (!result || result.length < 2) {\r\n            return undefined;\r\n        }\r\n\r\n        return getFirstMatching([...result], (el: Element) => {\r\n            return el !== this.element;\r\n        })\r\n    }\r\n}","import { ICuiComponent, ICuiComponentHandler, ICuiParsable } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiHandler } from \"../../core/handlers/base\";\r\nimport { EVENTS } from \"../../core/utils/statics\";\r\nimport { calcWindowSize2, getIntOrDefault, getStringOrDefault, is } from \"../../core/utils/functions\";\r\nimport { CuiIntersectionObserver } from \"../../core/observers/intersection\";\r\nimport { CuiWindowSize } from \"../../core/utils/types\";\r\nimport { CuiActionsFatory, ICuiComponentAction } from \"../../core/utils/actions\";\r\nimport { CuiResizeData } from \"src/plugins/resize/observer\";\r\n\r\ntype CuiResizeComponentMode = \"smart\" | \"simple\";\r\nexport class CuiResizeArgs implements ICuiParsable {\r\n    mode: CuiResizeComponentMode;\r\n    default: string;\r\n    small?: string;\r\n    medium?: string;\r\n    large?: string;\r\n    xlarge?: string;\r\n    delay: number;\r\n    constructor() {\r\n        this.mode = \"simple\";\r\n        this.default = \"\";\r\n        this.small = this.medium = this.large = this.xlarge = undefined;\r\n        this.delay = 0;\r\n    }\r\n\r\n    parse(args: any) {\r\n        this.default = getStringOrDefault(args.default, \"\");\r\n        this.small = args.small ?? args.s;\r\n        this.medium = args.medium ?? args.m;\r\n        this.large = args.large ?? args.l;\r\n        this.xlarge = args.xlarge ?? args.xl;\r\n        this.mode = args.mode === 'smart' ? \"smart\" : \"simple\";\r\n        this.delay = getIntOrDefault(args.delay, 0);\r\n    }\r\n}\r\n\r\nexport class CuiResizeComponent implements ICuiComponent {\r\n    attribute: string;\r\n    #prefix: string;\r\n\r\n    constructor(prefix?: string) {\r\n        this.#prefix = prefix ?? 'cui';\r\n        this.attribute = `${this.#prefix}-resize`;\r\n    }\r\n\r\n    getStyle(): string | null {\r\n        return null;\r\n    }\r\n\r\n    get(element: HTMLElement, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiResizeHandler(element, utils, this.attribute);\r\n    }\r\n}\r\n\r\nexport class CuiResizeHandler extends CuiHandler<CuiResizeArgs> {\r\n    #eventId: string | null;\r\n    #intersectionObserver: CuiIntersectionObserver;\r\n    #currentSize: CuiWindowSize;\r\n    #currentValue: string | undefined;\r\n    #lastValue: string;\r\n    #currentAction: ICuiComponentAction | undefined;\r\n    #isIntersecting: boolean;\r\n    #timeoutToken: any | undefined;\r\n    constructor(element: HTMLElement, utils: CuiUtils, attribute: string) {\r\n        super(\"CuiResizeHandler\", element, attribute, new CuiResizeArgs(), utils);\r\n        this.#eventId = null;\r\n        this.#intersectionObserver = new CuiIntersectionObserver(document.documentElement, [0, 0.1])\r\n        this.#intersectionObserver.setCallback(this.onIntersection.bind(this));\r\n        this.#lastValue = \"\";\r\n        this.#currentValue = \"\";\r\n        this.#currentSize = \"none\";\r\n        this.#isIntersecting = false;\r\n        this.#timeoutToken = undefined;\r\n        this.#currentAction = undefined;\r\n    }\r\n\r\n    onInit(): void {\r\n        this.#eventId = this.utils.bus.on(EVENTS.RESIZE, this.resize.bind(this));\r\n        this.#intersectionObserver.connect();\r\n        this.#intersectionObserver.observe(this.element);\r\n        this.#currentSize = calcWindowSize2(window.innerWidth);\r\n        this.#isIntersecting = this.isInViewport(this.element);\r\n        this.setNewValue();\r\n        this.updateElement();\r\n    }\r\n\r\n    onUpdate(): void {\r\n        this.setNewValue();\r\n        this.updateElement();\r\n    }\r\n\r\n    onDestroy(): void {\r\n        if (this.#eventId !== null) {\r\n            this.utils.bus.detach(EVENTS.RESIZE, this.#eventId);\r\n            this.#eventId = null\r\n        }\r\n        this.#intersectionObserver.unobserve(this.element);\r\n        this.#intersectionObserver.disconnect();\r\n    }\r\n\r\n    private resize(data: CuiResizeData) {\r\n        this.#currentSize = data.current;\r\n        this.setNewValue();\r\n        this.updateElement();\r\n    }\r\n\r\n    private onIntersection(entries: IntersectionObserverEntry[]) {\r\n        if (entries.length > 0) {\r\n            this.#isIntersecting = entries[0].isIntersecting;\r\n        }\r\n        this.updateElement();\r\n    }\r\n\r\n    private setNewValue() {\r\n        let newValue = this.isSmartMode() ? this.getSmartValue(this.#currentSize) : this.getValue(this.#currentSize, true);\r\n        if (newValue && newValue !== this.#currentValue) {\r\n            this.#currentValue = newValue;\r\n        }\r\n    }\r\n\r\n    private getValue(size: CuiWindowSize, replace?: boolean): string | undefined {\r\n        let value = undefined;\r\n        switch (size) {\r\n            case \"xlarge\":\r\n                value = this.args.xlarge;\r\n                break;\r\n            case \"large\":\r\n                value = this.args.large;\r\n                break;\r\n            case \"medium\":\r\n                value = this.args.medium;\r\n                break;\r\n            case \"small\":\r\n                value = this.args.small;\r\n                break;\r\n            default:\r\n                value = this.args.default;\r\n        }\r\n        return (replace && !value) ? this.args.default : value;\r\n    }\r\n\r\n    private getSmartValue(size: CuiWindowSize) {\r\n        let value = this.args.default;\r\n        if (size === 'none') {\r\n            return value;\r\n        }\r\n        value = this.args.small ?? value;\r\n        if (size === 'small') {\r\n            return value;\r\n        }\r\n        value = this.args.medium ?? value;\r\n        if (size === 'medium') {\r\n            return value;\r\n        }\r\n        value = this.args.large ?? value;\r\n        if (size === 'large') {\r\n            return value;\r\n        }\r\n        return this.args.xlarge ?? value;\r\n    }\r\n\r\n    private updateElement() {\r\n        if (!this.#isIntersecting && this.isSmartMode()) {\r\n            this.logInfo(\"Not intersecting\")\r\n            return;\r\n        }\r\n        if (!is(this.#currentValue)) {\r\n            this.logWarning(\"Not eligible to set value: \" + this.#currentValue)\r\n            return;\r\n        }\r\n        if (this.#lastValue !== this.#currentValue) {\r\n            this.run(() => {\r\n                //@ts-ignore already checked\r\n                let newAction = CuiActionsFatory.get(this.#currentValue);\r\n                this.mutate(() => {\r\n                    if (this.#currentAction) {\r\n                        this.#currentAction.remove(this.element);\r\n                    }\r\n                    newAction.add(this.element);\r\n                    //@ts-ignore already checked\r\n                    this.#lastValue = this.#currentValue;\r\n                    this.#currentAction = newAction;\r\n\r\n                })\r\n            })\r\n\r\n        }\r\n    }\r\n\r\n    private isSmartMode() {\r\n        return this.args.mode === 'smart';\r\n    }\r\n\r\n    private isInViewport(element: Element): boolean {\r\n        const rect = element.getBoundingClientRect();\r\n        return (\r\n            rect.top >= 0 &&\r\n            rect.left >= 0 &&\r\n            rect.bottom <= (window.innerHeight || document.documentElement.clientHeight) &&\r\n            rect.right <= (window.innerWidth || document.documentElement.clientWidth)\r\n        );\r\n    }\r\n\r\n    private run(callback: () => void) {\r\n        if (this.#timeoutToken) {\r\n            clearTimeout(this.#timeoutToken);\r\n            this.#timeoutToken = undefined;\r\n        }\r\n        this.#timeoutToken = setTimeout(() => {\r\n            callback();\r\n            this.#timeoutToken = undefined;\r\n        }, this.args.delay);\r\n    }\r\n}","import { ICuiComponent, ICuiComponentHandler, ICuiParsable } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiHandler } from \"../../core/handlers/base\";\r\nimport { EVENTS } from \"../../core/utils/statics\";\r\nimport { is, getOffsetTop, getStringOrDefault, are } from \"../../core/utils/functions\";\r\n\r\n/**\r\n * Component scrolls to specified target in the document\r\n * Arguments: \r\n * target - selector to target element where page should be scrolled to.\r\n * parent - set parent selector if parent should be different than html parent\r\n * behavior - auto/smooth - choose between step and smooth scrolling\r\n * \r\n */\r\n\r\nexport class CuiScrollComponent implements ICuiComponent {\r\n    attribute: string;\r\n    constructor(prefix?: string) {\r\n        this.attribute = is(prefix) ? prefix + 'scroll' : 'cui-scroll';\r\n    }\r\n\r\n    getStyle(): string | null {\r\n        return null;\r\n    }\r\n\r\n    get(element: HTMLElement, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiScrollHandler(element, utils, this.attribute);\r\n    }\r\n}\r\n\r\nexport interface CuiScrollAttribute {\r\n    target?: string;\r\n    parent?: string;\r\n    behavior?: 'auto' | 'smooth';\r\n}\r\n\r\nexport class CuiScrollArgs implements ICuiParsable {\r\n    target: string;\r\n    parent: string;\r\n    behavior: 'auto' | 'smooth';\r\n\r\n    constructor() {\r\n        this.target = \"\";\r\n        this.parent = \"\";\r\n        this.behavior = 'auto';\r\n    }\r\n\r\n    parse(val: any): void {\r\n        this.target = getStringOrDefault(val.target, \"\");\r\n        this.parent = getStringOrDefault(val.parent, \"\");\r\n        this.behavior = is(val.behavior) && val.behavior.toLowerCase() === 'smooth' ? 'smooth' : 'auto';\r\n    }\r\n\r\n\r\n}\r\n\r\nexport class CuiScrollHandler extends CuiHandler<CuiScrollArgs> {\r\n    #parent: HTMLElement | null;\r\n    #target: HTMLElement | null;\r\n\r\n    #onClickBound: (ev: MouseEvent) => void;\r\n    constructor(element: HTMLElement, utils: CuiUtils, attribute: string) {\r\n        super(\"CuiScrollHandler\", element, attribute, new CuiScrollArgs(), utils);\r\n        this.element = element;\r\n        this.#parent = null;\r\n        this.#target = null;\r\n\r\n        this.#onClickBound = this.onClick.bind(this);\r\n    }\r\n\r\n    onInit(): void {\r\n        this.element.addEventListener('click', this.#onClickBound);\r\n        this.setTargets();\r\n    }\r\n    onUpdate(): void {\r\n        this.setTargets();\r\n    }\r\n    onDestroy(): void {\r\n        this.element.removeEventListener('click', this.#onClickBound);\r\n    }\r\n\r\n    onClick(ev: MouseEvent) {\r\n        if (!are(this.#target, this.#parent)) {\r\n            return;\r\n        }\r\n        //@ts-ignore\r\n        let to = getOffsetTop(this.#target) - this.#parent.offsetTop;\r\n        //@ts-ignore\r\n        let from = this.#parent.scrollTop;\r\n        let by = to - from;\r\n        //@ts-ignore\r\n        this.#parent.scrollBy({\r\n            top: by,\r\n            behavior: this.args.behavior\r\n        });\r\n        this.emitEvent(EVENTS.ON_SCROLL, {\r\n            to: to,\r\n            by: by,\r\n            //@ts-ignore\r\n            target: this.#target,\r\n            //@ts-ignore\r\n            parent: this.#parent,\r\n            timestamp: Date.now(),\r\n        })\r\n        ev.preventDefault();\r\n    }\r\n\r\n    private setTargets(): void {\r\n        this.#target = is(this.args.target) ? document.querySelector(this.args.target) as HTMLElement : null;\r\n        if (is(this.#target)) {\r\n            // @ts-ignore target is set\r\n            this.#parent = is(this.args.parent) ? document.querySelector(this.args.parent) : this.#target.parentElement;\r\n        }\r\n    }\r\n}\r\n\r\n","import { CuiScrollEvent, CuiScrollListener } from \"../listeners/scroll\";\r\nimport { CuiElementBoxFactory, CuiElementBoxType, ICuiElementBox } from \"../models/elements\";\r\nimport { ICuiEventListener } from \"../models/interfaces\";\r\nimport { are, getRangeValue, is } from \"../utils/functions\";\r\nimport { CuiIntersectionCallback, CuiIntersectionListenerOptions, CuiIntersectionResult } from \"./interfaces\";\r\n\r\nconst DEFAULT_OPTION_THRESHOLD: number = 0;\r\n\r\nexport class CuiIntersectionListener implements ICuiEventListener<CuiIntersectionResult> {\r\n    #scrollListener: CuiScrollListener;\r\n    #callback: CuiIntersectionCallback | undefined;\r\n    #children: HTMLElement[];\r\n    #box: ICuiElementBox;\r\n    constructor(element: CuiElementBoxType, options?: CuiIntersectionListenerOptions) {\r\n        this.#box = CuiElementBoxFactory.get(element);\r\n        this.#scrollListener = new CuiScrollListener(element as Element, options?.threshold ?? DEFAULT_OPTION_THRESHOLD);\r\n        this.#scrollListener.setCallback(this.onScroll.bind(this));\r\n        this.#children = [];\r\n        this.#callback = undefined;\r\n    }\r\n\r\n    /**\r\n     * Sets child elements - ratio is calcutalated based on them\r\n     * @param children \r\n     */\r\n    setChildren(children: HTMLElement[]) {\r\n        this.#children = children;\r\n    }\r\n\r\n    setThreshold(threshold: number) {\r\n        this.#scrollListener.setThreshold(threshold)\r\n    }\r\n\r\n    setCallback(callback: (t: CuiIntersectionResult) => void): void {\r\n        this.#callback = callback;\r\n    }\r\n\r\n    setParent(target: CuiElementBoxType) {\r\n        this.#box = CuiElementBoxFactory.get(target);\r\n        this.#scrollListener.setTarget(target);\r\n    }\r\n\r\n    isInProgress(): boolean {\r\n        return this.#scrollListener.isInProgress();\r\n    }\r\n\r\n    attach(): void {\r\n        if (this.isAttached()) {\r\n            return;\r\n        }\r\n        this.#scrollListener.attach();\r\n    }\r\n\r\n    detach(): void {\r\n        if (!this.isAttached()) {\r\n            return;\r\n        }\r\n        this.#scrollListener.detach();\r\n    }\r\n\r\n    isAttached(): boolean {\r\n        return this.#scrollListener && this.#scrollListener.isAttached();\r\n    }\r\n\r\n    private onScroll(ev: CuiScrollEvent): void {\r\n        if (!are(this.#children, this.#callback)) {\r\n            return;\r\n        }\r\n        if (this.#callback)\r\n            this.#callback(this.prepareCallbackResult(ev))\r\n    }\r\n\r\n    private calcChildVerticalRatio(child: HTMLElement, currentTop: number, currentBottom: number): number {\r\n        let childBottom = child.offsetTop + child.offsetHeight;\r\n        // Simulated top if view top is outside of parent then takes parent top\r\n        let symTop = currentTop > child.offsetTop ? currentTop : child.offsetTop;\r\n        // Simulated bottom if view bottom is outside of parent then takes parent bottom\r\n        let symBottom = currentBottom < childBottom ? currentBottom : childBottom;\r\n        // Calculates amount of pixels that are in view\r\n        let diff = symBottom - symTop;\r\n        // Calculates ratio - how much of a child is in parent view\r\n        let ratio = diff / child.offsetHeight;\r\n        return getRangeValue(ratio, 0, 1);\r\n    }\r\n\r\n    private calcChildHorizontalRatio(child: HTMLElement, currentLeft: number, currentRight: number): number {\r\n        let childRight = child.offsetLeft + child.offsetWidth;\r\n        // Simulated top if view left is outside of parent then takes parent left\r\n        let symLeft = currentLeft > child.offsetLeft ? currentLeft : child.offsetLeft;\r\n        // Simulated bottom if view right is outside of parent then takes parent right\r\n        let symRight = currentRight < childRight ? currentRight : childRight;\r\n        // Calculates amount of pixels that are in view\r\n        let diff = symRight - symLeft;\r\n        // Calculates ratio - how much of a child is in parent view\r\n        let ratio = diff / child.offsetWidth;\r\n        return getRangeValue(ratio, 0, 1);\r\n    }\r\n\r\n    private prepareCallbackResult(ev: CuiScrollEvent): CuiIntersectionResult {\r\n        let parentBottom = ev.top + this.#box.getHeight();\r\n        let parentRight = ev.left + this.#box.getWidth();\r\n        let result: CuiIntersectionResult = {\r\n            ev: ev.base,\r\n            top: ev.top,\r\n            left: ev.left,\r\n            scrolling: ev.scrolling ?? false,\r\n            initial: ev.initial ?? false,\r\n            source: ev.source,\r\n            items: this.#children.map((child: HTMLElement, index: number) => {\r\n                let verticalRatio = this.calcChildVerticalRatio(child, ev.top, parentBottom)\r\n                let horizontalRatio = this.calcChildHorizontalRatio(child, ev.left, parentRight);\r\n                return {\r\n                    verticalRatio: verticalRatio,\r\n                    horizontalRatio: horizontalRatio,\r\n                    element: child\r\n                }\r\n            })\r\n        };\r\n\r\n        return result;\r\n    }\r\n}","\r\nimport { CuiIntersectionResultItem } from \"../../core/intersection/interfaces\";\r\nimport { ICuiComponentAction } from \"../../core/utils/actions\";\r\nimport { are, is } from \"../../core/utils/functions\";\r\n\r\nexport interface CuiScrollspyUpdateResult {\r\n    intersecting?: HTMLElement[];\r\n    changed: boolean;\r\n}\r\n\r\nexport interface ICuiScrollspyModeHandler {\r\n    update(items: CuiIntersectionResultItem[], ratio: number, actions: ICuiComponentAction[], links: HTMLElement[], linksActions: ICuiComponentAction[]): CuiScrollspyUpdateResult;\r\n}\r\n\r\nexport class CuiScrollSpyModeHandlerFactory {\r\n    static get(mode: string) {\r\n        if (mode === \"multi\") {\r\n            return new CuiMultiModeHandler();\r\n        }\r\n        return new CuiSingleModeHandler();\r\n    }\r\n}\r\n\r\nabstract class CuiModeHandlerBase<T> {\r\n    previous: T;\r\n    constructor(init: T) {\r\n        this.previous = init;\r\n    }\r\n\r\n\r\n    getMatching(ratio: number, items: CuiIntersectionResultItem[]): number[] {\r\n        return items.reduce((result: number[], item: CuiIntersectionResultItem, index: number) => {\r\n            if (item.verticalRatio > ratio) {\r\n                result.push(index);\r\n            }\r\n            return result;\r\n        }, [])\r\n    }\r\n\r\n    addActions(actions: ICuiComponentAction[], ...elements: HTMLElement[]) {\r\n        this.forEachAction(actions, elements, (action, element) => {\r\n            action.add(element);\r\n        })\r\n    }\r\n\r\n    removeActions(actions: ICuiComponentAction[], ...elements: HTMLElement[]) {\r\n        this.forEachAction(actions, elements, (action, element) => {\r\n            action.remove(element);\r\n        })\r\n    }\r\n\r\n    private forEachAction(actions: ICuiComponentAction[], elements: HTMLElement[], callback: (action: ICuiComponentAction, element: HTMLElement) => void): void {\r\n        if (!are(actions, elements, callback)) {\r\n            return;\r\n        }\r\n        actions.forEach(action => {\r\n            elements.forEach(element => {\r\n                if (is(element))\r\n                    callback(action, element);\r\n            })\r\n        })\r\n    }\r\n\r\n    abstract matches(item: T): boolean;\r\n\r\n}\r\n\r\nexport class CuiSingleModeHandler extends CuiModeHandlerBase<number> implements ICuiScrollspyModeHandler {\r\n\r\n    constructor() {\r\n        super(-1);\r\n    }\r\n\r\n    update(items: CuiIntersectionResultItem[], ratio: number, actions: ICuiComponentAction[], links: HTMLElement[], linksActions: ICuiComponentAction[]): CuiScrollspyUpdateResult {\r\n        let matching = this.getMatching(ratio, items);\r\n        let len = matching.length;\r\n        let last = len > 0 ? matching[len - 1] : -1;\r\n        let result: CuiScrollspyUpdateResult = {\r\n            changed: false\r\n        }\r\n        if (!this.matches(last)) {\r\n            if (this.previous > -1)\r\n                this.removeActions(actions, items[this.previous].element);\r\n            if (last > -1) {\r\n                let lastElement = items[last].element;\r\n                result.intersecting = [lastElement]\r\n                this.addActions(actions, lastElement)\r\n            }\r\n            if (are(links, linksActions)) {\r\n                if (this.previous > -1)\r\n                    this.removeActions(linksActions, links[this.previous]);\r\n                if (last > -1)\r\n                    this.addActions(linksActions, links[last])\r\n            }\r\n            this.previous = last;\r\n            result.changed = true;\r\n            result.intersecting = []\r\n            return result;\r\n        }\r\n        return result;\r\n    }\r\n\r\n    matches(item: number): boolean {\r\n        return item === this.previous;\r\n    }\r\n}\r\n\r\nexport class CuiMultiModeHandler extends CuiModeHandlerBase<number[]> implements ICuiScrollspyModeHandler {\r\n    constructor() {\r\n        super([]);\r\n    }\r\n    update(items: CuiIntersectionResultItem[], ratio: number, actions: ICuiComponentAction[], links: HTMLElement[], linksActions: ICuiComponentAction[]): CuiScrollspyUpdateResult {\r\n        let matching = this.getMatching(ratio, items);\r\n        let result: CuiScrollspyUpdateResult = {\r\n            changed: false\r\n        }\r\n        if (!this.matches(matching)) {\r\n            let intersecting = matching.map(idx => { return items[idx].element })\r\n            this.removeActions(actions, ...this.previous.map(idx => { return items[idx].element }));\r\n            this.addActions(actions, ...intersecting)\r\n            result.intersecting = intersecting;\r\n            if (are(links, linksActions)) {\r\n                this.removeActions(linksActions, ...this.previous.map(idx => { return links[idx] }));\r\n                this.addActions(linksActions, ...matching.map(idx => { return links[idx] }))\r\n            }\r\n            this.previous = matching;\r\n            result.changed = true;\r\n            return result;\r\n        }\r\n        return result;\r\n    }\r\n\r\n    matches(item: number[]): boolean {\r\n        let len = item.length;\r\n        if (len !== this.previous.length) {\r\n            return false;\r\n        }\r\n        let i = 0;\r\n        for (i = 0; i < len; i++) {\r\n            if (!this.previous.includes(item[i])) {\r\n                return false;\r\n            }\r\n        }\r\n        return true;\r\n    }\r\n}","import { ICuiComponent, ICuiComponentHandler } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiHandler } from \"../../core/handlers/base\";\r\nimport { ICuiComponentAction, CuiActionsListFactory } from \"../../core/utils/actions\";\r\nimport { getRangeValueOrDefault, getStringOrDefault, isStringTrue, getIntOrDefault } from \"../../core/utils/functions\";\r\nimport { EVENTS, SCOPE_SELECTOR } from \"../../core/utils/statics\";\r\nimport { CuiIntersectionListener } from \"../../core/intersection/intersection\";\r\nimport { CuiIntersectionResult } from \"../../core/intersection/interfaces\";\r\nimport { CuiElementBoxFactory, CuiElementBoxType, ICuiElementBox } from \"../../core/models/elements\";\r\nimport { CuiScrollSpyModeHandlerFactory, CuiScrollspyUpdateResult, ICuiScrollspyModeHandler } from \"./mode\";\r\n\r\nconst DEFAULT_SELECTOR = \"> *\";\r\n\r\nexport interface CuiScrollspyScrollEvent {\r\n    top: number;\r\n    left: number;\r\n    scrolling: boolean;\r\n    initial: boolean;\r\n    source: string;\r\n    timestamp: number;\r\n}\r\n\r\nexport interface CuiScrollspyTargetChangeEvent {\r\n    intersecting: HTMLElement[];\r\n    timestamp: number;\r\n}\r\n\r\nexport interface CuiScrollSpyAttribute {\r\n    selector?: string;\r\n    action?: string;\r\n    link?: string;\r\n    linkAction?: string;\r\n    ratio: number;\r\n    threshold: number;\r\n}\r\n\r\n\r\nexport class CuiScrollSpyArgs {\r\n    selector: string; // Child selector\r\n    action: string; // Action to be performed on intersecting elements\r\n    link: string; // Link selector\r\n    linkAction: string; //Actions to be triggered on link\r\n    ratio: number; // Value 0..1 telling how much of a child view must be in view to be added to intersecting items\r\n    isRoot: boolean; // Attach to window or element\r\n    mode: \"single\" | \"multi\"; // Action is triggered on single (last) intersecting item or all intersecting items\r\n    threshold: number; // Threshold value (in px) for scroll listener\r\n\r\n    constructor() {\r\n        this.ratio = 0;\r\n        this.mode = \"single\";\r\n        this.threshold = -1;\r\n        this.selector = \"\";\r\n        this.action = \"\";\r\n        this.isRoot = false;\r\n        this.link = \"\";\r\n        this.linkAction = \"\";\r\n    }\r\n    parse(args: any) {\r\n        this.selector = `${SCOPE_SELECTOR}${args.selector ?? DEFAULT_SELECTOR}`;\r\n        this.action = getStringOrDefault(args.action, \"\");\r\n        this.link = getStringOrDefault(args.link, \"\");\r\n        this.linkAction = getStringOrDefault(args.linkAction, \"\");\r\n        this.ratio = getRangeValueOrDefault(parseFloat(args.ratio), 0, 1, 0);\r\n        this.isRoot = isStringTrue(args.isRoot);\r\n        this.mode = args?.mode === 'multi' ? \"multi\" : \"single\";\r\n        this.threshold = getIntOrDefault(args.threshold, -1);\r\n    }\r\n}\r\nexport class CuiScrollspyComponent implements ICuiComponent {\r\n    attribute: string;\r\n    constructor(prefix?: string) {\r\n        this.attribute = `${prefix ?? 'cui'}-scrollspy`;\r\n    }\r\n\r\n    getStyle(): string | null {\r\n        return null;\r\n    }\r\n\r\n    get(element: HTMLElement, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiScrollspyHandler(element, utils, this.attribute);\r\n    }\r\n}\r\n\r\nexport class CuiScrollspyHandler extends CuiHandler<CuiScrollSpyArgs> {\r\n    #listener: CuiIntersectionListener;\r\n    #links: HTMLElement[];\r\n    #actions: ICuiComponentAction[];\r\n    #linkActions: ICuiComponentAction[];\r\n    #root: CuiElementBoxType | undefined;\r\n    #rootBox: ICuiElementBox | undefined;\r\n    #modeHandler: ICuiScrollspyModeHandler | undefined;\r\n    constructor(element: HTMLElement, utils: CuiUtils, attribute: string) {\r\n        super(\"CuiScrollspyHandler\", element, attribute, new CuiScrollSpyArgs(), utils);\r\n        this.element = element as HTMLElement;\r\n        this.#listener = new CuiIntersectionListener(this.element, { threshold: this.utils.setup.scrollThreshold });\r\n        this.#links = [];\r\n        this.#actions = [];\r\n        this.#linkActions = [];\r\n        this.#root = undefined;\r\n        this.#rootBox = undefined;\r\n        this.#modeHandler = undefined;\r\n    }\r\n\r\n    onInit(): void {\r\n        this.parseAttribute();\r\n        this.#listener.setCallback(this.onIntersection.bind(this));\r\n        this.#listener.attach();\r\n    }\r\n\r\n    onUpdate(): void {\r\n        this.updateAttributes();\r\n    }\r\n\r\n    onDestroy(): void {\r\n        this.#listener.detach();\r\n    }\r\n\r\n    private onIntersection(ev: CuiIntersectionResult): void {\r\n        if (!this.#modeHandler) {\r\n            this.logError(\"Cannot perform - mode handler not initialized\", \"OnIntersection\")\r\n            return;\r\n        }\r\n        let timestamp = Date.now();\r\n        this.mutate(() => {\r\n            //@ts-ignore - modeHandler checked\r\n            let updateResult: CuiScrollspyUpdateResult = this.#modeHandler.update(ev.items, this.args.ratio, this.#actions, this.#links, this.#linkActions)\r\n            if (updateResult.changed) {\r\n                this.emitEvent(EVENTS.TARGET_CHANGE, {\r\n                    intersecting: updateResult.intersecting,\r\n                    timestamp: timestamp\r\n                })\r\n            }\r\n        })\r\n        this.emitEvent(EVENTS.ON_SCROLL, {\r\n            top: ev.top,\r\n            left: ev.left,\r\n            scrolling: ev.scrolling,\r\n            initial: ev.initial,\r\n            source: ev.source,\r\n            timestamp: timestamp,\r\n        })\r\n    }\r\n\r\n    private parseAttribute() {\r\n        this.#root = this.args.isRoot ? window : this.element;\r\n        this.#rootBox = CuiElementBoxFactory.get(this.#root);\r\n        let targets = this.args.selector ? this.#rootBox.queryAll(this.args.selector) : [];\r\n        this.#listener.setChildren(targets);\r\n        this.#listener.setThreshold(this.args.threshold);\r\n        this.#links = this.args.link ? [...document.querySelectorAll<HTMLElement>(this.args.link)] : [];\r\n        this.#actions = CuiActionsListFactory.get(this.args.action);\r\n        this.#linkActions = CuiActionsListFactory.get(this.args.linkAction);\r\n        this.#modeHandler = CuiScrollSpyModeHandlerFactory.get(this.args.mode);\r\n\r\n    }\r\n\r\n    private updateAttributes() {\r\n        if (this.prevArgs && this.args.isRoot !== this.prevArgs.isRoot) {\r\n            this.#root = this.args.isRoot ? window : this.element;\r\n            this.#rootBox = CuiElementBoxFactory.get(this.#root);\r\n            this.#listener.setParent(this.#root);\r\n        }\r\n        if (this.prevArgs && this.#rootBox && this.args.selector !== this.prevArgs.selector) {\r\n            let targets = this.args.selector ? this.#rootBox.queryAll(this.args.selector) : [];\r\n            this.#listener.setChildren(targets);\r\n        }\r\n        this.#listener.setThreshold(this.args.threshold);\r\n        this.#links = this.args.link ? [...document.querySelectorAll<HTMLElement>(this.args.link)] : [];\r\n        this.#actions = CuiActionsListFactory.get(this.args.action);\r\n        this.#linkActions = CuiActionsListFactory.get(this.args.linkAction);\r\n        this.#modeHandler = CuiScrollSpyModeHandlerFactory.get(this.args.mode);\r\n\r\n    }\r\n}","import { is, enumerateObject, are } from \"../utils/functions\";\r\n\r\nexport interface ElementBuilderAttribute {\r\n    [name: string]: string;\r\n}\r\nexport class ElementBuilder {\r\n    #id: string | undefined;\r\n    #classes: string[];\r\n    #attributes: ElementBuilderAttribute | undefined;\r\n    #tag: string;\r\n    #text: string | undefined;\r\n    #children: Element[];\r\n    #rawChildren: ElementBuilder[];\r\n    #callback: ((ev: any) => void) | undefined;\r\n    #evName: string | undefined;\r\n    constructor(tag: string) {\r\n        this.#tag = tag;\r\n        this.#classes = [];\r\n        this.#attributes = undefined;\r\n        this.#id = undefined;\r\n        this.#text = undefined;\r\n        this.#children = [];\r\n        this.#rawChildren = [];\r\n        this.#evName = undefined;\r\n        this.#callback = undefined;\r\n    }\r\n\r\n    setId(id: string): ElementBuilder {\r\n        this.#id = id;\r\n        return this;\r\n    }\r\n\r\n    setClasses(...classList: string[]): ElementBuilder {\r\n        this.#classes = classList;\r\n        return this;\r\n    }\r\n\r\n    setAttributes(attributes: ElementBuilderAttribute): ElementBuilder {\r\n        this.#attributes = attributes;\r\n        return this;\r\n    }\r\n\r\n    setTextContent(text: string) {\r\n        this.#text = text;\r\n        return this;\r\n    }\r\n\r\n    setChildren(...elements: Element[]) {\r\n        this.#children = [...elements];\r\n        return this;\r\n    }\r\n\r\n    setRawChildren(...elements: ElementBuilder[]) {\r\n        this.#rawChildren = [...elements];\r\n        return this;\r\n    }\r\n\r\n    onEvent(name: string, callback: (ev: any) => void) {\r\n        this.#evName = name;\r\n        this.#callback = callback;\r\n        return this;\r\n    }\r\n\r\n    build(innerHTML?: string): HTMLElement {\r\n        let element = document.createElement(this.#tag);\r\n        if (is(this.#id)) {\r\n            // @ts-ignore id is checked\r\n            element.id = this.#id;\r\n        }\r\n        if (is(this.#classes)) {\r\n            element.classList.add(...this.#classes);\r\n        }\r\n        if (is(this.#attributes)) {\r\n            // @ts-ignore attributes are checked\r\n            enumerateObject(this.#attributes, (attr: string, value: string) => {\r\n                element.setAttribute(attr, value);\r\n            })\r\n        }\r\n        if (is(innerHTML)) {\r\n            // @ts-ignore innerHTML checked already\r\n            element.innerHTML = innerHTML;\r\n        } else if (is(this.#text)) {\r\n            // @ts-ignore text checked already\r\n            element.textContent = this.#text;\r\n        }\r\n        this.#rawChildren.forEach(raw => { element.appendChild(raw.build()) });\r\n        this.#children.forEach(child => element.appendChild(child));\r\n\r\n        if (are(this.#evName, this.#callback)) {\r\n            // @ts-ignore\r\n            element.addEventListener(this.#evName, (ev) => {\r\n                // @ts-ignore\r\n                this.#callback(ev);\r\n            })\r\n        }\r\n        return element;\r\n    }\r\n}","import { is } from \"../../utils/functions\";\r\nimport { ICuiElementDetector } from \"./interfaces\";\r\n\r\nexport class CuiSimpleDragOverDetector implements ICuiElementDetector {\r\n    #elements: Element[];\r\n    #count: number;\r\n    #threshold: number;\r\n    constructor() {\r\n        this.#elements = [];\r\n        this.#count = 0;\r\n        this.#threshold = 5;\r\n    }\r\n\r\n    setElements(elements: Element[]): void {\r\n        this.#elements = elements;\r\n        this.#count = this.#elements.length;\r\n    }\r\n\r\n    setThreshold(value: number) {\r\n        this.#threshold = value\r\n    }\r\n\r\n    detect(x: Number, y: Number): [number, Element | undefined] {\r\n        if (!is(this.#elements)) {\r\n            return [-1, undefined];\r\n        }\r\n\r\n        let idx: number = -1;\r\n        let found: Element | undefined = undefined;\r\n\r\n        for (let i = 0; i < this.#count; i++) {\r\n            if (this.isInBounds(this.#elements[i], x, y)) {\r\n                if (i === 0) {\r\n                    idx = i;\r\n                    found = this.#elements[i];\r\n                    //break;\r\n                } else if (i < this.#count - 1) {\r\n                    idx = i + 1;\r\n                    found = this.#elements[i + 1];\r\n                    //break;\r\n                }\r\n                break;\r\n            }\r\n        }\r\n\r\n        return [idx, found];\r\n    }\r\n\r\n    private isInBounds(element: Element, x: Number, y: Number): boolean {\r\n        const box = element.getBoundingClientRect();\r\n        return x > box.left - this.#threshold && x < box.left + box.width + this.#threshold &&\r\n            y > box.top - this.#threshold && y < box.top + box.height + this.#threshold;\r\n    }\r\n\r\n}","import { CuiMoveEventListener, ICuiMoveEvent } from \"../../listeners/move\";\r\n\r\nexport class CuiDragHandler {\r\n    #root: Element;\r\n    #moveHandler: CuiMoveEventListener;\r\n    #onDragStart: ((data: ICuiMoveEvent) => boolean) | undefined;\r\n    #onDragOver: ((data: ICuiMoveEvent) => void) | undefined;\r\n    #onDragEnd: ((data: ICuiMoveEvent) => void) | undefined;\r\n    #timeout: number;\r\n    #isTracking: boolean;\r\n    #timeoutId: any;\r\n    constructor(root: HTMLElement) {\r\n        this.#root = root;\r\n        this.#moveHandler = new CuiMoveEventListener();\r\n        this.#timeout = 150;\r\n        this.#isTracking = false;\r\n        this.#timeoutId = undefined;\r\n        this.#moveHandler.setTarget(this.#root);\r\n        this.#moveHandler.preventDefault(false);\r\n        this.#moveHandler.setCallback(this.onMove.bind(this));\r\n\r\n        this.#onDragStart = undefined;\r\n        this.#onDragOver = undefined;\r\n        this.#onDragEnd = undefined;\r\n    }\r\n\r\n    setLongPressTimeout(timeout: number) {\r\n        this.#timeout = timeout;\r\n    }\r\n\r\n    onDragStart(callback: (data: ICuiMoveEvent) => boolean) {\r\n        this.#onDragStart = callback;\r\n    }\r\n\r\n    onDragOver(callback: (data: ICuiMoveEvent) => void) {\r\n        this.#onDragOver = callback;\r\n    }\r\n\r\n    onDragEnd(callback: (data: ICuiMoveEvent) => void) {\r\n        this.#onDragEnd = callback;\r\n    }\r\n\r\n    attach() {\r\n        this.#moveHandler.attach();\r\n    }\r\n\r\n    detach() {\r\n        this.#moveHandler.detach();\r\n    }\r\n\r\n    private onMove(data: ICuiMoveEvent) {\r\n        switch (data.type) {\r\n            case \"down\":\r\n                if (this.#isTracking) {\r\n                    return;\r\n                }\r\n\r\n                this.#timeoutId = setTimeout(() => {\r\n                    if (this.#onDragStart && this.#onDragStart(data)) {\r\n                        this.#isTracking = true;\r\n                    }\r\n                }, this.#timeout);\r\n\r\n                break;\r\n            case \"move\":\r\n                this.cancelTimeout();\r\n                if (!this.#isTracking) {\r\n                    return;\r\n                }\r\n                if (this.#onDragOver) {\r\n                    this.#onDragOver(data);\r\n                }\r\n                break;\r\n            case \"up\":\r\n                this.cancelTimeout();\r\n                if (!this.#isTracking) {\r\n                    return;\r\n                }\r\n                if (this.#onDragEnd) {\r\n                    this.#onDragEnd(data);\r\n                }\r\n                this.#isTracking = false;\r\n                break;\r\n        }\r\n    }\r\n\r\n    private cancelTimeout() {\r\n        if (this.#timeoutId) {\r\n            clearTimeout(this.#timeoutId);\r\n            this.#timeoutId = undefined;\r\n        }\r\n    }\r\n}","import { ElementBuilder } from \"../../core/builders/element\";\r\nimport { CuiHandler } from \"../../core/handlers/base\";\r\nimport { CuiSimpleDragOverDetector } from \"../../core/handlers/drag/detectors\";\r\nimport { CuiDragHandler } from \"../../core/handlers/drag/drag\";\r\nimport { ICuiElementDetector } from \"../../core/handlers/drag/interfaces\";\r\nimport { CuiSwipeAnimationEngine, PropsTypes } from \"../../core/animation/engine\";\r\nimport { AnimationProperty } from \"../../core/animation/interfaces\";\r\nimport { ICuiMoveEvent } from \"../../core/listeners/move\";\r\nimport { ICuiParsable, ICuiComponent, ICuiComponentHandler } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { getIntOrDefault, replacePrefix, is, are } from \"../../core/utils/functions\";\r\nimport { SCOPE_SELECTOR, EVENTS, CLASSES } from \"../../core/utils/statics\";\r\n\r\nconst SORTABLE_IS_MOVING = \"{prefix}-moving\";\r\nconst DEFAULT_SELECTOR = \" > *\";\r\nconst SORTABLE_PREVIEW_CLS = \"{prefix}-sortable-preview\";\r\n\r\nexport class CuiSortableArgs implements ICuiParsable {\r\n    target: string;\r\n    trigger: string;\r\n    timeout: number;\r\n    threshold: number;\r\n    constructor() {\r\n        this.target = SCOPE_SELECTOR + DEFAULT_SELECTOR;;\r\n        this.trigger = SCOPE_SELECTOR + DEFAULT_SELECTOR;\r\n        this.timeout = 150;\r\n        this.threshold = 5;\r\n    }\r\n    parse(val: any): void {\r\n        this.target = val.target ? SCOPE_SELECTOR + \" \" + val.target : SCOPE_SELECTOR + DEFAULT_SELECTOR;\r\n        this.trigger = val.trigger ? SCOPE_SELECTOR + \" \" + val.trigger : SCOPE_SELECTOR + DEFAULT_SELECTOR;\r\n        this.timeout = getIntOrDefault(val.timeout, 150);\r\n        this.threshold = getIntOrDefault(val.threshold, 5);\r\n    }\r\n\r\n\r\n}\r\n\r\nexport class CuiSortableComponent implements ICuiComponent {\r\n    attribute: string;\r\n    #prefix: string;\r\n    constructor(prefix?: string) {\r\n        this.#prefix = prefix ?? \"cui\";\r\n        this.attribute = this.#prefix + \"-sortable\";\r\n    }\r\n    getStyle(): string | null {\r\n        return null;\r\n    }\r\n    get(element: HTMLElement, sutils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiSortableHandler(element, this.attribute, sutils, this.#prefix);\r\n    }\r\n}\r\n\r\nexport class CuiSortableHandler extends CuiHandler<CuiSortableArgs> {\r\n    #dragHandler: CuiDragHandler;\r\n    #triggers: Element[];\r\n    #targets: Element[];\r\n    #currentTarget: HTMLElement | null;\r\n    #currentIdx: number;\r\n    #preview: HTMLElement | null;\r\n    #movingCls: string;\r\n    #detector: ICuiElementDetector;\r\n    #currentBefore: HTMLElement | null;\r\n    #animation: CuiSwipeAnimationEngine;\r\n\r\n    #previewCls: string;\r\n    constructor(element: HTMLElement, attribute: string, utils: CuiUtils, prefix: string) {\r\n        super(\"CuiSortableHandler\", element, attribute, new CuiSortableArgs(), utils);\r\n        this.#targets = [];\r\n        this.#triggers = [];\r\n        this.#currentIdx = -1;\r\n        this.#currentTarget = null;\r\n        this.#currentBefore = null;\r\n        this.#preview = null;\r\n\r\n        this.#dragHandler = new CuiDragHandler(element);\r\n        this.#dragHandler.onDragStart(this.onDragStart.bind(this));\r\n        this.#dragHandler.onDragOver(this.onDragOver.bind(this));\r\n        this.#dragHandler.onDragEnd(this.onDragEnd.bind(this));\r\n        this.#movingCls = replacePrefix(SORTABLE_IS_MOVING, prefix);\r\n        this.#previewCls = replacePrefix(SORTABLE_PREVIEW_CLS, prefix);\r\n        this.#detector = new CuiSimpleDragOverDetector();\r\n        this.#animation = new CuiSwipeAnimationEngine();\r\n        this.#animation.setOnFinish(() => {\r\n            let item = this.#currentTarget;\r\n            let idx = this.#currentIdx;\r\n            this.stopMovementPrep();\r\n\r\n            this.utils.bus.emit(EVENTS.MOVE_LOCK, null, false);\r\n            this.emitEvent(EVENTS.SORTED, {\r\n                item: item,\r\n                index: idx,\r\n                timestamp: new Date()\r\n            })\r\n        })\r\n    }\r\n\r\n    onInit(): void {\r\n        this.#dragHandler.attach();\r\n        this.getTargetsAndTrggers();\r\n        this.#detector.setThreshold(this.args.threshold)\r\n    }\r\n\r\n    onUpdate(): void {\r\n        if (this.prevArgs && (this.args.target !== this.prevArgs.target ||\r\n            this.args.trigger !== this.prevArgs.trigger)) {\r\n            this.getTargetsAndTrggers();\r\n        }\r\n        this.#dragHandler.setLongPressTimeout(this.args.timeout);\r\n    }\r\n\r\n    onDestroy(): void {\r\n        this.#dragHandler.detach();\r\n    }\r\n\r\n    /**\r\n     * queries targets and triggers from the element\r\n     * If exception - lists are cleared\r\n     */\r\n    private getTargetsAndTrggers() {\r\n        try {\r\n            this.#targets = [...this.element.querySelectorAll(this.args.target)];\r\n            this.#triggers = [...this.element.querySelectorAll(this.args.trigger)];\r\n            if (this.#triggers.length !== this.#targets.length) {\r\n                throw new Error(`Triggers (count ${this.#triggers.length}) and targets (count ${this.#targets.length}) selector are not correct`)\r\n            }\r\n            this.#detector.setElements(this.#targets);\r\n        } catch (e) {\r\n            this._log.error(\"Incorrect trigger or target selector\")\r\n            this._log.exception(e, \"getTargetsAndTrggers\");\r\n            this.#targets = [];\r\n            this.#triggers = [];\r\n        }\r\n    }\r\n\r\n    private onDragStart(data: ICuiMoveEvent): boolean {\r\n        this.#currentIdx = this.getPressedElementIdx(data.target as Node);\r\n        this.#currentTarget = this.#currentIdx > -1 ? this.#targets[this.#currentIdx] as HTMLElement : null;\r\n        if (!is(this.#currentTarget)) {\r\n            return false;\r\n        }\r\n        this.utils.bus.emit(EVENTS.MOVE_LOCK, null, true);\r\n        this.startMovementPrep(data);\r\n        this.emitEvent(EVENTS.SORT_START, {\r\n            item: this.#currentTarget,\r\n            index: this.#currentIdx,\r\n            timestamp: new Date()\r\n        })\r\n        return true;\r\n    }\r\n\r\n    private onDragOver(data: ICuiMoveEvent): void {\r\n        this.move(data);\r\n        data.event.preventDefault();\r\n    }\r\n\r\n    private onDragEnd(data: ICuiMoveEvent): void {\r\n        if (!is(this.#preview)) {\r\n            return;\r\n        }\r\n        //@ts-ignore preview\r\n        this.#animation.setElement(this.#preview);\r\n        this.#animation.setProps(this.getFinishAnimation());\r\n        this.#animation.finish(0, 100, false);\r\n    }\r\n\r\n    private getPressedElementIdx(target: Node) {\r\n        return this.#triggers.findIndex((trigger: Element) => {\r\n            return trigger.contains(target)\r\n        });\r\n    }\r\n\r\n    private startMovementPrep(data: ICuiMoveEvent) {\r\n        this.mutate(() => {\r\n            this.createPreview();\r\n            if (is(this.#currentTarget))\r\n                //@ts-ignore currentTarget\r\n                this.helper.setClass(this.#movingCls, this.#currentTarget);\r\n            this.helper.setClass(\"cui-locked\", this.element);\r\n            this.helper.setClass(CLASSES.swipingOn, document.body);\r\n            this.setPreviewPosition(data);\r\n            this.setCurrentPosition(data);\r\n        })\r\n    }\r\n\r\n    private stopMovementPrep() {\r\n        this.mutate(() => {\r\n            if (is(this.#currentTarget))\r\n                //@ts-ignore currentTarget\r\n                this.helper.removeClass(this.#movingCls, this.#currentTarget);\r\n            this.helper.removeClass(CLASSES.swipingOn, document.body);\r\n            this.helper.removeClass(\"cui-locked\", this.element);\r\n            this.removePreview();\r\n            this.#currentTarget = null;\r\n            this.#currentBefore = null;\r\n            this.getTargetsAndTrggers();\r\n        })\r\n    }\r\n\r\n    private move(data: ICuiMoveEvent) {\r\n        this.mutate(() => {\r\n            this.setPreviewPosition(data);\r\n            this.setCurrentPosition(data);\r\n        })\r\n    }\r\n\r\n    private createPreview() {\r\n        if (!is(this.#currentTarget)) {\r\n            this.logError(\"Cannot create preview - current target does not exist\", \"createPreview\")\r\n            return;\r\n        }\r\n\r\n        this.#preview = new ElementBuilder(\"div\").setClasses(this.#previewCls).build();\r\n        //@ts-ignore currentTarget\r\n        this.#preview.style.width = `${this.#currentTarget.offsetWidth}px`;\r\n        //@ts-ignore currentTarget\r\n        this.#preview.style.height = `${this.#currentTarget.offsetHeight}px`;\r\n        document.body.appendChild(this.#preview);\r\n    }\r\n\r\n    private removePreview() {\r\n        if (is(this.#preview)) {\r\n            //@ts-ignore currentTarget\r\n            this.#preview.remove();\r\n            this.#preview = null;\r\n        }\r\n    }\r\n\r\n    private setPreviewPosition(data: ICuiMoveEvent) {\r\n        if (!is(this.#preview)) {\r\n            return;\r\n        }\r\n        //@ts-ignore preview\r\n        this.#preview.style.top = `${data.y}px`;\r\n        //@ts-ignore preview\r\n        this.#preview.style.left = `${data.x}px`;\r\n    }\r\n\r\n    private setCurrentPosition(data: ICuiMoveEvent) {\r\n        if (!this.#currentTarget) {\r\n            return;\r\n        }\r\n        let [idx, detected] = this.#detector.detect(data.x, data.y);\r\n        if ((idx !== this.#currentIdx) && detected && this.#currentBefore !== detected) {\r\n            let el = detected;\r\n            this.insertElement(this.#currentTarget, el);\r\n            this.#currentBefore = el as HTMLElement;\r\n            this.getTargetsAndTrggers();\r\n            this.#currentIdx = idx;\r\n        }\r\n    }\r\n\r\n    private insertElement(source: Element, destination: Element) {\r\n        if (is(destination)) {\r\n            this.element.insertBefore(source, destination);\r\n        } else {\r\n            this.element.appendChild(source);\r\n        }\r\n    }\r\n\r\n    private getFinishAnimation(): AnimationProperty<PropsTypes> {\r\n        if (!are(this.#currentTarget, this.#preview)) {\r\n            return {\r\n                opacity: {\r\n                    from: 1,\r\n                    to: 0,\r\n                }\r\n            }\r\n        }\r\n        //@ts-ignore currentTarget\r\n        const box = this.#currentTarget.getBoundingClientRect();\r\n        return {\r\n            opacity: {\r\n                from: 1,\r\n                to: 0,\r\n            },\r\n            top: {\r\n                //@ts-ignore preview\r\n                from: this.#preview.offsetTop,\r\n                //@ts-ignore preview\r\n                to: box.top > 0 ? box.top : this.#preview.offsetTop,\r\n                unit: \"px\"\r\n            },\r\n            left: {\r\n                //@ts-ignore preview\r\n                from: this.#preview.offsetLeft,\r\n                //@ts-ignore preview\r\n                to: box.left > 0 ? box.left : this.#preview.offsetLeft,\r\n                unit: \"px\"\r\n            }\r\n        }\r\n    }\r\n}","import { ICuiComponent, ICuiComponentHandler, ICuiParsable } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiHandler } from \"../../core/handlers/base\";\r\nimport { EVENTS, ICONS } from \"../../core/utils/statics\";\r\nimport { is, isString, getStringOrDefault, getIntOrDefault, replacePrefix } from \"../../core/utils/functions\";\r\nimport { IconBuilder } from \"../../core/builders/icon\";\r\n\r\nexport class CuiSpinnerArgs implements ICuiParsable {\r\n    spinner: string;\r\n    scale: number;\r\n    constructor() {\r\n        this.spinner = \"circle\";\r\n        this.scale = 1;\r\n    }\r\n\r\n    parse(args: any) {\r\n        if (isString(args)) {\r\n            this.spinner = getStringOrDefault(args, \"circle\");\r\n        } else {\r\n            this.spinner = getStringOrDefault(args.spinner, \"circle\");\r\n            this.scale = getIntOrDefault(args.scale, 1);\r\n        }\r\n    }\r\n\r\n}\r\n\r\nexport class CuiSpinnerComponent implements ICuiComponent {\r\n    attribute: string;\r\n    #prefix: string;\r\n    constructor(prefix?: string) {\r\n        this.#prefix = prefix ?? 'cui';\r\n        this.attribute = `${this.#prefix}-spinner`;\r\n        ICONS['spinner_circle'] = \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 20 20\\\" width=\\\"20\\\" height=\\\"20\\\"><path d=\\\"M 7.800378,1.7908996 A 8.4986862,8.4986862 0 0 1 18.2091,7.8003784 8.4986862,8.4986862 0 0 1 12.199621,18.209101 8.4986862,8.4986862 0 0 1 1.7908995,12.199622 8.4986862,8.4986862 0 0 1 7.800378,1.7908996 Z\\\"></path></svg>\";\r\n        ICONS['spinner_circle_double'] = \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 20 20\\\" width=\\\"20\\\" height=\\\"20\\\"><path d=\\\"M 10,1.5000006 A 8.4999997,8.4999997 0 0 1 18.5,10 8.4999997,8.4999997 0 0 1 10,18.499999 8.4999997,8.4999997 0 0 1 1.5000005,10 8.4999997,8.4999997 0 0 1 10,1.5000006 Z\\\"></path><path d=\\\"M 10,3.4999997 A 6.5000002,6.5000002 0 0 1 16.5,10 6.5000002,6.5000002 0 0 1 10,16.5 6.5000002,6.5000002 0 0 1 3.5,9.9999993 6.5000002,6.5000002 0 0 1 10,3.4999997 Z\\\"></path></svg>\";\r\n    }\r\n\r\n    getStyle(): string | null {\r\n        return null;\r\n    }\r\n\r\n    get(element: HTMLElement, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiSpinnerHandler(element, utils, this.attribute, this.#prefix);\r\n    }\r\n}\r\n\r\nexport class CuiSpinnerHandler extends CuiHandler<CuiSpinnerArgs> {\r\n    #pauseEventId: string | null;\r\n    #animationPauseClass: string;\r\n    constructor(element: HTMLElement, utils: CuiUtils, attribute: string, prefix: string) {\r\n        super(\"CuiSpinnerHandler\", element, attribute, new CuiSpinnerArgs(), utils);\r\n        this.#pauseEventId = null;\r\n        this.#animationPauseClass = replacePrefix(\"{prefix}-animation-pause\", prefix);\r\n    }\r\n\r\n    onInit(): void {\r\n        this.#pauseEventId = this.onEvent(EVENTS.PAUSE, this.onPause.bind(this));\r\n        this.add()\r\n    }\r\n\r\n    onUpdate(): void {\r\n        if (this.prevArgs && this.args.spinner !== this.prevArgs.spinner) {\r\n            this.add();\r\n        }\r\n    }\r\n\r\n    onDestroy(): void {\r\n        this.removeIfAnyExisists();\r\n        this.detachEvent(EVENTS.PAUSE, this.#pauseEventId);\r\n    }\r\n\r\n    private addSpinner(iconElement: Element, name: string) {\r\n        this.element.appendChild(iconElement);\r\n        this.element.classList.add(`animation-spinner-${name}`);\r\n    }\r\n\r\n    private add() {\r\n        const svgIcon = is(this.args.spinner) ? ICONS[`spinner_${this.args.spinner}`] : null;\r\n        if (!is(svgIcon)) {\r\n            this._log.warning(\"Incorrect spinner name: \" + this.args.spinner);\r\n            return;\r\n        }\r\n        this.removeIfAnyExisists();\r\n        const iconElement = new IconBuilder(svgIcon).setScale(this.args.scale).build();\r\n        this.mutate(this.addSpinner, iconElement, this.args.spinner);\r\n    }\r\n\r\n    private removeIfAnyExisists() {\r\n        let existing = this.element.querySelector(\"svg\");\r\n        if (existing) {\r\n            existing.remove();\r\n        }\r\n    }\r\n\r\n\r\n    private onPause(flag: boolean) {\r\n        this.fetch(() => {\r\n            if (flag && !this.helper.hasClass(this.#animationPauseClass, this.element)) {\r\n                this.helper.setClassesAs(this.element, this.#animationPauseClass);\r\n            } else {\r\n                this.helper.removeClassesAs(this.element, this.#animationPauseClass);\r\n            }\r\n        })\r\n        this.emitEvent(EVENTS.PAUSED, flag);\r\n    }\r\n\r\n\r\n}","import { ICuiComponent, ICuiComponentHandler, ICuiParsable, ICuiSwitchable } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiChildMutation, CuiMutableHandler } from \"../../core/handlers/base\";\r\nimport { ICuiTask, CuiTaskRunner } from \"../../core/utils/task\";\r\nimport { ICuiMoveEvent } from \"../../core/listeners/move\";\r\nimport { CuiSwipeAnimationEngine } from \"../../core/animation/engine\";\r\nimport { AnimationDefinition, SWIPE_ANIMATIONS_DEFINITIONS } from \"../../core/animation/definitions\";\r\nimport { getStringOrDefault, getIntOrDefault, boolStringOrDefault, calculateNextIndex, is, getChildrenHeight, isInRange } from \"../../core/utils/functions\";\r\nimport { SCOPE_SELECTOR, EVENTS, CLASSES } from \"../../core/utils/statics\";\r\n\r\n/**\r\n * \r\n *   targets: string - slider elements\r\n *   timeout: number - animation timeout\r\n *   links: string; - link to switcher (indicator, tab, etc)\r\n *   autoTimeout: number - if defined, slider will switch item automatically\r\n *   height: 'auto' | string - element height\r\n *   animation: string - animation name\r\n *   loop: boolean - allows to slide elements in loop\r\n */\r\nconst SWITCH_DEFAULT_TARGETS = \"> li\";\r\n\r\nexport class CuiSliderArgs implements ICuiParsable {\r\n    targets: string;\r\n    timeout: number;\r\n    links: string;\r\n    autoTimeout: number;\r\n    height: 'auto' | string;\r\n    animation: string;\r\n    loop: boolean;\r\n\r\n    #prefix: string;\r\n    #defTimeout: number;\r\n    constructor(prefix: string, timeout?: number) {\r\n        this.#prefix = prefix;\r\n        this.#defTimeout = timeout ?? 300;\r\n\r\n        this.targets = SWITCH_DEFAULT_TARGETS;\r\n        this.timeout = this.#defTimeout;\r\n        this.links = \"\";\r\n        this.autoTimeout = -1;\r\n        this.height = \"\";\r\n        this.animation = \"\";\r\n        this.loop = false;\r\n    }\r\n\r\n    parse(args: any): void {\r\n        this.targets = SCOPE_SELECTOR + getStringOrDefault(args.targets, SWITCH_DEFAULT_TARGETS)\r\n        this.timeout = getIntOrDefault(args.timeout, this.#defTimeout);\r\n        this.links = args.links;\r\n        this.autoTimeout = getIntOrDefault(args.autoTimeout, -1);\r\n        this.height = getStringOrDefault(args.height, 'auto')\r\n        this.animation = getStringOrDefault(args.animation, 'slide');\r\n        this.loop = boolStringOrDefault(args.loop, false);\r\n    }\r\n\r\n}\r\n\r\nexport class CuiSliderComponent implements ICuiComponent {\r\n    attribute: string;\r\n    constructor(prefix?: string) {\r\n        this.attribute = `${prefix ?? 'cui'}-slider`;\r\n    }\r\n\r\n    getStyle(): string | null {\r\n        return null;\r\n    }\r\n\r\n    get(element: HTMLElement, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiSliderHandler(element, utils, this.attribute);\r\n    }\r\n}\r\n\r\nexport class CuiSliderHandler extends CuiMutableHandler<CuiSliderArgs> implements ICuiSwitchable {\r\n    #targets: Element[];\r\n    #currentIdx: number;\r\n    #links: Element[];\r\n    #task: ICuiTask;\r\n    #switchEventId: string | null;\r\n    //  #moveListener: CuiMoveEventListener;\r\n    #isTracking: boolean;\r\n    #startX: number;\r\n    #swipeRatio: number;\r\n    #nextIdx: number;\r\n    #nextElement: HTMLElement | null;\r\n    #ratioThreshold: number;\r\n    #currSlider: CuiSwipeAnimationEngine;\r\n    #nextSlider: CuiSwipeAnimationEngine;\r\n    #animationDef: AnimationDefinition;\r\n    #targetsCount: number;\r\n    #moveEventId: string | null;\r\n    constructor(element: HTMLElement, utils: CuiUtils, attribute: string) {\r\n        super(\"CuiSliderHandler\", element, attribute, new CuiSliderArgs(utils.setup.prefix, utils.setup.animationTime), utils);\r\n        this.#targets = [];\r\n        this.#currentIdx = -1;\r\n        this.#nextIdx = -1;\r\n        this.#links = [];\r\n        this.#switchEventId = null;\r\n        this.#moveEventId = null;\r\n        this.#isTracking = false;\r\n        this.#startX = -1;\r\n        this.#swipeRatio = 0;\r\n        this.#nextElement = null;\r\n        this.#ratioThreshold = 0.4;\r\n        this.#currSlider = new CuiSwipeAnimationEngine();\r\n        this.#nextSlider = new CuiSwipeAnimationEngine();\r\n        this.#currSlider.setOnFinish(this.onAnimationFinish.bind(this));\r\n        this.#targetsCount = 0;\r\n        this.#task = new CuiTaskRunner(this.args.autoTimeout, true, this.switch.bind(this, 'next'));\r\n        this.#animationDef = SWIPE_ANIMATIONS_DEFINITIONS[this.args.animation];\r\n    }\r\n\r\n    onInit(): void {\r\n        this.#switchEventId = this.onEvent(EVENTS.SWITCH, this.onPushSwitch.bind(this))\r\n        this.#moveEventId = this.onEvent(EVENTS.GLOBAL_MOVE, this.onMove.bind(this))\r\n        this.getTargets();\r\n        this.getLinks();\r\n        this.getActiveIndex();\r\n        this.setLinkActive(-1, this.#currentIdx);\r\n\r\n        this.mutate(() => {\r\n            this.helper.setStyle(this.element, 'height', this.getElementHeight(this.#targets[this.#currentIdx]))\r\n        })\r\n        this.#task = new CuiTaskRunner(this.args.autoTimeout, true, this.switch.bind(this, 'next'));\r\n        this.#animationDef = SWIPE_ANIMATIONS_DEFINITIONS[this.args.animation];\r\n        this.startTask();\r\n    }\r\n\r\n    onUpdate(): void {\r\n        this.mutate(() => {\r\n            this.helper.setStyle(this.element, 'height', this.getElementHeight(this.#targets[this.#currentIdx]))\r\n        })\r\n        this.#animationDef = SWIPE_ANIMATIONS_DEFINITIONS[this.args.animation];\r\n\r\n        this.startTask();\r\n    }\r\n\r\n    onDestroy(): void {\r\n        this.#task.stop();\r\n        this.detachEvent(EVENTS.SWITCH, this.#switchEventId)\r\n        this.detachEvent(EVENTS.GLOBAL_MOVE, this.#moveEventId)\r\n    }\r\n\r\n    onMutation(record: CuiChildMutation): void {\r\n\r\n    }\r\n    /**\r\n     * Move listener callback\r\n     * @param data move listener data\r\n     */\r\n    onMove(data: ICuiMoveEvent) {\r\n        if (this.isLocked || !this.#animationDef) {\r\n            return;\r\n        }\r\n        let current = this.#targets[this.#currentIdx] as HTMLElement;\r\n        switch (data.type) {\r\n            case \"down\":\r\n                if (this.#isTracking || !current.contains((data.target as Node))) {\r\n                    return;\r\n                }\r\n                this.#isTracking = true;\r\n                this.#startX = data.x;\r\n                this.#currSlider.setElement(current);\r\n                this.helper.setClassesAs(document.body, CLASSES.swipingOn);\r\n                if (data.event.cancelable)\r\n                    data.event.preventDefault();\r\n                break;\r\n            case \"up\":\r\n                if (!this.#isTracking) {\r\n                    break;\r\n                }\r\n                // Lock component until animation is finished\r\n                this.isLocked = true;\r\n                let absRatio = Math.abs(this.#swipeRatio);\r\n                let timeout = absRatio * this.args.timeout;\r\n                let back = absRatio <= this.#ratioThreshold;\r\n                this.#currSlider.finish(absRatio, timeout, back);\r\n                this.#nextSlider.finish(absRatio, timeout, back);\r\n                this.helper.removeClassesAs(document.body, CLASSES.swipingOn);\r\n                this.#isTracking = false;\r\n                break;\r\n            case \"move\":\r\n                if (!this.#isTracking) {\r\n                    break;\r\n                }\r\n                let newRatio = (data.x - this.#startX) / current.offsetWidth;\r\n                if (Math.abs(newRatio - this.#swipeRatio) < 0.02) {\r\n                    break;\r\n                }\r\n                let nextIdx = calculateNextIndex(this.#swipeRatio > 0 ? \"next\" : \"prev\", this.#currentIdx, this.#targetsCount);\r\n                this.#swipeRatio = this.adjustMoveRatio(newRatio);\r\n\r\n                if (nextIdx !== this.#nextIdx) {\r\n                    this.#nextElement && this.helper.removeClass(CLASSES.animProgress, this.#nextElement);\r\n                    this.#nextElement = this.#targets[nextIdx] as HTMLElement;\r\n                    this.#nextIdx = nextIdx;\r\n\r\n                    this.#nextSlider.setElement(this.#nextElement)\r\n                    this.#nextSlider.setProps(this.#swipeRatio > 0 ? this.#animationDef.previous.right : this.#animationDef.previous.left);\r\n                    this.#currSlider.setProps(this.#swipeRatio > 0 ? this.#animationDef.current.right : this.#animationDef.current.left);\r\n                    this.mutate(() => {\r\n                        this.#nextElement && this.helper.setClass(CLASSES.animProgress, this.#nextElement);\r\n                    })\r\n                }\r\n                this.mutate(() => {\r\n                    this.#currSlider.update(Math.abs(this.#swipeRatio));\r\n                    this.#nextSlider.update(Math.abs(this.#swipeRatio));\r\n                })\r\n                if (data.event.cancelable)\r\n                    data.event.preventDefault();\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n\r\n    }\r\n\r\n    adjustMoveRatio(ratio: number): number {\r\n        if (this.args.loop) {\r\n            return ratio;\r\n        }\r\n        if (this.#currentIdx === this.#targetsCount - 1 && ratio > 0) {\r\n            return 0;\r\n        }\r\n        if (this.#currentIdx === 0 && ratio < 0) {\r\n            return 0;\r\n        }\r\n        return ratio;\r\n    }\r\n\r\n    /**\r\n     * Api method to switch childrens\r\n     * @param index - index to switch to\r\n     */\r\n    async switch(index: any): Promise<boolean> {\r\n        if (this.isLocked) {\r\n            return false;\r\n        }\r\n        this.onPushSwitch(index);\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param element element this animation was perfromed on\r\n     * @param reverted - flag inidicating whether animation was performed to the end or reverted back to start\r\n     * @param errorOccured - tells whether animation was finished with error\r\n     */\r\n    onAnimationFinish(element: Element | undefined, reverted: boolean, errorOccured: boolean) {\r\n        this.isLocked = false;\r\n        // If not go back or from push then switch, else was go back\r\n        let next = this.#targets[this.#nextIdx];\r\n        let current = this.#targets[this.#currentIdx];\r\n        if (!reverted) {\r\n            if (this.#nextIdx > -1) {\r\n                this.mutate(() => {\r\n                    this.helper.removeClass(CLASSES.animProgress, next);\r\n                    this.helper.setClass(this.activeClassName, next);\r\n                    this.helper.removeClass(this.activeClassName, current);\r\n                    this.helper.removeAttribute(\"style\", current);\r\n                    this.helper.removeAttribute(\"style\", next);\r\n                    this.setLinkActive(this.#currentIdx, this.#nextIdx);\r\n                    this.emitEvent(EVENTS.SWITCHED, {\r\n                        timestamp: Date.now(),\r\n                        index: this.#nextIdx\r\n                    })\r\n                    this.#currentIdx = this.#nextIdx;\r\n                    this.#nextIdx = -1;\r\n                    this.#nextElement = null;\r\n                    this.#startX = -1;\r\n                    this.#swipeRatio = 0;\r\n                })\r\n            }\r\n        } else {\r\n            if (is(this.#nextElement)) {\r\n                //@ts-ignore\r\n                this.helper.removeClass(CLASSES.animProgress, this.#nextElement);\r\n                //@ts-ignore\r\n                this.helper.removeAttribute(\"style\", this.#nextElement);\r\n            }\r\n\r\n            this.helper.removeAttribute(\"style\", current);\r\n            this.#nextIdx = -1;\r\n            this.#nextElement = null;\r\n            this.#startX = -1;\r\n            this.#swipeRatio = 0;\r\n        }\r\n        this.startTask();\r\n    }\r\n\r\n    onPushSwitch(index: string) {\r\n        if (!is(index) ||\r\n            this.isLocked ||\r\n            !this.#animationDef ||\r\n            (!this.args.loop && this.#currentIdx === 0 && index === 'prev') ||\r\n            (!this.args.loop && this.#currentIdx === this.#targetsCount - 1 && index === 'next')) {\r\n            return;\r\n        }\r\n        this.isLocked = true;\r\n        let nextIdx = calculateNextIndex(index, this.#currentIdx, this.#targetsCount);\r\n        if (nextIdx == this.#currentIdx || nextIdx < 0 || nextIdx >= this.#targets.length) {\r\n            this._log.warning(`Index ${index} is not within the suitable range`);\r\n            return false;\r\n        }\r\n        this.#nextIdx = nextIdx;\r\n        let current = this.#targets[this.#currentIdx];\r\n        let next = this.#targets[this.#nextIdx];\r\n        this.#currSlider.setElement(current);\r\n        this.#nextSlider.setElement(next);\r\n        this.#currSlider.setProps(index === 'prev' ? this.#animationDef.current.left : this.#animationDef.current.right);\r\n        this.#nextSlider.setProps(index === 'prev' ? this.#animationDef.previous.left : this.#animationDef.previous.right);\r\n        this.mutate(() => {\r\n            this.#currSlider.finish(0, this.args.timeout, false);\r\n            this.#nextSlider.finish(0, this.args.timeout, false);\r\n            this.helper.setClass(CLASSES.animProgress, next);\r\n        })\r\n\r\n    }\r\n\r\n    getActiveIndex(): void {\r\n        this.#currentIdx = is(this.#targets) ? this.#targets.findIndex(target => this.helper.hasClass(this.activeClassName, target)) : -1;\r\n    }\r\n\r\n    getElementHeight(current: Element): string {\r\n        if (!is(this.args.height) || this.args.height === 'auto') {\r\n            return getChildrenHeight(current) + \"px\";\r\n        } else {\r\n            return this.args.height;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Queries targets\r\n     */\r\n    getTargets() {\r\n        let t = this.element.querySelectorAll(this.args.targets);\r\n        this.#targets = t.length > 0 ? [...t] : [];\r\n        this.#targetsCount = this.#targets.length;\r\n    }\r\n\r\n    /**\r\n     * Get linked switcher elements\r\n     */\r\n    getLinks() {\r\n        this.#links = is(this.args.links) ? [...document.querySelectorAll(this.args.links)] : []\r\n    }\r\n\r\n    /**\r\n     * Set active class on linked switcher if set\r\n     * @param current - current index (to remove active from)\r\n     * @param next - next index (to set action on)\r\n     */\r\n    setLinkActive(current: number, next: number) {\r\n        if (!is(this.#links)) {\r\n            return\r\n        }\r\n        this.mutate(() => {\r\n            if (isInRange(current, 0, this.#links.length - 1)) {\r\n                this.helper.removeClass(this.activeClassName, this.#links[current])\r\n            }\r\n            if (isInRange(next, 0, this.#links.length - 1)) {\r\n                this.helper.setClass(this.activeClassName, this.#links[next])\r\n            }\r\n        })\r\n\r\n    }\r\n\r\n    /**\r\n     * Runs task if arguments setup allows for it - auto flag must be set to true \r\n     */\r\n    startTask() {\r\n        this.#task.stop();\r\n        if (this.args.autoTimeout) {\r\n            this.#task.start();\r\n        }\r\n    }\r\n}\r\n","import { ICuiComponent, ICuiComponentHandler, ICuiParsable, ICuiSwitchable, CuiElement } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiChildMutation, CuiMutableHandler } from \"../../core/handlers/base\";\r\nimport { ICuiTask, CuiTaskRunner } from \"../../core/utils/task\";\r\nimport { ICuiComponentAction, CuiActionsListFactory } from \"../../core/utils/actions\";\r\nimport { is, getStringOrDefault, replacePrefix, getIntOrDefault, isStringTrue, calculateNextIndex, getChildrenHeight, isInRange } from \"../../core/utils/functions\";\r\nimport { SCOPE_SELECTOR, EVENTS } from \"../../core/utils/statics\";\r\n\r\nconst SWITCH_DEFAULT_ACTION_IN = \".{prefix}-switch-animation-default-in\";\r\nconst SWITCH_DEFAULT_ACTION_OUT = \".{prefix}-switch-animation-default-out\";\r\nconst SWITCH_DEFAULT_TARGETS = \" > *\";\r\n\r\nexport class CuiSwitchArgs implements ICuiParsable {\r\n    targets: string;\r\n    in: string;\r\n    out: string;\r\n    timeout: number;\r\n    links: string;\r\n    switch: string;\r\n    autoTimeout: number;\r\n    height: 'auto' | string;\r\n    loop: boolean;\r\n\r\n    #prefix: string;\r\n    #defTimeout: number;\r\n    constructor(prefix: string, timeout?: number) {\r\n        this.#prefix = prefix;\r\n        this.#defTimeout = timeout ?? 300;\r\n\r\n        this.targets = \"\";\r\n        this.in = \"\";\r\n        this.out = \"\";\r\n        this.timeout = this.#defTimeout;\r\n        this.links = \"\";\r\n        this.switch = \"\";\r\n        this.autoTimeout = -1;\r\n        this.height = \"\";\r\n        this.loop = false;\r\n    }\r\n\r\n    parse(args: any): void {\r\n        this.targets = is(args.targets) ? SCOPE_SELECTOR + args.targets : SCOPE_SELECTOR + SWITCH_DEFAULT_TARGETS\r\n        this.in = getStringOrDefault(args.in, replacePrefix(SWITCH_DEFAULT_ACTION_IN, this.#prefix));\r\n        this.out = getStringOrDefault(args.out, replacePrefix(SWITCH_DEFAULT_ACTION_OUT, this.#prefix));\r\n        this.timeout = getIntOrDefault(args.timeout, this.#defTimeout);\r\n        this.links = getStringOrDefault(args.links, \"\");\r\n        this.switch = getStringOrDefault(args.switch, \"\");\r\n        this.autoTimeout = getIntOrDefault(args.autoTimeout, -1);\r\n        this.height = getStringOrDefault(args.height, 'auto');\r\n        this.loop = isStringTrue(args.loop);\r\n    }\r\n\r\n}\r\n\r\nexport class CuiSwitchComponent implements ICuiComponent {\r\n    attribute: string;\r\n    constructor(prefix?: string) {\r\n        this.attribute = `${prefix ?? 'cui'}-switch`;\r\n    }\r\n\r\n    getStyle(): string | null {\r\n        return null;\r\n    }\r\n\r\n    get(element: HTMLElement, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiSwitchHandler(element, utils, this.attribute);\r\n    }\r\n}\r\n\r\nexport class CuiSwitchHandler extends CuiMutableHandler<CuiSwitchArgs> implements ICuiSwitchable {\r\n    #targets: Element[];\r\n    #currentIdx: number;\r\n    #links: Element[];\r\n    #switches: CuiElement[];\r\n    #task: ICuiTask;\r\n    #switchEventId: string | null;\r\n    #actionsIn: ICuiComponentAction[];\r\n    #actionsOut: ICuiComponentAction[];\r\n    constructor(element: HTMLElement, utils: CuiUtils, attribute: string) {\r\n        super(\"CuiSwitchHandler\", element, attribute, new CuiSwitchArgs(utils.setup.prefix, utils.setup.animationTime), utils);\r\n        this.#targets = [];\r\n        this.#currentIdx = -1;\r\n        this.#links = [];\r\n        this.#switches = [];\r\n        this.#switchEventId = null;\r\n        this.#actionsIn = this.#actionsOut = [];\r\n        this.#task = new CuiTaskRunner(this.args.autoTimeout, true, this.switch.bind(this, 'next'));\r\n\r\n    }\r\n\r\n    onInit(): void {\r\n        this.#switchEventId = this.onEvent(EVENTS.SWITCH, this.onPushSwitch.bind(this))\r\n        this.parseArguments();\r\n        this.getTargets();\r\n        this.getActiveIndex();\r\n        this.getSwitches();\r\n        this.setSwitchesActive(this.#currentIdx);\r\n        this.setLinkActive(-1, this.#currentIdx);\r\n        this.mutate(() => {\r\n            this.helper.setStyle(this.element, 'height', this.getElementHeight(this.#targets[this.#currentIdx]))\r\n        })\r\n        this.#task = new CuiTaskRunner(this.args.autoTimeout, true, this.switch.bind(this, 'next'));\r\n        this.startTask();\r\n    }\r\n\r\n    onUpdate(): void {\r\n        this.parseArguments();\r\n        this.getTargets();\r\n        this.getSwitches();\r\n        this.setSwitchesActive(this.#currentIdx);\r\n        this.mutate(() => {\r\n            this.helper.setStyle(this.element, 'height', this.getElementHeight(this.#targets[this.#currentIdx]))\r\n        })\r\n        this.startTask();\r\n    }\r\n\r\n    onDestroy(): void {\r\n        this.#task.stop();\r\n        this.detachEvent(EVENTS.SWITCH, this.#switchEventId)\r\n    }\r\n\r\n    onMutation(record: CuiChildMutation): void {\r\n        this.getTargets();\r\n        this.mutate(() => {\r\n            this.helper.setStyle(this.element, 'height', this.getElementHeight(this.#targets[this.#currentIdx]))\r\n        })\r\n\r\n    }\r\n\r\n    async switch(index: any): Promise<boolean> {\r\n        if (this.isLocked) {\r\n            return false;\r\n        }\r\n        this.getSwitches();\r\n        this.getActiveIndex();\r\n        let nextIdx = calculateNextIndex(index, this.#currentIdx, this.#targets.length);\r\n        if (!this.args.loop && ((index === \"next\" && nextIdx === 0) || (index === 'prev' && this.#currentIdx === 0))) {\r\n            this.logInfo(\"Switch blocked by loop settings\", \"switch\");\r\n            return false;\r\n        }\r\n        if (nextIdx == this.#currentIdx || nextIdx < 0 || nextIdx >= this.#targets.length) {\r\n            this.logWarning(`Index ${index} is not within the suitable range`, \"switch\");\r\n            return false;\r\n        }\r\n        this.isLocked = true;\r\n        this.setSwitchesActive(nextIdx);\r\n        let nextItem = this.#targets[nextIdx];\r\n        await this.actionsHelper.performSwitchAction(nextItem,\r\n            this.#currentIdx > -1 ? this.#targets[this.#currentIdx] : null,\r\n            this.#actionsIn,\r\n            this.#actionsOut,\r\n            () => {\r\n                // Set next element active\r\n                nextItem.classList.add(this.activeClassName);\r\n                // Remove active from current element (if current exists)\r\n                if (this.#currentIdx > -1)\r\n                    this.#targets[this.#currentIdx].classList.remove(this.activeClassName);\r\n                // Update linked items\r\n                this.setLinkActive(this.#currentIdx, nextIdx);\r\n                // Update element height - it must be done a parent get height based on current child\r\n                this.helper.setStyle(this.element, 'height', this.getElementHeight(nextItem))\r\n                this.startTask();\r\n                this.isLocked = false;\r\n            },\r\n            this.args.timeout,\r\n        )\r\n        this.emitEvent(EVENTS.SWITCHED, {\r\n            timestamp: Date.now(),\r\n            index: nextIdx\r\n        })\r\n        return true;\r\n    }\r\n\r\n\r\n    private onPushSwitch(index: string) {\r\n        this.switch(index);\r\n    }\r\n\r\n    private getActiveIndex(): void {\r\n        this.#currentIdx = is(this.#targets) ? this.#targets.findIndex(target => this.helper.hasClass(this.activeClassName, target)) : -1;\r\n    }\r\n\r\n    private getElementHeight(current: Element): string {\r\n        if (!is(this.args.height) || this.args.height === 'auto') {\r\n            return getChildrenHeight(current) + \"px\";\r\n        } else {\r\n            return this.args.height;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Gets attributes value and prepares properties\r\n     */\r\n    private parseArguments() {\r\n        this.#actionsIn = CuiActionsListFactory.get(this.args.in);\r\n        this.#actionsOut = CuiActionsListFactory.get(this.args.out);\r\n        this.#links = is(this.args.links) ? [...document.querySelectorAll(this.args.links)] : []\r\n    }\r\n\r\n    /**\r\n     * Query target elements\r\n     */\r\n    private getTargets() {\r\n        let t = this.element.querySelectorAll(this.args.targets);\r\n        this.#targets = t.length > 0 ? [...t] : [];\r\n    }\r\n\r\n    private getSwitches() {\r\n        let switches = is(this.args.switch) ? document.querySelectorAll(this.args.switch) : null;\r\n        this.#switches = [];\r\n        if (switches) {\r\n            switches.forEach(sw => {\r\n                this.#switches.push(<CuiElement>(sw as any))\r\n            })\r\n        }\r\n    }\r\n\r\n    private setLinkActive(current: number, next: number) {\r\n        if (!is(this.#links)) {\r\n            return\r\n        }\r\n        if (isInRange(current, 0, this.#links.length - 1)) {\r\n            this.helper.removeClass(this.activeClassName, this.#links[current])\r\n        }\r\n        if (isInRange(next, 0, this.#links.length - 1)) {\r\n            this.helper.setClass(this.activeClassName, this.#links[next])\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Sets propers active state on attached switches\r\n     * @param index \r\n     */\r\n\r\n    private setSwitchesActive(index: number) {\r\n        this.#switches.forEach(sw => {\r\n            this.emitLinkSwitch(sw.$cuid, index)\r\n        })\r\n    }\r\n\r\n    /**\r\n     * Emits push event to attached switch to set proper index\r\n     * @param id - cuid of element\r\n     * @param index - index to be set on element\r\n     */\r\n    private emitLinkSwitch(id: string | null, index: number) {\r\n        if (is(id))\r\n            this.utils.bus.emit(EVENTS.SWITCH, id, index);\r\n    }\r\n\r\n    /**\r\n     * Runs task if arguments setup allows for it - auto flag must be set to true \r\n     */\r\n    private startTask() {\r\n        this.#task.stop();\r\n        if (this.args.autoTimeout) {\r\n            this.#task.start();\r\n        }\r\n    }\r\n\r\n}","import { ICuiComponent, ICuiComponentHandler, ICuiParsable, CuiElement } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiHandler } from \"../../core/handlers/base\";\r\nimport { is } from \"../../core/utils/functions\";\r\nimport { EVENTS } from \"../../core/utils/statics\";\r\n\r\nconst SWITCHER_LIST_ITEM_SELECTOR = \"li > a\";\r\n\r\nexport class CuiSwitcherArgs implements ICuiParsable {\r\n\r\n    target: string;\r\n    index: string;\r\n\r\n    constructor() {\r\n        this.index = \"\";\r\n        this.target = \"\"\r\n    }\r\n\r\n    parse(args: any): void {\r\n        if (!is(args)) {\r\n            return;\r\n        }\r\n        this.target = args.target;\r\n        this.index = args.index;\r\n    }\r\n\r\n}\r\n\r\nexport class CuiSwitcherComponent implements ICuiComponent {\r\n    attribute: string;\r\n    constructor(prefix?: string) {\r\n        this.attribute = `${prefix ?? 'cui'}-switcher`;\r\n    }\r\n\r\n    getStyle(): string | null {\r\n        return null;\r\n    }\r\n\r\n    get(element: HTMLElement, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiSwitcherHandler(element, utils, this.attribute);\r\n    }\r\n}\r\n\r\nexport class CuiSwitcherHandler extends CuiHandler<CuiSwitcherArgs>  {\r\n    #targetId: string | null;\r\n    #isList: boolean;\r\n    #listeners: ((ev: MouseEvent) => void)[];\r\n    constructor(element: HTMLElement, utils: CuiUtils, attribute: string) {\r\n        super(\"CuiSwitcherHandler\", element, attribute, new CuiSwitcherArgs(), utils);\r\n        this.#targetId = null;\r\n        this.#isList = element.tagName === 'UL';\r\n        this.onClickEvent = this.onClickEvent.bind(this);\r\n        this.#listeners = [];\r\n    }\r\n\r\n    onInit(): void {\r\n        this.setEvents();\r\n        this.getTarget();\r\n    }\r\n\r\n    onUpdate(): void {\r\n        this.getTarget();\r\n    }\r\n\r\n    onDestroy(): void {\r\n        this.removeEvents();\r\n    }\r\n\r\n    getTarget() {\r\n        if (!is(this.args.target)) {\r\n            this.#targetId = null;\r\n        }\r\n\r\n        let target = <CuiElement>(document.querySelector(this.args.target) as any);\r\n        if (is(target)) {\r\n            this.#targetId = target.$cuid;\r\n        }\r\n    }\r\n\r\n    setEvents() {\r\n        if (this.#isList) {\r\n            let elements = this.element.querySelectorAll(SWITCHER_LIST_ITEM_SELECTOR);\r\n            elements.forEach((el: Element, index: number) => {\r\n                let list = this.onListItemClick.bind(this, index)\r\n                this.#listeners.push(list)\r\n                //@ts-ignore\r\n                el.addEventListener('click', list)\r\n            })\r\n        } else {\r\n            this.element.addEventListener('click', this.onClickEvent)\r\n        }\r\n    }\r\n\r\n    removeEvents() {\r\n        if (this.#isList) {\r\n            let elements = this.element.querySelectorAll(SWITCHER_LIST_ITEM_SELECTOR);\r\n            elements.forEach((el: Element, index: number) => {\r\n                if (this.#listeners.length > index)\r\n                    //@ts-ignore\r\n                    el.removeEventListener('click', this.#listeners[index])\r\n            })\r\n            this.#listeners = [];\r\n        } else {\r\n            this.element.removeEventListener('click', this.onClickEvent);\r\n        }\r\n    }\r\n\r\n    onClickEvent(ev: MouseEvent) {\r\n        this.getTarget();\r\n        if (!is(this.args.index)) {\r\n            return;\r\n        }\r\n        this.onClick(this.args.index.trim());\r\n    }\r\n\r\n    onListItemClick(index: number, ev: MouseEvent) {\r\n        this.getTarget();\r\n        this.onClick(index);\r\n    }\r\n\r\n    onClick(index: any) {\r\n        if (!is(this.#targetId)) {\r\n            return;\r\n        }\r\n        //@ts-ignore  targetId checked already\r\n        this.utils.bus.emit(EVENTS.SWITCH, this.#targetId, index);\r\n    }\r\n\r\n}","import { ICuiComponent, ICuiComponentHandler } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiHandler } from \"../../core/handlers/base\";\r\nimport { ICuiComponentAction, CuiActionsListFactory } from \"../../core/utils/actions\";\r\nimport { is, isString, getStringOrDefault } from \"../../core/utils/functions\";\r\nimport { EVENTS } from \"../../core/utils/statics\";\r\n\r\nexport class CuiToggleArgs {\r\n    target: string;\r\n    action: string;\r\n    constructor() {\r\n        this.action = \"\";\r\n        this.target = \"\";\r\n    }\r\n\r\n    parse(args: any) {\r\n        if (is(args) && isString(args)) {\r\n            this.action = args;\r\n        } else {\r\n            this.target = getStringOrDefault(args.target, \"\");\r\n            this.action = args.action;\r\n        }\r\n    }\r\n}\r\nexport class CuiToggleComponent implements ICuiComponent {\r\n    attribute: string;\r\n    constructor(prefix?: string) {\r\n        this.attribute = `${prefix ?? \"cui\"}-toggle`;\r\n    }\r\n\r\n    getStyle(): string | null {\r\n        return null;\r\n    }\r\n\r\n    get(element: HTMLElement, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiToggleHandler(element, utils, this.attribute);\r\n    }\r\n}\r\n\r\nexport class CuiToggleHandler extends CuiHandler<CuiToggleArgs> {\r\n    #target: Element;\r\n    #utils: CuiUtils;\r\n    #toggleEventId: string | null;\r\n    #actions: ICuiComponentAction[];\r\n    constructor(element: HTMLElement, utils: CuiUtils, attribute: string) {\r\n        super(\"CuiToggleHandler\", element, attribute, new CuiToggleArgs(), utils);\r\n        this.#target = this.element;\r\n        this.#utils = utils;\r\n        this.#toggleEventId = null;\r\n        this.#actions = [];\r\n        this.onClick = this.onClick.bind(this);\r\n    }\r\n\r\n    onInit(): void {\r\n        this.#target = this.getTarget();\r\n        this.#actions = CuiActionsListFactory.get(this.args.action);\r\n        this.element.addEventListener('click', this.onClick);\r\n        this.#toggleEventId = this.onEvent(EVENTS.TOGGLE, this.toggle.bind(this));\r\n\r\n    }\r\n    onUpdate(): void {\r\n        this.#target = this.getTarget();\r\n        this.#actions = CuiActionsListFactory.get(this.args.action);\r\n    }\r\n\r\n    onDestroy(): void {\r\n        this.element.removeEventListener('click', this.onClick);\r\n        this.detachEvent(EVENTS.TOGGLE, this.#toggleEventId);\r\n    }\r\n\r\n    toggle() {\r\n        if (!this.#target) {\r\n            this.logError(\"Target in not provided\", \"toggle\");\r\n            return;\r\n        }\r\n        this.#actions.forEach(action => action.toggle(this.#target, this.#utils));\r\n        this.emitEvent(EVENTS.TOGGLED, {\r\n            action: this.args.action,\r\n            target: this.#target,\r\n            timestamp: Date.now()\r\n        })\r\n    }\r\n\r\n    onClick(ev: MouseEvent) {\r\n        this.toggle();\r\n        ev.preventDefault();\r\n    }\r\n\r\n    getTarget(): Element {\r\n        if (!this.args.target) {\r\n            return this.element;\r\n        }\r\n        return document.querySelector(this.args.target) ?? this.element;\r\n    }\r\n}","import { ElementBuilder } from \"../../core/builders/element\";\r\nimport { CuiHandler } from \"../../core/handlers/base\";\r\nimport { CuiHoverEvent, CuiHoverListener } from \"../../core/listeners/hover\";\r\nimport { CuiBasePositionCalculator } from \"../../core/position/calculator\";\r\nimport { ICuiPositionCalculator } from \"../../core/position/interfaces\";\r\nimport { CuiTaskRunner, ICuiTask } from \"../../core/utils/task\";\r\nimport { ICuiParsable, ICuiComponent, ICuiComponentHandler } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { ICuiComponentAction, CuiActionsListFactory } from \"../../core/utils/actions\";\r\nimport { replacePrefix, isString, getStringOrDefault, getIntOrDefault, is } from \"../../core/utils/functions\";\r\n\r\nconst TOOLTIP_ACTION = \".{prefix}-animation-tooltip-in\";\r\nconst TOOLTIP_DATA = \"{prefix}-tooltip-data\";\r\n\r\nexport class CuiTooltipArgs implements ICuiParsable {\r\n    content: string;\r\n    width: number;\r\n    pos: string;\r\n    margin: number;\r\n    action: string;\r\n    timeout: number;\r\n    #defAct: string;\r\n    constructor(prefix: string) {\r\n        this.#defAct = replacePrefix(TOOLTIP_ACTION, prefix)\r\n        this.content = \"\";\r\n        this.width = 150;\r\n        this.margin = 8;\r\n        this.timeout = 2000;\r\n        this.pos = \"\";\r\n        this.action = this.#defAct;\r\n    }\r\n\r\n    parse(val: any): void {\r\n        if (isString(val)) {\r\n            this.content = getStringOrDefault(val, \"\");\r\n            return;\r\n        }\r\n        this.content = getStringOrDefault(val.content, \"\");\r\n        this.width = getIntOrDefault(val.width, 150);\r\n        this.margin = getIntOrDefault(val.margin, 8);\r\n        this.pos = getStringOrDefault(val.pos, \"\");\r\n        this.action = getStringOrDefault(val.action, this.#defAct);\r\n        this.timeout = getIntOrDefault(val.timeout, 2000);\r\n    }\r\n}\r\n\r\nexport class CuiTooltipComponent implements ICuiComponent {\r\n    attribute: string;\r\n    #prefix: string;\r\n\r\n    constructor(prefix?: string) {\r\n        this.#prefix = prefix ?? 'cui';\r\n        this.attribute = `${this.#prefix}-tooltip`;\r\n    }\r\n\r\n\r\n    getStyle(): string | null {\r\n        return null;\r\n    }\r\n\r\n    get(element: HTMLElement, sutils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiTooltipHandler(element, this.attribute, sutils, this.#prefix);\r\n    }\r\n}\r\n\r\nexport class CuiTooltipHandler extends CuiHandler<CuiTooltipArgs> {\r\n    #hoverListener: CuiHoverListener;\r\n    #tooltip: HTMLElement | undefined;\r\n    #margin: number;\r\n    #positionCalculator: ICuiPositionCalculator;\r\n    #tooltipDataCls: string;\r\n    #actions: ICuiComponentAction[];\r\n    #task: ICuiTask | undefined;\r\n    constructor(element: HTMLElement, attribute: string, utils: CuiUtils, prefix: string) {\r\n        super(\"CuiTooltipHandler\", element, attribute, new CuiTooltipArgs(prefix), utils);\r\n        this.#tooltip = undefined;\r\n        this.#actions = [];\r\n        this.#task = undefined;\r\n        this.#tooltipDataCls = replacePrefix(TOOLTIP_DATA, prefix);\r\n        this.#hoverListener = new CuiHoverListener(element);\r\n        this.#hoverListener.setCallback(this.onHover.bind(this));\r\n        this.#margin = 8;\r\n        this.#positionCalculator = new CuiBasePositionCalculator();\r\n        this.#positionCalculator.setPreferred(\"top-center\");\r\n    }\r\n\r\n    onInit(): void {\r\n        this.#hoverListener.attach();\r\n        this.getDataFromArgs();\r\n        this.#task = new CuiTaskRunner(this.args.timeout, false, this.removeTooltip.bind(this));\r\n    }\r\n\r\n    onUpdate(): void {\r\n        this.getDataFromArgs();\r\n        if (this.#task)\r\n            this.#task.setTimeout(this.args.timeout);\r\n    }\r\n\r\n    onDestroy(): void {\r\n        this.removeTooltip();\r\n        this.#hoverListener.detach();\r\n    }\r\n\r\n    onHover(ev: CuiHoverEvent) {\r\n        if (ev.isHovering) {\r\n            this.createTooltip();\r\n        } else {\r\n            this.removeTooltip();\r\n        }\r\n    }\r\n\r\n    private createTooltip() {\r\n        if (is(this.#tooltip) || !is(this.args.content)) {\r\n            return;\r\n        }\r\n        const box = this.element.getBoundingClientRect();\r\n        this.#tooltip = new ElementBuilder(\"div\").setClasses(this.#tooltipDataCls).build();\r\n        this.#tooltip.textContent = this.args.content;\r\n        this.#tooltip.style.maxWidth = `${this.args.width}px`;\r\n        document.body.appendChild(this.#tooltip);\r\n        this.mutate(() => {\r\n            if (!this.#tooltip) {\r\n                return;\r\n            }\r\n            const toolbox = this.#tooltip.getBoundingClientRect();\r\n            this.#positionCalculator.setMargin(this.#margin);\r\n            try {\r\n                let [x, y] = this.#positionCalculator.calculate(box, toolbox);\r\n                this.#tooltip.style.top = `${y}px`;\r\n                this.#tooltip.style.left = `${x}px`;\r\n                this.toggleActions();\r\n                if (this.#task)\r\n                    this.#task.start();\r\n            } catch (e) {\r\n                this.logError(e.message, \"createTooltip\", e);\r\n            }\r\n\r\n        })\r\n    }\r\n\r\n    private removeTooltip() {\r\n        if (this.#task)\r\n            this.#task.stop();\r\n        this.mutate(() => {\r\n            if (is(this.#tooltip)) {\r\n                //@ts-ignore already checked\r\n                this.#tooltip.remove();\r\n                this.#tooltip = undefined;\r\n            }\r\n        })\r\n    }\r\n\r\n    private getDataFromArgs() {\r\n        this.#positionCalculator.setMargin(this.args.margin);\r\n        this.#positionCalculator.setStatic(this.args.pos);\r\n        this.#actions = CuiActionsListFactory.get(this.args.action);\r\n    }\r\n\r\n    private toggleActions() {\r\n        if (!this.#tooltip) {\r\n            return;\r\n        }\r\n        this.#actions.forEach(action => {\r\n            // @ts-ignore\r\n            action.toggle(this.#tooltip);\r\n        })\r\n    }\r\n}","import { ElementBuilder } from \"../../core/builders/element\";\r\nimport { is } from \"../../core/utils/functions\";\r\n\r\nexport class DialogBuilder {\r\n    #header: Element | undefined;\r\n    #body: Element | undefined;\r\n    #footer: Element | undefined;\r\n    #prefix: string;\r\n    #switches: string;\r\n    #reverse: boolean;\r\n    constructor(prefix: string, reverse: boolean, switches?: string) {\r\n        this.#prefix = prefix;\r\n        this.#header = this.#footer = this.#body = undefined;\r\n        this.#switches = switches ?? \"\";\r\n        this.#reverse = reverse;\r\n    }\r\n\r\n    createHeader(title: string, classes: string[], elements?: Element[]) {\r\n        if (!is(classes)) {\r\n            classes = []\r\n        }\r\n        if (!is(elements)) {\r\n            elements = []\r\n        }\r\n        let headerBuilder = new ElementBuilder('div');\r\n        headerBuilder.setClasses(`${this.#prefix}-dialog-header`, ...classes)\r\n        this.#header = headerBuilder.build();\r\n\r\n        let titleElement = new ElementBuilder('span').setClasses(this.getPrefixedString(\"-dialog-title\")).build(title)\r\n\r\n        this.#header.appendChild(titleElement);\r\n        // @ts-ignore\r\n        this.appendChildrens(this.#header, ...elements);\r\n\r\n    }\r\n\r\n    createFooter(classes: string[], elements: Element[]) {\r\n        if (!is(classes)) {\r\n            classes = []\r\n        }\r\n        if (!is(elements)) {\r\n            elements = []\r\n        }\r\n        this.#footer = new ElementBuilder('div').setClasses(this.getPrefixedString(\"-dialog-footer\"), ...classes).build();\r\n        // @ts-ignore\r\n        this.appendChildrens(this.#footer, ...elements);\r\n    }\r\n\r\n    createBody(classes: string[], elements: Element[]) {\r\n        if (!is(classes)) {\r\n            classes = []\r\n        }\r\n        if (!is(elements)) {\r\n            elements = []\r\n        }\r\n        this.#body = new ElementBuilder('div').setClasses(this.getPrefixedString(\"-dialog-body\"), ...classes).build();\r\n        // @ts-ignore\r\n        this.appendChildrens(this.#body, ...elements);\r\n    }\r\n\r\n    build(id: string): HTMLElement {\r\n        let classes = [this.getPrefixedString(\"-dialog\")]\r\n        if (this.#reverse) {\r\n            classes.push(this.getPrefixedString('-reverse-auto'));\r\n        }\r\n        let dialog = new ElementBuilder('div').setId(id).setClasses(...classes).setAttributes({\r\n            [this.getPrefixedString('-dialog')]: this.#switches\r\n        }).build();\r\n        let container = new ElementBuilder('div').setClasses(this.getPrefixedString(\"-dialog-container\")).build();\r\n        if (this.#header)\r\n            container.appendChild(this.#header);\r\n        if (this.#body)\r\n            container.appendChild(this.#body);\r\n        if (this.#footer)\r\n            container.appendChild(this.#footer);\r\n        dialog.appendChild(container);\r\n        return dialog;\r\n    }\r\n\r\n    private appendChildrens(parent: Element, ...elements: Element[]) {\r\n        if (is(elements)) {\r\n            elements.forEach((element) => parent.appendChild(element));\r\n        }\r\n    }\r\n    private getPrefixedString(str: string) {\r\n        return this.#prefix + str\r\n    }\r\n}","import { ElementManager } from \"../../app/managers/element\";\r\nimport { ElementBuilder } from \"../../core/builders/element\";\r\nimport { CuiContext } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { is } from \"../../core/utils/functions\";\r\nimport { DialogBuilder } from \"./builder\";\r\nimport { CuiAlertOptions, CuiAlertType } from \"./models\";\r\n\r\nexport interface ICuiAlertHandler {\r\n    show(root: Element): void;\r\n}\r\n\r\ninterface AlertCallbacks {\r\n    [name: string]: (() => void) | undefined;\r\n}\r\n\r\nabstract class CuiAlertHandlerBase implements ICuiAlertHandler, CuiContext {\r\n    #callbacks: AlertCallbacks;\r\n    #utils: CuiUtils;\r\n    #id: string;\r\n    #manager: ElementManager | undefined;\r\n    closeStr: string;\r\n    iconStr: string;\r\n    content: string;\r\n    title: string;\r\n    prefix: string;\r\n    reverse: boolean;\r\n    #attid: string | null;\r\n    constructor(setup: CuiUtils, id: string, data: CuiAlertOptions) {\r\n        this.#callbacks = {\r\n            \"yes\": data.onYes,\r\n            \"no\": data.onNo,\r\n            \"cancel\": data.onCancel,\r\n            \"ok\": data.onOk\r\n        }\r\n        this.content = data.message;\r\n        this.title = data.title;\r\n        this.prefix = setup.setup.prefix;\r\n        this.#utils = setup;\r\n        this.#id = id;\r\n        this.reverse = false;\r\n        this.#attid = null;\r\n        this.closeStr = `${this.#utils.setup.prefix}-close`;\r\n        this.iconStr = `${this.#utils.setup.prefix}-icon`;\r\n        this.#manager = undefined;\r\n    }\r\n\r\n    getId(): string {\r\n        return this.#id;\r\n    }\r\n\r\n    show(root: Element): void {\r\n        if (!this.#utils) {\r\n            return;\r\n        }\r\n\r\n        let element = document.getElementById(this.#id);\r\n        if (!is(element)) {\r\n            element = this.createElement();\r\n            this.#utils.interactions.mutate(() => {\r\n                // @ts-ignore - already checked\r\n                root.appendChild(element);\r\n            }, null)\r\n\r\n        } else {\r\n            // @ts-ignore - already checked\r\n            this.updateElement(element);\r\n        }\r\n        setTimeout(() => {\r\n            // @ts-ignore - already checked\r\n            this.#manager = new ElementManager([element], this.#utils);\r\n            let ids = this.#manager.on('closed', this.onClose.bind(this));\r\n            this.#attid = ids.length > 0 ? ids[0] : null;\r\n            this.#manager.emit(\"open\");\r\n        }, 50);\r\n    }\r\n\r\n    updateElement(element: HTMLElement) {\r\n        this.#utils.interactions.fetch(() => {\r\n            let title = element.querySelector(`.${this.prefix}-dialog-title`);\r\n            let content = element.querySelector(`.${this.prefix}-dialog-body>p`);\r\n            this.#utils.interactions.mutate(() => {\r\n                if (title) {\r\n                    title.innerHTML = this.title;\r\n                }\r\n                if (content) {\r\n                    content.innerHTML = this.content;\r\n                }\r\n            }, null)\r\n        }, null)\r\n    }\r\n\r\n    onClose(arg: any) {\r\n        try {\r\n            if (is(arg) && arg.state && this.#callbacks) {\r\n                if (is(this.#callbacks[arg.state])) {\r\n                    let callback = this.#callbacks[arg.state];\r\n                    if (callback) {\r\n                        callback();\r\n                    }\r\n                }\r\n            }\r\n        } finally {\r\n            if (this.#attid != null) {\r\n                if (this.#manager)\r\n                    this.#manager.detach('closed', this.#attid);\r\n                this.#attid = null;\r\n            }\r\n\r\n            this.#manager = undefined;\r\n        }\r\n    }\r\n\r\n    abstract createElement(): HTMLElement;\r\n\r\n\r\n}\r\n\r\nexport class CuiAlertHandler extends CuiAlertHandlerBase {\r\n    #id: string;\r\n    constructor(setup: CuiUtils, id: string, data: CuiAlertOptions) {\r\n        super(setup, id, data);\r\n        this.#id = id;\r\n        this.reverse = data.reverse ?? false;\r\n    }\r\n\r\n    createElement() {\r\n        let dialogBuilder = new DialogBuilder(this.prefix, this.reverse);\r\n\r\n        dialogBuilder.createHeader(this.title, [], [\r\n            new ElementBuilder('a').setClasses(`${this.prefix}-icon`).setAttributes({\r\n                [this.closeStr]: \"state: cancel\",\r\n                [this.iconStr]: \"close\"\r\n            }).build()\r\n        ]);\r\n        dialogBuilder.createBody([], [\r\n            new ElementBuilder('p').build(this.content)\r\n        ]);\r\n        dialogBuilder.createFooter([`${this.prefix}-flex`, `${this.prefix}-right`], [\r\n            new ElementBuilder('button').setClasses(`${this.prefix}-button`, `${this.prefix}-margin-small-right`).setAttributes({ [this.closeStr]: \"state: cancel\" }).build(\"Cancel\"),\r\n            new ElementBuilder('button').setClasses(`${this.prefix}-button`, `${this.prefix}-accent`).setAttributes({ [this.closeStr]: \"state: ok\" }).build(\"Ok\")\r\n        ])\r\n        return dialogBuilder.build(this.#id);\r\n    }\r\n}\r\n\r\nexport class CuiInfoAlertUpHandler extends CuiAlertHandlerBase {\r\n    #id: string;\r\n    constructor(setup: CuiUtils, id: string, data: CuiAlertOptions) {\r\n        super(setup, id, data);\r\n        this.#id = id;\r\n        this.content = data.message;;\r\n        this.title = data.title;\r\n        this.prefix = setup.setup.prefix;\r\n        this.reverse = data.reverse ?? false;\r\n\r\n    }\r\n\r\n    createElement() {\r\n        let dialogBuilder = new DialogBuilder(this.prefix, this.reverse);\r\n        dialogBuilder.createHeader(this.title, []);\r\n        dialogBuilder.createBody([], [\r\n            new ElementBuilder('p').build(this.content)\r\n        ]);\r\n        dialogBuilder.createFooter([`${this.prefix}-flex`, `${this.prefix}-right`], [\r\n            new ElementBuilder('button').setClasses(`${this.prefix}-button`, `${this.prefix}-accent`).setAttributes({ [this.closeStr]: \"state: ok\" }).build(\"Ok\")\r\n        ])\r\n\r\n        return dialogBuilder.build(this.#id);\r\n    }\r\n}\r\n\r\nexport class CuiYesNoPopUpHandler extends CuiAlertHandlerBase {\r\n    #id: string;\r\n    constructor(setup: CuiUtils, id: string, data: CuiAlertOptions) {\r\n        super(setup, id, data);\r\n        this.#id = id;\r\n        this.content = data.message;\r\n        this.title = data.title;\r\n        this.prefix = setup.setup.prefix;\r\n        this.reverse = data.reverse ?? false;\r\n    }\r\n\r\n    createElement() {\r\n        let dialogBuilder = new DialogBuilder(this.prefix, this.reverse);\r\n\r\n        dialogBuilder.createHeader(this.title, [], [\r\n            new ElementBuilder('a').setClasses(`${this.prefix}-icon`).setAttributes({\r\n                [this.closeStr]: \"state: cancel\",\r\n                [this.iconStr]: \"close\"\r\n            }).build()\r\n        ]);\r\n        dialogBuilder.createBody([], [\r\n            new ElementBuilder('p').build(this.content)\r\n        ]);\r\n        dialogBuilder.createFooter([`${this.prefix}-flex`, `${this.prefix}-right`], [\r\n            new ElementBuilder('button').setClasses(`${this.prefix}-button`, `${this.prefix}-margin-small-right`).setAttributes({ [this.closeStr]: \"state: no\" }).build(\"No\"),\r\n            new ElementBuilder('button').setClasses(`${this.prefix}-button`, `${this.prefix}-accent`).setAttributes({ [this.closeStr]: \"state: yes\" }).build(\"Yes\")\r\n        ])\r\n        return dialogBuilder.build(this.#id);\r\n    }\r\n}\r\n\r\nexport class CuiAlertFactory {\r\n    static get(id: string, type: CuiAlertType, data: CuiAlertOptions, utils: CuiUtils): ICuiAlertHandler | undefined {\r\n        if (type === \"Info\") {\r\n            return new CuiInfoAlertUpHandler(utils, id, data);\r\n        } else if (type === 'YesNoCancel') {\r\n            return new CuiYesNoPopUpHandler(utils, id, data);\r\n        } else if (type === 'OkCancel') {\r\n            return new CuiAlertHandler(utils, id, data);\r\n        }\r\n        return undefined;\r\n    }\r\n}\r\n\r\n\r\n","import { CuiLoggerFactory } from \"../../core/factories/logger\";\r\nimport { ICuiLogger, ICuiPlugin } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { EVENTS } from \"../../core/utils/statics\";\r\nimport { CuiAlertFactory } from \"./handler\";\r\nimport { CuiAlertEvent } from \"./models\";\r\n\r\n\r\n\r\nexport class CuiAlertsPlugin implements ICuiPlugin {\r\n    description: string;\r\n    name: string;\r\n    setup: any;\r\n\r\n    #handleId: string | null;\r\n    #utils: CuiUtils | undefined;\r\n    #log: ICuiLogger;\r\n    constructor() {\r\n        this.name = \"alert-plugin\";\r\n        this.description = \"CuiAlertsPlugin\";\r\n\r\n        this.#handleId = null;\r\n        this.#utils = undefined;\r\n        this.#log = CuiLoggerFactory.get(\"CuiAlertsPlugin\")\r\n    }\r\n    init(utils: CuiUtils): void {\r\n        this.#utils = utils;\r\n        this.detach();\r\n        this.#handleId = this.#utils.bus.on(EVENTS.ALERT, this.onAlert.bind(this), { $cuid: this.name });\r\n    }\r\n\r\n    destroy(): void {\r\n        this.detach();\r\n    }\r\n\r\n    private detach() {\r\n        if (this.#handleId && this.#utils) {\r\n            this.#utils.bus.detach(EVENTS.ALERT, this.#handleId);\r\n            this.#handleId = null\r\n        }\r\n    }\r\n\r\n    private onAlert(event: CuiAlertEvent) {\r\n        if (!this.#utils) {\r\n            this.#log.error(\"Utils are not set\");\r\n            return;\r\n        }\r\n        if (!this.validateEvent(event)) {\r\n            this.#log.error(\"Event validation failed\");\r\n            return;\r\n        }\r\n        let popup = CuiAlertFactory.get(event.id, event.type, event.options, this.#utils);\r\n        if (!popup) {\r\n            this.#log.error(\"Possibly incorrect alert type\");\r\n            return;\r\n        }\r\n        popup.show(this.#utils.setup.root);\r\n    }\r\n\r\n    private validateEvent(event: CuiAlertEvent): boolean {\r\n        if (!event || !event.id || !event.type || !event.options) {\r\n            return false;\r\n        }\r\n        return true\r\n    }\r\n}\r\n","import { ICuiPlugin, ICuiEventBus } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { EVENTS } from \"../../core/utils/statics\";\r\n\r\nexport class CuiWindowClickPlugin implements ICuiPlugin {\r\n    description: string;\r\n    name: string = 'click-plugin';\r\n    setup: any;\r\n    #bus: ICuiEventBus | undefined;\r\n    #boundClick: (ev: MouseEvent) => void;\r\n\r\n    constructor() {\r\n        this.description = \"CuiWindowClickPlugin\";\r\n        this.#bus = undefined;\r\n        this.#boundClick = this.onWindowClick.bind(this);\r\n    }\r\n\r\n    init(utils: CuiUtils): void {\r\n        this.#bus = utils.bus;\r\n        window.addEventListener('click', this.#boundClick)\r\n    }\r\n\r\n    destroy(): void {\r\n        window.removeEventListener('click', this.#boundClick);\r\n    }\r\n\r\n    onWindowClick(ev: MouseEvent) {\r\n        if (this.#bus)\r\n            this.#bus.emit(EVENTS.WINDOW_CLICK, null, ev)\r\n    }\r\n}","import { ICuiPlugin, IUIInteractionProvider } from \"src/core/models/interfaces\";\r\nimport { CuiUtils } from \"src/core/models/utils\";\r\n\r\nconst DEFAULT_FOCUS_VISIBLE = \"focus-visible\";\r\nconst DEFAULT_FOCUS_PRECISE = \"focus-precise\";\r\n\r\ntype FocusInputType = \"keyboard\" | \"mouse\" | \"touch\" | \"none\";\r\n\r\nexport interface ICuiLightFocusPluginSetup {\r\n    keybordClass?: string;\r\n    mouseClass?: string;\r\n    touchClass?: string;\r\n}\r\n\r\nexport class CuiLightFocusPlugin implements ICuiPlugin {\r\n    description: string;\r\n    name: string;\r\n    setup: ICuiLightFocusPluginSetup;\r\n    #interactions: IUIInteractionProvider | undefined;\r\n    #inputType: FocusInputType;\r\n    #onMouseListener: any;\r\n    #onTouchListener: any;\r\n    #onKeyDownListener: any;\r\n    #currentCls: string | undefined;\r\n    constructor(setup: ICuiLightFocusPluginSetup) {\r\n        this.setup = {\r\n            keybordClass: DEFAULT_FOCUS_VISIBLE,\r\n            mouseClass: DEFAULT_FOCUS_PRECISE,\r\n            touchClass: DEFAULT_FOCUS_PRECISE,\r\n            ...setup\r\n        }\r\n\r\n        this.description = \"CuiLightFocusPlugin\";\r\n        this.name = \"focus-plugin\";\r\n        this.#interactions = undefined;\r\n\r\n        this.#onKeyDownListener = this.onKeyDownEvent.bind(this);\r\n        this.#onMouseListener = this.onMouseEvent.bind(this);\r\n        this.#onTouchListener = this.onTouchEvent.bind(this);\r\n\r\n        this.#inputType = 'none';\r\n        this.#currentCls = undefined;\r\n\r\n    }\r\n\r\n    init(utils: CuiUtils): void {\r\n        this.#interactions = utils.interactions;\r\n        document.body.addEventListener('touchstart', this.#onTouchListener);\r\n        document.body.addEventListener('mousedown', this.#onMouseListener);\r\n        window.addEventListener('keydown', this.#onKeyDownListener);\r\n\r\n    }\r\n\r\n    private onMouseEvent(ev: MouseEvent) {\r\n        if (this.#inputType === 'mouse') {\r\n            return;\r\n        }\r\n        this.update('mouse');\r\n    }\r\n\r\n    private onKeyDownEvent(ev: KeyboardEvent) {\r\n        if (this.#inputType === 'keyboard') {\r\n            return;\r\n        }\r\n        this.update('keyboard');\r\n    }\r\n\r\n    private onTouchEvent(ev: TouchEvent) {\r\n        if (this.#inputType === 'touch') {\r\n            return;\r\n        }\r\n        this.update('touch');\r\n    }\r\n\r\n    private update(type: FocusInputType) {\r\n        let cls = this.getClass(type);\r\n        this.setClasses(cls, this.#currentCls, () => {\r\n            this.#currentCls = cls\r\n            this.#inputType = type;\r\n        })\r\n    }\r\n\r\n    private getClass(type: FocusInputType): string | undefined {\r\n        switch (type) {\r\n            case \"keyboard\":\r\n                return this.setup.keybordClass;\r\n            case \"mouse\":\r\n                return this.setup.mouseClass;\r\n            case \"touch\":\r\n                return this.setup.touchClass;\r\n            default:\r\n                return undefined;\r\n        }\r\n    }\r\n    private setClasses(cls: string | undefined, prevCls: string | undefined, callback: () => void) {\r\n        if (!this.#interactions || cls === prevCls) {\r\n            return;\r\n        }\r\n\r\n        this.#interactions.fetch(() => {\r\n            let hasCls = cls && document.body.classList.contains(cls);\r\n            let hasPrevCls = prevCls && document.body.classList.contains(prevCls);\r\n            // @ts-ignore interactions is set\r\n            this.#interactions.mutate(() => {\r\n                if (!hasCls)\r\n                    // @ts-ignore cls is set\r\n                    document.body.classList.add(cls);\r\n                if (hasPrevCls) {\r\n                    // @ts-ignore prevCls is set\r\n                    document.body.classList.remove(prevCls);\r\n                }\r\n                callback();\r\n            }, null)\r\n\r\n        }, null)\r\n    }\r\n\r\n    destroy(): void {\r\n        document.body.removeEventListener('touchstart', this.#onTouchListener);\r\n        document.body.removeEventListener('mousedown', this.#onMouseListener);\r\n        window.removeEventListener('keydown', this.#onKeyDownListener);\r\n    }\r\n\r\n}","import { ICuiEventListener } from \"../../core/models/interfaces\";\r\nimport { is } from \"../../core/utils/functions\";\r\n\r\nexport class CuiKeyPressListener implements ICuiEventListener<KeyboardEvent> {\r\n    #callback: ((t: KeyboardEvent) => void) | undefined;\r\n    #keys: string[];\r\n    #inProgress: boolean;\r\n    #singleEmit: boolean;\r\n    #isAttached: boolean;\r\n\r\n    #onKeyDownBound: (ev: KeyboardEvent) => void;\r\n    #onKeyUpBound: (ev: KeyboardEvent) => void;\r\n\r\n    constructor(singleEmit: boolean, keys?: string[]) {\r\n        this.#inProgress = false;\r\n        this.#singleEmit = true;\r\n        this.#isAttached = false;\r\n        this.#callback = undefined;\r\n        this.#keys = keys ?? [];\r\n\r\n        this.#onKeyDownBound = this.onKeyDown.bind(this);\r\n        this.#onKeyUpBound = this.onKeyUp.bind(this);\r\n    }\r\n\r\n    setCallback(callback: (t: KeyboardEvent) => void): void {\r\n        this.#callback = callback;\r\n    }\r\n\r\n    isInProgress(): boolean {\r\n        return this.#inProgress;\r\n    }\r\n\r\n    attach(): void {\r\n        document.addEventListener('keydown', this.#onKeyDownBound)\r\n        if (this.#singleEmit) {\r\n            document.addEventListener('keyup', this.#onKeyUpBound)\r\n        }\r\n        this.#isAttached = true;\r\n    }\r\n\r\n    detach(): void {\r\n        document.removeEventListener('keydown', this.#onKeyDownBound)\r\n        if (this.#singleEmit) {\r\n            document.addEventListener('keyup', this.#onKeyUpBound)\r\n        }\r\n        this.#isAttached = false;\r\n    }\r\n\r\n    isAttached(): boolean {\r\n        return this.#isAttached;\r\n    }\r\n\r\n    onKeyDown(ev: KeyboardEvent) {\r\n        if (this.#inProgress) {\r\n            return;\r\n        }\r\n        this.#inProgress = true;\r\n        try {\r\n            if ((!is(this.#keys) || this.#keys.includes(ev.code)) && this.#callback) {\r\n                this.#callback(ev);\r\n            }\r\n\r\n        } catch (e) {\r\n            console.error(e)\r\n        } finally {\r\n            if (!this.#singleEmit)\r\n                this.#inProgress = false;\r\n        }\r\n    }\r\n\r\n    onKeyUp(ev: KeyboardEvent) {\r\n        this.#inProgress = false;\r\n    }\r\n}","import { ICuiEventBus } from \"../../core/models/interfaces\";\r\nimport { EVENTS } from \"../../core/utils/statics\";\r\nimport { CuiKeyPressListener } from \"./listener\";\r\n\r\nexport interface KeyDownEvent {\r\n    timestamp: number;\r\n    event: KeyboardEvent;\r\n}\r\nexport interface ICuiKeysObserver {\r\n    connect(): void;\r\n    disconnect(): void;\r\n}\r\nexport class CuiKeysObserver {\r\n    #listener: CuiKeyPressListener;\r\n    #bus: ICuiEventBus\r\n    constructor(bus: ICuiEventBus) {\r\n        this.#bus = bus;\r\n        this.#listener = new CuiKeyPressListener(true);\r\n        this.#listener.setCallback(this.onKeyDown.bind(this))\r\n    }\r\n    connect(): void {\r\n        this.#listener.attach();\r\n    }\r\n    disconnect(): void {\r\n        this.#listener.detach();\r\n    }\r\n\r\n    onKeyDown(ev: KeyboardEvent) {\r\n        this.#bus.emit(EVENTS.KEYDOWN, null, {\r\n            timestamp: Date.now(),\r\n            event: ev\r\n        })\r\n    }\r\n\r\n}","import { ICuiPlugin } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { ICuiKeysObserver, CuiKeysObserver } from \"./observer\";\r\n\r\n\r\nexport interface CuiKeysObserverPluginSetup {\r\n    dummy?: boolean;\r\n}\r\n\r\nexport class CuiKeysObserverPlugin implements ICuiPlugin {\r\n    description: string;\r\n    name: string = 'keys-plugin';\r\n    setup: CuiKeysObserverPluginSetup;\r\n    #keysObserver: ICuiKeysObserver | undefined;\r\n    constructor(keySetup: CuiKeysObserverPluginSetup) {\r\n        this.description = \"CuiKeysObserverPlugin\";\r\n        this.setup = keySetup;\r\n        this.#keysObserver = undefined;\r\n    }\r\n\r\n    init(utils: CuiUtils): void {\r\n        this.#keysObserver = new CuiKeysObserver(utils.bus);\r\n        this.#keysObserver.connect();\r\n    }\r\n\r\n    destroy(): void {\r\n        if (this.#keysObserver)\r\n            this.#keysObserver.disconnect();\r\n    }\r\n}","import { ICuiEventListener } from \"../models/interfaces\";\r\n\r\nexport class CuiMediaQueryListener implements ICuiEventListener<MediaQueryListEvent> {\r\n\r\n    #mediaQuery: string;\r\n    #callback: ((t: MediaQueryListEvent) => void) | undefined;\r\n    #isInitialized: boolean;\r\n    #inProgress: boolean;\r\n\r\n    #onEventBound: (ev: MediaQueryListEvent) => void;\r\n    constructor(mediaQuery: string) {\r\n        this.#mediaQuery = mediaQuery;\r\n        this.#isInitialized = false;\r\n        this.#callback = undefined;\r\n        this.#inProgress = false;\r\n\r\n        this.#onEventBound = this.event.bind(this);\r\n    }\r\n    setCallback(callback: (t: MediaQueryListEvent) => void): void {\r\n        this.#callback = callback;\r\n    }\r\n\r\n    isInProgress(): boolean {\r\n        return this.#inProgress;\r\n    }\r\n    attach(): void {\r\n        if (!window.matchMedia || this.#isInitialized || !this.#mediaQuery) {\r\n            return;\r\n        }\r\n        window.matchMedia(this.#mediaQuery)\r\n            .addEventListener('change', this.#onEventBound)\r\n        this.#isInitialized = true\r\n    }\r\n\r\n    detach(): void {\r\n        if (this.#isInitialized) {\r\n            window.matchMedia(this.#mediaQuery).removeEventListener('change', this.#onEventBound);\r\n            this.#isInitialized = false\r\n        }\r\n    }\r\n\r\n    isAttached(): boolean {\r\n        return this.#isInitialized;\r\n    }\r\n\r\n    private event(ev: MediaQueryListEvent): void {\r\n        if (this.#inProgress || !this.#callback) {\r\n            return\r\n        }\r\n        this.#inProgress = true;\r\n        try {\r\n            this.#callback(ev);\r\n        } catch (e) {\r\n            console.error(e)\r\n        } finally {\r\n            this.#inProgress = false;\r\n        }\r\n    }\r\n}","import { ICuiPlugin } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { getSystemLightMode } from \"../../core/utils/functions\";\r\nimport { CuiMediaQueryListener } from \"../../core/listeners/media\";\r\n\r\nexport interface AutoLightPluginSetup {\r\n    autoLight: boolean;\r\n}\r\n\r\nexport class CuiAutoLightModePlugin implements ICuiPlugin {\r\n    description: string = 'Dark vs Light mode auto switcher';\r\n    name: string = 'auto-light';\r\n    setup: AutoLightPluginSetup;\r\n    #listener: CuiMediaQueryListener | undefined;\r\n    #utils: CuiUtils | undefined;\r\n    constructor(autoLightInit: AutoLightPluginSetup) {\r\n        this.description = \"CuiAutoLightModePlugin\";\r\n        this.setup = autoLightInit;\r\n        this.#utils = undefined;\r\n        this.#listener = undefined\r\n    }\r\n\r\n    init(utils: CuiUtils): void {\r\n        this.#utils = utils\r\n        if (this.setup.autoLight && getSystemLightMode() === 'dark') {\r\n            this.#utils.setLightMode('dark')\r\n        }\r\n        this.#listener = new CuiMediaQueryListener('(prefers-color-scheme: dark)')\r\n        this.#listener.setCallback(this.onChange.bind(this))\r\n        this.#listener.attach();\r\n    }\r\n\r\n    destroy(): void {\r\n        if (this.#listener)\r\n            this.#listener.detach();\r\n    }\r\n\r\n    onChange(ev: MediaQueryListEvent) {\r\n        if (!this.#utils) {\r\n            return;\r\n        }\r\n        let autoLightSetup = this.#utils.setup.plugins[this.description] as AutoLightPluginSetup;\r\n        let autoLight = autoLightSetup?.autoLight ?? false;\r\n        if (autoLight) {\r\n            if (ev.matches) {\r\n                this.#utils.setLightMode('dark')\r\n            } else {\r\n                this.#utils.setLightMode('light')\r\n            }\r\n        }\r\n    }\r\n\r\n}","import { CuiMoveEventListener, ICuiMoveEvent } from \"../../core/listeners/move\";\r\nimport { ICuiEventBus } from \"../../core/models/interfaces\";\r\nimport { EVENTS } from \"../../core/utils/statics\";\r\n\r\nconst DEFAULT_GESTURE_TRESHOLD = 0.3;\r\ntype GlobalMoveGesture = 'up' | 'down' | 'left' | 'right' | 'none'\r\n\r\nexport class CuiMoveObserver {\r\n    #bus: ICuiEventBus;\r\n    #moveListener: CuiMoveEventListener;\r\n    #isLocked: boolean;\r\n    #eventId: string | null;\r\n    #firstEvent: ICuiMoveEvent | undefined;\r\n    #wasFirstEventSend: boolean;\r\n    #gesturesEnabled: boolean;\r\n    constructor(bus: ICuiEventBus, gestures: boolean) {\r\n        this.#bus = bus;\r\n        this.#moveListener = new CuiMoveEventListener();\r\n        this.#moveListener.setCallback(this.onMove.bind(this));\r\n        this.#firstEvent = undefined;\r\n        this.#isLocked = false;\r\n        this.#eventId = null;\r\n        this.#wasFirstEventSend = false;\r\n        this.#gesturesEnabled = gestures;\r\n    }\r\n\r\n    attach() {\r\n        if (!this.#moveListener.isAttached()) {\r\n            this.#moveListener.attach();\r\n            this.#eventId = this.#bus.on(EVENTS.MOVE_LOCK, this.onMoveLock.bind(this))\r\n        }\r\n    }\r\n\r\n    detach() {\r\n        if (this.#moveListener.isAttached()) {\r\n            this.#moveListener.detach();\r\n            this.#eventId != null && this.#bus.detach(EVENTS.MOVE_LOCK, this.#eventId);\r\n        }\r\n\r\n    }\r\n\r\n    isAttached() {\r\n        return this.#moveListener.isAttached();\r\n    }\r\n\r\n    private onMove(data: ICuiMoveEvent) {\r\n        if (this.#isLocked) {\r\n            return;\r\n        }\r\n        switch (data.type) {\r\n            case \"down\":\r\n                this.#firstEvent = data;\r\n                this.#wasFirstEventSend = false\r\n                break;\r\n            case \"move\":\r\n                if (this.#firstEvent && !this.#wasFirstEventSend) {\r\n                    this.#bus.emit(EVENTS.GLOBAL_MOVE, null, this.#firstEvent);\r\n                    this.#wasFirstEventSend = true;\r\n                }\r\n                this.#bus.emit(EVENTS.GLOBAL_MOVE, null, data);\r\n                break;\r\n            case \"up\":\r\n                this.#bus.emit(EVENTS.GLOBAL_MOVE, null, data);\r\n                if (this.#firstEvent) {\r\n                    if (this.#gesturesEnabled) {\r\n                        const { diffX, diffY } = this.getGestureDiff(this.#firstEvent, data);\r\n                        const gesture = this.calculateGesture(diffX, diffY);\r\n                        this.pushGestureEvent(gesture, diffX, diffY);\r\n                    }\r\n                    this.#firstEvent = undefined;\r\n                }\r\n                break;\r\n        }\r\n\r\n    }\r\n\r\n    private onMoveLock(flag: boolean) {\r\n        this.#isLocked = flag;\r\n    }\r\n\r\n    private getGestureDiff(firstEvent: ICuiMoveEvent, lastEvent: ICuiMoveEvent) {\r\n        return {\r\n            diffX: lastEvent.x - firstEvent.x,\r\n            diffY: lastEvent.y - firstEvent.y\r\n        }\r\n    }\r\n\r\n    private calculateGesture(diffX: number, diffY: number): GlobalMoveGesture {\r\n        const tresholdX = window.innerWidth * DEFAULT_GESTURE_TRESHOLD;\r\n        const absDiffX = Math.abs(diffX);\r\n        const absDiffY = Math.abs(diffY);\r\n        if (absDiffX > absDiffY && absDiffX > tresholdX) {\r\n            return diffX > 0 ? \"right\" : \"left\";\r\n        }\r\n        const tresholdY = window.innerHeight * DEFAULT_GESTURE_TRESHOLD;\r\n        if (absDiffY > tresholdY) {\r\n            return diffY > 0 ? \"down\" : 'up';\r\n        }\r\n        return 'none';\r\n    }\r\n\r\n    private pushGestureEvent(type: GlobalMoveGesture, diffX: number, diffY: number) {\r\n        const eventName = this.getGestureEventName(type);\r\n        if (!eventName) {\r\n            return;\r\n        }\r\n        this.#bus.emit(eventName, null, {\r\n            timespstamp: Date.now(),\r\n            changeX: diffX,\r\n            changeY: diffY\r\n        })\r\n\r\n    }\r\n\r\n    private getGestureEventName(type: GlobalMoveGesture): string | null {\r\n        switch (type) {\r\n            case \"up\":\r\n                return EVENTS.GESTURE_UP;\r\n            case 'down':\r\n                return EVENTS.GESTURE_DOWN;\r\n            case \"left\":\r\n                return EVENTS.GESTURE_LEFT;\r\n            case \"right\":\r\n                return EVENTS.GESTURE_RIGHT;\r\n            default:\r\n                return null;\r\n        }\r\n    }\r\n}","import { ICuiPlugin } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiMoveObserver } from \"./observer\";\r\n\r\n\r\nexport class CuiMoveObserverPlugin implements ICuiPlugin {\r\n    description: string;\r\n    name: string = 'move-observer-plugin';\r\n    setup: any;\r\n    #moveObserver: CuiMoveObserver | undefined;\r\n    #gesturesEnabled: boolean;\r\n    constructor(gestures?: boolean) {\r\n        this.description = \"CuiMoveObserverPlugin\";\r\n        this.#moveObserver = undefined;\r\n        this.#gesturesEnabled = gestures === false ? false : true;\r\n    }\r\n\r\n    init(utils: CuiUtils): void {\r\n        this.#moveObserver = new CuiMoveObserver(utils.bus, this.#gesturesEnabled);\r\n        this.#moveObserver.attach();\r\n    }\r\n\r\n    destroy(): void {\r\n        if (this.#moveObserver && this.#moveObserver.isAttached())\r\n            this.#moveObserver.detach();\r\n    }\r\n}","import { IconBuilder } from \"../../core/builders/icon\";\r\nimport { ElementBuilder } from \"../../core/builders/element\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { are, is } from \"../../core/utils/functions\";\r\nimport { CuiNotificationType, ICuiNotification, ICuiNotificationAction } from \"./interfaces\";\r\nimport { CuiLoggerFactory } from \"../../core/factories/logger\";\r\n\r\n\r\n\r\nconst closeIcon = \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 20 20\\\" width=\\\"20\\\" height=\\\"20\\\"><path d=\\\"M 3,3 17,17\\\"></path><path d=\\\"M 17,3 3,17\\\"></path></svg>\";\r\n\r\n\r\nexport default async function getNotification(data: ICuiNotification, utils: CuiUtils, cache: any, onClose: () => void): Promise<HTMLElement | undefined> {\r\n    let prefix = utils.setup.prefix;\r\n\r\n    if (!are(data.title, data.id)) {\r\n        return undefined;\r\n    }\r\n    const parts: ElementBuilder[] = [getHeader(data.title, cache, onClose)];\r\n    if (is(data.message)) {\r\n        //@ts-ignore message is defined\r\n        parts.push(getBody(data.message, cache))\r\n    }\r\n    if (is(data.actions)) {\r\n        //@ts-ignore actions is defined\r\n        parts.push(getFooter(data.actions, cache, onClose));\r\n    }\r\n\r\n    return new ElementBuilder('div').setClasses(cache.NOTIFICATION_CLS, cache.MARGIN_SMALL_VERTICAL, getClassByType(prefix, data.type)).setId(data.id).setRawChildren(...parts).build();\r\n\r\n}\r\n\r\nfunction getHeader(title: string, cache: any, onClose: () => void): ElementBuilder {\r\n    const titleElement = new ElementBuilder('span').setClasses(cache.NOTIFICATION_TITLE_CLS).setTextContent(title);\r\n    const iconCloseElement = new IconBuilder(closeIcon).build();\r\n    const closeElement = new ElementBuilder('a').setClasses(cache.ICON_CLS, cache.NOTIFICATION_CLOSE_CLS).onEvent('click', onClose);\r\n    if (iconCloseElement) {\r\n        closeElement.setChildren(iconCloseElement)\r\n    }\r\n    const header = new ElementBuilder('div').setClasses(cache.NOTIFICATION_HEADER_CLS).setRawChildren(titleElement, closeElement);\r\n    return header;\r\n}\r\n\r\nfunction getBody(message: string, cache: any): ElementBuilder {\r\n    return new ElementBuilder('div').setClasses(cache.NOTIFICATION_BODY_CLS).setRawChildren(new ElementBuilder('div').setTextContent(message));\r\n}\r\n\r\nfunction getFooter(actions: ICuiNotificationAction[], cache: any, onClose: () => void): ElementBuilder {\r\n    return new ElementBuilder('div').setClasses(cache.NOTIFICATION_FOOTER_CLS).setRawChildren(getActionsList(actions, onClose));\r\n}\r\n\r\nfunction getActionsList(actions: ICuiNotificationAction[], onClose: () => void): ElementBuilder {\r\n    return new ElementBuilder('ul').setRawChildren(...actions.map(action => {\r\n        return new ElementBuilder('li').setRawChildren(new ElementBuilder('a').onEvent('click', () => {\r\n            try {\r\n                action.callback();\r\n            } catch (e) {\r\n                const log = CuiLoggerFactory.get(\"Notifications\");\r\n                log.exception(e, \"OnActionClick\");\r\n            } finally {\r\n                onClose();\r\n            }\r\n        }).setTextContent(action.name))\r\n    }));\r\n}\r\n\r\nfunction getClassByType(prefix: string, type?: CuiNotificationType) {\r\n    return `${prefix}-${type ?? 'default'}`;\r\n}","import { ElementBuilder } from \"../../core/builders/element\";\r\nimport { are, replacePrefix } from \"../../core/utils/functions\";\r\nimport { EVENTS } from \"../../core/utils/statics\";\r\nimport { ICuiPlugin } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiActionsHelper } from \"../../core/helpers/helpers\";\r\nimport { CuiClassAction } from \"../../core/utils/actions\";\r\nimport { ElementsHolder, ICuiNotification, ICuiNotificationPluginSetup } from \"./interfaces\";\r\nimport { validateNotificationData } from \"./helpers\";\r\nimport getNotification from \"./builder\";\r\n\r\n\r\nconst CONTAINER_ID = \"notifications-container\";\r\nconst CONTAINER_CLS = \"{prefix}-notification-container\";\r\n\r\nconst NOTIFICATION_CLS = '{prefix}-notification';\r\nconst NOTIFICATION_HEADER_CLS = '{prefix}-notification-header';\r\nconst NOTIFICATION_TITLE_CLS = '{prefix}-notification-title';\r\nconst NOTIFICATION_BODY_CLS = '{prefix}-notification-body';\r\nconst NOTIFICATION_FOOTER_CLS = '{prefix}-notification-footer';\r\nconst NOTIFICATION_ACTIVE_CLS = '{prefix}-active';\r\nconst NOTIFICATION_ICON_CLS = \"{prefix}-notification-icon\";\r\nconst NOTIFICATION_CLOSE_CLS = \"{prefix}-notification-close\";\r\nconst ICON_CLS = \"{prefix}-icon\";\r\n\r\nconst NOTIFICATION_ANIMATION_IN = \"{prefix}-notification-animation-in\";\r\nconst NOTIFICATION_ANIMATION_OUT = \"{prefix}-notification-animation-out\";\r\nconst MARGIN_SMALL_VERTICAL = \"{prefix}-margin-small-vertical\";\r\n\r\n\r\n\r\n\r\n\r\nexport class CuiNotificationPlugin implements ICuiPlugin {\r\n    description: string;\r\n    name: string = 'notification-plugin';\r\n    setup: any;\r\n    #utils: CuiUtils | undefined;\r\n    #container: HTMLElement | null;\r\n    #handleId: string | null;\r\n    #cache: any;\r\n    #holder: ElementsHolder;\r\n    #actionsHelper: CuiActionsHelper | undefined;\r\n    #timeout: number;\r\n\r\n    constructor(setup: ICuiNotificationPluginSetup) {\r\n        this.description = \"CuiNotificationPlugin\";\r\n        this.#container = null;\r\n        this.#utils = undefined;\r\n        this.#handleId = null;\r\n        this.#cache = {};\r\n        this.#holder = {};\r\n        this.#actionsHelper = undefined;\r\n        this.#timeout = setup.timeout ?? 5000;\r\n    }\r\n\r\n    init(utils: CuiUtils): void {\r\n        this.createCache(utils.setup.prefix);\r\n        this.getOrCreateContainer(utils, document.body);\r\n        this.#actionsHelper = new CuiActionsHelper(utils.interactions);\r\n        this.#utils = utils\r\n        this.#handleId = this.#utils.bus.on(EVENTS.NOTIFY, this.onEvent.bind(this), { $cuid: this.name });\r\n    }\r\n\r\n    destroy(): void {\r\n        if (this.#container)\r\n            this.#container.remove();\r\n        if (this.#handleId && this.#utils) {\r\n            this.#utils.bus.detach(EVENTS.NOTIFY, this.#handleId);\r\n        }\r\n    }\r\n\r\n    private onEvent(data: ICuiNotification) {\r\n        if (!validateNotificationData(data) || !this.#utils || !this.#actionsHelper || !this.#container) {\r\n            return;\r\n        }\r\n\r\n        if (this.#holder[data.id]) {\r\n            return;\r\n        }\r\n        // Create element\r\n        getNotification(data, this.#utils, this.#cache, () => {\r\n            this.onNotificationClose(data, false, true);\r\n        }).then(notificationEl => {\r\n            if (!notificationEl) {\r\n                return;\r\n            }\r\n            this.addNotificationToTree(notificationEl)\r\n            // Set timeout function\r\n            let timeoutId = null;\r\n            //  If auto option is not specifically set to false\r\n            if (!(data.auto === false)) {\r\n                timeoutId = this.setAutoClose(data);\r\n            }\r\n            // Setup holder\r\n            this.#holder[data.id] = {\r\n                element: notificationEl,\r\n                timeoutId: timeoutId\r\n            }\r\n            // Call open\r\n            this.act(notificationEl, this.#cache.NOTIFICATION_ANIMATION_IN).then(() => {\r\n                notificationEl.classList.add(this.#cache.NOTIFICATION_ACTIVE_CLS);\r\n            });\r\n        });\r\n    }\r\n\r\n    private setAutoClose(data: ICuiNotification): any {\r\n        return setTimeout(() => {\r\n            this.onNotificationClose(data, true, false);\r\n        }, this.#timeout);\r\n    }\r\n\r\n    private addNotificationToTree(notifiactionElement: HTMLElement) {\r\n        //@ts-ignore utils is defined\r\n        this.#utils.interactions.mutate(() => {\r\n            // Add to DOM treee\r\n            //@ts-ignore container is defined\r\n            if (this.#container.children.length === 0) {\r\n                //@ts-ignore container is defined\r\n                this.#container.appendChild(notifiactionElement)\r\n            } else {\r\n                //@ts-ignore container is defined\r\n                this.#container.insertBefore(notifiactionElement, this.#container.firstChild);\r\n            }\r\n        }, null)\r\n    }\r\n\r\n    private onNotificationClose(notification: ICuiNotification, fromTimeout: boolean, dissmissed: boolean) {\r\n        if (!notification || !this.#actionsHelper || !this.#utils) {\r\n            return;\r\n        }\r\n        const holder = this.#holder[notification.id];\r\n        if (!holder) {\r\n            return;\r\n        }\r\n\r\n        if (!fromTimeout) {\r\n            clearTimeout(holder.timeoutId);\r\n        }\r\n\r\n        this.act(holder.element, this.#cache.NOTIFICATION_ANIMATION_OUT).then(() => {\r\n            // @ts-ignore utils is defined\r\n            this.#utils.bus.emit(EVENTS.NOTIFIED, null, { ...notification, dissmissed: dissmissed })\r\n            holder.element.remove();\r\n            delete this.#holder[notification.id];\r\n        })\r\n    }\r\n\r\n    private getOrCreateContainer(utils: CuiUtils, root: HTMLElement) {\r\n        this.#container = document.getElementById(CONTAINER_ID);\r\n        if (!this.#container) {\r\n            this.#container = new ElementBuilder('div').setClasses(replacePrefix(CONTAINER_CLS, utils.setup.prefix)).build();\r\n            root.appendChild(this.#container);\r\n        }\r\n    }\r\n\r\n    private createCache(prefix: string) {\r\n        this.#cache = {\r\n            \"NOTIFICATION_CLS\": replacePrefix(NOTIFICATION_CLS, prefix),\r\n            \"NOTIFICATION_HEADER_CLS\": replacePrefix(NOTIFICATION_HEADER_CLS, prefix),\r\n            \"NOTIFICATION_TITLE_CLS\": replacePrefix(NOTIFICATION_TITLE_CLS, prefix),\r\n            \"NOTIFICATION_BODY_CLS\": replacePrefix(NOTIFICATION_BODY_CLS, prefix),\r\n            \"NOTIFICATION_FOOTER_CLS\": replacePrefix(NOTIFICATION_FOOTER_CLS, prefix),\r\n            \"NOTIFICATION_ACTIVE_CLS\": replacePrefix(NOTIFICATION_ACTIVE_CLS, prefix),\r\n            \"NOTIFICATION_ANIMATION_IN\": replacePrefix(NOTIFICATION_ANIMATION_IN, prefix),\r\n            \"NOTIFICATION_ANIMATION_OUT\": replacePrefix(NOTIFICATION_ANIMATION_OUT, prefix),\r\n            \"NOTIFICATION_ICON_CLS\": replacePrefix(NOTIFICATION_ICON_CLS, prefix),\r\n            \"NOTIFICATION_CLOSE_CLS\": replacePrefix(NOTIFICATION_CLOSE_CLS, prefix),\r\n            \"ICON_CLS\": replacePrefix(ICON_CLS, prefix),\r\n            \"MARGIN_SMALL_VERTICAL\": replacePrefix(MARGIN_SMALL_VERTICAL, prefix),\r\n        }\r\n    }\r\n\r\n    async act(element: HTMLElement, animationClass: string, timeout?: number): Promise<boolean> {\r\n        //@ts-ignore utils is ignored\r\n        const delay = timeout ?? this.#utils.setup.animationTime;\r\n        const action = new CuiClassAction(animationClass);\r\n        //@ts-ignore actionsHelper is defined\r\n        return this.#actionsHelper.performAction(element, action, delay ?? 0);\r\n    }\r\n\r\n}","import { are, is } from \"../../core/utils/functions\";\r\nimport { ICuiNotification } from \"./interfaces\";\r\n\r\nexport function validateNotificationData(data: ICuiNotification): boolean {\r\n    return is(data) && are(data.id, data.title);\r\n}","import { ICuiPlugin } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { getSystemPrintMode } from \"../../core/utils/functions\";\r\nimport { CuiMediaQueryListener } from \"../../core/listeners/media\";\r\n\r\nexport interface AutoPrintPluginSetup {\r\n    autoPrint: boolean;\r\n}\r\n\r\nexport class CuiAutoPrintModePlugin implements ICuiPlugin {\r\n    description: string = 'Auto print mode';\r\n    name: string = 'auto-print';\r\n    setup: AutoPrintPluginSetup;\r\n    #listener: CuiMediaQueryListener | undefined;\r\n    #utils: CuiUtils | undefined;\r\n    constructor(autoPrintInit: AutoPrintPluginSetup) {\r\n        this.description = \"CuiAutoPrintModePlugin\";\r\n        this.setup = autoPrintInit;\r\n        this.#listener = undefined;\r\n        this.#utils = undefined;\r\n    }\r\n\r\n    init(utils: CuiUtils): void {\r\n        this.#utils = utils;\r\n        if (this.setup.autoPrint && getSystemPrintMode()) {\r\n            this.#utils.setPrintMode(true)\r\n        }\r\n        this.#listener = new CuiMediaQueryListener('print')\r\n        this.#listener.setCallback(this.onChange.bind(this))\r\n        this.#listener.attach();\r\n    }\r\n\r\n    destroy(): void {\r\n        if (this.#listener)\r\n            this.#listener.detach();\r\n    }\r\n\r\n    onChange(ev: MediaQueryListEvent) {\r\n        if (!this.#utils) {\r\n            return;\r\n        }\r\n        this.setup = this.#utils.setup.plugins[this.description] as AutoPrintPluginSetup;\r\n        let autoPrint = this.setup?.autoPrint ?? false;\r\n        if (autoPrint) {\r\n            if (ev.matches) {\r\n                this.#utils.setPrintMode(true)\r\n            } else {\r\n                this.#utils.setPrintMode(false)\r\n            }\r\n        }\r\n    }\r\n\r\n}","import { getRangeValue, is, isInRange, } from \"../utils/functions\";\r\nimport { CuiColorError } from \"./errors\";\r\n\r\nexport class CuiColor {\r\n    #red: number;\r\n    #green: number;\r\n    #blue: number;\r\n    #alpha: number;\r\n    constructor(red: number, green: number, blue: number, alpha?: number) {\r\n        this.#red = 0;\r\n        this.#blue = 0;\r\n        this.#green = 0;\r\n        this.#alpha = 0\r\n        this.set(red, green, blue, alpha);\r\n    }\r\n\r\n    static create(colorStr: string): CuiColor {\r\n        if (!is(colorStr)) {\r\n            throw new CuiColorError(`Given color value is not in a valid format`)\r\n        }\r\n        let parser: ColorParser;\r\n        if (colorStr.startsWith(\"#\")) {\r\n            parser = new HexColorParser(colorStr);\r\n        } else if (colorStr.startsWith(\"rgb\")) {\r\n            parser = new RgbColorParser(colorStr);\r\n        } else {\r\n            throw new CuiColorError(\"Unknown color string format\");\r\n        }\r\n        let res = parser.parse();\r\n        if (!res) {\r\n            throw new CuiColorError(\"Color was not parsed\");\r\n        }\r\n        return res;\r\n    }\r\n\r\n    set(red: number, green: number, blue: number, alpha?: number) {\r\n        this.#alpha = getRangeValue(alpha ?? 1, 0, 1);\r\n        this.#blue = getRangeValue(blue, 0, 255);\r\n        this.#red = getRangeValue(red, 0, 255);\r\n        this.#green = getRangeValue(green, 0, 255);\r\n    }\r\n\r\n    setRed(red: number) {\r\n        this.#red = getRangeValue(red, 0, 255);\r\n    }\r\n\r\n    setGreen(green: number) {\r\n        this.#green = getRangeValue(green, 0, 255);\r\n    }\r\n\r\n    setBlue(blue: number) {\r\n        this.#blue = getRangeValue(blue, 0, 255);\r\n    }\r\n\r\n    opacity(val: number): CuiColor {\r\n        this.#alpha = getRangeValue(val, 0, 1);\r\n        return this;\r\n    }\r\n\r\n    lighten(amount: number): CuiColor {\r\n        this.shade(amount)\r\n        return this;\r\n    }\r\n\r\n    darken(amount: number): CuiColor {\r\n        this.shade(-amount);\r\n        return this;\r\n    }\r\n\r\n    invert(): CuiColor {\r\n        this.#blue = 255 - this.#blue;\r\n        this.#red = 255 - this.#red;\r\n        this.#green = 255 - this.#green;\r\n        return this;\r\n    }\r\n\r\n    getColorValue(type: string): number {\r\n        const t = type ? type.toLowerCase() : '#'\r\n        switch (type) {\r\n            case 'red':\r\n                return this.#red;\r\n            case 'green':\r\n                return this.#green;\r\n            case 'blue':\r\n                return this.#blue;\r\n            case 'alpha':\r\n                return this.#alpha;\r\n        }\r\n        return -1\r\n    }\r\n\r\n    toCssString(): string {\r\n        return `rgba(${this.#red}, ${this.#green}, ${this.#blue}, ${this.#alpha})`;\r\n    }\r\n\r\n    private shade(percent: number, self: boolean = true) {\r\n        this.#red = this.shadeSingle(this.#red, percent, self);\r\n        this.#green = this.shadeSingle(this.#green, percent, self);\r\n        this.#blue = this.shadeSingle(this.#blue, percent, self);\r\n    }\r\n\r\n    private shadeSingle(val: number, percent: number, self: boolean = true) {\r\n        let rel = self ? val : 255;\r\n        let prop = (rel * percent) / 100\r\n        let newVal = val + Math.round(prop);\r\n        return getRangeValue(newVal, 0, 255);\r\n    }\r\n\r\n    clone() {\r\n        return new CuiColor(this.#red, this.#green, this.#blue, this.#alpha)\r\n    }\r\n}\r\n\r\nexport interface CuiColorSet {\r\n    base: CuiColor,\r\n    muted?: CuiColor,\r\n    active?: CuiColor\r\n}\r\n\r\nexport interface CuiColorTheme {\r\n    base: string,\r\n    muted: string,\r\n    active: string\r\n}\r\n\r\nexport interface CuiColorPair {\r\n    light: string,\r\n    dark: string\r\n}\r\n\r\n\r\ninterface ColorParser {\r\n    trim(): void;\r\n    isValid(): boolean;\r\n    parse(): CuiColor | undefined;\r\n}\r\n\r\nexport class HexColorParser implements ColorParser {\r\n    #colorStr: string;\r\n    constructor(colorStr: string) {\r\n        this.#colorStr = colorStr;\r\n    }\r\n\r\n    trim(): void {\r\n        this.#colorStr = this.#colorStr ? this.#colorStr.trim() : \"\";\r\n        return\r\n    }\r\n\r\n    isValid(): boolean {\r\n        return is(this.#colorStr) && this.#colorStr.startsWith(\"#\")\r\n    }\r\n    parse(): CuiColor | undefined {\r\n        let red: number = 0;\r\n        let blue: number = 0;\r\n        let green: number = 0;\r\n        let alpha: number = 1;\r\n        let length = this.#colorStr.length;\r\n        if (this.#colorStr.length === 4) {\r\n            red = parseInt(this.#colorStr[1] + this.#colorStr[1], 16);\r\n            green = parseInt(this.#colorStr[2] + this.#colorStr[2], 16);\r\n            blue = parseInt(this.#colorStr[3] + this.#colorStr[3], 16);\r\n        } else {\r\n            red = parseInt(this.#colorStr[1] + this.#colorStr[2], 16);\r\n            green = parseInt(this.#colorStr[3] + this.#colorStr[4], 16);\r\n            blue = parseInt(this.#colorStr[5] + this.#colorStr[6], 16);\r\n\r\n            if (length > 7) {\r\n                let alphaHex = parseInt(this.#colorStr[7] + this.#colorStr[8], 16);\r\n                alpha = parseFloat((alphaHex / 255).toFixed(2));\r\n            }\r\n        }\r\n        return new CuiColor(red, green, blue, alpha);\r\n    }\r\n}\r\n\r\nexport class RgbColorParser implements ColorParser {\r\n    #colorStr: string;\r\n\r\n    constructor(colorStr: string) {\r\n        this.#colorStr = colorStr;\r\n    }\r\n\r\n    trim(): void {\r\n        this.#colorStr = is(this.#colorStr) ? this.#colorStr.trim() : \"\";\r\n    }\r\n\r\n    isValid(): boolean {\r\n        return is(this.#colorStr) && this.#colorStr.startsWith(\"rgb\");\r\n    }\r\n\r\n    parse(): CuiColor | undefined {\r\n        let len = this.#colorStr.length;\r\n        let str = this.#colorStr.startsWith(\"rgba\") ? this.#colorStr.substring(5, len - 1) : this.#colorStr.substring(4, len - 1);\r\n        let split = str.split(\",\");\r\n        if (!isInRange(split.length, 3, 4)) {\r\n            return undefined;\r\n        }\r\n        let red: number = parseInt(split[0]);\r\n        let green: number = parseInt(split[1]);\r\n        let blue: number = parseInt(split[2]);\r\n        let alpha: number = split.length === 4 ? parseFloat(split[3]) : 1\r\n        return new CuiColor(red, green, blue, alpha);\r\n    }\r\n}","\r\nimport { CuiColor } from \"../../core/models/colors\";\r\nimport { CSS_VARIABLES } from \"../../core/utils/statics\";\r\nimport { PropertySet, PropertySetter } from \"./setter\";\r\n\r\ninterface BaseColorSet {\r\n    background: string;\r\n    base: string;\r\n    active: string;\r\n    muted: string;\r\n    // border: string;\r\n}\r\n\r\nexport interface BaseColors {\r\n    background: CuiColor;\r\n    base: CuiColor;\r\n    active: CuiColor;\r\n    muted: CuiColor;\r\n    // border: string;\r\n}\r\n\r\ninterface ThemeColorSet {\r\n    base: string;\r\n    muted: string;\r\n    active: string;\r\n    shade: string;\r\n    shadeDark: string;\r\n}\r\n\r\ninterface ThemeColors {\r\n    base: CuiColor;\r\n    muted: CuiColor;\r\n    active: CuiColor;\r\n    shade: CuiColor;\r\n    shadeDark: CuiColor;\r\n}\r\n\r\ninterface BaseColorSets {\r\n    [id: string]: BaseColorSet;\r\n}\r\n\r\ninterface ThemeColorSets {\r\n    [id: string]: ThemeColorSet;\r\n}\r\n\r\nconst baseColorSets: BaseColorSets = {\r\n    \"light\": {\r\n        background: CSS_VARIABLES.colorLightBackground,\r\n        base: CSS_VARIABLES.colorLightBase,\r\n        active: CSS_VARIABLES.colorLightActive,\r\n        muted: CSS_VARIABLES.colorLightMuted,\r\n        //  border: CSS_VARIABLES.colorLightBorder,\r\n    },\r\n    \"dark\": {\r\n        background: CSS_VARIABLES.colorDarkBackground,\r\n        base: CSS_VARIABLES.colorDarkBase,\r\n        active: CSS_VARIABLES.colorDarkActive,\r\n        muted: CSS_VARIABLES.colorDarkMuted,\r\n        // border: CSS_VARIABLES.colorLightBorder,\r\n    }\r\n}\r\n\r\nconst themeColors: ThemeColorSets = {\r\n    'accent': {\r\n        base: CSS_VARIABLES.colorAccent,\r\n        muted: CSS_VARIABLES.colorAccentMuted,\r\n        active: CSS_VARIABLES.colorAccentActive,\r\n        shade: CSS_VARIABLES.colorAccentShade,\r\n        shadeDark: CSS_VARIABLES.colorAccentShadeDark\r\n    },\r\n    'secondary': {\r\n        base: CSS_VARIABLES.colorSecondary,\r\n        muted: CSS_VARIABLES.colorSecondaryMuted,\r\n        active: CSS_VARIABLES.colorSecondaryActive,\r\n        shade: CSS_VARIABLES.colorSecondaryShade,\r\n        shadeDark: CSS_VARIABLES.colorSecondaryShadeDark\r\n    },\r\n    'error': {\r\n        base: CSS_VARIABLES.colorError,\r\n        muted: CSS_VARIABLES.colorErrorMuted,\r\n        active: CSS_VARIABLES.colorErrorActive,\r\n        shade: CSS_VARIABLES.colorErrorShade,\r\n        shadeDark: CSS_VARIABLES.colorErrorShadeDark\r\n    },\r\n    'warning': {\r\n        base: CSS_VARIABLES.colorWarning,\r\n        muted: CSS_VARIABLES.colorWarningMuted,\r\n        active: CSS_VARIABLES.colorWarningActive,\r\n        shade: CSS_VARIABLES.colorWarningShade,\r\n        shadeDark: CSS_VARIABLES.colorWarningShadeDark\r\n    },\r\n    'success': {\r\n        base: CSS_VARIABLES.colorSuccess,\r\n        muted: CSS_VARIABLES.colorSuccessMuted,\r\n        active: CSS_VARIABLES.colorSuccessActive,\r\n        shade: CSS_VARIABLES.colorSuccessShade,\r\n        shadeDark: CSS_VARIABLES.colorSuccessShadeDark\r\n    }\r\n}\r\n\r\n\r\nexport class CuiBaseColorsSetter {\r\n    #set: BaseColorSet;\r\n    #setter: PropertySetter;\r\n    constructor(colorSet: string, setter: PropertySetter) {\r\n        this.#set = baseColorSets[colorSet];\r\n        this.#setter = setter;\r\n    }\r\n\r\n    setBackgroundColor(color: CuiColor) {\r\n        this.setColor(this.#set.background, color);\r\n    }\r\n\r\n    setBaseColor(color: CuiColor) {\r\n        this.setColor(this.#set.base, color);\r\n    }\r\n\r\n    setActiveColor(color: CuiColor) {\r\n        this.setColor(this.#set.active, color);\r\n    }\r\n\r\n    setMutedColor(color: CuiColor) {\r\n        this.setColor(this.#set.muted, color);\r\n    }\r\n\r\n    setBaseColors(colors: BaseColors) {\r\n        if (!this.#set) {\r\n            return;\r\n        }\r\n        let set: PropertySet = {}\r\n        set[this.#set.background] = colors.background ? colors.background.toCssString() : \"\";\r\n        set[this.#set.active] = colors.active ? colors.active.toCssString() : \"\";\r\n        set[this.#set.muted] = colors.muted ? colors.muted.toCssString() : \"\";\r\n        set[this.#set.base] = colors.base ? colors.base.toCssString() : \"\";\r\n\r\n        this.#setter.setProperties(set);\r\n    }\r\n\r\n    private setColor(color: string, value: CuiColor) {\r\n        this.#setter.setProperty(color, value.toCssString());\r\n    }\r\n}\r\n\r\n\r\nexport class CuiThemeColorsSetter {\r\n    #setter: PropertySetter;\r\n    #set: ThemeColorSet;\r\n    constructor(set: string, setter: PropertySetter) {\r\n        this.#setter = setter;\r\n        this.#set = themeColors[set];\r\n    }\r\n\r\n    setBaseColor(color: CuiColor) {\r\n        this.setColor(this.#set.base, color);\r\n    }\r\n\r\n    setMutedColor(color: CuiColor) {\r\n        this.setColor(this.#set.muted, color);\r\n    }\r\n\r\n    setActiveColor(color: CuiColor) {\r\n        this.setColor(this.#set.active, color);\r\n    }\r\n\r\n    setShadeColor(color: CuiColor) {\r\n        this.setColor(this.#set.shade, color);\r\n    }\r\n\r\n    setShadeDarkColor(color: CuiColor) {\r\n        this.setColor(this.#set.shadeDark, color);\r\n    }\r\n\r\n    setColors(colors: ThemeColors) {\r\n        if (!this.#set) {\r\n            return;\r\n        }\r\n        let set: PropertySet = {}\r\n        set[this.#set.shade] = colors.shade ? colors.shade.toCssString() : \"\";\r\n        set[this.#set.shadeDark] = colors.shadeDark ? colors.shadeDark.toCssString() : \"\";\r\n        set[this.#set.active] = colors.active ? colors.active.toCssString() : \"\";\r\n        set[this.#set.muted] = colors.muted ? colors.muted.toCssString() : \"\";\r\n        set[this.#set.base] = colors.base ? colors.base.toCssString() : \"\";\r\n\r\n        this.#setter.setProperties(set);\r\n    }\r\n\r\n    setAutoColors(base: CuiColor) {\r\n        let set: PropertySet = {}\r\n        set[this.#set.base] = base.toCssString();\r\n        set[this.#set.shade] = base.lighten(30).toCssString();\r\n        set[this.#set.shadeDark] = base.darken(30).toCssString();\r\n        set[this.#set.active] = base.darken(10).toCssString();\r\n        set[this.#set.muted] = base.lighten(10).toCssString();\r\n        this.#setter.setProperties(set);\r\n    }\r\n\r\n    private setColor(color: string, value: CuiColor) {\r\n        this.#setter.setProperty(color, value.toCssString());\r\n    }\r\n\r\n}","import { CuiUtils } from \"../../core/models/utils\";\r\nimport { are, is } from \"../../core/utils/functions\";\r\n\r\nexport interface PropertySet {\r\n    [property: string]: string;\r\n}\r\nexport class PropertySetter {\r\n    #utils: CuiUtils;\r\n    constructor(utils: CuiUtils) {\r\n        this.#utils = utils;\r\n    }\r\n\r\n    setProperty(property: string, value: string) {\r\n        if (!are(property, value)) {\r\n            return;\r\n        }\r\n        this.#utils.interactions.mutate(() => {\r\n            this.#utils.setProperty(property, value)\r\n        }, null)\r\n    }\r\n\r\n    setProperties(set: PropertySet) {\r\n        if (!is(set)) {\r\n            return;\r\n        }\r\n        this.#utils.interactions.mutate(() => {\r\n            for (let property in set) {\r\n                if (is(set[property]))\r\n                    this.#utils.setProperty(property, set[property])\r\n            }\r\n        }, null)\r\n    }\r\n}","import { CuiColor } from \"../../core/models/colors\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { is } from \"../../core/utils/functions\";\r\nimport { CSS_VARIABLES } from \"../../core/utils/statics\";\r\nimport { CuiBaseColorsSetter, CuiThemeColorsSetter } from \"./colors\";\r\nimport { PropertySetter } from \"./setter\";\r\n\r\nexport class CuiPropertiesHandler {\r\n    #setter: PropertySetter;\r\n    constructor(utils: CuiUtils) {\r\n        this.#setter = new PropertySetter(utils);\r\n    }\r\n\r\n    /**\r\n     * Sets main font size\r\n     * @param {number} value numeric value\r\n     * @param {string} unit optional - size unit, px if not provided\r\n     */\r\n    setBaseFontSize(value: number, unit?: string) {\r\n        this.setBaseUnitValue(CSS_VARIABLES.fontSize, value, unit);\r\n    }\r\n\r\n    /**\r\n     * Sets base animation time\r\n     * @param {number} value - time value\r\n     * @param {string} unit  - optional - ms is passed when no provided\r\n     */\r\n    setAnimationTime(value: number, unit?: string) {\r\n        this.setBaseUnitValue(CSS_VARIABLES.animationTime, value, unit ?? 'ms');\r\n    }\r\n\r\n    /**\r\n    * Sets long animation time\r\n    * @param {number} value - time value\r\n    * @param {string} unit  - optional - ms is passed when no provided\r\n    */\r\n    setAnimationTimeLong(value: number, unit?: string) {\r\n        this.setBaseUnitValue(CSS_VARIABLES.setAnimationTimeLong, value, unit ?? 'ms');\r\n    }\r\n\r\n    /**\r\n    * Sets short animation time\r\n    * @param {number} value - time value\r\n    * @param {string} unit  - optional - ms is passed when no provided\r\n    */\r\n    setAnimationTimeShort(value: number, unit?: string) {\r\n        this.setBaseUnitValue(CSS_VARIABLES.setAnimationTimeShort, value, unit ?? 'ms');\r\n    }\r\n\r\n    /**\r\n    * Sets main line size\r\n    * @param {number} value numeric value\r\n    * @param {string} unit optional - size unit, px if not provided\r\n    */\r\n    setBaseLineHeight(value: number, unit?: string) {\r\n        this.setBaseUnitValue(CSS_VARIABLES.lineHeight, value, unit);\r\n    }\r\n\r\n    /**\r\n     * Sets base margin value\r\n     * @param {number} value - margin value\r\n     * @param {string} unit - optional - margin unit (px default)\r\n     */\r\n    setBaseMargin(value: number, unit?: string) {\r\n        this.setBaseUnitValue(CSS_VARIABLES.margin, value, unit)\r\n    }\r\n\r\n    /**\r\n    * Sets base padding value\r\n    * @param {number} value - padding value\r\n    * @param {string} unit - optional - padding unit (px default)\r\n    */\r\n    setBasePadding(value: number, unit?: string) {\r\n        this.setBaseUnitValue(CSS_VARIABLES.padding, value, unit)\r\n    }\r\n\r\n    /**\r\n    * Sets base border radius\r\n    * @param {number} value - border value\r\n    * @param {string} unit - optional - border unit (px default)\r\n    */\r\n    setBaseBorderRadius(value: number, unit?: string) {\r\n        this.setBaseUnitValue(CSS_VARIABLES.borderRadius, value, unit)\r\n    }\r\n\r\n    /**\r\n   * Sets component space\r\n   * @param {number} value - space value\r\n   * @param {string} unit - optional - space unit (px default)\r\n   */\r\n    setComponentSpace(value: number, unit?: string) {\r\n        this.setBaseUnitValue(CSS_VARIABLES.componentSpace, value, unit)\r\n    }\r\n\r\n    /**\r\n     * Sets new accordion chevron icon\r\n     * @param value A SVG formatted to be replaced default value\r\n     */\r\n    setAccordionIcon(value: string) {\r\n        if (!is(value)) {\r\n            return;\r\n        }\r\n        this.setCSSVariable(CSS_VARIABLES.accordionIcon, value);\r\n    }\r\n\r\n    /**\r\n    * Sets a scrollbar width\r\n    * @param value A SVG formatted to be replaced default value\r\n    */\r\n    setScrollbarWidth(value: number, unit?: string) {\r\n        this.setBaseUnitValue(CSS_VARIABLES.scrollbarWidth, value, unit);\r\n    }\r\n\r\n    /**\r\n     * Sets app viewport light background color\r\n     * @param color color to be set\r\n     */\r\n    setAppBackgroundColor(color: CuiColor) {\r\n        if (!is(color)) {\r\n            return;\r\n        }\r\n        this.setCSSVariable(CSS_VARIABLES.colorLightAppBackground, color.toCssString());\r\n    }\r\n\r\n    /**\r\n    * Sets app viewport dark background color\r\n    * @param color color to be set\r\n    */\r\n    setDarkAppBackgroundColor(color: CuiColor) {\r\n        if (!is(color)) {\r\n            return;\r\n        }\r\n        this.setCSSVariable(CSS_VARIABLES.colorDarkAppBackground, color.toCssString());\r\n    }\r\n\r\n    getBaseColorsSetter(): CuiBaseColorsSetter {\r\n        return new CuiBaseColorsSetter(\"light\", this.#setter)\r\n    }\r\n\r\n    getDarkBaseColorsSetter(): CuiBaseColorsSetter {\r\n        return new CuiBaseColorsSetter(\"dark\", this.#setter)\r\n    }\r\n\r\n    getAccentThemeColorsSetter(): CuiThemeColorsSetter {\r\n        return new CuiThemeColorsSetter(\"accent\", this.#setter);\r\n    }\r\n\r\n    getSecondaryThemeColorsSetter(): CuiThemeColorsSetter {\r\n        return new CuiThemeColorsSetter(\"secondary\", this.#setter);\r\n    }\r\n\r\n    getErrorThemeColorsSetter(): CuiThemeColorsSetter {\r\n        return new CuiThemeColorsSetter(\"error\", this.#setter);\r\n    }\r\n\r\n    getWarningThemeColorsSetter(): CuiThemeColorsSetter {\r\n        return new CuiThemeColorsSetter(\"warning\", this.#setter);\r\n    }\r\n\r\n    getSuccessThemeColorsSetter(): CuiThemeColorsSetter {\r\n        return new CuiThemeColorsSetter(\"success\", this.#setter);\r\n    }\r\n\r\n    /**\r\n     * Sets property in interactive way\r\n     * @param {string} name property name - value of {prefix} is replaced by current prefix\r\n     * @param {string} value - property value\r\n     */\r\n    setCSSVariable(name: string, value: string) {\r\n        this.#setter.setProperty(name, value);\r\n    }\r\n\r\n    /**\r\n     * Sets unit type CSS variable property\r\n     * @param name Variable name\r\n     * @param value numeric value\r\n     * @param unit unit - optional - px is default value\r\n     */\r\n    private setBaseUnitValue(name: string, value: number, unit?: string) {\r\n        if (!is(value)) {\r\n            return;\r\n        }\r\n        let strVal = `${value}${unit ?? \"px\"}`;\r\n        this.setCSSVariable(name, strVal);\r\n    }\r\n}","import { ICuiLogger, ICuiPlugin } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiColor } from \"../../core/models/colors\";\r\nimport { CuiLoggerFactory } from \"../../core/factories/logger\";\r\nimport { is } from \"../../core/utils/functions\";\r\nimport { CuiPropertiesHandler } from \"./handler\";\r\nexport interface CssChangeEvent {\r\n    method: string,\r\n    arg: any\r\n}\r\nexport interface CuiCSSVariablesPluginSetup {\r\n\r\n}\r\n\r\nexport class CuiCSSVariablesPlugin implements ICuiPlugin {\r\n    description: string;\r\n    name: string = 'css-variables-plugin';\r\n    setup: CuiCSSVariablesPluginSetup;\r\n    handler: CuiPropertiesHandler | undefined;\r\n    #log: ICuiLogger;\r\n    constructor(keySetup: CuiCSSVariablesPluginSetup) {\r\n        this.description = \"CuiCSSVariablesPlugin\";\r\n        this.setup = keySetup;\r\n        this.#log = CuiLoggerFactory.get(\"CuiCSSVariablesPlugin\");\r\n        this.handler = undefined;\r\n\r\n    }\r\n\r\n    init(utils: CuiUtils): void {\r\n        this.handler = new CuiPropertiesHandler(utils);\r\n        utils.bus.on(\"csschange\", this.onCssChange.bind(this))\r\n    }\r\n\r\n    destroy(): void {\r\n\r\n    }\r\n\r\n    onCssChange(event: CssChangeEvent) {\r\n        if (!this.handler) {\r\n            return;\r\n        }\r\n        let setter = null;\r\n        let accentSetter = null;\r\n\r\n        switch (event.method) {\r\n            case \"baseFontSize\":\r\n                if (!this.isArgNumber(event.arg)) return;\r\n                this.handler.setBaseFontSize(event.arg.value, event.arg.unit);\r\n                break;\r\n            case \"baseLineHeight\":\r\n                if (!this.isArgNumber(event.arg)) return;\r\n                this.handler.setBaseLineHeight(event.arg.value, event.arg.unit);\r\n                break;\r\n            case \"animationTime\":\r\n                if (!this.isArgNumber(event.arg)) return;\r\n                this.handler.setAnimationTime(event.arg.value, event.arg.unit);\r\n                break;\r\n            case \"animationTimeLong\":\r\n                if (!this.isArgNumber(event.arg)) return;\r\n                this.handler.setAnimationTimeLong(event.arg.value, event.arg.unit);\r\n                break;\r\n            case \"animationTimeShort\":\r\n                if (!this.isArgNumber(event.arg)) return;\r\n                this.handler.setAnimationTimeShort(event.arg.value, event.arg.unit);\r\n                break;\r\n            case \"margin\":\r\n                if (!this.isArgNumber(event.arg)) return;\r\n                this.handler.setBaseMargin(event.arg.value, event.arg.unit);\r\n                break;\r\n            case \"padding\":\r\n                if (!this.isArgNumber(event.arg)) return;\r\n                this.handler.setBasePadding(event.arg.value, event.arg.unit);\r\n                break;\r\n            case \"borderRadius\":\r\n                if (!this.isArgNumber(event.arg)) return;\r\n                this.handler.setBaseBorderRadius(event.arg.value, event.arg.unit);\r\n                break;\r\n            case \"componentSpace\":\r\n                if (!this.isArgNumber(event.arg)) return;\r\n                this.handler.setComponentSpace(event.arg.value, event.arg.unit);\r\n                break;\r\n            case \"scrollbarWidth\":\r\n                if (!this.isArgNumber(event.arg)) return;\r\n                this.handler.setScrollbarWidth(event.arg.value, event.arg.unit);\r\n                break;\r\n            case \"accordionIcon\":\r\n                if (!is(event.arg)) return;\r\n                this.handler.setAccordionIcon(event.arg);\r\n                break;\r\n            case \"appLightBackground\":\r\n                if (!is(event.arg)) return;\r\n                this.handler.setAppBackgroundColor(CuiColor.create(event.arg));\r\n                break;\r\n            case \"appDarkBackground\":\r\n                if (!is(event.arg)) return;\r\n                this.handler.setDarkAppBackgroundColor(CuiColor.create(event.arg));\r\n                break;\r\n            case \"appDarkBackground\":\r\n                if (!is(event.arg)) return;\r\n                this.handler.setDarkAppBackgroundColor(CuiColor.create(event.arg));\r\n                break;\r\n            case \"mainColorBackground\":\r\n                if (!this.isArgColor(event.arg)) return;\r\n                setter = this.getBaseColorSetter(event.arg.palette);\r\n                if (setter)\r\n                    setter.setBackgroundColor(CuiColor.create(event.arg.color))\r\n                break;\r\n            case \"mainColor\":\r\n                if (!this.isArgColor(event.arg)) return;\r\n                setter = this.getBaseColorSetter(event.arg.palette);\r\n                if (setter)\r\n                    setter.setBaseColor(CuiColor.create(event.arg.color))\r\n                break;\r\n            case \"mainColorMuted\":\r\n                if (!this.isArgColor(event.arg)) return;\r\n                setter = this.getBaseColorSetter(event.arg.palette);\r\n                if (setter)\r\n                    setter.setMutedColor(CuiColor.create(event.arg.color))\r\n                break;\r\n            case \"mainColorActive\":\r\n                if (!this.isArgColor(event.arg)) return;\r\n                setter = this.getBaseColorSetter(event.arg.palette);\r\n                if (setter)\r\n                    setter.setActiveColor(CuiColor.create(event.arg.color))\r\n                break;\r\n            case \"themeAutoColor\":\r\n                if (!this.isArgColor(event.arg)) return;\r\n                accentSetter = this.getAccentColorSetter(event.arg.palette);\r\n                if (accentSetter)\r\n                    accentSetter.setAutoColors(CuiColor.create(event.arg.color))\r\n            case \"themeBaseColor\":\r\n                if (!this.isArgColor(event.arg)) return;\r\n                accentSetter = this.getAccentColorSetter(event.arg.palette);\r\n                if (accentSetter)\r\n                    accentSetter.setAutoColors(CuiColor.create(event.arg.color))\r\n            case \"themeMutedColor\":\r\n                if (!this.isArgColor(event.arg)) return;\r\n                accentSetter = this.getAccentColorSetter(event.arg.palette);\r\n                if (accentSetter)\r\n                    accentSetter.setMutedColor(CuiColor.create(event.arg.color))\r\n            case \"themeActiveColor\":\r\n                if (!this.isArgColor(event.arg)) return;\r\n                accentSetter = this.getAccentColorSetter(event.arg.palette);\r\n                if (accentSetter)\r\n                    accentSetter.setActiveColor(CuiColor.create(event.arg.color))\r\n\r\n            case \"themeShadeColor\":\r\n                if (!this.isArgColor(event.arg)) return;\r\n                accentSetter = this.getAccentColorSetter(event.arg.palette);\r\n                if (accentSetter)\r\n                    accentSetter.setShadeColor(CuiColor.create(event.arg.color))\r\n            case \"themeShadeDarkColor\":\r\n                if (!this.isArgColor(event.arg)) return;\r\n                accentSetter = this.getAccentColorSetter(event.arg.palette);\r\n                if (accentSetter)\r\n                    accentSetter.setShadeDarkColor(CuiColor.create(event.arg.color))\r\n            default:\r\n                this.#log.warning(\"Unknown event method\", \"onCssChange\");\r\n        }\r\n    }\r\n\r\n    private isArgNumber(arg: any): boolean {\r\n        return is(arg) && is(arg.value);\r\n    }\r\n\r\n    private isArgColor(arg: any) {\r\n        return is(arg) && is(arg.palette) && is(arg.color);\r\n    }\r\n\r\n    private getBaseColorSetter(pallete: string) {\r\n        if (!this.handler) {\r\n            return undefined;\r\n        }\r\n        let prerp = pallete.trim().toLowerCase();\r\n        switch (prerp) {\r\n            case \"light\":\r\n                return this.handler.getBaseColorsSetter();\r\n            case \"dark\":\r\n                return this.handler.getDarkBaseColorsSetter();\r\n        }\r\n    }\r\n\r\n    private getAccentColorSetter(pallete: string) {\r\n        if (!this.handler) {\r\n            return undefined;\r\n        }\r\n        let prerp = pallete.trim().toLowerCase();\r\n        switch (prerp) {\r\n            case \"accent\":\r\n                return this.handler.getAccentThemeColorsSetter();\r\n            case \"secondary\":\r\n                return this.handler.getSecondaryThemeColorsSetter();\r\n            case \"error\":\r\n                return this.handler.getErrorThemeColorsSetter();\r\n            case \"warning\":\r\n                return this.handler.getWarningThemeColorsSetter();\r\n            case \"success\":\r\n                return this.handler.getSuccessThemeColorsSetter();\r\n            default:\r\n                return undefined;\r\n        }\r\n    }\r\n}\r\n","import { CuiWindowSize } from \"../../core/utils/types\";\r\nimport { calcWindowSize, calcWindowSize2 } from \"../../core/utils/functions\";\r\nimport { ICuiEventBus } from \"../../core/models/interfaces\";\r\nimport { EVENTS } from \"../../core/utils/statics\";\r\n\r\nexport interface ICuiResizable {\r\n    resize(data: CuiResizeData): Promise<boolean>;\r\n}\r\n\r\nexport interface ICuiResizableObserver {\r\n    observe(target: ICuiResizable): void;\r\n    unobserve(target: ICuiResizable): void;\r\n    connect(): void;\r\n    disconnect(): void;\r\n}\r\n\r\nexport interface CuiResizeData {\r\n    current: CuiWindowSize;\r\n    previous: CuiWindowSize;\r\n    width: number;\r\n    height: number;\r\n    timestamp: number;\r\n}\r\n\r\nexport class CuiResizeObserver implements ICuiResizableObserver {\r\n\r\n    #items: ICuiResizable[];\r\n    #promises: Promise<boolean>[];\r\n    #prevYValue: number;\r\n    #inProgress: boolean;\r\n    #previousSize: CuiWindowSize;\r\n    #threshold: number;\r\n    #bus: ICuiEventBus;\r\n    #listenerBoundCall: (ev: UIEvent) => void;\r\n    constructor(bus: ICuiEventBus, threshold?: number) {\r\n        this.#items = [];\r\n        this.#promises = [];\r\n        this.#prevYValue = window.innerWidth;\r\n        this.#inProgress = false;\r\n        this.#previousSize = calcWindowSize(window.innerWidth)\r\n        this.#threshold = threshold ?? 0;\r\n        this.#bus = bus;\r\n        this.#listenerBoundCall = this.listener.bind(this);\r\n    }\r\n\r\n    observe(target: ICuiResizable): void {\r\n        let idx = this.#items.findIndex(x => x === target)\r\n        if (idx < 0) {\r\n            this.#items.push(target);\r\n        }\r\n    }\r\n\r\n    unobserve(target: ICuiResizable): void {\r\n        let idx = this.#items.findIndex(x => x === target)\r\n        if (idx >= 0) {\r\n            this.#items.splice(idx, 1)\r\n        }\r\n    }\r\n    connect(): void {\r\n        window.addEventListener('resize', this.#listenerBoundCall)\r\n    }\r\n\r\n    disconnect(): void {\r\n        window.removeEventListener('resize', this.#listenerBoundCall)\r\n    }\r\n\r\n    private pushUpdateToItems(resizeData: CuiResizeData) {\r\n        if (this.#items.length < 1) {\r\n            return;\r\n        }\r\n        this.#promises = [];\r\n        this.#items.forEach(x => {\r\n            this.#promises.push(x.resize(resizeData))\r\n        })\r\n        Promise.all(this.#promises)\r\n        this.#promises = [];\r\n    }\r\n\r\n    private listener(ev: UIEvent) {\r\n        if (this.#inProgress) {\r\n            return;\r\n        }\r\n        this.#inProgress = true\r\n        const diff = window.innerWidth - this.#prevYValue;\r\n\r\n        if (Math.abs(diff) >= this.#threshold) {\r\n            const currentSize = calcWindowSize2(window.innerWidth);\r\n            if (currentSize !== this.#previousSize) {\r\n                const resizeData: CuiResizeData = {\r\n                    current: currentSize,\r\n                    previous: this.#previousSize,\r\n                    width: window.innerWidth,\r\n                    height: window.innerHeight,\r\n                    timestamp: Date.now()\r\n                };\r\n                this.#bus.emit(EVENTS.RESIZE, \"\", resizeData)\r\n                this.pushUpdateToItems(resizeData);\r\n\r\n                this.#previousSize = currentSize;\r\n            }\r\n        }\r\n        this.#inProgress = false\r\n    }\r\n\r\n\r\n}","import { ICuiPlugin } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { ICuiResizableObserver, CuiResizeObserver } from \"./observer\";\r\n\r\nexport interface CuiResizeObserverPluginSetup {\r\n    resizeThreshold?: number;\r\n}\r\n\r\nexport class CuiResizeObserverPlugin implements ICuiPlugin {\r\n    description: string;\r\n    name: string = 'resize-observer-plugin';\r\n    setup: any;\r\n    #resizeObserver: ICuiResizableObserver | undefined;\r\n\r\n    constructor(setup: CuiResizeObserverPluginSetup) {\r\n        this.description = \"CuiResizeObserverPlugin\";\r\n        this.#resizeObserver = undefined;\r\n        this.setup = setup\r\n    }\r\n\r\n    init(utils: CuiUtils): void {\r\n        this.#resizeObserver = new CuiResizeObserver(utils.bus, this.setup.resizeThreshold ?? 20);\r\n        this.#resizeObserver.connect();\r\n    }\r\n\r\n    destroy(): void {\r\n        if (this.#resizeObserver)\r\n            this.#resizeObserver.disconnect();\r\n    }\r\n}","import { IUIInteractionProvider } from \"../../core/models/interfaces\";\r\nimport { is, sleep } from \"../../core/utils/functions\";\r\nimport { CLASSES } from \"../../core/utils/statics\";\r\n\r\nexport class CuiToastHandler {\r\n    #interactions: IUIInteractionProvider;\r\n    #selector: string;\r\n    #className: string;\r\n    #activeCls: string;\r\n    #animationTime: number;\r\n    #lock: boolean;\r\n    #animClsIn: string;\r\n    #animClsOut: string;\r\n    constructor(interaction: IUIInteractionProvider, prefix: string, animationTime: number) {\r\n        this.#interactions = interaction;\r\n        this.#selector = `.${prefix}-toast`;\r\n        this.#className = `${prefix}-toast`;\r\n        this.#activeCls = `${prefix}-active`;\r\n        this.#animationTime = animationTime;\r\n        this.#lock = false;\r\n        this.#animClsIn = `${prefix}-toast-animation-in`;\r\n        this.#animClsOut = `${prefix}-toast-animation-out`\r\n    }\r\n\r\n    async show(message: string): Promise<boolean> {\r\n        if (this.#lock) {\r\n            return false;\r\n        }\r\n        this.#lock = true;\r\n        let toastElement = document.querySelector(this.#selector);\r\n        if (!is(toastElement)) {\r\n            toastElement = document.createElement('div');\r\n            toastElement.classList.add(this.#className);\r\n            document.body.appendChild(toastElement);\r\n            await sleep(10);\r\n        }\r\n\r\n        this.#interactions.mutate(() => {\r\n            //@ts-ignore\r\n            toastElement.textContent = message;\r\n            //@ts-ignore\r\n            toastElement.classList.add(CLASSES.animProgress);\r\n            //@ts-ignore\r\n            toastElement.classList.add(this.#animClsIn);\r\n        }, this);\r\n\r\n        await sleep(this.#animationTime);\r\n        this.#interactions.mutate(() => {\r\n            //@ts-ignore\r\n            toastElement.classList.remove(CLASSES.animProgress);\r\n            //@ts-ignore\r\n            toastElement.classList.remove(this.#animClsIn);\r\n            //@ts-ignore\r\n            toastElement.classList.add(this.#activeCls);\r\n        }, this)\r\n        await sleep(3000);\r\n        this.#interactions.mutate(() => {\r\n            //@ts-ignore\r\n            toastElement.classList.add(CLASSES.animProgress);\r\n            //@ts-ignore\r\n            toastElement.classList.add(this.#animClsOut);\r\n        }, this)\r\n\r\n        setTimeout(() => {\r\n            this.#interactions.mutate(() => {\r\n                //@ts-ignore\r\n                toastElement.classList.remove(CLASSES.animProgress);\r\n                //@ts-ignore\r\n                toastElement.classList.remove(this.#animClsOut);\r\n                //@ts-ignore\r\n                toastElement.classList.remove(this.#activeCls);\r\n            }, this)\r\n            this.#lock = false;\r\n        }, this.#animationTime);\r\n        return true;\r\n    }\r\n}","import { EVENTS } from \"../../core/utils/statics\";\r\nimport { ICuiPlugin } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiToastHandler } from \"./handler\";\r\n\r\nexport interface CuiToastPluginSetup {\r\n\r\n}\r\n\r\nexport class CuiToastPlugin implements ICuiPlugin {\r\n    description: string;\r\n    name: string = 'toast-plugin';\r\n    setup: any;\r\n    #toastHandler: CuiToastHandler | undefined;\r\n    #eventId: string | null;\r\n    #utils: CuiUtils | undefined;\r\n    constructor(setup: CuiToastPluginSetup) {\r\n        this.description = \"CuiToastPlugin\";\r\n        this.setup = setup;\r\n        this.#toastHandler = undefined;\r\n        this.#eventId = null;\r\n        this.#utils = undefined;\r\n    }\r\n\r\n    init(utils: CuiUtils): void {\r\n        this.#utils = utils;\r\n        if (!this.#toastHandler) {\r\n            this.#toastHandler = new CuiToastHandler(utils.interactions, utils.setup.prefix, utils.setup.animationTime ?? 300);\r\n        }\r\n\r\n        this.#eventId = utils.bus.on(EVENTS.TOAST, this.onToastShow.bind(this), { $cuid: this.name });\r\n    }\r\n\r\n    destroy(): void {\r\n        if (this.#utils && this.#eventId) {\r\n            this.#utils.bus.detach(EVENTS.TOAST, this.#eventId);\r\n            this.#eventId = null;\r\n        }\r\n    }\r\n\r\n    private onToastShow(message: string) {\r\n        if (!this.#toastHandler || !this.#utils) {\r\n            return;\r\n        }\r\n        this.#utils.bus.emit(EVENTS.TOAST_SHOW, null, []);\r\n        this.#toastHandler.show(message).then(() => {\r\n            if (this.#utils)\r\n                this.#utils.bus.emit(EVENTS.TOAST_HIDDEN, null, []);\r\n        })\r\n    }\r\n}","import { CuiInit } from './app/init';\r\n\r\nexport const CUI_LIGHT_VERSION = \"0.3.7\";\r\n\r\ndeclare global {\r\n    interface Window {\r\n        cuiInit: CuiInit;\r\n    }\r\n}\r\n\r\nexport { CuiInstance } from './app/instance';\r\nwindow.cuiInit = new CuiInit();","import { ICuiPlugin, ICuiComponent } from \"../core/models/interfaces\";\r\nimport { is } from \"../core/utils/functions\";\r\nimport { CuiInitData, CuiInitializer } from \"./initializer\";\r\nimport { GetComponents } from \"../components/module\";\r\nimport { GetPlugins } from \"../plugins/module\"\r\n\r\n\r\nexport class CuiInit {\r\n    #isInitialized: boolean;\r\n    constructor() {\r\n        this.#isInitialized = false;\r\n    }\r\n\r\n    async init(data: CuiInitData): Promise<boolean> {\r\n        if (this.#isInitialized) {\r\n            console.log(\"Module is already initialized\")\r\n            return false;\r\n        }\r\n        const initializer = new CuiInitializer();\r\n        const pluginList: ICuiPlugin[] = GetPlugins({\r\n            autoLight: true,\r\n            autoPrint: true\r\n        });\r\n\r\n        const componentList: ICuiComponent[] = GetComponents({\r\n            prefix: data.setup?.prefix\r\n        })\r\n        let appPlugins = pluginList;\r\n        if (data.plugins) {\r\n            appPlugins = { ...pluginList, ...data.plugins }\r\n        }\r\n\r\n        let result = await initializer.init({\r\n            ...data,\r\n            plugins: appPlugins,\r\n            // @ts-ignore already checked\r\n            components: is(data.components) ? [...componentList, ...data.components] : componentList,\r\n        })\r\n        if (result.result) {\r\n            this.#isInitialized = true;\r\n            return true;\r\n        } else {\r\n            console.error(`A cUI instance failed to initialize: [${result.message ?? \"#\"}]`);\r\n        }\r\n        console.log(\"Cui Light failed to init\")\r\n        return false;\r\n\r\n    }\r\n}","import { ICuiPlugin } from \"../core/models/interfaces\";\r\nimport { CuiAlertsPlugin } from \"./alert/alert\";\r\nimport { CuiWindowClickPlugin } from \"./click/click\";\r\nimport { CuiLightFocusPlugin, ICuiLightFocusPluginSetup } from \"./focus/focus\";\r\nimport { CuiKeysObserverPlugin } from \"./keys/keys\";\r\nimport { CuiAutoLightModePlugin } from \"./light/light\";\r\nimport { CuiMoveObserverPlugin } from \"./move/move\";\r\nimport { CuiNotificationPlugin } from \"./notification/notification\";\r\nimport { CuiAutoPrintModePlugin } from \"./print/print\";\r\nimport { CuiCSSVariablesPlugin } from \"./properties/properties\";\r\nimport { CuiResizeObserverPlugin } from \"./resize/resize\";\r\nimport { CuiToastPlugin } from \"./toast/toast\";\r\n\r\nexport interface CuiPluginsInit {\r\n    autoLight: boolean;\r\n    autoPrint: boolean;\r\n    notifcationTimeout?: number;\r\n    focusSetup?: ICuiLightFocusPluginSetup;\r\n}\r\n\r\nexport function GetPlugins(init: CuiPluginsInit): ICuiPlugin[] {\r\n    let light: boolean = init ? init.autoLight : true;\r\n    let print: boolean = init ? init.autoPrint : true;\r\n    return [\r\n        new CuiAutoLightModePlugin({ autoLight: light }),\r\n        new CuiAutoPrintModePlugin({ autoPrint: print }),\r\n        new CuiKeysObserverPlugin({}),\r\n        new CuiWindowClickPlugin(),\r\n        new CuiCSSVariablesPlugin({}),\r\n        new CuiMoveObserverPlugin(),\r\n        new CuiResizeObserverPlugin({}),\r\n        new CuiToastPlugin({}),\r\n        new CuiAlertsPlugin(),\r\n        new CuiNotificationPlugin({ timeout: init.notifcationTimeout }),\r\n        new CuiLightFocusPlugin(init.focusSetup ?? {})\r\n\r\n    ]\r\n}","import { ICuiComponent } from \"../core/models/interfaces\";\r\nimport { CuiAccordionComponent } from \"./accordion/accordion\";\r\nimport { CuiBanerComponent } from \"./banner/banner\";\r\nimport { CuiCircleComponent } from \"./circle/circle\";\r\nimport { CuiCloseComponent } from \"./close/close\";\r\nimport { CuiCoverComponent } from \"./cover/cover\";\r\nimport { CuiDialogComponent } from \"./dialog/dialog\";\r\nimport { CuiDropComponenet } from \"./drop/drop\";\r\nimport { CuiFloatComponent } from \"./float/float\";\r\nimport { CuiIconComponent } from \"./icon/icon\";\r\nimport { CuiIntersectionComponent } from \"./intersection/intersection\";\r\nimport { CuiOffCanvasComponent } from \"./offcanvas/offcanvas\";\r\nimport { CuiOffsetComponent } from \"./offset/offset\";\r\nimport { CuiOpenComponent } from \"./open/open\";\r\nimport { CuiResizeComponent } from \"./resize/resize\";\r\nimport { CuiScrollComponent } from \"./scroll/scroll\";\r\nimport { CuiScrollspyComponent } from \"./scrollspy/scrollspy\";\r\nimport { CuiSortableComponent } from \"./sortable/sortable\";\r\nimport { CuiSpinnerComponent } from \"./spinner/spinner\";\r\nimport { CuiSliderComponent } from \"./switch/slider\";\r\nimport { CuiSwitchComponent } from \"./switch/switch\";\r\nimport { CuiSwitcherComponent } from \"./switch/switcher\";\r\nimport { CuiToggleComponent } from \"./toggle/toggle\";\r\nimport { CuiTooltipComponent } from \"./tooltip/tooltip\";\r\n\r\nexport interface ComponentsModuleAttributes {\r\n    prefix?: string;\r\n}\r\n\r\n\r\n/**\r\n * Function that initializes and returns all components available in package\r\n * @param attributes - object holding data needed for components initialization\r\n */\r\nexport function GetComponents(attributes: ComponentsModuleAttributes): ICuiComponent[] {\r\n    let prefix = attributes?.prefix;\r\n    return [\r\n        new CuiIconComponent(prefix),\r\n        new CuiTooltipComponent(prefix),\r\n        new CuiCircleComponent(prefix),\r\n        new CuiSpinnerComponent(prefix),\r\n        new CuiScrollComponent(prefix),\r\n        new CuiScrollspyComponent(prefix),\r\n        new CuiIntersectionComponent(prefix),\r\n        new CuiOpenComponent(prefix),\r\n        new CuiCloseComponent(prefix),\r\n        new CuiToggleComponent(prefix),\r\n        new CuiDialogComponent(prefix),\r\n        new CuiOffCanvasComponent(prefix),\r\n        new CuiAccordionComponent(prefix),\r\n        new CuiDropComponenet(prefix),\r\n        new CuiOffsetComponent(prefix),\r\n        new CuiSwitchComponent(prefix),\r\n        new CuiSwitcherComponent(prefix),\r\n        new CuiFloatComponent(prefix),\r\n        new CuiSliderComponent(prefix),\r\n        new CuiBanerComponent(prefix),\r\n        new CuiCoverComponent(prefix),\r\n        new CuiSortableComponent(prefix),\r\n        new CuiResizeComponent(prefix),\r\n    ]\r\n}"],"sourceRoot":""}