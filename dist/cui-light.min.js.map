{"version":3,"sources":["webpack://cuiLight/webpack/universalModuleDefinition","webpack://cuiLight/webpack/bootstrap","webpack://cuiLight/./src/core/models/errors.ts","webpack://cuiLight/./src/core/utils/statics.ts","webpack://cuiLight/./src/core/utils/functions.ts","webpack://cuiLight/./src/core/models/setup.ts","webpack://cuiLight/./src/core/development/console.ts","webpack://cuiLight/./src/core/development/factory.ts","webpack://cuiLight/./src/core/api/functions.ts","webpack://cuiLight/./src/core/observers/mutations.ts","webpack://cuiLight/./src/core/utils/interactions.ts","webpack://cuiLight/./src/core/queue/queue.ts","webpack://cuiLight/./src/core/bus/handlers.ts","webpack://cuiLight/./src/core/bus/executors.ts","webpack://cuiLight/./src/core/bus/bus.ts","webpack://cuiLight/./src/core/styles/appender.ts","webpack://cuiLight/./src/core/models/core.ts","webpack://cuiLight/./src/core/factories/interactions.ts","webpack://cuiLight/./src/core/helpers/helpers.ts","webpack://cuiLight/./src/core/utils/actions.ts","webpack://cuiLight/./src/app/managers/element.ts","webpack://cuiLight/./src/app/managers/plugins.ts","webpack://cuiLight/./src/core/api/handler.ts","webpack://cuiLight/./src/app/instance.ts","webpack://cuiLight/./src/core/animation/definitions.ts","webpack://cuiLight/./src/app/initializer.ts","webpack://cuiLight/./src/plugins/base.ts","webpack://cuiLight/./src/core/builders/element.ts","webpack://cuiLight/./src/plugins/alert/builder.ts","webpack://cuiLight/./src/plugins/alert/handler.ts","webpack://cuiLight/./src/plugins/alert/alert.ts","webpack://cuiLight/./src/plugins/focus/focus.ts","webpack://cuiLight/./src/plugins/keys/listener.ts","webpack://cuiLight/./src/plugins/keys/observer.ts","webpack://cuiLight/./src/core/listeners/media.ts","webpack://cuiLight/./src/plugins/light/light.ts","webpack://cuiLight/./src/core/listeners/move.ts","webpack://cuiLight/./src/plugins/move/observer.ts","webpack://cuiLight/./src/core/builders/icon.ts","webpack://cuiLight/./src/plugins/notification/builder.ts","webpack://cuiLight/./src/plugins/notification/notification.ts","webpack://cuiLight/./src/plugins/notification/helpers.ts","webpack://cuiLight/./src/plugins/print/print.ts","webpack://cuiLight/./src/plugins/resize/observer.ts","webpack://cuiLight/./src/plugins/resize/resize.ts","webpack://cuiLight/./src/plugins/toast/handler.ts","webpack://cuiLight/./src/plugins/toast/toast.ts","webpack://cuiLight/./src/core/utils/dictionary.ts","webpack://cuiLight/./src/core/handlers/extensions/handler.ts","webpack://cuiLight/./src/core/handlers/extensions/facades.ts","webpack://cuiLight/./src/core/handlers/base.ts","webpack://cuiLight/./src/core/utils/arguments.ts","webpack://cuiLight/./src/components/extensions/click/click.ts","webpack://cuiLight/./src/components/base.ts","webpack://cuiLight/./src/core/utils/aria.ts","webpack://cuiLight/./src/components/extensions/move/performer.ts","webpack://cuiLight/./src/components/extensions/performers.ts","webpack://cuiLight/./src/components/extensions/event/event.ts","webpack://cuiLight/./src/components/accordion/accordion.ts","webpack://cuiLight/./src/core/animation/animators.ts","webpack://cuiLight/./src/core/animation/factory.ts","webpack://cuiLight/./src/core/animation/engine.ts","webpack://cuiLight/./src/core/animation/calculators.ts","webpack://cuiLight/./src/components/banner/banner.ts","webpack://cuiLight/./src/components/circle/circle.ts","webpack://cuiLight/./src/components/close/close.ts","webpack://cuiLight/./src/components/extensions/keys/keys.ts","webpack://cuiLight/./src/components/extensions/keys/performer.ts","webpack://cuiLight/./src/components/extensions/helpers/helpers.ts","webpack://cuiLight/./src/core/utils/parsers/keys.ts","webpack://cuiLight/./src/components/cover/cover.ts","webpack://cuiLight/./src/components/extensions/window/performer.ts","webpack://cuiLight/./src/components/dialog/dialog.ts","webpack://cuiLight/./src/core/listeners/hover.ts","webpack://cuiLight/./src/core/position/evaluator.ts","webpack://cuiLight/./src/core/position/calculator.ts","webpack://cuiLight/./src/core/utils/task.ts","webpack://cuiLight/./src/components/extensions/hover/hover.ts","webpack://cuiLight/./src/components/drop/drop.ts","webpack://cuiLight/./src/components/float/helpers.ts","webpack://cuiLight/./src/components/extensions/listener/listener.ts","webpack://cuiLight/./src/components/extensions/move/move.ts","webpack://cuiLight/./src/components/float/float.ts","webpack://cuiLight/./src/components/icon/icon.ts","webpack://cuiLight/./src/components/offcanvas/offcanvas.ts","webpack://cuiLight/./src/components/offset/modes.ts","webpack://cuiLight/./src/core/models/elements.ts","webpack://cuiLight/./src/core/listeners/scroll.ts","webpack://cuiLight/./src/components/extensions/scroll/scroll.ts","webpack://cuiLight/./src/components/extensions/scroll/performers.ts","webpack://cuiLight/./src/components/offset/performer.ts","webpack://cuiLight/./src/components/offset/offset.ts","webpack://cuiLight/./src/components/open/open.ts","webpack://cuiLight/./src/components/parallax/animator.ts","webpack://cuiLight/./src/components/extensions/mutations/mutations.ts","webpack://cuiLight/./src/components/extensions/mutations/performer.ts","webpack://cuiLight/./src/components/parallax/parallax.ts","webpack://cuiLight/./src/core/observers/intersection.ts","webpack://cuiLight/./src/components/resize/calculator.ts","webpack://cuiLight/./src/components/resize/resize.ts","webpack://cuiLight/./src/components/extensions/observer/observer.ts","webpack://cuiLight/./src/components/extensions/click/performer.ts","webpack://cuiLight/./src/components/scroll/scroll.ts","webpack://cuiLight/./src/components/extensions/switch/switch.ts","webpack://cuiLight/./src/components/scroll/helper.ts","webpack://cuiLight/./src/components/scroll/perform.ts","webpack://cuiLight/./src/components/scroll/switch.ts","webpack://cuiLight/./src/components/scrollspy/mode.ts","webpack://cuiLight/./src/components/scrollspy/scrollspy.ts","webpack://cuiLight/./src/core/handlers/drag/detectors.ts","webpack://cuiLight/./src/components/sortable/sortable.ts","webpack://cuiLight/./src/components/spinner/spinner.ts","webpack://cuiLight/./src/components/switch/slider.ts","webpack://cuiLight/./src/components/switch/switch.ts","webpack://cuiLight/./src/components/switch/switcher.ts","webpack://cuiLight/./src/components/toggle/toggle.ts","webpack://cuiLight/./src/components/tooltip/tooltip.ts","webpack://cuiLight/./src/app/init.ts","webpack://cuiLight/./src/plugins/module.ts","webpack://cuiLight/./src/plugins/keys/keys.ts","webpack://cuiLight/./src/plugins/click/click.ts","webpack://cuiLight/./src/plugins/move/move.ts","webpack://cuiLight/./src/components/module.ts","webpack://cuiLight/./src/index.ts"],"names":["root","factory","exports","module","define","amd","window","installedModules","__webpack_require__","moduleId","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","ErrorBase","Error","message","super","setPrototypeOf","this","ItemNotFoundError","ArgumentError","CuiInstanceInitError","RegisterElementError","AnimatorError","CSSVariableError","CuiPositionError","CLASSES","ATTRIBUTES","ICONS","close","accordion","special_menu","special_fail","special_success","CSS_VARIABLES","freeze","fontSize","lineHeight","animationTime","animationTimeLong","animationTimeShort","colorLightAppBackground","colorLightBackground","colorLightBorder","colorLightBase","colorLightActive","colorLightMuted","colorDarkAppBackground","colorDarkBackground","colorDarkBorder","colorDarkBase","colorDarkActive","colorDarkMuted","colorAccent","colorAccentActive","colorAccentMuted","colorAccentShade","colorAccentShadeDark","colorSecondary","colorSecondaryActive","colorSecondaryMuted","colorSecondaryShade","colorSecondaryShadeDark","colorWarning","colorWarningActive","colorWarningMuted","colorWarningShade","colorWarningShadeDark","colorSuccess","colorSuccessActive","colorSuccessMuted","colorSuccessShade","colorSuccessShadeDark","colorError","colorErrorActive","colorErrorMuted","colorErrorShade","colorErrorShadeDark","inputBackground","colorShade","colorShadeDarker","colorShadeLight","colorShadeLighter","outline","borderRadius","padding","margin","scrollbarWidth","componentSpace","accordionIcon","STATICS","logLevel","prefix","EVENTS","INSTANCE_INITIALIZED","INSTANCE_FINISHED","RESIZE","OPEN","OPENED","CLOSE","CLOSED","TOGGLE","TOGGLED","SWITCH","SWITCHED","ON_SCROLL","TARGET_CHANGE","INTERSECTION","KEYDOWN","SCROLLBY","WINDOW_CLICK","OFFSET","PROGRESS_CHANGE","PROGRESS_CHANGED","CHANGE","CHANGED","GLOBAL_MOVE","MOVE_LOCK","PAUSE","PAUSED","SORTED","SORT_START","TOAST","TOAST_SHOW","TOAST_HIDDEN","ALERT","GESTURE_DOWN","GESTURE_UP","GESTURE_LEFT","GESTURE_RIGHT","NOTIFY","NOTIFIED","COMPONENTS_COUNTER","idx","counter","CuiRAF","requestAnimationFrame","webkitRequestAnimationFrame","f","setTimeout","is","val","typecheck","length","Array","isArray","isEmpty","getName","sleep","timeout","Promise","resolve","getRangeValue","min","max","getRangeValueOrDefault","def","isNaN","joinAttributesForQuery","attributes","join","are","calcWindowSize","width","size","splitText","text","splitBy","split","parseAttributeString","attribute","ret","out","startsWith","endsWith","JSON","parse","jsonify","e","console","error","component","functionName","Date","toLocaleString","parseJsonString","trim","includes","forEach","pair","sp","splitColon","tag","replace","parseSingleAttribute","getOffsetTop","element","offsetTop","parseInt","getStyleValue","getIntOrDefault","integer","parseFloat","target","currentStyle","getComputedStyle","getPropertyValue","isInRange","parseAttribute","getAttribute","isStringTrue","toLowerCase","replacePrefix","getRandomInt","Math","ceil","floor","random","getParentCuiElement","parent","parentElement","$cuid","getChildrenHeight","height","from","children","child","getBoundingClientRect","enumerateObject","callback","prop","calculateNextIndex","currentIndex","totalLength","shift","getEnumOrDefault","defVal","values","joinWithScopeSelector","getChildSelectorFromScoped","scopedSelector","isInViewport","rect","top","left","bottom","innerHeight","document","documentElement","clientHeight","right","innerWidth","clientWidth","queryAll","selector","querySelectorAll","getCuiElementsBySelector","reduce","result","item","push","CuiSetup","autoLightMode","scrollThreshold","resizeThreshold","plugins","body","parallaxAnimations","init","cacheSize","CuiSetupInit","app","interaction","busSetup","undefined","development","_name","_cuid","_level","cuid","log","prepString","type","logByType","warn","stack","id","level","debug","warning","devTool","getMatchingComponents","node","components","filter","hasAttribute","createCuiElement","core","next","generateCUID","tagName","setAttribute","createComponent","destroyCuiElement","$handlers","destroyComponent","args","handler","handle","updateComponent","refresh","destroy","_observer","_plugins","_options","_element","_log","_components","_core","_queryString","subtree","childList","attributeFilter","MutationObserver","mutationCallback","observe","disconnect","mutations","observer","mutation","attributeName","handeComponentUpdate","handleChildListMutation","onMutation","then","catch","exception","addedLen","addedNodes","removedLen","removedNodes","handleAddedNodes","handleRemovedNodes","nodes","handleAddedNode","hasChildNodes","handleAddedChildren","matchingComponents","handleDestroyChildren","_isScheduled","_writes","_reads","_limit","_reportCallback","ctx","createTask","schedule","tasks","task","recursion","flush","rec","writes","reads","run","isRunning","CuiQueue","adapter","_lock","_items","_adapter","_comparer","_onError","index","findIndex","_item","compare","splice","item1","item2","items","getItemsForFlush","onFlush","callError","queue","onError","events","add","SimpleEventEmitHandlerAdapter","executor","_executor","event","idMatches","execute","TaskedEventEmitHandlerAdapter","promises","all","CuiEventEmitHandlerFactory","emitId","handleId","CuiCallbackExecutor","emitHandler","_events","_eventHandler","cui","rand","rand2","generateRandomString","isAttached","getCuid","ev","callbacks","evId","evValue","setup","_buses","_last","sort","first","second","priority","initBusInstance","mapEvents","eventsDef","on","detach","detachAll","emit","isSubscribing","detachByCuid","busName","handlerName","current","interactions","style","head","getElementsByTagName","createElement","createTextNode","appendChild","initialSetup","fromInit","errorReport","fastDom","onInteractionError","bus","styleAppender","classes","classList","contains","mutate","remove","flag","setProperty","find","plugin","getActionsHelper","performActions","actions","x","onFinish","_interactions","action","inTarget","outTarget","inAction","outAction","className","CuiInboundAction","setLightMode","setDarkMode","getLightMode","_attributeName","_attributeValue","removeAttribute","el","DummyAction","utils","substring","map","single","elements","_elements","_isLocked","_logger","_cDt","now","_actionsHelper","fetch","attr","attributeValue","onClick","addEventListener","eventName","lock","unlock","actionStr","animationClass","act","animate","delay","performAction","ids","cuiElement","disposeId","_mutated","description","matching","_rootElement","_mutationObserver","_mutatedAttributes","_api","initElements","setComponents","setAttributes","setPlugins","start","stop","querySelector","arg","data","cuiArg","argArr","addCuiArgument","SWIPE_ANIMATIONS_DEFINITIONS","transform","translateX","to","unit","previous","fade","opacity","initIcons","icons","icon","initSwipeAnimations","swipeAnimations","animation","initInstance","settings","checkIfExists","CuiPlugin","_onDestroy","_callback","_extensions","forEachExtension","extension","finish","getPluginEventExtension","_utils","_handleId","getCui","getPluginListenerExtension","listener","attach","_tag","_classes","_attributes","_id","_text","_children","_rawChildren","_evName","innerHTML","textContent","raw","build","reverse","switches","title","headerBuilder","setClasses","titleElement","getPrefixedString","appendChildrens","dialog","setId","container","str","onYes","onNo","onCancel","onOk","content","closeStr","iconStr","getElementById","updateElement","onClose","state","dialogBuilder","createHeader","createBody","createFooter","CuiAlertsPluginFn","options","validateEvent","popup","show","CuiLightFocusPluginFn","keybordClass","mouseClass","touchClass","_currentCls","_inputType","update","cls","getClass","prevCls","hasCls","hasPrevCls","onMouseEvent","onKeyDownEvent","onTouchEvent","removeEventListener","singleEmit","keys","onKeyDown","onKeyUp","code","setCallback","timestamp","source","CuiMediaQueryListener","mediaQuery","_mediaQuery","_isInitialized","_inProgress","matchMedia","CuiAutoLightModePluginFn","autoLight","matches","autoLightSetup","_isAttached","_preventDefault","_onEvent","_target","onMouseDown","onMouseUp","onMouseMove","onTouchStart","onTouchEnd","onTouchMove","passive","publishMouseEvent","publishTouchEvent","cancelable","preventDefault","clientX","y","clientY","moveX","movementX","moveY","movementY","touch","touches","changedTouches","gestures","onMove","onMoveLock","pushMoveEvent","diffX","diffY","getGestureDiff","gesture","calculateGesture","pushGestureEvent","firstEvent","lastEvent","tresholdX","absDiffX","abs","absDiffY","getGestureEventName","timespstamp","changeX","changeY","svgString","_scale","_appender","scale","created","htmlString","template","createElementFromString","append","toString","getNotification","cache","parts","getHeader","NOTIFICATION_BODY_CLS","setRawChildren","setTextContent","getBody","NOTIFICATION_FOOTER_CLS","onEvent","getActionsList","getFooter","NOTIFICATION_CLS","MARGIN_SMALL_VERTICAL","getClassByType","NOTIFICATION_TITLE_CLS","iconCloseElement","closeElement","ICON_CLS","NOTIFICATION_CLOSE_CLS","setChildren","NOTIFICATION_HEADER_CLS","CuiNotificationPluginFn","_cache","_timeout","_holder","_container","onNotificationClose","notification","fromTimeout","dissmissed","holder","clearTimeout","timeoutId","NOTIFICATION_ANIMATION_OUT","getOrCreateContainer","validateNotificationData","notificationEl","notifiactionElement","insertBefore","firstChild","auto","setAutoClose","NOTIFICATION_ANIMATION_IN","NOTIFICATION_ACTIVE_CLS","CuiAutoPrintModePluginFn","autoPrintInit","desc","autoPrint","setPrintMode","threshold","resizeData","resize","diff","currentSize","pushUpdateToItems","CuiResizeObserverPluginFn","resizeObserver","connect","toastElement","CuiToastPlugin","toastHandler","_keys","_values","throwOnEmptyKey","containsKey","indexOf","len","checkLock","getEventBusFacade","_emittedEvents","detachEmittedEvents","getCuiHandlerInteractions","ClassesHelper","removeClasses","CuiClassesAsyncHelper","helper","_classesHelper","CuiStyleHelper","CuiStyleAsyncHelper","_helper","setStyle","removeStyle","properties","clean","componentName","activeClassName","fName","asyncClasses","prevArgs","isInitialized","_extensionHandler","activeAction","logWarning","registerElement","logInfo","performLifecycleOp","onHandle","assign","onRefresh","logError","onRemove","unregisterElement","method","operation","parserCallbacks","num","_parser","TypeParser","props","_defaults","_defaultsLength","fillDefaultValues","main","currentType","parseValue","thisProp","thisValue","newVal","prperty","_props","corrector","default","clickExtension","performer","perform","CuiComponentBaseHook","_prefix","_attribute","AriaAttributes","label","moveExtensionPerformer","getBaseMovePerformer","onStart","onDown","onEnd","onUp","_isTracking","_isEnabled","_waiting","status","setEnabled","callbackPerformer","ignoreEmpty","getActionsPerformer","_setup","localLock","onAfter","onBefore","performResult","finally","updateSetup","openActionsPerformer","isActive","active","setAria","closeActionsPerformer","sliderPerformer","classeHelper","startX","swipeRatio","moveThreshold","prevent","canMove","velocity","lastTime","canPerformMove","ratio","passesThreshold","preventEventDefault","calculateVelocity","distance","time","calculateAcceleration","prev","performance","offsetWidth","dt","newVelo","acceleration","adjustRatio","progress","end","eventExtension","eventId","stopPropagation","CuiAccordionComponent","_currentIndex","_busFacade","extend","onElementClick","switch","getOpenedIndex","queryItems","nextIdx","updateTargets","currentTarget","previousTarget","targets","toggleTarget","closeAllExcept","hasClass","removeClass","setClass","foundIdx","findMatchingTrigger","trigger","factor","calcUnitValue","cur","buildSingle","calcNewValue","prepUnitValue","ColorAnimator","red","green","blue","alpha","newColor","adjustColor","filters","filterName","color","calculator","_animationStart","_currentTimestamp","_timingFunction","animators","reject","performAsync","progressValue","calculateProgress","setValues","animator","revert","timingprogress","animationEngine","shouldCleanOnFinish","_animators","_animationEngine","move","getEaseTimingFunction","currentTimeProgress","pow","swipe","closeAct","CuiBannerComponent","_swipeEngine","setElement","_swipeAnimation","getId","_movePerformer","_closeActionPerformer","setProps","absRatio","back","minVelo","v","CuiCircleComponent","_factor","_full","_path","onSetProgress","iconSvg","svg","getTotalLength","readStyle","strokeDashoffset","updateStyle","CuiCloseComponent","getTarget","emitClose","cuiId","busFacade","_performer","_eventId","allowRepeatedEvent","onlyWhenInViewport","repeat","getCuiKeyActionPerformer","_keyCombos","combo","ctrlKey","isCtrl","altKey","isAlt","shiftKey","isShift","getScrollFreezeHelper","_scrollY","getScroll","pageYOffset","release","scrollTo","getKeyCloseCombos","parser","escClose","combos","comboList","getDefaultSwitchKeyCombo","getCuiKeysComboParser","_handlers","KeyComboParsers","_splitBy","input","itemPrep","getResult","defTimeout","openAct","keyClose","CuiCoverComponent","_bodyClass","_keysPerformer","closeOutside","_freezeHelper","_keyComboParser","actionsHelper","_openActionPerformer","onBeforeOpen","onAfterOpen","onAfterClose","setKeyCombos","isAnyActive","getAdvancedCuiWindowClickPerformer","getCuiWindowClickPerformer","outClose","CuiDialogComponent","isPlugin","_windowClickPerformer","_isHovering","_onMoveBound","_onOutBound","onMouseOut","_onOverBound","onMouseOver","mouseEvent","force","invoke","isHovering","_targetHeight","_targetWidth","_box","_margin","box","targetBox","getTopPosition","getBottomPosition","getMiddlePosition","getLeftPosition","getRightPosition","getCenterPosition","initial","number","getVerticalPosition","getHorizontalPosition","throwIfNotValid","validate","evaluator","_preferred","_static","_evaluator","setMargin","position","elementBox","setElementBox","setTarget","vertical","horizontal","outVNum","outVPos","getAutoVerticalPosition","outHNum","outHPos","getAutoHorizontalPosition","autoRenew","_autoRenew","canRun","_taskId","onHover","_onHover","_hoverListener","autoClose","pos","CuiDropComponent","onTriggerClick","_positionCalculator","setPreferred","_posClass","_triggerHoverListener","_trigger","_actions","_autoTask","onElementHover","open","acquireTrigger","onHoverEvent","setDataFromArgs","setStatic","findAndCloseOpenedDrop","onOpen","calculate","toggleActions","runAutoCloseTask","opened","toggle","BasePositionCalculator","BaseResizeCalculator","offsetLeft","getMoveAction","styles","floatCallbacks","newX","newY","offsetHeight","floatActionBase","listenerExtension","moveExtension","CuiFloatComponent","_prevX","_prevY","_resizeCalculator","_moveBtn","_resizeBtn","_currentAction","_styles","onCloseAction","updateSetups","CuiIconComponent","addIcon","setScale","svgs","childNodes","iconElement","getDefaultOpenClass","getDefaultCloseClass","CuiOffCanvasComponent","setPositionLeft","CuiOffsetStaticMode","offsetX","offsetY","CuiOffsetDynamicMode","fitsOffsetY","fitsOffsetX","CuiOffsetModeFactory","CuiElementBoxFactory","Window","WindowElementBox","HTMLElement","HTMLElementBox","ElementBox","scrollHeight","scrollWidth","scrollTop","scrollLeft","pageXOffset","_threshold","_task","onScrollFinish","_listener","getScrollLeft","getScrollTop","passedThreshold","base","scrolling","getCuiScrollExtension","_scrollListener","getBaseScrollPerformer","getCuiIntersectionPerformer","onScroll","parentBottom","getHeight","parentRight","getWidth","verticalRatio","currentTop","currentBottom","childBottom","symTop","calcChildVerticalRatio","horizontalRatio","currentLeft","currentRight","childRight","symLeft","calcChildHorizontalRatio","prepareCallbackResult","callInitialEvent","getOffsetPerformer","CuiOffsetComponent","_targets","_matched","_modeHandler","_root","checkAndPerformActions","getTargets","matchesOffset","callEvent","calcaRatio","actForTargets","ratioX","ratioY","ratY","getScrollHeight","toFixed","getScrollWidth","CuiOpenComponent","emitOpen","handleClickCui","propName","CuiComponentMutationExtension","_disabled","_isObserving","unobserve","record","getCuiMutationPerformer","_selector","isAnyItemMatching","array","filterRecordsBySelector","matchesSelector","setSelector","startRatio","stopRatio","CuiParallaxComponent","_defaultAnimator","_targetSetup","_intersectionPerformer","onIntersection","_mutationPerformer","updateArguments","curr","calculateRatio","targetSetup","getTargetAnimator","CuiIntersectionObserver","IntersectionObserver","rootMargin","SmartResizeSteps","small","medium","large","xlarge","SimpleResizeCalculator","_replace","SmartResizeCalculator","_steps","step","getResizeCalculator","CuiResizeComponent","_lastValue","_currentValue","_isIntersecting","_resizeValueCalculator","updateAction","intersectionObserver","cuiObserverExtension","handleUpdate","setNewValue","entries","isIntersecting","newValue","cannotUpdate","newAction","clickPerformer","_prevent","_stopPropagation","behavior","CuiScrollComponent","_clickPerformer","getTargetsParent","by","scrollBy","_switchEventId","onSwitch","getScrollHelper","direction","scroll","toIndex","getPagesCount","calcPages","getCurrentPage","toLast","toPercent","toSelector","found","getOffsetLeft","getLeft","ScrollXHelper","getTop","ScrollYHelper","scrollSize","ScrollSwitchPerformers","check","match","strValue","getPercentPerformer","getToIndexPerform","getStringBasedPerformer","count","loop","CuiScrollSwitchComponent","_scrollPerformers","setArgs","emitSwitch","CuiScrollSpyModeHandlerFactory","forEachAction","links","linksActions","getMatching","last","changed","removeActions","lastElement","intersecting","addActions","link","linkAction","CuiScrollspyComponent","_links","_linkActions","updateResult","_count","isInBounds","CuiSortableComponent","_triggers","_currentIdx","_currentTarget","_currentBefore","_preview","_movingCls","_previewCls","_lockedCls","_dragPerformer","dragStartTimeout","cancelTimeout","getDragMovePerformer","onDragStart","onDragOver","onDragEnd","_detector","_animation","timingFunction","getTargetsAndTrggers","setThreshold","setElements","getPressedElementIdx","startMovementPrep","getFinishAnimation","onSortAnimationFinish","createPreview","setPreviewPosition","setCurrentPosition","removePreview","detected","detect","insertElement","destination","stopMovementPrep","spinner","CuiSpinnerComponent","_animationPauseClass","_interactionFacade","onPause","removeIfAnyExisists","svgIcon","addSpinner","existing","paused","autoTimeout","keyChange","CuiSliderComponent","_nextIdx","_current","_nextElement","_currSlider","_nextSlider","_targetsCount","_animationDef","adjustMoveRatio","getLinks","getActiveIndex","setLinkActive","setElementHeight","setKeyCombo","startTask","getElementHeight","onAnimationFinish","onPushSwitch","reverted","errorOccured","clearSlideData","statuses","condition","in","CuiSwitchComponent","_asyncStyles","_switchPerformer","parseArguments","setSwitchesActive","setTargetHeight","actionsIn","actionsOut","activeIndex","nextItem","performSwitchAction","linksLen","sw","emitLinkSwitch","targetIndex","isList","CuiSwitcherComponent","_perfromer","onClickEvent","handleArguments","targetId","getTargetCuid","handleListClick","handleItemClick","targetCuid","currentSelector","CuiToggleComponent","CuiTooltipComponent","_tooltip","_tooltipDataCls","removeTooltip","hoverExtension","getDataFromArgs","createTooltip","maxWidth","toolbox","pluginList","light","print","onWindowClick","notifcationTimeout","focusSetup","GetPlugins","componentList","GetComponents","appPlugins","_window","steps","errMsg","CuiInitializer","CUI_LIGHT_VERSION"],"mappings":"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","file":"cui-light.min.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"cuiLight\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"cuiLight\"] = factory();\n\telse\n\t\troot[\"cuiLight\"] = factory();\n})(window, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","export class ErrorBase extends Error {\r\n    constructor(name: string, message?: string,) {\r\n        super(message);\r\n        Object.setPrototypeOf(this, new.target.prototype);\r\n        this.name = name;\r\n    }\r\n}\r\n\r\nexport class ItemNotFoundError extends ErrorBase {\r\n    constructor(message?: string) {\r\n        super(\"ItemNotFoundError\", message);\r\n    }\r\n}\r\n\r\nexport class ArgumentError extends ErrorBase {\r\n    constructor(message?: string) {\r\n        super(\"ArgumentError\", message);\r\n    }\r\n}\r\n\r\nexport class CuiBusError extends ErrorBase {\r\n    constructor(message?: string) {\r\n        super(\"ArgumentError\", message);\r\n    }\r\n}\r\n\r\nexport class CuiInstanceInitError extends ErrorBase {\r\n    constructor(message?: string) {\r\n        super(\"CuiInstanceInitError\", message);\r\n    }\r\n}\r\n\r\nexport class CuiScrollSpyOutOfRangeError extends ErrorBase {\r\n    constructor(message?: string) {\r\n        super(\"CuiScrollSpyOutOfRangeError\", message);\r\n    }\r\n}\r\n\r\n\r\nexport class RegisterElementError extends ErrorBase {\r\n    constructor(message?: string) {\r\n        super(\"RegisterElementError\", message);\r\n    }\r\n}\r\n\r\nexport class AnimatorError extends ErrorBase {\r\n    constructor(message?: string) {\r\n        super(\"AnimatorError\", message);\r\n    }\r\n}\r\n\r\nexport class CSSVariableError extends ErrorBase {\r\n    constructor(message?: string) {\r\n        super(\"CSSVariableError\", message);\r\n    }\r\n}\r\n\r\nexport class CuiColorError extends ErrorBase {\r\n    constructor(message?: string) {\r\n        super(\"CuiColorError\", message);\r\n    }\r\n}\r\n\r\nexport class CuiPositionError extends ErrorBase {\r\n    constructor(message?: string) {\r\n        super(\"CuiPositionError\", message);\r\n    }\r\n}","import { CuiLogLevel } from \"./types\";\r\n//import { CuiColorPair } from \"../models/colors\";\r\nimport { counter } from \"./functions\";\r\nimport { ICuiDevelopmentToolFactory } from \"../development/interfaces\";\r\nimport { ICuiMeasure } from \"../models/interfaces\";\r\n\r\nexport const CUID_ATTRIBUTE = \"cuid\";\r\n\r\nexport const CLASSES = {\r\n    dark: 'dark',\r\n    animProgress: 'animation-progress',\r\n    print: 'print',\r\n    active: 'active',\r\n    swipingOn: \"swiping-on\",\r\n    selectionOff: \"selection-off\",\r\n}\r\n\r\nexport const ATTRIBUTES = {\r\n    root: \"data-root\"\r\n}\r\n\r\nexport const ICONS: any = {\r\n    close: \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 20 20\\\" width=\\\"20\\\" height=\\\"20\\\"><path d=\\\"M 1.9999999,1.9999999 18,18\\\"></path><path d=\\\"M 18,1.9999999 1.9999999,18\\\"></path></svg>\",\r\n    accordion: \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 20 20\\\" width=\\\"20\\\" height=\\\"20\\\"><path d=\\\"M 5.0000475,7.4490018 10.000024,12.551028 15,7.4490018\\\"></path></svg>\",\r\n    special_menu: \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 20 20\\\" width=\\\"20\\\" height=\\\"20\\\"><path class=\\\"menu_handle_2\\\" d=\\\"M 1,10 H 19\\\"></path><path class=\\\"menu_handle_1\\\" d=\\\"M 1,4.8571429 H 19\\\"></path><path  class=\\\"menu_handle_3\\\" d=\\\"M 1,15.142857 H 19\\\"></path></svg>\",\r\n    special_fail: \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" class=\\\"special-fail\\\" viewBox=\\\"0 0 100 100\\\" width=\\\"100\\\" height=\\\"100\\\"><path class=\\\"circle\\\" d=\\\"M 50,7.000001 A 43,43 0 0 1 92.999999,50 43,43 0 0 1 50,92.999999 43,43 0 0 1 7.0000011,50 43,43 0 0 1 50,7.000001 Z\\\"></path><path class=\\\"arm_1\\\" d=\\\"M 28.536809,28.536809 71.342023,71.342023\\\"></path><path class=\\\"arm_2\\\" d=\\\"M 71.342023,28.536809 28.536809,71.342023\\\"></path></svg>\",\r\n    special_success: \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" class=\\\"special-success\\\" viewBox=\\\"0 0 100 100\\\" width=\\\"100\\\" height=\\\"100\\\"><path class=\\\"circle\\\" d=\\\"M 50,7 A 43,43 0 0 1 93,50 43,43 0 0 1 50,93 43,43 0 0 1 7,50 43,43 0 0 1 50,7 Z\\\"></path><path class=\\\"arm\\\" d=\\\"M 22.988405,48.234784 36.946233,72.410453 75.516456,33.84023\\\"></path></svg>\",\r\n};\r\n\r\n// export const COLORS = ['red', 'green', 'blue', 'alpha']\r\n\r\n// export const CSS_APP_BACKGROUND_COLORS: CuiColorPair = {\r\n//     light: '--cui-color-light-app-background',\r\n//     dark: '--cui-color-dark-app-background'\r\n// }\r\n\r\n// export const CSS_COMPONENT_BACKGROUND_COLORS: CuiColorPair = {\r\n//     light: '--cui-color-light-background',\r\n//     dark: '--cui-color-dark-background '\r\n// }\r\n\r\n// export const CSS_COMPONENT_BORDER_COLORS: CuiColorPair = {\r\n//     light: '--cui-color-light-border',\r\n//     dark: '--cui-color-dark-border'\r\n// }\r\n\r\n// export const CSS_THEMES = {\r\n//     light: {\r\n//         base: '--cui-color-light-base',\r\n//         muted: '--cui-color-light-muted',\r\n//         active: '--cui-color-light-active'\r\n//     },\r\n//     dark: {\r\n//         base: '--cui-color-dark-base',\r\n//         muted: '--cui-color-dark-muted',\r\n//         active: '--cui-color-dark-active'\r\n//     },\r\n//     accent: {\r\n//         base: '--cui-color-primary',\r\n//         muted: '--cui-color-primary-muted',\r\n//         active: '--cui-color-primary-active'\r\n//     },\r\n//     secondary: {\r\n//         base: '--cui-color-secondary',\r\n//         muted: '--cui-color-secondary-muted',\r\n//         active: '--cui-color-secondary-active'\r\n//     },\r\n//     success: {\r\n//         base: '--cui-color-success',\r\n//         muted: '--cui-color-success-muted',\r\n//         active: '--cui-color-success-active'\r\n//     },\r\n//     warning: {\r\n//         base: '--cui-color-warning',\r\n//         muted: '--cui-color-warning-muted',\r\n//         active: '--cui-color-warning-active'\r\n//     },\r\n//     error: {\r\n//         base: '--cui-color-error',\r\n//         muted: '--cui-color-error-muted',\r\n//         active: '--cui-color-error-active'\r\n//     }\r\n// }\r\n\r\nexport const SCOPE_SELECTOR = \":scope \";\r\n\r\nexport const CSS_VARIABLES: any = Object.freeze({\r\n    fontSize: \"--{prefix}-font-size\",\r\n    lineHeight: \"--{prefix}-line-height\",\r\n    animationTime: \"--{prefix}-animation-time\",\r\n    animationTimeLong: \"--{prefix}-animation-time-long\",\r\n    animationTimeShort: \"--{prefix}-animation-time-short\",\r\n    colorLightAppBackground: \"--{prefix}-color-light-app-background\",\r\n    colorLightBackground: \"--{prefix}-color-light-background\",\r\n    colorLightBorder: \"--{prefix}-color-light-border\",\r\n    colorLightBase: \"--{prefix}-color-light-base\",\r\n    colorLightActive: \"--{prefix}-color-light-active\",\r\n    colorLightMuted: \"--{prefix}-color-light-muted\",\r\n    colorDarkAppBackground: \"--{prefix}-color-dark-app-background\",\r\n    colorDarkBackground: \"--{prefix}-color-dark-background\",\r\n    colorDarkBorder: \"--{prefix}-color-dark-border\",\r\n    colorDarkBase: \"--{prefix}-color-dark-base\",\r\n    colorDarkActive: \"--{prefix}-color-dark-active\",\r\n    colorDarkMuted: \"--{prefix}-color-dark-muted\",\r\n    colorAccent: \"--{prefix}-color-primary\",\r\n    colorAccentActive: \"--{prefix}-color-primary-active\",\r\n    colorAccentMuted: \"--{prefix}-color-primary-muted\",\r\n    colorAccentShade: \"--{prefix}-color-primary-shade\",\r\n    colorAccentShadeDark: \"--{prefix}-color-primary-shade-dark\",\r\n    colorSecondary: \"--{prefix}-color-secondary\",\r\n    colorSecondaryActive: \"--{prefix}-color-secondary-active\",\r\n    colorSecondaryMuted: \"--{prefix}-color-secondary-muted\",\r\n    colorSecondaryShade: \"--{prefix}-color-secondary-shade\",\r\n    colorSecondaryShadeDark: \"--{prefix}-color-secondary-shade-dark\",\r\n    colorWarning: \"--{prefix}-color-warning\",\r\n    colorWarningActive: \"--{prefix}-color-warning-active\",\r\n    colorWarningMuted: \"--{prefix}-color-warning-muted\",\r\n    colorWarningShade: \"--{prefix}-color-warning-shade\",\r\n    colorWarningShadeDark: \"--{prefix}-color-warning-shade-dark\",\r\n    colorSuccess: \"--{prefix}-color-success\",\r\n    colorSuccessActive: \"--{prefix}-color-success-active\",\r\n    colorSuccessMuted: \"--{prefix}-color-success-muted\",\r\n    colorSuccessShade: \"--{prefix}-color-success-shade\",\r\n    colorSuccessShadeDark: \"--{prefix}-color-success-shade-dark\",\r\n    colorError: \"--{prefix}-color-error\",\r\n    colorErrorActive: \"--{prefix}-color-error-active\",\r\n    colorErrorMuted: \"--{prefix}-color-error-muted\",\r\n    colorErrorShade: \"--{prefix}-color-error-shade\",\r\n    colorErrorShadeDark: \"--{prefix}-color-error-shade-dark\",\r\n    inputBackground: \"--{prefix}-input-background-color\",\r\n    colorShade: \"--{prefix}-color-shade\",\r\n    colorShadeDarker: \"--{prefix}-color-shade-darker\",\r\n    colorShadeLight: \"--{prefix}-color-shade-light\",\r\n    colorShadeLighter: \"--{prefix}-color-shade-light-lighter\",\r\n    outline: \"--{prefix}-outline\",\r\n    borderRadius: \"--{prefix}-border-radius\",\r\n    padding: \"--{prefix}-padding\",\r\n    margin: \"--{prefix}-margin\",\r\n    scrollbarWidth: \"--{prefix}-scrollbar-width\",\r\n    componentSpace: \"--{prefix}-component-space\",\r\n    accordionIcon: \"--{prefix}-accordion-icon\"\r\n})\r\n\r\n\r\nexport class STATICS {\r\n    static logLevel: CuiLogLevel = 'none';\r\n    static prefix: string = 'cui';\r\n    static devTool: ICuiDevelopmentToolFactory;\r\n}\r\n\r\nexport const EVENTS = Object.freeze({\r\n    INSTANCE_INITIALIZED: 'instance-initialized',\r\n    INSTANCE_FINISHED: 'instance-finished',\r\n    RESIZE: \"resize\",\r\n    OPEN: \"open\",\r\n    OPENED: \"opened\",\r\n    CLOSE: \"close\",\r\n    CLOSED: \"closed\",\r\n    TOGGLE: \"toggle\",\r\n    TOGGLED: 'toggled',\r\n    SWITCH: \"switch\",\r\n    SWITCHED: \"switched\",\r\n    ON_SCROLL: \"scroll\",\r\n    TARGET_CHANGE: 'targetchange',\r\n    INTERSECTION: 'intersection',\r\n    KEYDOWN: 'keydown',\r\n    SCROLLBY: 'scrollby',\r\n    WINDOW_CLICK: 'windowclick',\r\n    OFFSET: 'offset',\r\n    PROGRESS_CHANGE: \"progresschange\",\r\n    PROGRESS_CHANGED: \"progresschanged\",\r\n    CHANGE: \"change\",\r\n    CHANGED: \"changed\",\r\n    GLOBAL_MOVE: \"globalmove\",\r\n    MOVE_LOCK: \"movelock\",\r\n    PAUSE: \"pause\",\r\n    PAUSED: \"paused\",\r\n    SORTED: \"sorted\",\r\n    SORT_START: \"sortstart\",\r\n    TOAST: \"toast\",\r\n    TOAST_SHOW: \"toastshow\",\r\n    TOAST_HIDDEN: \"toasthidden\",\r\n    ALERT: \"alert\",\r\n    GESTURE_DOWN: \"gesture-down\",\r\n    GESTURE_UP: \"gesture-up\",\r\n    GESTURE_LEFT: \"gesture-left\",\r\n    GESTURE_RIGHT: \"gesture-right\",\r\n    NOTIFY: \"notify\",\r\n    NOTIFIED: \"notified\",\r\n})\r\n\r\n// export const GLOBAL_EVENTS = [EVENTS.ALERT, EVENTS.TOAST, EVENTS.KEYDOWN, EVENTS.MOVE_LOCK, EVENTS.GLOBAL_MOVE, EVENTS.RESIZE]\r\n\r\nexport const OBSERVABLE_SCROLL = \"SCROLL\";\r\nexport const OBSERVABLE_INTERSECTION = \"INTERSECTION\";\r\nexport const COMPONENTS_COUNTER = counter();\r\n\r\nexport const SCREEN_SIZE_SMALL = 640;\r\nexport const SCREEN_SIZE_MEDIUM = 960;\r\nexport const SCREEN_SIZE_LARGE = 1200;\r\nexport const SCREEN_SIZE_XLARGE = 1600;\r\n\r\nexport const MEASUREMENT: ICuiMeasure[] = []\r\n\r\nexport const CuiRAF = window.requestAnimationFrame\r\n    // || window.mozRequestAnimationFrame\r\n    || window.webkitRequestAnimationFrame\r\n    //  || window.msRequestAnimationFrame\r\n    || function (f: any) { return setTimeout(f, 1000 / 60) }","import { CuiLightMode, CuiWindowSize } from \"./types\";\r\nimport { ArgumentError } from \"../models/errors\";\r\nimport { CuiElement, CuiHTMLElement, ICuiKeysCombo, ICuiPair } from \"../models/interfaces\";\r\nimport { COMPONENTS_COUNTER, MEASUREMENT, SCOPE_SELECTOR, SCREEN_SIZE_LARGE, SCREEN_SIZE_MEDIUM, SCREEN_SIZE_SMALL, SCREEN_SIZE_XLARGE } from \"./statics\";\r\n\r\n/**\r\n * Checks if value is defined an is not null\r\n * Additionally with type check it can check value if it is not empty string or collection or object\r\n * \r\n * @param val - value\r\n * @param typecheck - default true - additional check whether value is not empty (string, collection, object)\r\n * @returns whether value passed all conditions\r\n */\r\nexport function is(val: any, typecheck: boolean = true): boolean {\r\n    if (typeof val !== 'undefined' && val !== null) {\r\n        if (!typecheck) {\r\n            return true;\r\n        } else {\r\n            return !isEmpty(val)\r\n        }\r\n    }\r\n    return false;\r\n}\r\n\r\n/**\r\n * Checks if value is empty string, array or object\r\n *\r\n *\r\n * @param val - value\r\n * @returns whether value passed all conditions\r\n */\r\nexport function isEmpty(val: any): boolean {\r\n    if (typeof val === \"string\") {\r\n        return val.length === 0\r\n    }\r\n    if (typeof val === \"boolean\") {\r\n        return val;\r\n    }\r\n    else if (Array.isArray(val)) {\r\n        return val.length === 0\r\n    }\r\n    return false\r\n}\r\n\r\nexport function getName(prefix: string, name: string) {\r\n    if (!is(prefix) || !is(name)) {\r\n        throw new ArgumentError(\"Missing argument value\")\r\n    }\r\n    return `${prefix}-${name}`\r\n}\r\n\r\nexport function sleep(timeout: number): Promise<boolean> {\r\n    return new Promise(resolve => setTimeout(() => {\r\n        resolve(true)\r\n    }, timeout));\r\n}\r\n\r\n/**\r\n * Creates proper html element from given string\r\n * @param htmlString - string containing html\r\n */\r\nexport function createElementFromString(htmlString: string): Element | null {\r\n    if (!is(htmlString)) {\r\n        return null;\r\n    }\r\n    let template = document.createElement('template')\r\n    template.innerHTML = htmlString\r\n    return template.content.children.length > 0 ? template.content.children[0] : null;\r\n}\r\n\r\nexport function getMatchingAttribute(element: any, attributes: string[]): string | null {\r\n    let attr = null;\r\n    let len = attributes.length;\r\n    for (let i = 0; i < len; i++) {\r\n        let attribute = attributes[i];\r\n        if (element.hasAttribute(attribute)) {\r\n            attr = attribute\r\n            break;\r\n        }\r\n    }\r\n    return attr;\r\n}\r\n\r\n// export function getMatchingAttributes(element: any, attributes: string[]): string[] {\r\n//     if (!element || !is(element.hasAttribute)) {\r\n//         return [];\r\n//     }\r\n//     return attributes.filter(a => {\r\n//         return element.hasAttribute(a);\r\n//     });\r\n// }\r\n\r\nexport function getRangeValue(value: number, min: number, max: number) {\r\n    if (value < min) {\r\n        return min;\r\n    } else if (value > max) {\r\n        return max;\r\n    }\r\n    return value;\r\n}\r\n\r\nexport function getRangeValueOrDefault(value: number | undefined, min: number, max: number, def: number) {\r\n    if (value === null || typeof value === 'undefined' || isNaN(value)) {\r\n        return def;\r\n    }\r\n    return getRangeValue(value, min, max)\r\n}\r\n\r\nexport function increaseValue(value: number, amount: number): number {\r\n    return amount < 0 || amount > 1 ? 0 : value + (value * amount);\r\n}\r\n\r\nexport function decreaseValue(value: number, amount: number): number {\r\n    return amount < 0 || amount > 1 ? 0 : value - (value * amount);\r\n}\r\n\r\nexport function clone(object: any): any {\r\n    if (!is(object)) {\r\n        return null;\r\n    }\r\n    return Object.assign({}, object);\r\n}\r\n\r\nexport function getSingleColorRatio(first: number, second: number, max: number): number {\r\n    return Math.abs(((first - second) / max) * 100)\r\n}\r\n\r\n/**\r\n * Creates string containg css selector for array of attributes\r\n * @param attributes - attributes values\r\n */\r\nexport function joinAttributesForQuery(attributes: string[]): string {\r\n    if (!is(attributes)) {\r\n        return \"\"\r\n    }\r\n    return `[${attributes.join('],[')}]`\r\n}\r\n\r\n/**\r\n * Checks light system light mode\r\n * @returns Light Mode - dark/light\r\n */\r\nexport function getSystemLightMode(): CuiLightMode {\r\n    return window.matchMedia &&\r\n        window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';\r\n}\r\n\r\n/**\r\n * Check print mode in the browser window\r\n * @returns true if window is displayed in print mode\r\n */\r\nexport function getSystemPrintMode(): boolean {\r\n    return window.matchMedia &&\r\n        window.matchMedia('print').matches;\r\n}\r\n\r\n/**\r\n * Verifies whether attributes exist and have some values\r\n * @param attributes attributes list\r\n */\r\nexport function are(...attributes: any[]): boolean {\r\n    if (!is(attributes)) {\r\n        return false\r\n    }\r\n    let c = attributes.length;\r\n    for (let i = 0; i < c; i++) {\r\n        if (!is(attributes[i])) {\r\n            return false;\r\n        }\r\n    }\r\n    return true;\r\n}\r\n\r\nexport function calcWindowSize(width: number): CuiWindowSize {\r\n    let size: CuiWindowSize = \"none\";\r\n    if (width >= SCREEN_SIZE_SMALL) {\r\n        size = 'small';\r\n    }\r\n    if (width >= SCREEN_SIZE_MEDIUM) {\r\n        size = \"medium\";\r\n    }\r\n    if (width >= SCREEN_SIZE_LARGE) {\r\n        size = \"large\"\r\n    }\r\n\r\n    if (width >= SCREEN_SIZE_XLARGE) {\r\n        size = 'xlarge';\r\n    }\r\n    return size;\r\n}\r\n\r\n/**\r\n * Simply splits text by character or returns empty array\r\n * @param text Text to split\r\n * @param splitBy character to split by\r\n * @returns array of split characters\r\n */\r\nexport function splitText(text: string, splitBy: string): string[] {\r\n    return text ? text.split(splitBy) : [];\r\n}\r\n\r\nexport function* generateSplitText(text: string, splitBy: string) {\r\n    let array = splitText(text, splitBy);\r\n    for (const item of array) {\r\n        yield item;\r\n    }\r\n}\r\n\r\n/**\r\n * Creates object from string.\r\n * Supported syntaxes are:\r\n * - JSON\r\n * - single value\r\n * - key:value,value;key=value\r\n * \r\n * @param attribute - attribute value\r\n */\r\nexport function parseAttributeString(attribute: string | null): any {\r\n    let ret: any = {};\r\n    if (!is(attribute)) {\r\n        return ret;\r\n    }\r\n    //@ts-ignore - null already checked\r\n    ret = parseJsonString(attribute.trim())\r\n    if (!is(ret)) {\r\n        //@ts-ignore - null already checked\r\n        if (!attribute.includes(';') && !attribute.includes(':')) {\r\n            ret = attribute;\r\n        } else {\r\n            ret = {}\r\n            //@ts-ignore - null already checked\r\n            attribute.split(';').forEach(val => {\r\n                const pair = parseSingleAttribute(val);\r\n                if (pair) {\r\n                    ret[pair.key] = pair.value;\r\n                }\r\n            })\r\n        }\r\n    }\r\n    return ret\r\n}\r\n\r\nexport function parseSingleAttribute(value: string): ICuiPair<string, string> | undefined {\r\n    let sp = splitColon(value);\r\n\r\n    if (sp.length < 2) {\r\n        return undefined;\r\n    }\r\n\r\n    let tag = sp[0].trim();\r\n    let val = sp[1].trim();\r\n    return {\r\n        key: tag,\r\n        value: val.replace('U+0003B', ';')\r\n    }\r\n}\r\n\r\n/**\r\n * Creates object from JSON string\r\n* String must start with { and end with }\r\n *\r\n * @param attribute - attribute value\r\n * @returns object if string passes test, null otherwise\r\n */\r\n\r\nexport function parseJsonString(attribute: string): any | null {\r\n    let out = null;\r\n    if (is(attribute) && attribute.startsWith('{') && attribute.endsWith('}')) {\r\n        try {\r\n            out = jsonify(attribute);\r\n        } catch (e) {\r\n            console.error(prepLogString(\"An exception occured\", 'Functions', 'parseJsonString'), e)\r\n        }\r\n        return out;\r\n    }\r\n    return null;\r\n}\r\n\r\n/**\r\n * Creates object from JSON string\r\n * @param attribute - JSON string\r\n */\r\nexport function jsonify(attribute: string): any {\r\n    return attribute && attribute.length > 0 ? JSON.parse(attribute) : {}\r\n}\r\n\r\nexport function getOffsetTop(element: HTMLElement) {\r\n    if (!is(element)) {\r\n        return -1;\r\n    }\r\n    let val = element.offsetTop - parseInt(getStyleValue(element, 'margin-top')) - parseInt(getStyleValue(element, 'padding-top')) - parseInt(getStyleValue(element, 'border-top-width'))\r\n    return val < 0 ? element.offsetTop : val;\r\n}\r\n\r\nexport function getOffsetLeft(element: HTMLElement) {\r\n    if (!is(element)) {\r\n        return -1;\r\n    }\r\n    let val = element.offsetLeft - parseInt(getStyleValue(element, 'margin-left')) - parseInt(getStyleValue(element, 'padding-left')) - parseInt(getStyleValue(element, 'border-left-width'))\r\n    return val < 0 ? element.offsetLeft : val;\r\n}\r\n\r\nexport function getIntOrDefault(value: any, def: number): number {\r\n    if (!value) {\r\n        return def;\r\n    }\r\n    let integer = value.includes && value.includes('.') ? parseFloat(value) : parseInt(value);\r\n    return isNaN(integer) ? def : integer;\r\n}\r\n\r\nexport function getStyleValue(target: any, property: string): any {\r\n    if (!is(target) || !is(property)) {\r\n        return null;\r\n    }\r\n    if (target.currentStyle) {\r\n        return target.currentStyle[property];\r\n    } else if (window.getComputedStyle) {\r\n        return window.getComputedStyle(target, null).getPropertyValue(property)\r\n    }\r\n    return null;\r\n}\r\n\r\nexport function prepLogString(message: string, component: string, functionName?: string) {\r\n    return `[${new Date().toLocaleString()}][${component ?? \"-\"}][${functionName ?? '-'}][${message}]`\r\n}\r\n\r\nexport function isInRange(value: number, min: number, max: number): boolean {\r\n    return is(value) && value >= min && value <= max;\r\n}\r\n\r\nexport function getActiveClass(prefix: string) {\r\n    return `${prefix ?? \"\"}-active`;\r\n}\r\n\r\nexport function parseAttribute(element: Element, attribute: string): any {\r\n    return are(element, attribute) ? parseAttributeString(element.getAttribute(attribute)) : null;\r\n}\r\n\r\n\r\n/**\r\n *  Checks whether string value contains synonym of true\r\n * @param value - string to check\r\n */\r\nexport function isStringTrue(value: string): boolean {\r\n    return is(value) ? ['y', 't', 'true', 'yes'].includes(value.toLowerCase()) : false\r\n}\r\n\r\nexport function boolStringOrDefault(prop: any, def: boolean): boolean {\r\n    return is(prop) ? isStringTrue(prop) : def;\r\n}\r\n\r\nexport function getStringOrDefault(value: any, def: string) {\r\n    return is(value) ? value.toLowerCase() : def;\r\n}\r\n\r\n/**\r\n * Checks whether device supports touch\r\n */\r\nexport function isTouchSupported(): boolean {\r\n    return ('ontouchstart' in window) ||\r\n        (navigator.maxTouchPoints > 0) ||\r\n        (navigator.msMaxTouchPoints > 0);\r\n}\r\n\r\n/**\r\n * Checks whether value is type of string\r\n * @param {any} value - value to be checked\r\n */\r\nexport function isString(value: any): boolean {\r\n    return typeof value === 'string';\r\n}\r\n\r\n\r\n/**\r\n * Replaces mask {prefix} with actual value in the string\r\n * @param {string} value - text containg a mask\r\n * @param {string} prefix - value to be put in place of mask\r\n */\r\nexport function replacePrefix(value: string, prefix: string): string {\r\n    return !is(value) ? value : value.replace(\"{prefix}\", prefix ?? \"\");\r\n}\r\n\r\n/**\r\n * Generates identifier for Cui element\r\n * \r\n * @param element - Cui element selector\r\n * @returns generated identifier\r\n */\r\nexport function generateCUID(element?: string) {\r\n    let starter = is(element) ? element : \"cui-element\"\r\n    return `${starter}-${COMPONENTS_COUNTER.next().value}`;\r\n}\r\n\r\n/**\r\n * Generates random string\r\n */\r\nexport function generateRandomString(): string {\r\n    let rand = getRandomInt(1, 1000)\r\n    let rand2 = getRandomInt(1, 100)\r\n    return `${Math.floor(Math.random() * rand2)}-${Math.floor(rand)}`;\r\n}\r\n/**\r\n * Generates random integer\r\n * @param min - min number\r\n * @param max - max number\r\n * @returns random integer\r\n */\r\nexport function getRandomInt(min: number, max: number): number {\r\n    min = Math.ceil(min);\r\n    max = Math.floor(max);\r\n    return Math.floor(Math.random() * (max - min + 1)) + min;\r\n}\r\n\r\n\r\n\r\nexport function* counter(): Generator<number, number, number> {\r\n    let idx = 0;\r\n    while (true) {\r\n        let reset = yield idx++;\r\n        if (reset || idx > 200000) {\r\n            idx = 0\r\n        }\r\n    }\r\n}\r\n\r\nexport function all<T>(array: T[], condition: (t: T) => boolean) {\r\n    return array && array.length > 0 && array.find((t: T) => !condition(t)) === undefined;\r\n}\r\n\r\nexport function getHandlerExtendingOrNull<T>(target: CuiElement, fName: string): T | null {\r\n    if (!is(target.$handlers)) {\r\n        return null;\r\n    }\r\n\r\n    for (let handler in target.$handlers) {\r\n\r\n        if (target.$handlers.hasOwnProperty(handler)) {\r\n            let h: any = target.$handlers[handler];\r\n            if (hasFunction(h, fName))\r\n                return h;\r\n        }\r\n    }\r\n    return null;\r\n}\r\n\r\n/**\r\n * Checks whether property exists on the object and it is a function\r\n * @param obj - object\r\n * @param fName - property name\r\n */\r\nexport function hasFunction(obj: any, fName: string) {\r\n    return is(obj[fName]) && typeof obj[fName] === 'function'\r\n}\r\n\r\n/**\r\n * Gets closest parent element which is a cUI element\r\n * @param element \r\n */\r\nexport function getParentCuiElement(element: Element): Element | undefined {\r\n    if (!is(element)) {\r\n        return undefined;\r\n    }\r\n    let parent = element.parentElement as any;\r\n    return is(parent) && is(parent.$cuid) ? parent : getParentCuiElement(parent);\r\n}\r\n\r\n/**\r\n * Calculates element height by calculating childerns heights\r\n * @param element\r\n */\r\nexport function getChildrenHeight(element: Element): number {\r\n    let height: number = 0;\r\n    if (!element) {\r\n        return -1;\r\n    }\r\n    Array.from(element.children).forEach((child: Element) => {\r\n        height += child.getBoundingClientRect().height;\r\n    })\r\n    return height > 0 ? height + 4 : height;\r\n}\r\n\r\nexport function enumerateObject<T extends object>(object: T, callback: (property: string, value: any) => void) {\r\n    if (!are(object, callback)) {\r\n        return;\r\n    }\r\n    for (let prop in object) {\r\n        if (object.hasOwnProperty(prop)) {\r\n            callback(prop, object[prop]);\r\n        }\r\n    }\r\n}\r\n\r\nexport function round(value: number, decimalPlaces: number): number {\r\n    const multiplier = 10 ** decimalPlaces;\r\n    return Math.floor(value) / multiplier;\r\n}\r\n\r\nexport function calculateNextIndex(val: any, currentIndex: number, totalLength: number): number {\r\n    let idx = -1;\r\n    switch (val) {\r\n        case 'prev':\r\n            idx = currentIndex <= 0 ? totalLength - 1 : currentIndex - 1;\r\n            break;\r\n        case 'next':\r\n            idx = currentIndex < totalLength - 1 ? currentIndex + 1 : 0\r\n            break;\r\n        case 'first':\r\n            idx = 0;\r\n            break;\r\n        case 'last':\r\n            idx = totalLength - 1;\r\n        default:\r\n            idx = getRangeValueOrDefault(val, 0, totalLength, -1);\r\n            break;\r\n    }\r\n    return idx;\r\n}\r\n\r\nexport function getFirstMatching<T>(array: T[], callback: (t: T, index: number) => boolean): T | undefined {\r\n    let count = array.length;\r\n    if (!array || count === 0) {\r\n        return undefined;\r\n    }\r\n\r\n    for (let idx = 0; idx < count; idx++) {\r\n        if (callback(array[idx], idx)) {\r\n            return array[idx];\r\n        }\r\n    }\r\n    return undefined;\r\n}\r\n\r\nexport function mapObject<T, V>(input: T, callback: (t: T) => V): V {\r\n    return callback(input);\r\n}\r\n\r\nexport function mapObjectArray<T, V>(input: T[], callback: (t: T) => V): V[] {\r\n    return input.map((item: T) => {\r\n        return mapObject(item, callback);\r\n    })\r\n}\r\n\r\n/**\r\n * Delays callback execution by specific time. Callback cannot be called again until previous execution finishes or was cancelled\r\n * @param callback - callback to execute\r\n * @param delayTime - time in ms that execution shall be delayed by\r\n * @returns Cancel callback\r\n */\r\nexport function delay(callback: (...args: any[]) => void, delayTime: number) {\r\n    if (!are(callback, delayTime)) {\r\n        throw new Error(\"[delay]: Input arguments are not correct\")\r\n    }\r\n    let id: any = null;\r\n    return function (...args: any[]) {\r\n        if (id === null) {\r\n            id = setTimeout(() => {\r\n                callback(...args);\r\n                id = null;\r\n            }, delayTime)\r\n        }\r\n        return function () {\r\n            if (id !== null) {\r\n                clearTimeout(id);\r\n                id = null;\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nexport function splitColon(text: string): string[] {\r\n    let ret: string[] = [];\r\n    if (!is(text)) {\r\n        return ret;\r\n    }\r\n    let split = text.split(\":\");\r\n    if (split.length === 1) {\r\n        return split;\r\n    }\r\n    let tag = split.shift();\r\n    // @ts-ignore tag is always defined\r\n    return [tag, split.join(\":\")];\r\n}\r\n\r\nexport function getEnumOrDefault<T>(value: T, defVal: T, ...values: T[]): T {\r\n    if (values.includes(value)) {\r\n        return value;\r\n    }\r\n    return defVal;\r\n}\r\n\r\nexport function joinWithScopeSelector(value: string) {\r\n    return SCOPE_SELECTOR + value;\r\n}\r\n\r\nexport function measure(name?: string) {\r\n    const optName = name ?? \"\";\r\n    return function (target: Object, propertyKey: string, descriptor: PropertyDescriptor) {\r\n        const originalMethod = descriptor.value;\r\n        descriptor.value = function (...args: any[]) {\r\n            const start = performance.now();\r\n            const result = originalMethod.apply(this, args);\r\n            const finish = performance.now();\r\n            MEASUREMENT.push({\r\n                target: optName,\r\n                method: propertyKey,\r\n                time: finish - start\r\n            })\r\n            return result;\r\n        };\r\n\r\n        return descriptor;\r\n    }\r\n};\r\n\r\nexport function getChildSelectorFromScoped(scopedSelector: string): string {\r\n    const split = scopedSelector.split(\">\");\r\n    return split[split.length - 1].trim();\r\n}\r\n\r\nexport function applyMixins(derivedCtor: any, constructors: any[]) {\r\n    constructors.forEach((baseCtor) => {\r\n        Object.getOwnPropertyNames(baseCtor.prototype).forEach((name) => {\r\n            Object.defineProperty(\r\n                derivedCtor.prototype,\r\n                name,\r\n                Object.getOwnPropertyDescriptor(baseCtor.prototype, name) ||\r\n                Object.create(null)\r\n            );\r\n        });\r\n    });\r\n}\r\n\r\nexport function isInViewport(element: HTMLElement): boolean {\r\n    const rect = element.getBoundingClientRect();\r\n    return (\r\n        rect.top >= 0 &&\r\n        rect.left >= 0 &&\r\n        rect.bottom <= (window.innerHeight || document.documentElement.clientHeight) &&\r\n        rect.right <= (window.innerWidth || document.documentElement.clientWidth)\r\n    );\r\n}\r\n\r\nexport function matchesKeyCombo(event: KeyboardEvent, compare: ICuiKeysCombo): boolean {\r\n    return compare.key !== undefined && (compare.key === event.key) &&\r\n        (event.ctrlKey === compare.isCtrl) &&\r\n        (event.altKey === compare.isAlt) &&\r\n        (event.shiftKey === compare.isShift);\r\n}\r\n\r\n/**\r\n * Performs query all and returns result as an array\r\n * @param root - root element to query from\r\n * @param selector - query selector\r\n * @returns list of found elements\r\n */\r\nexport function queryAll(root: Document | Element, selector: string): HTMLElement[] {\r\n    return [...root.querySelectorAll(selector)] as HTMLElement[];\r\n}\r\n\r\nexport function findMatchingElementIndex<T>(item: T, items: T[]) {\r\n    return items.findIndex(i => i === item)\r\n}\r\n\r\nexport function getCuiElementsBySelector(selector: string): CuiHTMLElement[] {\r\n    let switches = is(selector) ? [...document.querySelectorAll(selector)] : [];\r\n    return switches.reduce((result, item: any) => {\r\n        if (item.$cuid) {\r\n            //@ts-ignore\r\n            result.push(item);\r\n        }\r\n        return result;\r\n    }, [])\r\n}\r\n","import { ParallaxAnimations } from \"../animation/interfaces\";\r\nimport { ICuiEventBusQueueSetup } from \"../bus/interfaces\";\r\nimport { ICuiDevelopmentToolFactory } from \"../development/interfaces\";\r\nimport { CuiLogLevel, CuiInteractionsType } from \"../utils/types\";\r\n\r\ninterface CuiSetupCommon {\r\n    prefix?: string;\r\n    logLevel?: CuiLogLevel;\r\n    cacheSize?: number;\r\n    autoLightMode?: boolean;\r\n    animationTime?: number;\r\n    animationTimeShort?: number;\r\n    animationTimeLong?: number;\r\n    scrollThreshold?: number;\r\n    resizeThreshold?: number;\r\n    root: HTMLElement;\r\n}\r\n\r\nexport class CuiSetup implements CuiSetupCommon {\r\n    prefix: string;\r\n    logLevel?: CuiLogLevel;\r\n    cacheSize?: number;\r\n    autoLightMode?: boolean;\r\n    animationTime?: number;\r\n    animationTimeShort?: number;\r\n    animationTimeLong?: number;\r\n    scrollThreshold: number;\r\n    resizeThreshold: number;\r\n    plugins: any;\r\n    root: HTMLElement;\r\n    parallaxAnimations: ParallaxAnimations;\r\n\r\n    constructor() {\r\n        this.autoLightMode = false;\r\n        this.scrollThreshold = 20;\r\n        this.resizeThreshold = 20;\r\n        this.prefix = \"cui\";\r\n        this.plugins = {};\r\n        this.root = document.body;\r\n        this.parallaxAnimations = {};\r\n    }\r\n\r\n    fromInit(init: CuiSetupInit): CuiSetup {\r\n        this.prefix = init.prefix ?? \"cui\";\r\n        this.logLevel = init.logLevel;\r\n        this.cacheSize = init.cacheSize;\r\n        this.autoLightMode = init.autoLightMode;\r\n        this.animationTime = init.animationTime;\r\n        this.animationTimeShort = init.animationTimeShort;\r\n        this.animationTimeLong = init.animationTimeLong;\r\n        this.scrollThreshold = init.scrollThreshold;\r\n        this.resizeThreshold = init.resizeThreshold;\r\n        this.root = init.root;\r\n        this.parallaxAnimations = init.parallaxAnimations;\r\n\r\n        return this;\r\n    }\r\n}\r\n\r\n\r\nexport class CuiSetupInit implements CuiSetupCommon {\r\n    prefix: string;\r\n    app: string;\r\n    interaction: CuiInteractionsType;\r\n    logLevel: CuiLogLevel;\r\n    cacheSize: number;\r\n    autoLightMode?: boolean;\r\n    animationTime: number;\r\n    animationTimeShort: number;\r\n    animationTimeLong: number;\r\n    scrollThreshold: number;\r\n    resizeThreshold: number;\r\n    busSetup?: ICuiEventBusQueueSetup[];\r\n    development: ICuiDevelopmentToolFactory | undefined;\r\n    parallaxAnimations: ParallaxAnimations;\r\n    root: HTMLElement;\r\n    constructor() {\r\n        this.prefix = 'cui';\r\n        this.app = '$cui';\r\n        this.logLevel = 'warning';\r\n        this.interaction = 'async';\r\n        this.animationTime = 300;\r\n        this.animationTimeShort = 150;\r\n        this.animationTimeLong = 500;\r\n        this.cacheSize = 500;\r\n        this.autoLightMode = false;\r\n        this.scrollThreshold = 20;\r\n        this.resizeThreshold = 20;\r\n        this.root = document.body;\r\n        this.busSetup = undefined;\r\n        this.development = undefined;\r\n        this.parallaxAnimations = {};\r\n    }\r\n}","import { STATICS } from \"../utils/statics\";\r\nimport { CuiLogLevel } from \"../utils/types\";\r\nimport { CuiDevelopmentStateType, ICuiDevelopmentTool } from \"./interfaces\";\r\n\r\nexport class CuiConsoleDevelopementTool implements ICuiDevelopmentTool {\r\n    private _cuid: string;\r\n    private _name: string;\r\n    private _level: CuiLogLevel;\r\n    constructor(name: string, logLevel?: CuiLogLevel) {\r\n        this._name = name;\r\n        this._cuid = '-';\r\n        this._level = logLevel ?? STATICS.logLevel;\r\n\r\n    }\r\n    registerElement(element: HTMLElement, cuid: string, component: string): void {\r\n        this._cuid = cuid;\r\n        console.log(this.prepString(\"Register element: \" + cuid, 'debug', component))\r\n    }\r\n    unregisterElement(cuid: string, component: string): void {\r\n        this._cuid = '-'\r\n        console.log(this.prepString(\"Unregister element: \" + cuid, 'debug', component))\r\n    }\r\n\r\n    setProperty<T>(cuid: string, component: string, name: string, t: T): void {\r\n        //throw new Error(\"Method not implemented.\");\r\n    }\r\n\r\n    pushState(cuid: string, component: string, type: CuiDevelopmentStateType, message: string, functionName?: string): void {\r\n        this.logByType(type, message, functionName);\r\n    }\r\n\r\n    log(type: CuiDevelopmentStateType, message: string, functionName?: string): void {\r\n        this.logByType(type, message, functionName);\r\n    }\r\n\r\n    debug(message: string, functionName?: string): void {\r\n        if (this._level === 'debug') {\r\n            console.log(this.prepString(message, \"debug\", functionName))\r\n        }\r\n    }\r\n    warning(message: string, functionName?: string): void {\r\n        if (this._level === 'warning' || this._level === 'debug')\r\n            console.warn(this.prepString(message, \"warning\", functionName))\r\n    }\r\n    error(message: string, functionName?: string): void {\r\n        if (this._level === 'error' || this._level === 'debug' || this._level === 'warning')\r\n            console.error(this.prepString(message, \"error\", functionName))\r\n    }\r\n    exception(e: Error, functionName?: string): void {\r\n        console.error(this.prepString(`An exception occured: ${e.name}: ${e.message}`, \"exception\", functionName))\r\n        if (this._level === 'debug')\r\n            console.error(e.stack)\r\n    }\r\n\r\n    setId(id: string) {\r\n        if (id)\r\n            this._cuid = id;\r\n    }\r\n\r\n    private prepString(message: string, level: string, functionName?: string) {\r\n        return `[${new Date().toLocaleString()}][${level}][${this._name}][${functionName ?? '-'}][${this._cuid}][${message}]`\r\n    }\r\n\r\n    private logByType(type: CuiDevelopmentStateType, message: string, functionName?: string) {\r\n        switch (type) {\r\n            case 'debug':\r\n                this.debug(message, functionName);\r\n                break;\r\n            case 'warning':\r\n                this.warning(message, functionName);\r\n                break;\r\n            case 'error':\r\n                this.error(message, functionName);\r\n                break;\r\n        }\r\n    }\r\n}","import { STATICS } from \"../utils/statics\";\r\nimport { CuiConsoleDevelopementTool } from \"./console\";\r\nimport { ICuiDevelopmentTool, ICuiDevelopmentToolFactory } from \"./interfaces\";\r\n\r\nexport class CuiConsoleDevToolFactory implements ICuiDevelopmentToolFactory {\r\n    get(name: string): ICuiDevelopmentTool {\r\n        return new CuiConsoleDevelopementTool(name);\r\n    }\r\n\r\n}\r\n\r\nexport class CuiDevtoolFactory {\r\n    static get(name: string): ICuiDevelopmentTool {\r\n        if (!STATICS.devTool) {\r\n            STATICS.devTool = new CuiConsoleDevToolFactory();\r\n        }\r\n        return STATICS.devTool.get(name);\r\n    }\r\n}","import { RegisterElementError } from \"../models/errors\";\r\nimport { ICuiComponent, CuiHTMLElement } from \"../models/interfaces\";\r\nimport { CuiCore } from \"../models/core\";\r\nimport { generateCUID, are, enumerateObject, parseAttribute } from \"../utils/functions\";\r\nimport { CUID_ATTRIBUTE } from \"../utils/statics\";\r\n\r\nexport function getMatchingComponents(node: any, components: ICuiComponent[]): ICuiComponent[] {\r\n    return components.filter(component => {\r\n        return node.hasAttribute && node.hasAttribute(component.attribute);\r\n    })\r\n}\r\n\r\nexport async function createCuiElement(node: any, components: ICuiComponent[], core: CuiCore): Promise<boolean> {\r\n    if (!are(node, components, core)) {\r\n        return false;\r\n    }\r\n    let element = node as CuiHTMLElement;\r\n    if (!element.$cuid) {\r\n        element.$cuid = node.hasAttribute(CUID_ATTRIBUTE) ? node.getAttribute(CUID_ATTRIBUTE) : generateCUID(node.tagName);\r\n        node.setAttribute(CUID_ATTRIBUTE, element.$cuid);\r\n    }\r\n    for (let component of components) {\r\n        await createComponent(element, component, core, parseAttribute(element, component.attribute))\r\n    }\r\n    return true;\r\n}\r\n\r\nexport async function destroyCuiElement(node: any): Promise<boolean> {\r\n    const element = node as CuiHTMLElement;\r\n    if (!element.$handlers) {\r\n        return false;\r\n    }\r\n    for (let name in element.$handlers) {\r\n        await destroyComponent(element, name);\r\n    }\r\n\r\n    return true;\r\n}\r\n\r\nexport function addCuiArgument<T extends object>(element: HTMLElement, cuiArg: string, args: T): boolean {\r\n    if (!are(cuiArg, args, element)) {\r\n        return false;\r\n    }\r\n    if (element.hasAttribute(cuiArg)) {\r\n        return false;\r\n    }\r\n    let argArr: string[] = [];\r\n    enumerateObject(args, (arg: string, value: string) => {\r\n        argArr.push(`${arg}: ${value}`);\r\n    })\r\n    element.setAttribute(cuiArg, argArr.join(\"; \"));\r\n    return true;\r\n\r\n}\r\n\r\nexport async function createComponent(node: CuiHTMLElement, component: ICuiComponent, core: CuiCore, args?: any): Promise<boolean> {\r\n    if (!node.$handlers) {\r\n        node.$handlers = {};\r\n    }\r\n    // If handler already exists - ignore\r\n    if (node.$handlers[component.attribute]) {\r\n        return false;\r\n    }\r\n    try {\r\n        let handler = component.get(node, core);\r\n        node.$handlers[component.attribute] = handler;\r\n        await node.$handlers[component.attribute].handle(args);\r\n    } catch (e) {\r\n        throw new RegisterElementError(`An error occured during [${component.attribute}] initialization: ${e.message}`);\r\n    }\r\n    return true;\r\n}\r\n\r\nexport async function updateComponent(node: CuiHTMLElement, component: string, args?: any): Promise<boolean> {\r\n    if (!node || !node.$handlers) {\r\n        return false;\r\n    }\r\n\r\n    let handler = node.$handlers[component];\r\n    if (!handler) {\r\n        return false;\r\n    }\r\n    try {\r\n        if (handler.refresh)\r\n            await handler.refresh(args);\r\n    } catch (e) {\r\n        throw new RegisterElementError(`An error occured during [${component}] update: ${e.message}`);\r\n    }\r\n    return true;\r\n}\r\n\r\nasync function destroyComponent(node: CuiHTMLElement, component: string): Promise<boolean> {\r\n    if (!node || !node.$handlers) {\r\n        return false;\r\n    }\r\n\r\n    let handler = node.$handlers[component];\r\n    if (!handler) {\r\n        return false;\r\n    }\r\n    try {\r\n        await handler.destroy();\r\n    } catch (e) {\r\n        throw new RegisterElementError(`An error occured during [${component}] destroy: ${e.message}`);\r\n    }\r\n    return true;\r\n}","import {\r\n\tICuiComponent,\r\n\tICuiPluginManager,\r\n\tCuiHTMLElement,\r\n} from \"../models/interfaces\";\r\nimport {\r\n\tis,\r\n\tare,\r\n\tjoinAttributesForQuery,\r\n\tparseAttribute,\r\n\tmeasure,\r\n} from \"../utils/functions\";\r\nimport { CuiCore } from \"../models/core\";\r\nimport { ICuiDevelopmentTool } from \"../development/interfaces\";\r\nimport { CuiDevtoolFactory } from \"../development/factory\";\r\nimport {\r\n\tcreateCuiElement,\r\n\tdestroyCuiElement,\r\n\tgetMatchingComponents,\r\n\tupdateComponent,\r\n} from \"../api/functions\";\r\n\r\nexport interface ICuiMutionObserver {\r\n\t// setOptions(options: MutationObserverInit): ICuiMutionObserver;\r\n\tsetPlugins(plugins: ICuiPluginManager): ICuiMutionObserver;\r\n\tsetComponents(components: ICuiComponent[]): ICuiMutionObserver;\r\n\tsetAttributes(attributes: string[]): ICuiMutionObserver;\r\n\tstart(): ICuiMutionObserver;\r\n\tstop(): ICuiMutionObserver;\r\n}\r\n\r\nexport interface ICuiComponentMutationObserver {\r\n\tobserve(): void;\r\n\tunobserve(): void;\r\n\tisObserving(): boolean;\r\n\tonMutation(callback: (record: MutationRecord[]) => void): void;\r\n\tdisable(flag: boolean): void;\r\n\tsetSelector(selector: string): void;\r\n\tsetAttributes(attributes: string[]): void;\r\n}\r\n\r\nexport class CuiMutationObserver implements ICuiMutionObserver {\r\n\tprivate _log: ICuiDevelopmentTool;\r\n\tprivate _observer: MutationObserver | undefined;\r\n\tprivate _options: MutationObserverInit | undefined;\r\n\tprivate _element: HTMLElement;\r\n\tprivate _plugins: ICuiPluginManager | undefined;\r\n\tprivate _components: ICuiComponent[];\r\n\tprivate _core: CuiCore;\r\n\tprivate _queryString: string;\r\n\tconstructor(element: HTMLElement, core: CuiCore) {\r\n\t\tthis._observer = undefined;\r\n\t\tthis._plugins = undefined;\r\n\t\tthis._options = undefined;\r\n\t\tthis._element = element;\r\n\t\tthis._log = CuiDevtoolFactory.get(\"CuiMutationObserver\");\r\n\t\tthis._components = [];\r\n\t\tthis._core = core;\r\n\t\tthis._queryString = \"\";\r\n\t}\r\n\r\n\tsetPlugins(plugins: ICuiPluginManager): ICuiMutionObserver {\r\n\t\tthis._plugins = plugins;\r\n\t\treturn this;\r\n\t}\r\n\r\n\tsetComponents(components: ICuiComponent[]): ICuiMutionObserver {\r\n\t\tthis._components = components;\r\n\t\treturn this;\r\n\t}\r\n\r\n\tsetAttributes(attributes: string[]): ICuiMutionObserver {\r\n\t\tthis._options = {\r\n\t\t\tattributes: true,\r\n\t\t\tsubtree: true,\r\n\t\t\tchildList: true,\r\n\t\t\tattributeFilter: attributes,\r\n\t\t};\r\n\t\tthis._queryString = joinAttributesForQuery(attributes);\r\n\t\treturn this;\r\n\t}\r\n\r\n\tstart(): ICuiMutionObserver {\r\n\t\tthis._log.debug(\"Starting\");\r\n\t\tif (!this._options) {\r\n\t\t\tthis._log.error(\"Cannot start - options are not defined\");\r\n\t\t\treturn this;\r\n\t\t}\r\n\t\tthis._observer = new MutationObserver(this.mutationCallback.bind(this));\r\n\t\tthis._observer.observe(this._element, this._options);\r\n\t\tthis._log.debug(\"Started\");\r\n\t\treturn this;\r\n\t}\r\n\r\n\tstop(): ICuiMutionObserver {\r\n\t\tthis._log.debug(\"Stopping\");\r\n\t\tif (!this._observer) {\r\n\t\t\tthis._log.debug(\"Observer not available\");\r\n\t\t\treturn this;\r\n\t\t}\r\n\t\tthis._observer.disconnect();\r\n\t\tthis._observer = undefined;\r\n\t\tthis._log.debug(\"Stopped\");\r\n\t\treturn this;\r\n\t}\r\n\r\n\tprivate mutationCallback(\r\n\t\tmutations: MutationRecord[],\r\n\t\tobserver: MutationObserver\r\n\t) {\r\n\t\tmutations.forEach((mutation: MutationRecord) => {\r\n\t\t\tswitch (mutation.type) {\r\n\t\t\t\tcase \"attributes\":\r\n\t\t\t\t\tconst item = mutation.target as CuiHTMLElement;\r\n\t\t\t\t\tif (!are(mutation.attributeName, item)) {\r\n\t\t\t\t\t\tthis._log.error(\r\n\t\t\t\t\t\t\t\"Mutation attribute doesn't not exisist\"\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// @ts-ignore attribute is defined\r\n\t\t\t\t\tthis.handeComponentUpdate(mutation.attributeName, item);\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase \"childList\":\r\n\t\t\t\t\tthis.handleChildListMutation(mutation);\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tif (is(this._plugins)) {\r\n\t\t\t\t// @ts-ignore plugins is defined here\r\n\t\t\t\tthis._plugins.onMutation(mutation).then(() => {\r\n\t\t\t\t\t//\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tprivate handeComponentUpdate(attributeName: string, item: CuiHTMLElement) {\r\n\t\tlet args = parseAttribute(item, attributeName);\r\n\t\tupdateComponent(item, attributeName, args)\r\n\t\t\t.then((result) => {\r\n\t\t\t\tthis._log.debug(\r\n\t\t\t\t\t\"Component: \" + attributeName + \" updated with: \" + result,\r\n\t\t\t\t\t\"handeComponentUpdate\"\r\n\t\t\t\t);\r\n\t\t\t})\r\n\t\t\t.catch((e) => {\r\n\t\t\t\tthis._log.exception(e);\r\n\t\t\t});\r\n\t}\r\n\r\n\tprivate async handleChildListMutation(mutation: MutationRecord) {\r\n\t\tconst addedLen = mutation.addedNodes.length;\r\n\t\tconst removedLen = mutation.removedNodes.length;\r\n\t\tif (addedLen > 0) {\r\n\t\t\tthis._log.debug(\"Registering added nodes: \" + addedLen);\r\n\t\t\ttry {\r\n\t\t\t\tawait this.handleAddedNodes(mutation.addedNodes);\r\n\t\t\t} catch (e) {\r\n\t\t\t\tthis._log.exception(e);\r\n\t\t\t}\r\n\t\t} else if (removedLen > 0) {\r\n\t\t\tthis._log.debug(\"Removing nodes: \" + removedLen);\r\n\t\t\ttry {\r\n\t\t\t\tawait this.handleRemovedNodes(mutation.removedNodes);\r\n\t\t\t} catch (e) {\r\n\t\t\t\tthis._log.exception(e);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprivate async handleAddedNodes(nodes: NodeList): Promise<boolean> {\r\n\t\tfor (let node of nodes) {\r\n\t\t\tawait this.handleAddedNode(node);\r\n\t\t\tlet element = node as Element;\r\n\t\t\tlet children = element.hasChildNodes()\r\n\t\t\t\t? element.querySelectorAll(this._queryString)\r\n\t\t\t\t: null;\r\n\t\t\tif (is(children)) {\r\n\t\t\t\t// @ts-ignore children is defined\r\n\t\t\t\tthis._log.debug(\"Additional nodes to add: \" + children.length);\r\n\t\t\t\t// @ts-ignore children is defined\r\n\t\t\t\tawait this.handleAddedChildren(children);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\r\n\tprivate async handleAddedChildren(nodes: NodeList): Promise<boolean[]> {\r\n\t\tlet result: boolean[] = [];\r\n\t\tfor (let node of nodes) {\r\n\t\t\tresult.push(await this.handleAddedNode(node));\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\tprivate async handleAddedNode(node: any): Promise<boolean> {\r\n\t\tlet matchingComponents = getMatchingComponents(node, this._components);\r\n\t\treturn createCuiElement(node, matchingComponents, this._core);\r\n\t}\r\n\r\n\tprivate async handleRemovedNodes(nodes: NodeList): Promise<boolean> {\r\n\t\tfor (let node of nodes) {\r\n\t\t\tawait destroyCuiElement(node);\r\n\t\t\tlet element = node as Element;\r\n\t\t\tlet children = node.hasChildNodes()\r\n\t\t\t\t? element.querySelectorAll(this._queryString)\r\n\t\t\t\t: null;\r\n\t\t\tif (is(children)) {\r\n\t\t\t\tthis._log.debug(\r\n\t\t\t\t\t// @ts-ignore children is defined\r\n\t\t\t\t\t\"Additional nodes to remove: \" + children.length\r\n\t\t\t\t);\r\n\t\t\t\t// @ts-ignore children is defined\r\n\t\t\t\tawait this.handleDestroyChildren(children);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\r\n\tprivate async handleDestroyChildren(nodes: NodeList): Promise<boolean[]> {\r\n\t\tlet result = [];\r\n\t\tfor (let child of nodes) {\r\n\t\t\tresult.push(await destroyCuiElement(child));\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n}\r\n\r\nexport class CuiComponentMutationHandler\r\n\timplements ICuiComponentMutationObserver\r\n{\r\n\tprivate _isObserving: boolean;\r\n\tprivate _observer: MutationObserver;\r\n\tprivate _element: Element;\r\n\tprivate _disabled: boolean;\r\n\tprivate _selector: string | undefined;\r\n\tprivate _options: MutationObserverInit = {\r\n\t\tchildList: true,\r\n\t\tsubtree: true,\r\n\t};\r\n\r\n\tprivate _callback?: (record: MutationRecord[]) => void;\r\n\tconstructor(target: Element, selector?: string) {\r\n\t\tthis._disabled = false;\r\n\t\tthis._isObserving = false;\r\n\t\tthis._element = target;\r\n\t\tthis._selector = selector;\r\n\t\tthis._callback = undefined;\r\n\t\tthis._observer = new MutationObserver(this.mutationCallback.bind(this));\r\n\t}\r\n\r\n\tobserve(): void {\r\n\t\tif (!this._isObserving && !this._disabled) {\r\n\t\t\tthis._observer.observe(this._element, this._options);\r\n\t\t\tthis._isObserving = true;\r\n\t\t}\r\n\t}\r\n\r\n\tunobserve(): void {\r\n\t\tif (this._isObserving) {\r\n\t\t\tthis._observer.disconnect();\r\n\t\t\tthis._isObserving = false;\r\n\t\t}\r\n\t}\r\n\r\n\tsetSelector(selector?: string) {\r\n\t\tthis._selector = selector;\r\n\t}\r\n\r\n\tsetAttributes(attributes: string[]) {\r\n\t\tif (attributes && attributes.length > 0) {\r\n\t\t\tthis._options = {\r\n\t\t\t\t...this._options,\r\n\t\t\t\tattributes: true,\r\n\t\t\t\tattributeFilter: attributes,\r\n\t\t\t};\r\n\t\t}\r\n\t\tthis._options = {\r\n\t\t\tchildList: true,\r\n\t\t\tsubtree: true,\r\n\t\t};\r\n\r\n\t\tthis.unobserve();\r\n\t}\r\n\r\n\tisObserving(): boolean {\r\n\t\treturn this._isObserving;\r\n\t}\r\n\r\n\tdisable(flag: boolean): void {\r\n\t\tthis._disabled = flag;\r\n\t\tif (this._disabled) {\r\n\t\t\tthis.unobserve();\r\n\t\t}\r\n\t}\r\n\r\n\tonMutation(callback: (record: MutationRecord[]) => void): void {\r\n\t\tthis._callback = callback;\r\n\t}\r\n\r\n\tprivate mutationCallback(record: MutationRecord[]) {\r\n\t\tlet records: MutationRecord[] = record.reduce<MutationRecord[]>(\r\n\t\t\t(result, record) => {\r\n\t\t\t\tif (this._selector && record.type === \"childList\") {\r\n\t\t\t\t\tif (this.matchesSelector(record)) {\r\n\t\t\t\t\t\tresult.push(record);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tresult.push(record);\r\n\t\t\t\t}\r\n\t\t\t\treturn result;\r\n\t\t\t},\r\n\t\t\t[]\r\n\t\t);\r\n\t\tif (this._callback) {\r\n\t\t\tthis._callback(records);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate matchesSelector(record: MutationRecord): boolean {\r\n\t\tif (record.addedNodes.length > 0) {\r\n\t\t\treturn this.isAnyItemMatching([\r\n\t\t\t\t...record.addedNodes,\r\n\t\t\t] as HTMLElement[]);\r\n\t\t}\r\n\t\tif (record.removedNodes.length > 0) {\r\n\t\t\treturn this.isAnyItemMatching([\r\n\t\t\t\t...record.removedNodes,\r\n\t\t\t] as HTMLElement[]);\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tprivate isAnyItemMatching(array: HTMLElement[]): boolean {\r\n\t\treturn (\r\n\t\t\tarray.find((node) =>\r\n\t\t\t\t//@ts-ignore\r\n\t\t\t\t(<HTMLElement>node).matches(this._selector)\r\n\t\t\t) !== null\r\n\t\t);\r\n\t}\r\n}\r\n","import { IUIInteractionProvider } from \"../models/interfaces\";\r\nimport { CuiRAF } from \"./statics\";\r\n\r\nexport class FastDom implements IUIInteractionProvider {\r\n    private _writes: any[];\r\n    private _reads: any[];\r\n    // private _raf: any;\r\n    private _isScheduled: boolean = false;\r\n    private _limit: number;\r\n    private _reportCallback: ((e: Error) => void) | undefined;\r\n\r\n    constructor() {\r\n        // this._raf = window.requestAnimationFrame.bind(window)\r\n        this._writes = []\r\n        this._reads = []\r\n        this._limit = 5;\r\n        this._reportCallback = undefined;\r\n\r\n    }\r\n\r\n    onError(callback: (e: Error) => void) {\r\n        this._reportCallback = callback;\r\n    }\r\n\r\n    mutate(callback: any, ctx: any, ...args: any[]): void {\r\n        this._reads.push(this.createTask(callback, ctx, ...args))\r\n        this.schedule()\r\n    }\r\n\r\n    fetch(callback: any, ctx: any, ...args: any[]): void {\r\n        this._writes.push(this.createTask(callback, ctx, ...args))\r\n        this.schedule()\r\n    }\r\n\r\n    private createTask(callback: any, ctx: any, ...args: any[]): any {\r\n        return ctx || args ? callback.bind(ctx, ...args) : callback;\r\n    }\r\n\r\n    private run(tasks: any[]) {\r\n        let task = null\r\n        while (task = tasks.shift()) {\r\n            task()\r\n        }\r\n    }\r\n\r\n    private schedule(recursion?: number) {\r\n        if (!this._isScheduled) {\r\n            this._isScheduled = true;\r\n            if (recursion && recursion >= this._limit) {\r\n                throw new Error(\"Fast Dom limit reached\")\r\n            } else {\r\n                CuiRAF(this.flush.bind(this, recursion));\r\n            }\r\n\r\n        }\r\n    }\r\n\r\n    private flush(recursion?: number) {\r\n        let rec: number = recursion ?? 0;\r\n        let error = null;\r\n        let writes = this._writes;\r\n        let reads = this._reads;\r\n\r\n        try {\r\n            this.run(reads);\r\n            this.run(writes);\r\n        } catch (e) {\r\n            if (this._reportCallback) {\r\n                this._reportCallback(e);\r\n            } else {\r\n                console.error(`An error has been captured in interactions: ${e.message}`);\r\n                //console.error(e)\r\n            }\r\n            error = e\r\n        }\r\n        this._isScheduled = false;\r\n        if (error || this._writes.length || this._reads.length) {\r\n            this.schedule(rec + 1);\r\n        }\r\n    }\r\n}\r\n\r\nexport class SyncInteractions implements IUIInteractionProvider {\r\n    tasks: any[];\r\n    // raf: any;\r\n    isRunning: boolean = false;\r\n    constructor() {\r\n        this.tasks = [];\r\n        // this.raf = window.requestAnimationFrame.bind(window)\r\n    }\r\n\r\n    mutate(callback: any, ctx: any, ...args: any[]): void {\r\n        this.tasks.push(this.createTask(callback, ctx, ...args))\r\n        this.schedule()\r\n    }\r\n\r\n    fetch(callback: any, ctx: any, ...args: any[]): void {\r\n        this.tasks.push(this.createTask(callback, ctx, ...args))\r\n        this.schedule()\r\n    }\r\n\r\n    private schedule() {\r\n        if (!this.isRunning) {\r\n            this.isRunning = true;\r\n            CuiRAF(this.flush.bind(this))\r\n        }\r\n    }\r\n\r\n    private flush() {\r\n        let task = null\r\n        while (task = this.tasks.shift()) {\r\n            try {\r\n                task()\r\n            }\r\n            catch (e) {\r\n            }\r\n        }\r\n        this.isRunning = false\r\n    }\r\n\r\n    private createTask(callback: any, ctx: any, ...args: any[]): any {\r\n        return ctx || args ? callback.bind(ctx, ...args) : callback;\r\n    }\r\n\r\n}","import { CuiQueueCompareCallback, CuiQueueErrorCallback, ICuiQueue, ICuiQueueAdapter } from \"./interfaces\";\r\n\r\nexport class CuiQueue<T> implements ICuiQueue<T> {\r\n    private _items: T[];\r\n    private _lock: boolean;\r\n    private _adapter: ICuiQueueAdapter<T>;\r\n    private _onError?: CuiQueueErrorCallback<T>;\r\n    private _comparer?: CuiQueueCompareCallback<T>;\r\n\r\n    constructor(adapter: ICuiQueueAdapter<T>) {\r\n        this._lock = false;\r\n        this._items = [];\r\n        this._adapter = adapter;\r\n        this._comparer = undefined;\r\n        this._onError = undefined;\r\n    }\r\n\r\n    add(item: T): void {\r\n        this._items.push(item);\r\n        if (this._lock) {\r\n            return;\r\n        }\r\n\r\n        this._lock = true;\r\n        this.flush().then(() => {\r\n            this._lock = false;\r\n        })\r\n    }\r\n\r\n    delete(item: T): T | undefined {\r\n        const index = this._items.findIndex(_item => this.compare(_item, item));\r\n        if (index < 0) {\r\n            return undefined;\r\n        }\r\n        return this._items.splice(index, 1)[0];\r\n    }\r\n\r\n    isLocked(): boolean {\r\n        return this._lock;\r\n    }\r\n\r\n    setCompareCallback(callback: CuiQueueCompareCallback<T>) {\r\n        this._comparer = callback;\r\n    }\r\n\r\n    onError(callback: CuiQueueErrorCallback<T>) {\r\n        this._onError = callback;\r\n    }\r\n\r\n    private compare(item1: T, item2: T): boolean {\r\n        if (this._comparer) {\r\n            return this._comparer(item1, item2)\r\n        }\r\n        return Object.is(item1, item2);\r\n    }\r\n\r\n    private async flush(): Promise<boolean> {\r\n        const items = this.getItemsForFlush();\r\n        if (items.length === 0) {\r\n            return true;\r\n        }\r\n        try {\r\n            await this._adapter.onFlush(items);\r\n        } catch (e) {\r\n            this.callError(e, items);\r\n        }\r\n\r\n        return this.flush();\r\n    }\r\n\r\n    private getItemsForFlush(): T[] {\r\n        if (this._adapter.type === 'batch') {\r\n            let result = [...this._items];\r\n            this._items = []\r\n            return result;\r\n        }\r\n        const item = this._items.shift();\r\n        if (item) {\r\n            return [item];\r\n        }\r\n        return [];\r\n    }\r\n\r\n    private callError(error: unknown, items?: T[]) {\r\n        if (this._onError) {\r\n            this._onError(error, items)\r\n        }\r\n    }\r\n}","import { CuiDevtoolFactory } from \"../development/factory\";\r\nimport { ICuiDevelopmentTool } from \"../development/interfaces\";\r\nimport { CuiQueueAdapterType, ICuiQueue, ICuiQueueAdapter } from \"../queue/interfaces\";\r\nimport { CuiQueue } from \"../queue/queue\";\r\nimport { is } from \"../utils/functions\";\r\nimport { ICuiCallbackExecutor, ICuiEventEmitHandler, CuiEventReceiver } from \"./interfaces\";\r\n\r\nexport interface EmitHandlerData {\r\n    events: CuiEventReceiver;\r\n    cuid: string | null;\r\n    args?: any;\r\n}\r\n\r\nexport class EmitHandler implements ICuiEventEmitHandler {\r\n    queue: ICuiQueue<EmitHandlerData>;\r\n    log: ICuiDevelopmentTool;\r\n    constructor(name: string, adapter: ICuiQueueAdapter<EmitHandlerData>) {\r\n        this.log = CuiDevtoolFactory.get(name);\r\n        this.queue = new CuiQueue<EmitHandlerData>(adapter);\r\n        this.queue.onError((e: unknown) => {\r\n            this.log.error(e as any, \"Flush\");\r\n        })\r\n    }\r\n\r\n    async handle(events: CuiEventReceiver, cuid: string, args?: any): Promise<boolean> {\r\n        if (!is(events)) {\r\n            this.log.warning(\"No events provided\")\r\n            return false;\r\n        }\r\n        this.queue.add({\r\n            events: events,\r\n            cuid: cuid,\r\n            args: args\r\n        })\r\n        return true;\r\n    }\r\n}\r\n\r\nexport class SimpleEventEmitHandlerAdapter implements ICuiQueueAdapter<EmitHandlerData> {\r\n    type?: CuiQueueAdapterType;\r\n    private _executor: ICuiCallbackExecutor;\r\n    constructor(executor: ICuiCallbackExecutor) {\r\n        this.type = 'single';\r\n        this._executor = executor;\r\n    }\r\n\r\n    async onFlush(items: EmitHandlerData[]): Promise<boolean> {\r\n        for (const task of items) {\r\n            for (let id in task.events) {\r\n                let event = task.events[id]\r\n                if (idMatches(task.cuid, event.$cuid))\r\n                    await this._executor.execute(event.callback, task.args)\r\n            }\r\n        }\r\n        return true;\r\n    }\r\n}\r\n\r\nexport class TaskedEventEmitHandlerAdapter implements ICuiQueueAdapter<EmitHandlerData> {\r\n    type?: CuiQueueAdapterType;\r\n    private _executor: ICuiCallbackExecutor;\r\n    constructor(executor: ICuiCallbackExecutor) {\r\n        this.type = 'single';\r\n        this._executor = executor;\r\n    }\r\n\r\n    async onFlush(items: EmitHandlerData[]): Promise<boolean> {\r\n        for (const task of items) {\r\n            let promises: Promise<boolean>[] = []\r\n            for (let id in task.events) {\r\n                let event = task.events[id]\r\n                if (idMatches(task.cuid, event.$cuid))\r\n                    promises.push(this._executor.execute(event.callback, task.args))\r\n            }\r\n            await Promise.all(promises);\r\n        }\r\n        return true;\r\n    }\r\n}\r\n\r\nexport class CuiEventEmitHandlerFactory {\r\n    static get(name: string, executor: ICuiCallbackExecutor): ICuiEventEmitHandler {\r\n        switch (name) {\r\n            case \"tasked\":\r\n                return new EmitHandler(\"TaskedEventEmitHandler\", new TaskedEventEmitHandlerAdapter(executor));\r\n            default:\r\n                return new EmitHandler(\"SimpleEventEmitHandler\", new SimpleEventEmitHandlerAdapter(executor));\r\n        }\r\n    }\r\n}\r\n\r\nfunction idMatches(emitId: string | null | undefined, handleId: string | null | undefined) {\r\n    return !is(emitId) || (is(emitId) && emitId == handleId);\r\n}","import { ICuiCallbackExecutor } from \"./interfaces\";\r\n\r\n\r\nexport class CuiCallbackExecutor implements ICuiCallbackExecutor {\r\n    async execute(callback: any, args?: any): Promise<boolean> {\r\n        try {\r\n            callback(args)\r\n            return true;\r\n        } catch (e) {\r\n\r\n        }\r\n\r\n        return false;\r\n    }\r\n}","import { CuiElement } from \"../models/interfaces\";\r\nimport { is, are, generateRandomString, enumerateObject } from \"../utils/functions\";\r\nimport { ArgumentError } from \"../models/errors\";\r\nimport { CuiEventEmitHandlerFactory } from \"./handlers\";\r\nimport { CuiCallbackExecutor } from \"./executors\";\r\nimport { CuiBusCallback, CuiBusExtStatistics, CuiEventObj, CuiEventReceiver, ICuiEventBus, ICuiEventBusQueueSetup, ICuiEventEmitHandler } from \"./interfaces\";\r\nimport { ICuiDevelopmentTool } from \"../development/interfaces\";\r\nimport { CuiDevtoolFactory } from \"../development/factory\";\r\n\r\ninterface ICuiBusMapping {\r\n    [name: string]: number;\r\n}\r\n\r\nexport class CuiEventBus implements ICuiEventBus {\r\n    private _events: { [event: string]: CuiEventReceiver }\r\n    private _log: ICuiDevelopmentTool;\r\n    private _eventHandler: ICuiEventEmitHandler;\r\n    private _name: string;\r\n    constructor(emitHandler: ICuiEventEmitHandler, name?: string) {\r\n        this._events = {};\r\n        this._eventHandler = emitHandler;\r\n        this._name = name ?? \"CuiEventBus\"\r\n        this._log = CuiDevtoolFactory.get(this._name);\r\n    }\r\n\r\n    /**\r\n     * Attaches event to event bus\r\n     * \r\n     * @param {string} name - Event name\r\n     * @param {any} callback - callback function\r\n     * @param {CuiContext} ctx - callback context with id\r\n     * @param {CuiElement} cui - optional - cui element which event shall be attached to \r\n     */\r\n    on<T>(name: string, callback: CuiBusCallback<T>, cui?: CuiElement): string | null {\r\n        if (!are(name, callback)) {\r\n            throw new ArgumentError(\"Missing argument\")\r\n        }\r\n        // When context is not provided (e.g. anonymous function) then generate random\r\n        let id = this._name + \"-\" + generateRandomString();\r\n\r\n\r\n        if (!this._events[name]) {\r\n            this._events[name] = {}\r\n        }\r\n        if (this.isAttached(this._events[name], id, cui)) {\r\n            return null;\r\n        }\r\n        this._log.debug(`Attaching new event: [${name}] for: [${id}]`)\r\n\r\n        this._events[name][id] = { callback: callback, $cuid: this.getCuid(cui) }\r\n        return id;\r\n    }\r\n\r\n    /**\r\n    * Detaches specific event from event bus\r\n    *\r\n    * @param {string} name - Event name\r\n    * @param {CuiContext} ctx - callback context with id\r\n    * @param {CuiElement} cui - optional - cui element which event shall be attached to\r\n    */\r\n    detach(name: string, id: string): void {\r\n        if (!are(name, id)) {\r\n            throw new ArgumentError(\"Missing argument\")\r\n        }\r\n        let ev = this._events[name]\r\n        this._log.debug(`Detaching item: [${id}] from [${name}]`)\r\n        if (this.isAttached(ev, id)) {\r\n            delete ev[id];\r\n        }\r\n    }\r\n\r\n    /**\r\n    * Detaches all callbacks from event\r\n    *\r\n    * @param {string} name - Event name\r\n    */\r\n    detachAll(name: string): void {\r\n        if (is(name) && this._events[name]) {\r\n            delete this._events[name]\r\n        } else {\r\n            this._log.error(`Event name is missing or incorrect`, \"detachAll\")\r\n        }\r\n    }\r\n\r\n    /**\r\n    * Emits event call to event bus\r\n    *\r\n    * @param {string} name - Event name\r\n    * @param {string} cuid - id of component which emits the event\r\n    * @param {any[]} args  - event arguments\r\n    */\r\n    async emit<T>(event: string, cuid: string | null, args?: T): Promise<boolean> {\r\n        if (!is(event)) {\r\n            throw new ArgumentError(\"Event name is incorrect\");\r\n        }\r\n\r\n        let callbacks = this._events[event];\r\n        if (is(callbacks)) {\r\n            this._log.debug(`Emit: [${event}]`)\r\n            await this._eventHandler.handle(callbacks, cuid, args)\r\n        }\r\n        return true;\r\n    }\r\n\r\n    /**\r\n    * Checks whether given context is already attached to specific event\r\n    *\r\n    * @param {string} name - Event name\r\n    * @param {CuiContext} ctx - callback context with id\r\n    * @param {CuiElement} cui - optional - cui element which event shall be attached to\r\n    */\r\n    isSubscribing(name: string, id: string, cui?: CuiElement) {\r\n        let ev = this._events[name]\r\n        return this.isAttached(ev, id, cui)\r\n    }\r\n\r\n    /**\r\n     * Detaches callbacks by component cuid - this is used to clean up attachments on component deletion\r\n     * @param {string} event - event name\r\n     * @param {string} cuid - cuid of the component\r\n     */\r\n    detachByCuid(event: string, cuid: string): void {\r\n        if (!are(event, cuid)) {\r\n            return;\r\n        }\r\n        let ev = this._events[event];\r\n        if (!is(ev)) {\r\n            return;\r\n        }\r\n        enumerateObject({ ...ev }, (evId: string, evValue: CuiEventObj) => {\r\n            if (evValue.$cuid === cuid) {\r\n                delete ev[evId]\r\n            }\r\n        })\r\n    }\r\n\r\n    private isAttached(ev: CuiEventReceiver, id: string, cui?: CuiElement): boolean {\r\n        if (is(cui)) {\r\n            // @ts-ignore\r\n            return is(ev) && is(id) && is(ev[id]) && ev[id].$cuid == cui.$cuid;\r\n        }\r\n        return is(ev) && is(id) && is(ev[id]);\r\n    }\r\n\r\n    private getCuid(cui?: CuiElement) {\r\n        // @ts-ignore\r\n        return is(cui) ? cui.$cuid : null;\r\n    }\r\n\r\n\r\n}\r\n\r\n\r\nexport class CuiEventExtBus implements ICuiEventBus {\r\n    private _events: { [event: string]: number };\r\n    private _log: ICuiDevelopmentTool;\r\n    private _buses: ICuiEventBus[];\r\n    private _last: number;\r\n    constructor(setup: ICuiEventBusQueueSetup[]) {\r\n        this._log = CuiDevtoolFactory.get(\"CuiEventBus\");\r\n        this._buses = [];\r\n        this._events = {};\r\n        this._last = 0;\r\n        if (is(setup)) {\r\n            this._log.debug(\"Initiating buses\")\r\n            let sorted = setup.length === 1 ? setup : setup.sort((first, second) => {\r\n                return first.priority - second.priority\r\n            })\r\n            sorted.forEach((item, index) => {\r\n                this._buses.push(this.initBusInstance(item.name, item.handler))\r\n                this._events = {\r\n                    ...this._events,\r\n                    ...this.mapEvents(item.eventsDef, index),\r\n                }\r\n                this._log.debug(`Bus ${item.name} has been initialized with number: ${index}`)\r\n            })\r\n\r\n            this._buses.push(this.initBusInstance(\"DefaultEventBus\", 'tasked'))\r\n            this._last = this._buses.length - 1;\r\n            this._log.debug(`Bus initialization finished`);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Attaches event to event bus\r\n     * \r\n     * @param {string} name - Event name\r\n     * @param {any} callback - callback function\r\n     * @param {CuiContext} ctx - callback context with id\r\n     * @param {CuiElement} cui - optional - cui element which event shall be attached to \r\n     */\r\n    on<T>(name: string, callback: CuiBusCallback<T>, cui?: CuiElement): string | null {\r\n\r\n        if (!are(name, callback)) {\r\n            throw new ArgumentError(\"Missing argument\")\r\n        }\r\n        return this.get(name).on(name, callback, cui);\r\n    }\r\n\r\n    /**\r\n    * Detaches specific event from event bus\r\n    *\r\n    * @param {string} name - Event name\r\n    * @param {CuiContext} ctx - callback context with id\r\n    * @param {CuiElement} cui - optional - cui element which event shall be attached to\r\n    */\r\n    detach(name: string, id: string, cui?: CuiElement): void {\r\n        if (!are(name, id)) {\r\n            throw new ArgumentError(\"Missing argument\")\r\n        }\r\n        this.get(name).detach(name, id, cui);\r\n    }\r\n\r\n    /**\r\n    * Detaches all callbacks from event\r\n    *\r\n    * @param {string} name - Event name\r\n    */\r\n    detachAll(name: string): void {\r\n        this.get(name).detachAll(name);\r\n    }\r\n\r\n    /**\r\n    * Emits event call to event bus\r\n    *\r\n    * @param {string} name - Event name\r\n    * @param {string} cuid - id of component which emits the event\r\n    * @param {any[]} args  - event arguments\r\n    */\r\n    async emit<T>(event: string, cuid: string | null, args?: T): Promise<boolean> {\r\n        if (!is(event)) {\r\n            throw new ArgumentError(\"Event name is incorrect\");\r\n        }\r\n        return this.get(event).emit(event, cuid, args);\r\n    }\r\n\r\n    /**\r\n    * Checks whether given context is already attached to specific event\r\n    *\r\n    * @param {string} name - Event name\r\n    * @param {CuiContext} ctx - callback context with id\r\n    * @param {CuiElement} cui - optional - cui element which event shall be attached to\r\n    */\r\n    isSubscribing(name: string, id: string, cui?: CuiElement) {\r\n        return this.get(name).isSubscribing(name, id, cui);\r\n    }\r\n\r\n    /**\r\n    * Detaches callbacks by component cuid - this is used to clean up attachments on component deletion\r\n    * @param {string} event - event name\r\n    * @param {string} cuid - cuid of the component\r\n    */\r\n    detachByCuid(event: string, cuid: string): void {\r\n        if (!are(event, cuid)) {\r\n            return\r\n        }\r\n        this.get(event).detachByCuid(event, cuid);\r\n    }\r\n\r\n\r\n    /**\r\n     * Creates and initializes event bus instance\r\n     * @param busName Event bus name for logger\r\n     * @param handlerName handler name to create proper handler instance\r\n     */\r\n    private initBusInstance(busName: string, handlerName: string): ICuiEventBus {\r\n        if (!are(busName, handlerName)) {\r\n            throw new ArgumentError(\"Bus name or handler name is incorrect\");\r\n        }\r\n        let executor = new CuiCallbackExecutor();\r\n        let handler = CuiEventEmitHandlerFactory.get(handlerName, executor);\r\n        return new CuiEventBus(handler, busName);\r\n    }\r\n\r\n    /**\r\n     * Creates mapping object from events array\r\n     * @param events events array\r\n     * @param index queue number\r\n     */\r\n    private mapEvents(events: string[], index: number): ICuiBusMapping {\r\n        return events.reduce((result: ICuiBusMapping, current: string) => {\r\n            if (!result[current]) {\r\n                return {\r\n                    ...result,\r\n                    [current]: index\r\n                }\r\n            }\r\n            return result;\r\n        }, {})\r\n    }\r\n\r\n    /**\r\n     * Retrives porper event bus based on event name\r\n     * @param event \r\n     */\r\n    private get(event: string): ICuiEventBus {\r\n        let idx = this._events[event];\r\n        return this._buses[idx ?? this._last];\r\n    }\r\n}\r\n\r\nexport class CuiEventBusFactory {\r\n    static get(setup?: ICuiEventBusQueueSetup[]): ICuiEventBus {\r\n        //@ts-ignore - setup is underfined check is perfromed\r\n        return is(setup) ? new CuiEventExtBus(setup) : new CuiEventBus(CuiEventEmitHandlerFactory.get('tasked', new CuiCallbackExecutor()));\r\n    }\r\n}\r\n\r\nexport class CuiBusExtStatisticsHandler {\r\n    #isOn: boolean;\r\n    #statistics: CuiBusExtStatistics;\r\n    constructor(gather: boolean, queueCount: number) {\r\n        this.#isOn = gather;\r\n        this.#statistics = {\r\n            queueCount: queueCount,\r\n            events: {}\r\n        }\r\n    }\r\n\r\n    addEvent(event: string, queueNumber: number, emitCount?: number) {\r\n        this.#statistics.events[event] = {\r\n            name: event,\r\n            queueNumber: queueNumber,\r\n            emits: emitCount ?? 0\r\n        }\r\n    }\r\n\r\n    addQueue() {\r\n        this.#statistics.queueCount += 1;\r\n    }\r\n\r\n    addEmit(event: string, queueNumber?: number) {\r\n        if (!this.#isOn) {\r\n            return;\r\n        }\r\n\r\n        if (this.#statistics.events[event]) {\r\n            this.#statistics.events[event].emits += 1;\r\n        } else {\r\n            this.addEvent(event, queueNumber ?? -1, 1);\r\n        }\r\n\r\n    }\r\n\r\n    getStatistics(): CuiBusExtStatistics {\r\n        return this.#statistics;\r\n    }\r\n\r\n}","import { is } from \"../utils/functions\";\r\nimport { IUIInteractionProvider } from \"../models/interfaces\";\r\n\r\nexport interface ICuiDocumentStyleAppender {\r\n    append(style: string): boolean;\r\n}\r\n\r\nexport class CuiDocumentStyleAppender implements ICuiDocumentStyleAppender {\r\n    constructor(interactions: IUIInteractionProvider) {\r\n    }\r\n\r\n    append(style: string): boolean {\r\n        if (is(style)) {\r\n            const head = document.head || document.getElementsByTagName('head')[0]\r\n            const node = document.createElement('style');\r\n            const text = document.createTextNode(style);\r\n            // node.type = 'text/css';\r\n            node.appendChild(text);\r\n            head.appendChild(node);\r\n        }\r\n        return true;\r\n    }\r\n\r\n}","import { IUIInteractionProvider } from \"./interfaces\";\r\nimport { CuiSetup, CuiSetupInit } from \"./setup\";\r\nimport { CuiLightMode } from \"../utils/types\";\r\nimport { CuiInteractionsFactory } from \"../factories/interactions\";\r\nimport { CuiEventBusFactory } from \"../bus/bus\";\r\nimport { are, getName, is, replacePrefix } from \"../utils/functions\";\r\nimport { CLASSES } from \"../utils/statics\";\r\nimport { ICuiDocumentStyleAppender, CuiDocumentStyleAppender } from \"../styles/appender\";\r\nimport { CSSVariableError } from \"./errors\";\r\nimport { ICuiEventBus } from \"../bus/interfaces\";\r\n\r\nexport class CuiCore {\r\n    interactions: IUIInteractionProvider;\r\n    bus: ICuiEventBus;\r\n    setup: CuiSetup;\r\n    styleAppender: ICuiDocumentStyleAppender;\r\n    #plugins: string[];\r\n    constructor(initialSetup: CuiSetupInit, plugins?: string[]) {\r\n        this.setup = new CuiSetup().fromInit(initialSetup);\r\n        this.interactions = CuiInteractionsFactory.get(initialSetup.interaction, this.onInteractionError.bind(this));\r\n        // this.cache = new CuiCacheManager(this.setup.cacheSize);\r\n        this.bus = CuiEventBusFactory.get(initialSetup.busSetup);\r\n        // this.colors = new CuiInstanceColorHandler(this.interactions);\r\n\r\n        this.styleAppender = new CuiDocumentStyleAppender(this.interactions);\r\n        this.#plugins = plugins ?? [];\r\n    }\r\n\r\n    setLightMode(mode: CuiLightMode) {\r\n        const name: string = getName(this.setup.prefix, CLASSES.dark);\r\n        const classes = document.body.classList;\r\n        if (mode === 'dark' && !classes.contains(name)) {\r\n            this.interactions.mutate(() => {\r\n                classes.add(name);\r\n            }, this)\r\n\r\n        } else if (mode === 'light' && classes.contains(name)) {\r\n            this.interactions.mutate(() => {\r\n                classes.remove(name);\r\n            }, this)\r\n        }\r\n    }\r\n\r\n    getLightMode(): CuiLightMode {\r\n        const name: string = getName(this.setup.prefix, CLASSES.dark);\r\n        return document.body.classList.contains(name) ? 'dark' : 'light';\r\n    }\r\n\r\n    setPrintMode(flag: boolean) {\r\n        const name: string = getName(this.setup.prefix, CLASSES.print);\r\n        const classes = document.body.classList;\r\n        if (flag && !classes.contains(name)) {\r\n            classes.add(name);\r\n\r\n        } else if (!flag && classes.contains(name)) {\r\n            classes.remove(name);\r\n        }\r\n    }\r\n\r\n    isPrintMode(): boolean {\r\n        const name: string = getName(this.setup.prefix, CLASSES.print);\r\n        return document.body.classList.contains(name);\r\n    }\r\n\r\n    setProperty(name: string, value: string) {\r\n        if (!are(name, value)) {\r\n            throw new CSSVariableError(\"Property or value was not provided\");\r\n        }\r\n        let prop = replacePrefix(name, this.setup.prefix);\r\n        this.interactions.mutate(() => {\r\n            document.documentElement.style.setProperty(prop, value);\r\n        }, null)\r\n\r\n    }\r\n\r\n    isPlugin(name: string) {\r\n        return is(name) && this.#plugins.find(plugin => plugin === name);\r\n    }\r\n\r\n    private onInteractionError(e: Error) {\r\n        console.error(\"An error has been captured from interactions\");\r\n        console.error(e);\r\n    }\r\n}","import { IUIInteractionProvider } from \"../models/interfaces\";\r\nimport { CuiInteractionsType } from \"../utils/types\";\r\nimport { FastDom, SyncInteractions } from \"../utils/interactions\";\r\n\r\nexport class CuiInteractionsFactory {\r\n    /**\r\n     * Gets new instance interactions provider\r\n     * @param type - Interactions type\r\n     */\r\n    public static get(type: CuiInteractionsType, errorReport?: (e: Error) => void): IUIInteractionProvider {\r\n        const interactionType = type;\r\n        switch (interactionType) {\r\n            case 'async':\r\n                const fastDom = new FastDom();\r\n                if (errorReport)\r\n                    fastDom.onError(errorReport);\r\n                return fastDom;\r\n            default:\r\n                return new SyncInteractions();\r\n        }\r\n    }\r\n}","import { IUIInteractionProvider } from \"../models/interfaces\";\r\nimport { ICuiComponentAction } from \"../utils/actions\";\r\nimport { CLASSES } from \"../utils/statics\";\r\nimport { is } from \"../utils/functions\";\r\n\r\nexport interface ICuiActionHelper {\r\n    performAction(target: Element, action: ICuiComponentAction, timeout: number, callback?: () => void): Promise<boolean>;\r\n}\r\n\r\nexport interface ICuiSwitchActionHelper {\r\n    performSwitchAction(inTarget: Element, outTarget: Element | null, inAction: ICuiComponentAction[], outAction: ICuiComponentAction[], onFinish: () => void, timeout: number): Promise<boolean>\r\n}\r\n\r\nexport interface ICuiActionsHelper {\r\n    performActions(target: Element, actions: ICuiComponentAction[], timeout: number, callback?: () => void): Promise<boolean>;\r\n}\r\n\r\nexport function getActionsHelper(interactions: IUIInteractionProvider): ICuiActionsHelper {\r\n    return {\r\n        performActions: (target: Element, actions: ICuiComponentAction[], timeout: number, callback?: () => void) => {\r\n            function onFinish(resolve: (value: boolean | PromiseLike<boolean>) => void) {\r\n                interactions.mutate(() => {\r\n                    actions.forEach(x => x.remove(target));\r\n                    target.classList.remove(CLASSES.animProgress);\r\n                    if (callback)\r\n                        callback();\r\n                    resolve(true)\r\n                }, null)\r\n            }\r\n            return new Promise((resolve) => {\r\n                interactions.mutate(() => {\r\n                    actions.forEach(x => x.add(target));\r\n                    target.classList.add(CLASSES.animProgress);\r\n                    setTimeout(() => {\r\n                        onFinish(resolve)\r\n                    }, timeout)\r\n                }, null)\r\n            })\r\n        }\r\n    }\r\n}\r\n\r\nexport class CuiActionsHelper implements ICuiActionHelper, ICuiSwitchActionHelper, ICuiActionsHelper {\r\n    private _interactions: IUIInteractionProvider;\r\n    constructor(interactions: IUIInteractionProvider) {\r\n        this._interactions = interactions;\r\n    }\r\n\r\n    async performAction(target: Element, action: ICuiComponentAction, timeout: number, callback?: () => void): Promise<boolean> {\r\n        return new Promise((resolve) => {\r\n            this._interactions.mutate(() => {\r\n                action.add(target);\r\n                target.classList.add(CLASSES.animProgress);\r\n                setTimeout(() => {\r\n                    this._interactions.mutate(() => {\r\n                        action.remove(target);\r\n                        target.classList.remove(CLASSES.animProgress);\r\n                        if (callback)\r\n                            callback();\r\n                        resolve(true)\r\n                    }, null)\r\n                }, timeout)\r\n            }, null)\r\n        })\r\n    }\r\n\r\n    async performActions(target: Element, actions: ICuiComponentAction[], timeout: number, callback?: () => void): Promise<boolean> {\r\n        return new Promise((resolve) => {\r\n            this._interactions.mutate(() => {\r\n                actions.forEach(x => x.add(target));\r\n                target.classList.add(CLASSES.animProgress);\r\n                setTimeout(() => {\r\n                    this._interactions.mutate(() => {\r\n                        actions.forEach(x => x.remove(target));\r\n                        target.classList.remove(CLASSES.animProgress);\r\n                        if (callback)\r\n                            callback();\r\n                        resolve(true)\r\n                    }, null)\r\n                }, timeout)\r\n            }, null)\r\n        })\r\n    }\r\n\r\n    /**\r\n     * Performs switch operation on two targets, by toggling in and out actions on in and out target.\r\n     * Note: this runs in async \r\n     * @param inTarget incoming target element\r\n     * @param outTarget outgoing target element\r\n     * @param inAction action for incoming target\r\n     * @param outAction action for outgoing target\r\n     * @param onFinish callback to be executed when perform is finished\r\n     * @param timeout timeout for perfrom\r\n     * @returns Promise when resolves after all acctions and callback are performed\r\n     */\r\n    async performSwitchAction(inTarget: Element, outTarget: Element | null, inAction: ICuiComponentAction[], outAction: ICuiComponentAction[], onFinish: () => void, timeout: number): Promise<boolean> {\r\n        return new Promise((resolve) => {\r\n            this._interactions.mutate(() => {\r\n                inAction.forEach(x => x.add(inTarget));\r\n                inTarget.classList.add(CLASSES.animProgress);\r\n                if (is(outTarget)) {\r\n                    //@ts-ignore\r\n                    outAction.forEach(x => x.add(outTarget));\r\n                    //@ts-ignore\r\n                    outTarget.classList.add(CLASSES.animProgress);\r\n                }\r\n                setTimeout(() => {\r\n                    this._interactions.mutate(() => {\r\n                        inAction.forEach(x => x.remove(inTarget));\r\n                        inTarget.classList.remove(CLASSES.animProgress);\r\n                        if (is(outTarget)) {\r\n                            //@ts-ignore\r\n                            outAction.forEach(x => x.remove(outTarget));\r\n                            //@ts-ignore\r\n                            outTarget.classList.remove(CLASSES.animProgress);\r\n                        }\r\n                        onFinish();\r\n                        resolve(true)\r\n                    }, null)\r\n                }, timeout)\r\n            }, null)\r\n        })\r\n    }\r\n}","import { is, are, splitColon } from \"./functions\";\r\nimport { CuiCore } from \"../models/core\";\r\n\r\nexport interface ICuiComponentAction {\r\n    add(element: Element, core?: CuiCore): void;\r\n    remove(element: Element, core?: CuiCore): void;\r\n    toggle(element: Element, core?: CuiCore): void;\r\n}\r\n\r\nexport class CuiClassAction implements ICuiComponentAction {\r\n    #class: string;\r\n\r\n    constructor(className: string) {\r\n        this.#class = className;\r\n    }\r\n\r\n    add(element: Element, core?: CuiCore): void {\r\n        if (are(element, this.#class) && !element.classList.contains(this.#class)) {\r\n            element.classList.add(this.#class);\r\n        }\r\n    }\r\n\r\n    remove(element: Element, core?: CuiCore): void {\r\n        if (are(element, this.#class) && element.classList.contains(this.#class)) {\r\n            element.classList.remove(this.#class);\r\n        }\r\n    }\r\n\r\n    toggle(element: Element, core?: CuiCore): void {\r\n        if (are(element, this.#class)) {\r\n            if (element.classList.contains(this.#class)) {\r\n                element.classList.remove(this.#class);\r\n            } else {\r\n                element.classList.add(this.#class);\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nexport class CuiInboundAction implements ICuiComponentAction {\r\n    _name: string;\r\n\r\n    constructor(name: string) {\r\n        this._name = name;\r\n    }\r\n    add(element: Element, core?: CuiCore): void {\r\n        if (!core) {\r\n            return;\r\n        }\r\n        switch (this._name) {\r\n            case 'dark-mode':\r\n                core.setLightMode('dark')\r\n                break;\r\n            case 'light-mode':\r\n                core.setLightMode('light')\r\n                break;\r\n        }\r\n    }\r\n\r\n    remove(element: Element, core?: CuiCore): void {\r\n        if (!core) {\r\n            return;\r\n        }\r\n        switch (this._name) {\r\n            case 'dark-mode':\r\n                core.setLightMode('light')\r\n                break;\r\n            case 'light-mode':\r\n                core.setLightMode('dark')\r\n                break;\r\n        }\r\n    }\r\n\r\n    toggle(element: Element, core?: CuiCore): void {\r\n        if (!core) {\r\n            return;\r\n        }\r\n        switch (this._name) {\r\n            case 'dark-mode':\r\n                this.setDarkMode(core)\r\n                break;\r\n            case 'light-mode':\r\n                this.setDarkMode(core)\r\n                break;\r\n        }\r\n    }\r\n\r\n    private setDarkMode(core: CuiCore) {\r\n        if (core.getLightMode() === 'dark') {\r\n            core.setLightMode('light')\r\n        } else {\r\n            core.setLightMode('dark')\r\n        }\r\n    }\r\n}\r\n\r\nexport class AttributeAction implements ICuiComponentAction {\r\n    private _attributeName: string;\r\n    private _attributeValue: string;\r\n    constructor(attribute: string) {\r\n        [this._attributeName, this._attributeValue] = splitColon(attribute);// attribute.split(',')\r\n    }\r\n\r\n    add(element: Element, core?: CuiCore): void {\r\n        if (!are(element, this._attributeName, this._attributeValue)) {\r\n            return;\r\n        }\r\n        element.setAttribute(this._attributeName, this._attributeValue)\r\n    }\r\n\r\n    remove(element: Element, core?: CuiCore): void {\r\n        if (!are(element, this._attributeName, this._attributeValue)) {\r\n            return;\r\n        }\r\n        if (element.hasAttribute(this._attributeName)) {\r\n            element.removeAttribute(this._attributeName)\r\n        }\r\n\r\n    }\r\n\r\n    toggle(element: Element, core?: CuiCore): void {\r\n        if (!are(element, this._attributeName, this._attributeValue)) {\r\n            return;\r\n        }\r\n        if (element.hasAttribute(this._attributeName)) {\r\n            element.removeAttribute(this._attributeName)\r\n        } else {\r\n            element.setAttribute(this._attributeName, this._attributeValue)\r\n        }\r\n    }\r\n}\r\n\r\n\r\nexport class StyleAction implements ICuiComponentAction {\r\n    private _attributeName: string;\r\n    private _attributeValue: string;\r\n    constructor(attribute: string) {\r\n        [this._attributeName, this._attributeValue] = splitColon(attribute);\r\n    }\r\n\r\n    add(element: Element, core?: CuiCore): void {\r\n        if (!are(element, this._attributeName, this._attributeValue)) {\r\n            return;\r\n        }\r\n        let el = element as any;\r\n        if (el.style && !el.style[this._attributeName]) {\r\n            el.style[this._attributeName] = this._attributeValue;\r\n        }\r\n\r\n    }\r\n\r\n    remove(element: Element, core?: CuiCore): void {\r\n        if (!are(element, this._attributeName, this._attributeValue)) {\r\n            return;\r\n        }\r\n        let el = element as any;\r\n        if (el.style && el.style[this._attributeName]) {\r\n            el.style[this._attributeName] = \"\";\r\n        }\r\n\r\n    }\r\n\r\n    toggle(element: Element, core?: CuiCore): void {\r\n        if (!are(element, this._attributeName, this._attributeValue)) {\r\n            return;\r\n        }\r\n        let el = element as any;\r\n        if (!el.style) {\r\n            return;\r\n        }\r\n        if (!el.style[this._attributeName]) {\r\n            el.style[this._attributeName] = this._attributeValue;\r\n        } else {\r\n            delete el.style[this._attributeName];\r\n        }\r\n    }\r\n}\r\n\r\nexport class DummyAction implements ICuiComponentAction {\r\n    constructor() {\r\n    }\r\n\r\n    add(element: Element, utils?: CuiCore): void {\r\n\r\n    }\r\n\r\n    remove(element: Element, utils?: CuiCore): void {\r\n    }\r\n\r\n    toggle(element: Element, utils?: CuiCore): void {\r\n    }\r\n}\r\n\r\nexport class CuiActionsFactory {\r\n    public static get(value: string): ICuiComponentAction {\r\n        if (!is(value)) {\r\n            return new DummyAction();\r\n        }\r\n        let indicator = value[0];\r\n        switch (indicator) {\r\n            case '.':\r\n                return new CuiClassAction(value.substring(1));\r\n            case '~':\r\n                return new CuiInboundAction(value.substring(1));\r\n            case \"&\":\r\n                return new AttributeAction(value.substring(1));\r\n            case \"^\":\r\n                return new StyleAction(value.substring(1));\r\n            default:\r\n                return new CuiClassAction(value);\r\n        }\r\n    }\r\n}\r\n\r\nexport class CuiActionsListFactory {\r\n    public static get(value: string): ICuiComponentAction[] {\r\n        if (!is(value)) {\r\n            return [];\r\n        }\r\n        const split = value.split(',');\r\n        return split.map(single => {\r\n            return CuiActionsFactory.get(single.trim());\r\n        })\r\n    }\r\n}","import { is, are } from \"../../core/utils/functions\";\r\nimport { CuiCachable, CuiElement } from \"../../core/models/interfaces\";\r\nimport { CuiCore } from \"../../core/models/core\";\r\nimport { CuiActionsHelper } from \"../../core/helpers/helpers\";\r\nimport { CuiActionsFactory, CuiClassAction } from \"../../core/utils/actions\";\r\nimport { ICuiDevelopmentTool } from \"../../core/development/interfaces\";\r\nimport { CuiDevtoolFactory } from \"../../core/development/factory\";\r\n\r\nexport class ElementManager implements CuiCachable {\r\n    private _elements: Element[];\r\n    private _isLocked: boolean;\r\n    private _logger: ICuiDevelopmentTool;\r\n    private _cDt: number;\r\n    private _core: CuiCore;\r\n    private _actionsHelper: CuiActionsHelper;\r\n    constructor(elements: Element[], utils: CuiCore) {\r\n        this._elements = elements;\r\n        this._isLocked = false;\r\n        this._logger = CuiDevtoolFactory.get(\"ElementManager\");\r\n        this._core = utils;\r\n        this._cDt = Date.now();\r\n        this._actionsHelper = new CuiActionsHelper(utils.interactions);\r\n    }\r\n\r\n    async toggleClass(className: string): Promise<boolean> {\r\n        if (!is(className)) {\r\n            return false;\r\n        }\r\n        return this.call((element) => {\r\n            if (!element.classList.contains(className)) {\r\n                element.classList.add(className);\r\n            } else {\r\n                element.classList.remove(className);\r\n            }\r\n        }, 'toggleClass');\r\n    }\r\n\r\n    async toggleClassAs(className: string): Promise<boolean> {\r\n        if (!is(className)) {\r\n            return false;\r\n        }\r\n        return this.call((element) => {\r\n            let classes = element.classList;\r\n            this._core.interactions.fetch(() => {\r\n                if (!classes.contains(className)) {\r\n                    this._core.interactions.mutate(classes.add, classes, className);\r\n                } else {\r\n                    this._core.interactions.mutate(classes.remove, classes, className);\r\n                }\r\n            }, this)\r\n\r\n        }, 'toggleClassAs');\r\n    }\r\n\r\n    async setClass(className: string): Promise<boolean> {\r\n        if (!is(className)) {\r\n            return false;\r\n        }\r\n        return this.call((element) => {\r\n            if (!element.classList.contains(className)) {\r\n                element.classList.add(className)\r\n            }\r\n        }, 'setClass');\r\n    }\r\n\r\n    async setClassAs(className: string): Promise<boolean> {\r\n        if (!is(className)) {\r\n            return false;\r\n        }\r\n\r\n        return this.call((element) => {\r\n            let classes = element.classList;\r\n            this._core.interactions.fetch(() => {\r\n                if (!classes.contains(className)) {\r\n                    this._core.interactions.mutate(classes.add, classes, className);\r\n                }\r\n            }, this)\r\n\r\n        }, 'setClassAs');\r\n    }\r\n\r\n    async removeClass(className: string): Promise<boolean> {\r\n        if (!is(className)) {\r\n            return false;\r\n        }\r\n        return this.call((element) => {\r\n            if (element.classList.contains(className)) {\r\n                element.classList.remove(className)\r\n            }\r\n        }, 'removeClass');\r\n    }\r\n\r\n    async removeClassAs(className: string): Promise<boolean> {\r\n        if (!is(className)) {\r\n            return false;\r\n        }\r\n        return this.call((element) => {\r\n            let classes = element.classList;\r\n            this._core.interactions.fetch(() => {\r\n                if (classes.contains(className)) {\r\n                    this._core.interactions.mutate(classes.remove, classes, className);\r\n                }\r\n            }, this)\r\n        }, 'removeClass');\r\n    }\r\n\r\n    getAttribute(attributeName: string): string[] {\r\n        if (!is(attributeName)) {\r\n            return [];\r\n        }\r\n        return this._elements.reduce<string[]>((val: string[], current: Element) => {\r\n            let attr = current.getAttribute(attributeName);\r\n            if (attr != null) {\r\n                val.push(attr)\r\n            }\r\n            return val;\r\n        }, []);\r\n    }\r\n\r\n    async setAttribute(attributeName: string, attributeValue?: string): Promise<boolean> {\r\n        if (!is(attributeName)) {\r\n            return false;\r\n        }\r\n        return this.call((element) => {\r\n            element.setAttribute(attributeName, attributeValue ?? \"\")\r\n        }, 'setAttribute');\r\n    }\r\n\r\n    async setAttributeAs(attributeName: string, attributeValue?: string): Promise<boolean> {\r\n        if (!is(attributeName)) {\r\n            return false;\r\n        }\r\n        return this.call((element) => {\r\n            this._core.interactions.mutate(element.setAttribute, element, attributeName, attributeValue ?? \"\")\r\n        }, 'setAttributeAs');\r\n    }\r\n\r\n    async removeAttribute(attributeName: string): Promise<boolean> {\r\n        if (!is(attributeName)) {\r\n            return false;\r\n        }\r\n        return this.call((element) => {\r\n            element.removeAttribute(attributeName)\r\n        }, 'removeAttribute');\r\n    }\r\n\r\n    async removeAttributeAs(attributeName: string): Promise<boolean> {\r\n        if (!is(attributeName)) {\r\n            return false;\r\n        }\r\n        return this.call((element) => {\r\n            this._core.interactions.mutate(element.removeAttribute, element, attributeName);\r\n        }, 'removeAttributeAs');\r\n    }\r\n\r\n    async toggleAttribute(attributeName: string, attributeValue?: string): Promise<boolean> {\r\n        if (!is(attributeName)) {\r\n            return false;\r\n        }\r\n        return this.call((element) => {\r\n            if (element.hasAttribute(attributeName)) {\r\n                element.removeAttribute(attributeName)\r\n            } else {\r\n                element.setAttribute(attributeName, attributeValue ?? \"\")\r\n            }\r\n        }, 'toggleAttribute');\r\n    }\r\n\r\n    async toggleAttributeAs(attributeName: string, attributeValue?: string): Promise<boolean> {\r\n        if (!is(attributeName)) {\r\n            return false;\r\n        }\r\n        return this.call((element) => {\r\n            this._core.interactions.fetch(() => {\r\n                if (element.hasAttribute(attributeName)) {\r\n                    this._core.interactions.mutate(element.removeAttribute, element, attributeName);\r\n                } else {\r\n                    this._core.interactions.mutate(element.setAttribute, element, attributeName, attributeValue ?? \"\")\r\n                }\r\n            }, this)\r\n\r\n        }, 'toggleAttributeAs');\r\n    }\r\n\r\n    async click(onClick: (ev: MouseEvent) => void): Promise<boolean> {\r\n        if (!is(onClick)) {\r\n            return false;\r\n        }\r\n        return this.call((element) => {\r\n            //@ts-ignore\r\n            element.addEventListener('click', onClick);\r\n        }, 'click');\r\n    }\r\n\r\n    async event(eventName: string, callback: any): Promise<boolean> {\r\n        if (!is(eventName) || !is(callback)) {\r\n            return false;\r\n        }\r\n        return this.call((element) => {\r\n            element.addEventListener(eventName, callback);\r\n        }, 'event');\r\n    }\r\n\r\n    async call(callback: (element: Element, index: Number) => void, functionName?: string): Promise<boolean> {\r\n        if (this._isLocked) {\r\n            this._logger.error(\"Element is locked\", functionName)\r\n        }\r\n        this.lock();\r\n        this._elements.forEach((element, index) => {\r\n            callback(element, index)\r\n        })\r\n        this.unlock();\r\n        return true;\r\n    }\r\n\r\n    async setAction(actionStr: string, animationClass: string, timeout?: number): Promise<boolean> {\r\n        if (!is(actionStr)) {\r\n            return false\r\n        }\r\n        let act = CuiActionsFactory.get(actionStr);\r\n        return this.animate(animationClass, timeout, (element: Element) => {\r\n            act.add(element);\r\n        })\r\n    }\r\n\r\n    async removeAction(actionStr: string, animationClass: string, timeout?: number): Promise<boolean> {\r\n        if (!is(actionStr)) {\r\n            return false\r\n        }\r\n        let act = CuiActionsFactory.get(actionStr);\r\n        return this.animate(animationClass, timeout, (element: Element) => {\r\n            act.remove(element);\r\n        })\r\n    }\r\n    /**\r\n     * Perform animation on the element\r\n     * @param animationClass \r\n     * @param timeout \r\n     * @param callback \r\n     */\r\n    async animate(animationClass: string, timeout?: number, callback?: (element: Element) => void) {\r\n        if (!is(animationClass)) {\r\n            return false\r\n        }\r\n        const delay = timeout ?? this._core.setup.animationTime ?? 0;\r\n        const action = new CuiClassAction(animationClass);\r\n        return this.call((element) => {\r\n            return this._actionsHelper.performAction(element, action, delay, () => {\r\n                if (callback)\r\n                    callback(element);\r\n            });\r\n        });\r\n    }\r\n\r\n    emit(event: string, ...args: any[]): void {\r\n        if (!is(event)) {\r\n            this._logger.warning(\"Not enough data to emit event\", \"emit\")\r\n            return;\r\n        }\r\n        this.call((element: Element) => {\r\n            let cuid = (<CuiElement>(element as any)).$cuid;\r\n            if (is(cuid)) {\r\n                this._logger.debug(`Emitting event ${event} to ${cuid}`)\r\n                this._core.bus.emit(event, cuid, ...args);\r\n            }\r\n        }, \"emit\")\r\n    }\r\n\r\n    on(event: string, callback: any): string[] {\r\n        let ids: string[] = []\r\n        if (!are(event, callback)) {\r\n            this._logger.error(\"Incorrect arguments\", \"on\")\r\n            return ids;\r\n        }\r\n\r\n        this.call((element: Element) => {\r\n            let cuiElement = (<CuiElement>(element as any));\r\n            if (is(cuiElement)) {\r\n                let disposeId = this._core.bus.on(event, callback, cuiElement);\r\n                if (disposeId != null)\r\n                    ids.push(disposeId);\r\n            }\r\n        }, \"on\")\r\n        return ids;\r\n    }\r\n\r\n    detach(event: string, id: string): void {\r\n        if (!are(event, id)) {\r\n            this._logger.error(\"Incorrect arguments\", \"detach\")\r\n        }\r\n        this.call((element: Element) => {\r\n            let cuiElement = (<CuiElement>(element as any));\r\n            if (is(cuiElement)) {\r\n                this._core.bus.detach(event, id, cuiElement);\r\n            }\r\n        }, \"detach\")\r\n    }\r\n\r\n    read(callback: any, ...args: any[]): void {\r\n        this._core.interactions.fetch(callback, this, ...args)\r\n    }\r\n\r\n    change(callback: any, ...args: any[]): void {\r\n        this._core.interactions.mutate(callback, this, ...args)\r\n    }\r\n\r\n    elements(): Element[] {\r\n        return this._elements;\r\n    }\r\n\r\n    count() {\r\n        return this._elements.length;\r\n    }\r\n\r\n    lock() {\r\n        this._isLocked = true;\r\n    }\r\n\r\n    unlock() {\r\n        this._isLocked = false;\r\n    }\r\n\r\n    isLocked(): boolean {\r\n        return this._isLocked;\r\n    }\r\n\r\n    refresh(): boolean {\r\n        return (Date.now() - this._cDt) < 360000;\r\n    }\r\n}","import { CuiDevtoolFactory } from \"../../core/development/factory\";\r\nimport { ICuiDevelopmentTool } from \"../../core/development/interfaces\";\r\nimport { ICuiPlugin, ICuiMutiationPlugin, ICuiPluginManager } from \"../../core/models/interfaces\";\r\nimport { CuiCore } from \"../../core/models/core\";\r\nimport { is } from \"../../core/utils/functions\";\r\n\r\n\r\n\r\nexport class CuiPluginManager implements ICuiPluginManager {\r\n    private _plugins: ICuiPlugin[];\r\n    private _mutated: ICuiMutiationPlugin[];\r\n    private _log: ICuiDevelopmentTool;\r\n    constructor(plugins: ICuiPlugin[]) {\r\n        this._plugins = plugins ?? [];\r\n        this._log = CuiDevtoolFactory.get(\"CuiPluginManager\");\r\n        this._mutated = [];\r\n    }\r\n\r\n    init(core: CuiCore): void {\r\n        this._log.debug(\"Plugins initialization started: \" + this._plugins.length)\r\n        this._mutated = this._plugins.filter((plugin: any) => {\r\n            return is(plugin.mutation);\r\n        }) as any;\r\n        this._plugins.forEach(plugin => {\r\n            plugin.init(core);\r\n            core.setup.plugins[plugin.description] = plugin.setup;\r\n        })\r\n        this._log.debug(\"Plugins have been initialized\");\r\n    }\r\n\r\n    get(name: string): ICuiPlugin | undefined {\r\n        if (!is(name)) {\r\n            return undefined;\r\n        }\r\n        return this._plugins.find(p => p.name === name);\r\n    }\r\n\r\n    has(name: string): boolean {\r\n        return is(this.get(name))\r\n    }\r\n\r\n    async onMutation(mutation: MutationRecord): Promise<boolean> {\r\n        let tasks: Promise<boolean>[] = [];\r\n        this._mutated.forEach((plugin: any) => {\r\n            tasks.push(plugin.mutation(mutation))\r\n        })\r\n        let result: boolean[] = await Promise.all(tasks);\r\n        return result.find(val => {\r\n            val === false\r\n        }) ? false : true;\r\n    }\r\n\r\n}","import { CuiHTMLElement, ICuiComponent } from \"../models/interfaces\";\r\nimport { CuiCore } from \"../models/core\";\r\nimport { ICuiApiHandler } from \"./interfaces\";\r\nimport { createCuiElement, destroyCuiElement, getMatchingComponents, updateComponent } from \"./functions\";\r\n\r\nexport class CuiApiHandler implements ICuiApiHandler {\r\n    private _components: ICuiComponent[];\r\n    private _core: CuiCore;\r\n\r\n    constructor(components: ICuiComponent[], core: CuiCore) {\r\n        this._components = components;\r\n        this._core = core;\r\n    }\r\n    async registerComponent(node: CuiHTMLElement): Promise<boolean> {\r\n        let matching = getMatchingComponents(node, this._components);\r\n        if (!matching || matching.length === 0) {\r\n            return false;\r\n        }\r\n        return createCuiElement(node, matching, this._core);\r\n    }\r\n    async updateComponent(node: CuiHTMLElement, component: string, args?: any): Promise<boolean> {\r\n        if (!node.hasAttribute(component)) {\r\n            return false;\r\n        }\r\n        return updateComponent(node, component, args);\r\n    }\r\n    async destroyComponent(node: CuiHTMLElement): Promise<boolean> {\r\n        return destroyCuiElement(node);\r\n    }\r\n\r\n}","import { CuiSetupInit } from \"../core/models/setup\";\r\nimport { is, joinAttributesForQuery, are } from \"../core/utils/functions\";\r\nimport { STATICS, EVENTS, CSS_VARIABLES } from \"../core/utils/statics\";\r\nimport { ICuiPlugin, ICuiComponent, ICuiPluginManager, CuiElement } from \"../core/models/interfaces\";\r\nimport { ICuiMutionObserver, CuiMutationObserver } from \"../core/observers/mutations\";\r\nimport { CuiCore } from \"../core/models/core\";\r\nimport { CuiInstanceInitError } from \"../core/models/errors\";\r\nimport { ElementManager } from \"./managers/element\";\r\nimport { CuiPluginManager } from \"./managers/plugins\";\r\nimport { CuiDevtoolFactory } from \"../core/development/factory\";\r\nimport { ICuiDevelopmentTool } from \"../core/development/interfaces\";\r\nimport { ICuiApiHandler } from \"src/core/api/interfaces\";\r\nimport { CuiApiHandler } from \"../core/api/handler\";\r\nimport { getMatchingComponents, createCuiElement, addCuiArgument } from \"../core/api/functions\";\r\n\r\nexport class CuiInstance {\r\n    private _log: ICuiDevelopmentTool;\r\n    private _mutationObserver: ICuiMutionObserver | undefined;\r\n    private _core: CuiCore;\r\n    private _plugins: ICuiPluginManager;\r\n    private _components: ICuiComponent[];\r\n    private _rootElement: HTMLElement;\r\n    private _mutatedAttributes: string[];\r\n    private _api: ICuiApiHandler;\r\n    constructor(setup: CuiSetupInit, plugins: ICuiPlugin[], components: ICuiComponent[]) {\r\n        STATICS.prefix = setup.prefix;\r\n        STATICS.logLevel = setup.logLevel;\r\n        if (setup.development)\r\n            STATICS.devTool = setup.development;\r\n        this._plugins = new CuiPluginManager(plugins);\r\n        this._components = components ?? [];\r\n        this._core = new CuiCore(setup, plugins.map(plugin => { return plugin.name; }));\r\n        this._log = CuiDevtoolFactory.get(\"CuiInstance\");\r\n        this._rootElement = setup.root;\r\n        this._mutationObserver = undefined;\r\n        this._mutatedAttributes = [];\r\n        this._api = new CuiApiHandler(this._components, this._core);\r\n    }\r\n\r\n    async init(): Promise<CuiInstance> {\r\n        this._log.debug(\"Instance started\", \"init\")\r\n        // Init elements\r\n        if (!is(window.MutationObserver)) {\r\n            throw new CuiInstanceInitError(\"Mutation observer does not exists\");\r\n        }\r\n        this._mutatedAttributes = this._components.map(x => { return x.attribute }); // MUTATED_ATTRIBUTES; \r\n        const initElements = is(this._mutatedAttributes) ? this._rootElement.querySelectorAll(joinAttributesForQuery(this._mutatedAttributes)) : null;\r\n        if (is(initElements)) {\r\n            //@ts-ignore initElements already checked\r\n            this._log.debug(`Initiating ${initElements.length} elements`)\r\n            let promises = [];\r\n            //@ts-ignore initElements already checked\r\n            for (let element of initElements) {\r\n                try {\r\n                    let matchingComponents = getMatchingComponents(element, this._components)\r\n                    promises.push(createCuiElement(element, matchingComponents, this._core));\r\n                } catch (e) {\r\n                    this._log.exception(e);\r\n                }\r\n            }\r\n            await Promise.all(promises);\r\n        }\r\n        this._log.debug(\"Init plugins\", \"init\")\r\n        // Init plugins\r\n        this._plugins.init(this._core);\r\n\r\n        if (are(this._components, this._mutatedAttributes)) {\r\n            this._log.debug(\"Init mutation observer\", \"init\")\r\n            this._mutationObserver = new CuiMutationObserver(this._rootElement, this._core)\r\n            this._mutationObserver.setComponents(this._components).setAttributes(this._mutatedAttributes)\r\n            this._mutationObserver.setPlugins(this._plugins);\r\n            this._mutationObserver.start();\r\n        }\r\n\r\n        this._log.debug(\"Setting CSS globals\", 'init')\r\n        this._core.interactions.mutate(() => {\r\n            this._core.setProperty(CSS_VARIABLES.animationTimeLong, `${this._core.setup.animationTimeLong}ms`)\r\n            this._core.setProperty(CSS_VARIABLES.animationTime, `${this._core.setup.animationTime}ms`);\r\n            this._core.setProperty(CSS_VARIABLES.animationTimeShort, `${this._core.setup.animationTimeShort}ms`);\r\n        }, null)\r\n\r\n        this._core.bus.emit(EVENTS.INSTANCE_INITIALIZED, null)\r\n        return this;\r\n    }\r\n\r\n    finish(): void {\r\n        if (this._mutationObserver)\r\n            this._mutationObserver.stop();\r\n        this._core.bus.emit(EVENTS.INSTANCE_FINISHED, null)\r\n    }\r\n\r\n    get(selector: string): ElementManager | undefined {\r\n        const elements = this.all(selector);\r\n        if (!elements) {\r\n            return undefined;\r\n        }\r\n        const newElement = new ElementManager(elements, this._core);\r\n        return newElement\r\n    }\r\n\r\n    all(selector: string): Element[] | undefined {\r\n        const nodes: NodeListOf<Element> = document.querySelectorAll(selector);\r\n        if (!is(nodes)) {\r\n            return undefined;\r\n        }\r\n        return [...nodes];\r\n    }\r\n\r\n    getUtils(): CuiCore {\r\n        return this._core//;\r\n    }\r\n\r\n    on(event: string, callback: any, element?: CuiElement): string | null {\r\n        if (!are(event, callback)) {\r\n            this._log.error(\"Incorrect arguments\", \"on\")\r\n            return null;\r\n        }\r\n        return this._core.bus.on(event, callback, element);\r\n    }\r\n\r\n    detach(event: string, id: string): void {\r\n        if (!are(event, id)) {\r\n            this._log.error(\"Incorrect arguments\", \"detach\")\r\n        }\r\n        this._core.bus.detach(event, id);\r\n    }\r\n\r\n    detachAll(event: string): void {\r\n        if (!is(event)) {\r\n            this._log.error(\"Incorrect arguments\", \"detachAll\")\r\n        }\r\n        this._core.bus.detachAll(event);\r\n    }\r\n\r\n    emit(event: string, element: Element | string, ...args: any[]): void {\r\n        if (!are(event, element)) {\r\n            this._log.warning(\"Not enough data to emit event\", \"emit\")\r\n            return;\r\n        }\r\n        let cuid = null\r\n        if (typeof element === 'string' && element.startsWith('~')) {\r\n            cuid = element.substring(1);\r\n        } else {\r\n            let el = typeof element === 'string' ? document.querySelector(element) : element;\r\n            cuid = (<CuiElement>(el as any)).$cuid;\r\n        }\r\n        if (!is(cuid)) {\r\n            this._log.warning(\"Element is not a cUI element\", \"emit\")\r\n            return\r\n        }\r\n        this._core.bus.emit(event, cuid, ...args);\r\n    }\r\n\r\n    getPlugin(name: string): ICuiPlugin | undefined {\r\n        return this._plugins.get(name);\r\n    }\r\n\r\n    api(): ICuiApiHandler {\r\n        return this._api;\r\n    }\r\n\r\n\r\n    /**\r\n     * Creates cUI element outside of cUI root scope\r\n     * @param element \r\n     * @param arg \r\n     * @param data \r\n     */\r\n    async createCuiElement<T extends object>(element: HTMLElement, arg: string, data: T): Promise<boolean> {\r\n        if (!is(arg) || !this._mutatedAttributes.includes(arg)) {\r\n            this._log.error(\"Element cannot be created: Unknown attribute\")\r\n            return false;\r\n        }\r\n        let component = this._components.find(component => component.attribute === arg);\r\n\r\n        if (!component)\r\n            return false;\r\n\r\n        if (addCuiArgument(element, arg, data)) {\r\n            return createCuiElement(element, [component], this._core);\r\n        }\r\n\r\n        return false;\r\n    }\r\n}","import { PropsTypes } from \"./engine\";\r\nimport { AnimationProperty } from \"./interfaces\";\r\n\r\nexport interface AnimationDefinition {\r\n    previous: DefinitionItem;\r\n    current: DefinitionItem;\r\n}\r\n\r\nexport interface DefinitionItem {\r\n    left: AnimationProperty<PropsTypes>;\r\n    right: AnimationProperty<PropsTypes>\r\n}\r\n\r\nexport interface CuiAnimationsDefinition {\r\n    [id: string]: AnimationDefinition;\r\n}\r\n\r\nexport const SWIPE_ANIMATIONS_DEFINITIONS: CuiAnimationsDefinition = {\r\n    \"slide\": {\r\n        current: {\r\n            left: {\r\n                transform: {\r\n                    translateX: {\r\n                        from: 0,\r\n                        to: -100,\r\n                        unit: \"%\"\r\n                    }\r\n                }\r\n            },\r\n            right: {\r\n                transform: {\r\n                    translateX: {\r\n                        from: 0,\r\n                        to: 100,\r\n                        unit: \"%\"\r\n                    }\r\n                }\r\n            }\r\n        },\r\n        previous: {\r\n            left: {\r\n                transform: {\r\n                    translateX: {\r\n                        from: 100,\r\n                        to: 0,\r\n                        unit: \"%\"\r\n                    }\r\n                }\r\n            },\r\n            right: {\r\n                transform: {\r\n                    translateX: {\r\n                        from: -100,\r\n                        to: 0,\r\n                        unit: \"%\"\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    },\r\n    fade: {\r\n        current: {\r\n            left: {\r\n                opacity: {\r\n                    from: 1,\r\n                    to: 0\r\n                }\r\n            },\r\n            right: {\r\n                opacity: {\r\n                    from: 1,\r\n                    to: 0\r\n                }\r\n            }\r\n        },\r\n        previous: {\r\n            left: {\r\n                opacity: {\r\n                    from: 0,\r\n                    to: 1\r\n                }\r\n            },\r\n            right: {\r\n                opacity: {\r\n                    from: 0,\r\n                    to: 1\r\n                }\r\n            }\r\n        }\r\n    },\r\n    push: {\r\n        current: {\r\n            left: {\r\n                transform: {\r\n                    translateX: {\r\n                        from: 0,\r\n                        to: -10,\r\n                        unit: \"%\"\r\n                    }\r\n                }\r\n            },\r\n            right: {\r\n                transform: {\r\n                    translateX: {\r\n                        from: 0,\r\n                        to: 10,\r\n                        unit: \"%\"\r\n                    }\r\n                }\r\n            }\r\n        },\r\n        previous: {\r\n            left: {\r\n                transform: {\r\n                    translateX: {\r\n                        from: 100,\r\n                        to: 0,\r\n                        unit: \"%\"\r\n                    }\r\n                }\r\n            },\r\n            right: {\r\n                transform: {\r\n                    translateX: {\r\n                        from: -100,\r\n                        to: 0,\r\n                        unit: \"%\"\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n","import { CuiSetupInit } from \"../core/models/setup\";\r\nimport { is } from \"../core/utils/functions\";\r\nimport { CuiInstance } from \"./instance\";\r\nimport { ICONS } from \"../core/utils/statics\";\r\nimport { ICuiComponent, ICuiPlugin } from \"../core/models/interfaces\";\r\nimport {\r\n\tCuiAnimationsDefinition,\r\n\tSWIPE_ANIMATIONS_DEFINITIONS,\r\n} from \"../core/animation/definitions\";\r\n\r\nexport interface CuiInitData {\r\n\tplugins?: ICuiPlugin[];\r\n\tcomponents?: ICuiComponent[];\r\n\tsetup?: CuiSetupInit;\r\n\ticons?: any;\r\n\tswipeAnimations?: CuiAnimationsDefinition;\r\n}\r\n\r\nexport interface CuiInitResult {\r\n\tresult: boolean;\r\n\tmessage?: string;\r\n}\r\n\r\nasync function initIcons(setup: CuiInitData): Promise<string | undefined> {\r\n\tif (!is(setup.icons)) {\r\n\t\treturn;\r\n\t}\r\n\tfor (let icon in setup.icons) {\r\n\t\tICONS[icon] = setup.icons[icon];\r\n\t}\r\n\treturn;\r\n}\r\n\r\nasync function initSwipeAnimations(\r\n\tsetup: CuiInitData\r\n): Promise<string | undefined> {\r\n\tif (!is(setup.swipeAnimations)) {\r\n\t\treturn;\r\n\t}\r\n\tfor (let animation in setup.swipeAnimations) {\r\n\t\tSWIPE_ANIMATIONS_DEFINITIONS[animation] =\r\n\t\t\tsetup.swipeAnimations[animation];\r\n\t}\r\n\treturn;\r\n}\r\n\r\nfunction initInstance(root: any, settings: CuiSetupInit) {\r\n\treturn async (setup: CuiInitData): Promise<string | undefined> => {\r\n\t\ttry {\r\n\t\t\troot[settings.app] = new CuiInstance(\r\n\t\t\t\tsettings,\r\n\t\t\t\tsetup.plugins ?? [],\r\n\t\t\t\tsetup.components ?? []\r\n\t\t\t);\r\n\t\t\tawait root[settings.app].init();\r\n\t\t} catch (e) {\r\n\t\t\tconsole.error(e);\r\n\t\t\treturn e.message;\r\n\t\t}\r\n\t\treturn;\r\n\t};\r\n}\r\n\r\nfunction checkIfExists(root: any, prefix: string) {\r\n\treturn async () => {\r\n\t\tif (is(root[prefix])) {\r\n\t\t\treturn \"Instance is already initialized\";\r\n\t\t}\r\n\t};\r\n}\r\n\r\nexport default async function CuiInitializer(\r\n\tsetup: CuiInitData\r\n): Promise<CuiInitResult> {\r\n\tconst _window: any = window;\r\n\tlet settings: CuiSetupInit = { ...new CuiSetupInit(), ...setup.setup };\r\n\tconst appPrefix: string = settings.app;\r\n\tconst result: CuiInitResult = {\r\n\t\tresult: false,\r\n\t};\r\n\tconst steps = [\r\n\t\tcheckIfExists(_window, appPrefix),\r\n\t\tinitIcons,\r\n\t\tinitSwipeAnimations,\r\n\t\tinitInstance(_window, settings),\r\n\t];\r\n\r\n\tfor (let step of steps) {\r\n\t\tconst errMsg = await step(setup);\r\n\t\tif (errMsg) {\r\n\t\t\tresult.message = errMsg;\r\n\t\t\treturn result;\r\n\t\t}\r\n\t}\r\n\tresult.result = true;\r\n\treturn result;\r\n}\r\n","import { CuiElement, ICuiEventListener, ICuiPlugin } from \"src/core/models/interfaces\";\r\nimport { CuiCore } from \"src/core/models/core\";\r\n\r\nexport interface ICuiPluginExtension {\r\n    init(utils: CuiCore): Promise<boolean>;\r\n    finish(): Promise<boolean>;\r\n}\r\n\r\nexport interface ICuiPluginEventExtensionSetup<T> {\r\n    name: string,\r\n    callback: (t: T) => void;\r\n    id?: string;\r\n}\r\n\r\nexport interface CuiPluginDestroyCallback {\r\n    (): void;\r\n}\r\n\r\nexport interface CuiPluginImplCallback<T> {\r\n    (utils: CuiCore, t: T): [ICuiPluginExtension[], CuiPluginDestroyCallback | undefined];\r\n}\r\n\r\n\r\nexport interface ICuiPluginImpl<T> {\r\n    name: string;\r\n    description: string;\r\n    setup: T;\r\n    callback?: CuiPluginImplCallback<T>;\r\n}\r\n\r\nexport class CuiPlugin<T> implements ICuiPlugin {\r\n    description: string;\r\n    name: string;\r\n    setup: T;\r\n    private _callback: CuiPluginImplCallback<T> | undefined;\r\n    private _onDestroy: CuiPluginDestroyCallback | void | undefined;\r\n    private _extensions: ICuiPluginExtension[] | undefined;\r\n    constructor(setup: ICuiPluginImpl<T>) {\r\n        this._onDestroy = undefined;\r\n        this._callback = setup.callback;\r\n        this.name = setup.name;\r\n        this.description = setup.description;\r\n        this.setup = setup.setup;\r\n        this._extensions = [];\r\n    }\r\n\r\n    init(utils: CuiCore): void {\r\n        if (this._callback) {\r\n            [this._extensions, this._onDestroy] = this._callback(utils, this.setup);\r\n        }\r\n        this.forEachExtension((extension) => {\r\n            return extension.init(utils)\r\n        }).then((result) => {\r\n\r\n        })\r\n    }\r\n    destroy(): void {\r\n        this.forEachExtension((extension) => {\r\n            return extension.finish()\r\n        }).then((result) => {\r\n\r\n        })\r\n        if (this._onDestroy) {\r\n            this._onDestroy();\r\n        }\r\n    }\r\n\r\n    private async forEachExtension(callback: (extension: ICuiPluginExtension) => Promise<boolean>): Promise<boolean> {\r\n        if (!this._extensions || this._extensions.length === 0) {\r\n            return true;\r\n        }\r\n        const promises: Promise<boolean>[] = [];\r\n        this._extensions.forEach((extension) => {\r\n            promises.push(callback(extension))\r\n        })\r\n        await Promise.all(promises);\r\n        return true;\r\n    }\r\n\r\n\r\n}\r\n\r\nexport function getPluginEventExtension<T>(setup: ICuiPluginEventExtensionSetup<T>): ICuiPluginExtension {\r\n    let _utils: CuiCore | undefined = undefined;\r\n    let _handleId: string | null = null;\r\n\r\n    function getCui(): CuiElement {\r\n        return { $cuid: setup.id ?? setup.name }\r\n    }\r\n    return {\r\n        init: async (utils: CuiCore) => {\r\n            _utils = utils;\r\n            if (_handleId) {\r\n                return false;\r\n            }\r\n            _handleId = utils.bus.on<T>(setup.name, setup.callback, getCui())\r\n            return true;\r\n        },\r\n        finish: async () => {\r\n            if (!_utils || !_handleId) {\r\n                return false;\r\n            }\r\n            _utils.bus.detach(setup.name, _handleId, getCui())\r\n            _handleId = null;\r\n            return true;\r\n        }\r\n    }\r\n}\r\n\r\nexport interface ICuiPluginListenerExtensionSetup<T> {\r\n    listener: ICuiEventListener<T>;\r\n}\r\n\r\nexport function getPluginListenerExtension<T>(setup: ICuiPluginListenerExtensionSetup<T>): ICuiPluginExtension {\r\n    return {\r\n        init: async (utils: CuiCore) => {\r\n            if (setup.listener.isAttached()) {\r\n                return false;\r\n            }\r\n            setup.listener.attach();\r\n            return true;\r\n        },\r\n        finish: async () => {\r\n            if (!setup.listener.isAttached()) {\r\n                return false;\r\n            }\r\n            setup.listener.detach();\r\n            return true;\r\n        }\r\n    }\r\n}\r\n","import { is, enumerateObject, are } from \"../utils/functions\";\r\n\r\nexport interface ElementBuilderAttribute {\r\n    [name: string]: string;\r\n}\r\nexport class ElementBuilder {\r\n    private _id: string | undefined;\r\n    private _classes: string[];\r\n    private _attributes: ElementBuilderAttribute | undefined;\r\n    private _tag: string;\r\n    private _text: string | undefined;\r\n    private _children: Element[];\r\n    private _rawChildren: ElementBuilder[];\r\n    private _callback: ((ev: any) => void) | undefined;\r\n    private _evName: string | undefined;\r\n    constructor(tag: string) {\r\n        this._tag = tag;\r\n        this._classes = [];\r\n        this._attributes = undefined;\r\n        this._id = undefined;\r\n        this._text = undefined;\r\n        this._children = [];\r\n        this._rawChildren = [];\r\n        this._evName = undefined;\r\n        this._callback = undefined;\r\n    }\r\n\r\n    setId(id: string): ElementBuilder {\r\n        this._id = id;\r\n        return this;\r\n    }\r\n\r\n    setClasses(...classList: string[]): ElementBuilder {\r\n        this._classes = classList;\r\n        return this;\r\n    }\r\n\r\n    setAttributes(attributes: ElementBuilderAttribute): ElementBuilder {\r\n        this._attributes = attributes;\r\n        return this;\r\n    }\r\n\r\n    setTextContent(text: string) {\r\n        this._text = text;\r\n        return this;\r\n    }\r\n\r\n    setChildren(...elements: Element[]) {\r\n        this._children = [...elements];\r\n        return this;\r\n    }\r\n\r\n    setRawChildren(...elements: ElementBuilder[]) {\r\n        this._rawChildren = [...elements];\r\n        return this;\r\n    }\r\n\r\n    onEvent(name: string, callback: (ev: any) => void) {\r\n        this._evName = name;\r\n        this._callback = callback;\r\n        return this;\r\n    }\r\n\r\n    build(innerHTML?: string): HTMLElement {\r\n        let element = document.createElement(this._tag);\r\n        if (is(this._id)) {\r\n            // @ts-ignore id is checked\r\n            element.id = this._id;\r\n        }\r\n        if (is(this._classes)) {\r\n            element.classList.add(...this._classes);\r\n        }\r\n        if (is(this._attributes)) {\r\n            // @ts-ignore attributes are checked\r\n            enumerateObject(this._attributes, (attr: string, value: string) => {\r\n                element.setAttribute(attr, value);\r\n            })\r\n        }\r\n        if (is(innerHTML)) {\r\n            // @ts-ignore innerHTML checked already\r\n            element.innerHTML = innerHTML;\r\n        } else if (is(this._text)) {\r\n            // @ts-ignore text checked already\r\n            element.textContent = this._text;\r\n        }\r\n        this._rawChildren.forEach(raw => { element.appendChild(raw.build()) });\r\n        this._children.forEach(child => element.appendChild(child));\r\n\r\n        if (are(this._evName, this._callback)) {\r\n            // @ts-ignore\r\n            element.addEventListener(this._evName, (ev) => {\r\n                // @ts-ignore\r\n                this._callback(ev);\r\n            })\r\n        }\r\n        return element;\r\n    }\r\n}","import { ElementBuilder } from \"../../core/builders/element\";\r\nimport { is } from \"../../core/utils/functions\";\r\n\r\nexport class DialogBuilder {\r\n    #header: Element | undefined;\r\n    #body: Element | undefined;\r\n    #footer: Element | undefined;\r\n    #prefix: string;\r\n    #switches: string;\r\n    #reverse: boolean;\r\n    constructor(prefix: string, reverse: boolean, switches?: string) {\r\n        this.#prefix = prefix;\r\n        this.#header = this.#footer = this.#body = undefined;\r\n        this.#switches = switches ?? \"\";\r\n        this.#reverse = reverse;\r\n    }\r\n\r\n    createHeader(title: string, classes: string[], elements?: Element[]) {\r\n        if (!is(classes)) {\r\n            classes = []\r\n        }\r\n        if (!is(elements)) {\r\n            elements = []\r\n        }\r\n        let headerBuilder = new ElementBuilder('div');\r\n        headerBuilder.setClasses(`${this.#prefix}-dialog-header`, ...classes)\r\n        this.#header = headerBuilder.build();\r\n\r\n        let titleElement = new ElementBuilder('span').setClasses(this.getPrefixedString(\"-dialog-title\")).build(title)\r\n\r\n        this.#header.appendChild(titleElement);\r\n        // @ts-ignore\r\n        this.appendChildrens(this.#header, ...elements);\r\n\r\n    }\r\n\r\n    createFooter(classes: string[], elements: Element[]) {\r\n        if (!is(classes)) {\r\n            classes = []\r\n        }\r\n        if (!is(elements)) {\r\n            elements = []\r\n        }\r\n        this.#footer = new ElementBuilder('div').setClasses(this.getPrefixedString(\"-dialog-footer\"), ...classes).build();\r\n        // @ts-ignore\r\n        this.appendChildrens(this.#footer, ...elements);\r\n    }\r\n\r\n    createBody(classes: string[], elements: Element[]) {\r\n        if (!is(classes)) {\r\n            classes = []\r\n        }\r\n        if (!is(elements)) {\r\n            elements = []\r\n        }\r\n        this.#body = new ElementBuilder('div').setClasses(this.getPrefixedString(\"-dialog-body\"), ...classes).build();\r\n        // @ts-ignore\r\n        this.appendChildrens(this.#body, ...elements);\r\n    }\r\n\r\n    build(id: string): HTMLElement {\r\n        let classes = [this.getPrefixedString(\"-dialog\")]\r\n        if (this.#reverse) {\r\n            classes.push(this.getPrefixedString('-reverse-auto'));\r\n        }\r\n        let dialog = new ElementBuilder('div').setId(id).setClasses(...classes).setAttributes({\r\n            [this.getPrefixedString('-dialog')]: this.#switches\r\n        }).build();\r\n        let container = new ElementBuilder('div').setClasses(this.getPrefixedString(\"-dialog-container\")).build();\r\n        if (this.#header)\r\n            container.appendChild(this.#header);\r\n        if (this.#body)\r\n            container.appendChild(this.#body);\r\n        if (this.#footer)\r\n            container.appendChild(this.#footer);\r\n        dialog.appendChild(container);\r\n        return dialog;\r\n    }\r\n\r\n    private appendChildrens(parent: Element, ...elements: Element[]) {\r\n        if (is(elements)) {\r\n            elements.forEach((element) => parent.appendChild(element));\r\n        }\r\n    }\r\n    private getPrefixedString(str: string) {\r\n        return this.#prefix + str\r\n    }\r\n}","import { ElementManager } from \"../../app/managers/element\";\r\nimport { ElementBuilder } from \"../../core/builders/element\";\r\nimport { CuiContext } from \"../../core/models/interfaces\";\r\nimport { CuiCore } from \"../../core/models/core\";\r\nimport { is } from \"../../core/utils/functions\";\r\nimport { DialogBuilder } from \"./builder\";\r\nimport { CuiAlertOptions, CuiAlertType } from \"./models\";\r\n\r\nexport interface ICuiAlertHandler {\r\n    show(root: Element): void;\r\n}\r\n\r\ninterface AlertCallbacks {\r\n    [name: string]: (() => void) | undefined;\r\n}\r\n\r\nabstract class CuiAlertHandlerBase implements ICuiAlertHandler, CuiContext {\r\n    #callbacks: AlertCallbacks;\r\n    #utils: CuiCore;\r\n    #id: string;\r\n    #manager: ElementManager | undefined;\r\n    closeStr: string;\r\n    iconStr: string;\r\n    content: string;\r\n    title: string;\r\n    prefix: string;\r\n    reverse: boolean;\r\n    #attid: string | null;\r\n    constructor(setup: CuiCore, id: string, data: CuiAlertOptions) {\r\n        this.#callbacks = {\r\n            \"yes\": data.onYes,\r\n            \"no\": data.onNo,\r\n            \"cancel\": data.onCancel,\r\n            \"ok\": data.onOk\r\n        }\r\n        this.content = data.message;\r\n        this.title = data.title;\r\n        this.prefix = setup.setup.prefix;\r\n        this.#utils = setup;\r\n        this.#id = id;\r\n        this.reverse = false;\r\n        this.#attid = null;\r\n        this.closeStr = `${this.#utils.setup.prefix}-close`;\r\n        this.iconStr = `${this.#utils.setup.prefix}-icon`;\r\n        this.#manager = undefined;\r\n    }\r\n\r\n    getId(): string {\r\n        return this.#id;\r\n    }\r\n\r\n    show(root: Element): void {\r\n        if (!this.#utils) {\r\n            return;\r\n        }\r\n\r\n        let element = document.getElementById(this.#id);\r\n        if (!is(element)) {\r\n            element = this.createElement();\r\n            this.#utils.interactions.mutate(() => {\r\n                // @ts-ignore - already checked\r\n                root.appendChild(element);\r\n            }, null)\r\n\r\n        } else {\r\n            // @ts-ignore - already checked\r\n            this.updateElement(element);\r\n        }\r\n        setTimeout(() => {\r\n            // @ts-ignore - already checked\r\n            this.#manager = new ElementManager([element], this.#utils);\r\n            let ids = this.#manager.on('closed', this.onClose.bind(this));\r\n            this.#attid = ids.length > 0 ? ids[0] : null;\r\n            this.#manager.emit(\"open\");\r\n        }, 50);\r\n    }\r\n\r\n    updateElement(element: HTMLElement) {\r\n        this.#utils.interactions.fetch(() => {\r\n            let title = element.querySelector(`.${this.prefix}-dialog-title`);\r\n            let content = element.querySelector(`.${this.prefix}-dialog-body>p`);\r\n            this.#utils.interactions.mutate(() => {\r\n                if (title) {\r\n                    title.innerHTML = this.title;\r\n                }\r\n                if (content) {\r\n                    content.innerHTML = this.content;\r\n                }\r\n            }, null)\r\n        }, null)\r\n    }\r\n\r\n    onClose(arg: any) {\r\n        try {\r\n            if (is(arg) && arg.state && this.#callbacks) {\r\n                if (is(this.#callbacks[arg.state])) {\r\n                    let callback = this.#callbacks[arg.state];\r\n                    if (callback) {\r\n                        callback();\r\n                    }\r\n                }\r\n            }\r\n        } finally {\r\n            if (this.#attid != null) {\r\n                if (this.#manager)\r\n                    this.#manager.detach('closed', this.#attid);\r\n                this.#attid = null;\r\n            }\r\n\r\n            this.#manager = undefined;\r\n        }\r\n    }\r\n\r\n    abstract createElement(): HTMLElement;\r\n\r\n\r\n}\r\n\r\nexport class CuiAlertHandler extends CuiAlertHandlerBase {\r\n    #id: string;\r\n    constructor(setup: CuiCore, id: string, data: CuiAlertOptions) {\r\n        super(setup, id, data);\r\n        this.#id = id;\r\n        this.reverse = data.reverse ?? false;\r\n    }\r\n\r\n    createElement() {\r\n        let dialogBuilder = new DialogBuilder(this.prefix, this.reverse);\r\n\r\n        dialogBuilder.createHeader(this.title, [], [\r\n            new ElementBuilder('a').setClasses(`${this.prefix}-icon`).setAttributes({\r\n                [this.closeStr]: \"state: cancel\",\r\n                [this.iconStr]: \"close\"\r\n            }).build()\r\n        ]);\r\n        dialogBuilder.createBody([], [\r\n            new ElementBuilder('p').build(this.content)\r\n        ]);\r\n        dialogBuilder.createFooter([`${this.prefix}-flex`, `${this.prefix}-right`], [\r\n            new ElementBuilder('button').setClasses(`${this.prefix}-button`, `${this.prefix}-margin-small-right`).setAttributes({ [this.closeStr]: \"state: cancel\" }).build(\"Cancel\"),\r\n            new ElementBuilder('button').setClasses(`${this.prefix}-button`, `${this.prefix}-accent`).setAttributes({ [this.closeStr]: \"state: ok\" }).build(\"Ok\")\r\n        ])\r\n        return dialogBuilder.build(this.#id);\r\n    }\r\n}\r\n\r\nexport class CuiInfoAlertUpHandler extends CuiAlertHandlerBase {\r\n    #id: string;\r\n    constructor(setup: CuiCore, id: string, data: CuiAlertOptions) {\r\n        super(setup, id, data);\r\n        this.#id = id;\r\n        this.content = data.message;;\r\n        this.title = data.title;\r\n        this.prefix = setup.setup.prefix;\r\n        this.reverse = data.reverse ?? false;\r\n\r\n    }\r\n\r\n    createElement() {\r\n        let dialogBuilder = new DialogBuilder(this.prefix, this.reverse);\r\n        dialogBuilder.createHeader(this.title, []);\r\n        dialogBuilder.createBody([], [\r\n            new ElementBuilder('p').build(this.content)\r\n        ]);\r\n        dialogBuilder.createFooter([`${this.prefix}-flex`, `${this.prefix}-right`], [\r\n            new ElementBuilder('button').setClasses(`${this.prefix}-button`, `${this.prefix}-accent`).setAttributes({ [this.closeStr]: \"state: ok\" }).build(\"Ok\")\r\n        ])\r\n\r\n        return dialogBuilder.build(this.#id);\r\n    }\r\n}\r\n\r\nexport class CuiYesNoPopUpHandler extends CuiAlertHandlerBase {\r\n    #id: string;\r\n    constructor(setup: CuiCore, id: string, data: CuiAlertOptions) {\r\n        super(setup, id, data);\r\n        this.#id = id;\r\n        this.content = data.message;\r\n        this.title = data.title;\r\n        this.prefix = setup.setup.prefix;\r\n        this.reverse = data.reverse ?? false;\r\n    }\r\n\r\n    createElement() {\r\n        let dialogBuilder = new DialogBuilder(this.prefix, this.reverse);\r\n\r\n        dialogBuilder.createHeader(this.title, [], [\r\n            new ElementBuilder('a').setClasses(`${this.prefix}-icon`).setAttributes({\r\n                [this.closeStr]: \"state: cancel\",\r\n                [this.iconStr]: \"close\"\r\n            }).build()\r\n        ]);\r\n        dialogBuilder.createBody([], [\r\n            new ElementBuilder('p').build(this.content)\r\n        ]);\r\n        dialogBuilder.createFooter([`${this.prefix}-flex`, `${this.prefix}-right`], [\r\n            new ElementBuilder('button').setClasses(`${this.prefix}-button`, `${this.prefix}-margin-small-right`).setAttributes({ [this.closeStr]: \"state: no\" }).build(\"No\"),\r\n            new ElementBuilder('button').setClasses(`${this.prefix}-button`, `${this.prefix}-accent`).setAttributes({ [this.closeStr]: \"state: yes\" }).build(\"Yes\")\r\n        ])\r\n        return dialogBuilder.build(this.#id);\r\n    }\r\n}\r\n\r\nexport class CuiAlertFactory {\r\n    static get(id: string, type: CuiAlertType, data: CuiAlertOptions, utils: CuiCore): ICuiAlertHandler | undefined {\r\n        if (type === \"Info\") {\r\n            return new CuiInfoAlertUpHandler(utils, id, data);\r\n        } else if (type === 'YesNoCancel') {\r\n            return new CuiYesNoPopUpHandler(utils, id, data);\r\n        } else if (type === 'OkCancel') {\r\n            return new CuiAlertHandler(utils, id, data);\r\n        }\r\n        return undefined;\r\n    }\r\n}\r\n\r\n\r\n","import { CuiDevtoolFactory } from \"../../core/development/factory\";\r\nimport { ICuiDevelopmentTool } from \"../../core/development/interfaces\";\r\nimport { ICuiPlugin } from \"../../core/models/interfaces\";\r\nimport { CuiCore } from \"../../core/models/core\";\r\nimport { EVENTS } from \"../../core/utils/statics\";\r\nimport { CuiPlugin, getPluginEventExtension } from \"../base\";\r\nimport { CuiAlertFactory } from \"./handler\";\r\nimport { CuiAlertEvent } from \"./models\";\r\n\r\nexport function CuiAlertsPluginFn(): ICuiPlugin {\r\n    const pluginName = \"alert-plugin\";\r\n    return new CuiPlugin({\r\n        name: pluginName,\r\n        description: \"CuiAlertsPlugin\",\r\n        setup: undefined,\r\n        callback: (utils: CuiCore) => {\r\n            const log = CuiDevtoolFactory.get(\"CuiAlertsPlugin\");\r\n            function onAlert(event: CuiAlertEvent) {\r\n\r\n                if (!validateEvent(event)) {\r\n                    log.error(\"Event validation failed\");\r\n                    return;\r\n                }\r\n                let popup = CuiAlertFactory.get(event.id, event.type, event.options, utils);\r\n                if (!popup) {\r\n                    log.error(\"Possibly incorrect alert type\");\r\n                    return;\r\n                }\r\n                popup.show(utils.setup.root);\r\n            }\r\n\r\n            function validateEvent(event: CuiAlertEvent): boolean {\r\n                if (!event || !event.id || !event.type || !event.options) {\r\n                    return false;\r\n                }\r\n                return true\r\n            }\r\n\r\n\r\n            return [\r\n                [getPluginEventExtension({\r\n                    name: EVENTS.ALERT,\r\n                    id: pluginName,\r\n                    callback: onAlert\r\n                })],\r\n                undefined\r\n            ]\r\n        }\r\n    })\r\n}\r\n// export class CuiAlertsPlugin implements ICuiPlugin {\r\n//     description: string;\r\n//     name: string;\r\n//     setup: any;\r\n\r\n//     #handleId: string | null;\r\n//     #utils: CuiUtils | undefined;\r\n//     #log: ICuiDevelopmentTool;\r\n//     constructor() {\r\n//         this.name = \"alert-plugin\";\r\n//         this.description = \"CuiAlertsPlugin\";\r\n\r\n//         this.#handleId = null;\r\n//         this.#utils = undefined;\r\n//         //@ts-ignore\r\n//         this.#log = null;\r\n//     }\r\n//     init(utils: CuiUtils): void {\r\n//         this.#log = CuiDevtoolFactory.get(\"CuiAlertsPlugin\");\r\n//         this.#utils = utils;\r\n//         this.detach();\r\n//         this.#handleId = this.#utils.bus.on(EVENTS.ALERT, this.onAlert.bind(this), { $cuid: this.name });\r\n//     }\r\n\r\n//     destroy(): void {\r\n//         this.detach();\r\n//     }\r\n\r\n//     private detach() {\r\n//         if (this.#handleId && this.#utils) {\r\n//             this.#utils.bus.detach(EVENTS.ALERT, this.#handleId);\r\n\r\n//             this.#handleId = null;\r\n//         }\r\n//     }\r\n\r\n//     private onAlert(event: CuiAlertEvent) {\r\n//         if (!this.#utils) {\r\n//             this.#log.error(\"Utils are not set\");\r\n//             return;\r\n//         }\r\n//         if (!this.validateEvent(event)) {\r\n//             this.#log.error(\"Event validation failed\");\r\n//             return;\r\n//         }\r\n//         let popup = CuiAlertFactory.get(event.id, event.type, event.options, this.#utils);\r\n//         if (!popup) {\r\n//             this.#log.error(\"Possibly incorrect alert type\");\r\n//             return;\r\n//         }\r\n//         popup.show(this.#utils.setup.root);\r\n//     }\r\n\r\n//     private validateEvent(event: CuiAlertEvent): boolean {\r\n//         if (!event || !event.id || !event.type || !event.options) {\r\n//             return false;\r\n//         }\r\n//         return true\r\n//     }\r\n// }\r\n","import { ICuiPlugin, IUIInteractionProvider } from \"src/core/models/interfaces\";\r\nimport { CuiCore } from \"src/core/models/core\";\r\nimport { CuiPlugin } from \"../base\";\r\n\r\nconst DEFAULT_FOCUS_VISIBLE = \"focus-visible\";\r\nconst DEFAULT_FOCUS_PRECISE = \"focus-precise\";\r\n\r\ntype FocusInputType = \"keyboard\" | \"mouse\" | \"touch\" | \"none\";\r\n\r\nexport interface ICuiLightFocusPluginSetup {\r\n    keybordClass?: string;\r\n    mouseClass?: string;\r\n    touchClass?: string;\r\n}\r\n\r\nexport function CuiLightFocusPluginFn(setup: ICuiLightFocusPluginSetup): ICuiPlugin {\r\n    return new CuiPlugin({\r\n        name: \"focus-plugin\",\r\n        description: \"CuiLightFocusPlugin\",\r\n        setup: {\r\n            keybordClass: DEFAULT_FOCUS_VISIBLE,\r\n            mouseClass: DEFAULT_FOCUS_PRECISE,\r\n            touchClass: DEFAULT_FOCUS_PRECISE,\r\n            ...setup\r\n        },\r\n        callback: (utils: CuiCore, setup: ICuiLightFocusPluginSetup) => {\r\n            let _currentCls: string | undefined = undefined;\r\n            let _inputType: FocusInputType = 'none';\r\n\r\n            function update(type: FocusInputType) {\r\n                let cls = getClass(type, setup);\r\n                setClasses(cls, _currentCls, () => {\r\n                    _currentCls = cls\r\n                    _inputType = type;\r\n                })\r\n            }\r\n\r\n            function onMouseEvent(ev: MouseEvent) {\r\n                if (_inputType === 'mouse') {\r\n                    return;\r\n                }\r\n                update('mouse');\r\n            }\r\n\r\n            function onKeyDownEvent(ev: KeyboardEvent) {\r\n                if (_inputType === 'keyboard') {\r\n                    return;\r\n                }\r\n                update('keyboard');\r\n            }\r\n\r\n            function onTouchEvent(ev: TouchEvent) {\r\n                if (_inputType === 'touch') {\r\n                    return;\r\n                }\r\n                update('touch');\r\n            }\r\n\r\n            function setClasses(cls: string | undefined, prevCls: string | undefined, callback: () => void) {\r\n                if (!utils.interactions || cls === prevCls) {\r\n                    return;\r\n                }\r\n\r\n                utils.interactions.fetch(() => {\r\n                    let hasCls = cls && document.body.classList.contains(cls);\r\n                    let hasPrevCls = prevCls && document.body.classList.contains(prevCls);\r\n                    // @ts-ignore interactions is set\r\n                    utils.interactions.mutate(() => {\r\n                        if (!hasCls)\r\n                            // @ts-ignore cls is set\r\n                            document.body.classList.add(cls);\r\n                        if (hasPrevCls) {\r\n                            // @ts-ignore prevCls is set\r\n                            document.body.classList.remove(prevCls);\r\n                        }\r\n                        callback();\r\n                    }, null)\r\n\r\n                }, null)\r\n            }\r\n\r\n            document.body.addEventListener('touchstart', onTouchEvent);\r\n            document.body.addEventListener('mousedown', onMouseEvent);\r\n            window.addEventListener('keydown', onKeyDownEvent);\r\n\r\n            return [\r\n                [],\r\n                () => {\r\n                    document.body.removeEventListener('touchstart', onTouchEvent);\r\n                    document.body.removeEventListener('mousedown', onMouseEvent);\r\n                    window.removeEventListener('keydown', onKeyDownEvent);\r\n                }\r\n            ]\r\n        }\r\n    })\r\n}\r\n\r\nfunction getClass(type: FocusInputType, setup: ICuiLightFocusPluginSetup): string | undefined {\r\n    switch (type) {\r\n        case \"keyboard\":\r\n            return setup.keybordClass;\r\n        case \"mouse\":\r\n            return setup.mouseClass;\r\n        case \"touch\":\r\n            return setup.touchClass;\r\n        default:\r\n            return undefined;\r\n    }\r\n}\r\n\r\n\r\n\r\n// export class CuiLightFocusPlugin implements ICuiPlugin {\r\n//     description: string;\r\n//     name: string;\r\n//     setup: ICuiLightFocusPluginSetup;\r\n//     #interactions: IUIInteractionProvider | undefined;\r\n//     #inputType: FocusInputType;\r\n//     #onMouseListener: any;\r\n//     #onTouchListener: any;\r\n//     #onKeyDownListener: any;\r\n//     #currentCls: string | undefined;\r\n//     constructor(setup: ICuiLightFocusPluginSetup) {\r\n//         this.setup = {\r\n//             keybordClass: DEFAULT_FOCUS_VISIBLE,\r\n//             mouseClass: DEFAULT_FOCUS_PRECISE,\r\n//             touchClass: DEFAULT_FOCUS_PRECISE,\r\n//             ...setup\r\n//         }\r\n\r\n//         this.description = \"CuiLightFocusPlugin\";\r\n//         this.name = \"focus-plugin\";\r\n//         this.#interactions = undefined;\r\n\r\n//         this.#onKeyDownListener = this.onKeyDownEvent.bind(this);\r\n//         this.#onMouseListener = this.onMouseEvent.bind(this);\r\n//         this.#onTouchListener = this.onTouchEvent.bind(this);\r\n\r\n//         this.#inputType = 'none';\r\n//         this.#currentCls = undefined;\r\n\r\n//     }\r\n\r\n//     init(utils: CuiUtils): void {\r\n//         this.#interactions = utils.interactions;\r\n//         document.body.addEventListener('touchstart', this.#onTouchListener);\r\n//         document.body.addEventListener('mousedown', this.#onMouseListener);\r\n//         window.addEventListener('keydown', this.#onKeyDownListener);\r\n\r\n//     }\r\n\r\n//     private onMouseEvent(ev: MouseEvent) {\r\n//         if (this.#inputType === 'mouse') {\r\n//             return;\r\n//         }\r\n//         this.update('mouse');\r\n//     }\r\n\r\n//     private onKeyDownEvent(ev: KeyboardEvent) {\r\n//         if (this.#inputType === 'keyboard') {\r\n//             return;\r\n//         }\r\n//         this.update('keyboard');\r\n//     }\r\n\r\n//     private onTouchEvent(ev: TouchEvent) {\r\n//         if (this.#inputType === 'touch') {\r\n//             return;\r\n//         }\r\n//         this.update('touch');\r\n//     }\r\n\r\n//     private update(type: FocusInputType) {\r\n//         let cls = this.getClass(type);\r\n//         this.setClasses(cls, this.#currentCls, () => {\r\n//             this.#currentCls = cls\r\n//             this.#inputType = type;\r\n//         })\r\n//     }\r\n\r\n//     private getClass(type: FocusInputType): string | undefined {\r\n//         switch (type) {\r\n//             case \"keyboard\":\r\n//                 return this.setup.keybordClass;\r\n//             case \"mouse\":\r\n//                 return this.setup.mouseClass;\r\n//             case \"touch\":\r\n//                 return this.setup.touchClass;\r\n//             default:\r\n//                 return undefined;\r\n//         }\r\n//     }\r\n//     private setClasses(cls: string | undefined, prevCls: string | undefined, callback: () => void) {\r\n//         if (!this.#interactions || cls === prevCls) {\r\n//             return;\r\n//         }\r\n\r\n//         this.#interactions.fetch(() => {\r\n//             let hasCls = cls && document.body.classList.contains(cls);\r\n//             let hasPrevCls = prevCls && document.body.classList.contains(prevCls);\r\n//             // @ts-ignore interactions is set\r\n//             this.#interactions.mutate(() => {\r\n//                 if (!hasCls)\r\n//                     // @ts-ignore cls is set\r\n//                     document.body.classList.add(cls);\r\n//                 if (hasPrevCls) {\r\n//                     // @ts-ignore prevCls is set\r\n//                     document.body.classList.remove(prevCls);\r\n//                 }\r\n//                 callback();\r\n//             }, null)\r\n\r\n//         }, null)\r\n//     }\r\n\r\n//     destroy(): void {\r\n//         document.body.removeEventListener('touchstart', this.#onTouchListener);\r\n//         document.body.removeEventListener('mousedown', this.#onMouseListener);\r\n//         window.removeEventListener('keydown', this.#onKeyDownListener);\r\n//     }\r\n\r\n// }","import { ICuiEventListener } from \"../../core/models/interfaces\";\r\nimport { is } from \"../../core/utils/functions\";\r\n\r\nexport class CuiKeyPressListener implements ICuiEventListener<KeyboardEvent> {\r\n    #callback: ((t: KeyboardEvent) => void) | undefined;\r\n    #keys: string[];\r\n    #inProgress: boolean;\r\n    #singleEmit: boolean;\r\n    #isAttached: boolean;\r\n\r\n    #onKeyDownBound: (ev: KeyboardEvent) => void;\r\n    #onKeyUpBound: (ev: KeyboardEvent) => void;\r\n\r\n    constructor(singleEmit: boolean, keys?: string[]) {\r\n        this.#inProgress = false;\r\n        this.#singleEmit = true;\r\n        this.#isAttached = false;\r\n        this.#callback = undefined;\r\n        this.#keys = keys ?? [];\r\n\r\n        this.#onKeyDownBound = this.onKeyDown.bind(this);\r\n        this.#onKeyUpBound = this.onKeyUp.bind(this);\r\n    }\r\n\r\n    setCallback(callback: (t: KeyboardEvent) => void): void {\r\n        this.#callback = callback;\r\n    }\r\n\r\n    isInProgress(): boolean {\r\n        return this.#inProgress;\r\n    }\r\n\r\n    attach(): void {\r\n        document.addEventListener('keydown', this.#onKeyDownBound)\r\n        if (this.#singleEmit) {\r\n            document.addEventListener('keyup', this.#onKeyUpBound)\r\n        }\r\n        this.#isAttached = true;\r\n    }\r\n\r\n    detach(): void {\r\n        document.removeEventListener('keydown', this.#onKeyDownBound)\r\n        if (this.#singleEmit) {\r\n            document.addEventListener('keyup', this.#onKeyUpBound)\r\n        }\r\n        this.#isAttached = false;\r\n    }\r\n\r\n    isAttached(): boolean {\r\n        return this.#isAttached;\r\n    }\r\n\r\n    onKeyDown(ev: KeyboardEvent) {\r\n        if (this.#inProgress) {\r\n            return;\r\n        }\r\n        this.#inProgress = true;\r\n        try {\r\n            if ((!is(this.#keys) || this.#keys.includes(ev.code)) && this.#callback) {\r\n                this.#callback(ev);\r\n            }\r\n\r\n        } catch (e) {\r\n            console.error(e)\r\n        } finally {\r\n            if (!this.#singleEmit)\r\n                this.#inProgress = false;\r\n        }\r\n    }\r\n\r\n    onKeyUp(ev: KeyboardEvent) {\r\n        this.#inProgress = false;\r\n    }\r\n}","import { ICuiEventBus } from \"src/core/bus/interfaces\";\r\nimport { KeyDownEvent } from \"src/core/models/events\";\r\nimport { EVENTS } from \"../../core/utils/statics\";\r\nimport { CuiKeyPressListener } from \"./listener\";\r\n\r\n\r\nexport interface ICuiKeysObserver {\r\n    connect(): void;\r\n    disconnect(): void;\r\n}\r\nexport class CuiKeysObserver {\r\n    #listener: CuiKeyPressListener;\r\n    #bus: ICuiEventBus\r\n    constructor(bus: ICuiEventBus) {\r\n        this.#bus = bus;\r\n        this.#listener = new CuiKeyPressListener(true);\r\n        this.#listener.setCallback(this.onKeyDown.bind(this))\r\n    }\r\n    connect(): void {\r\n        this.#listener.attach();\r\n    }\r\n    disconnect(): void {\r\n        this.#listener.detach();\r\n    }\r\n\r\n    onKeyDown(ev: KeyboardEvent) {\r\n        this.#bus.emit<KeyDownEvent>(EVENTS.KEYDOWN, null, {\r\n            timestamp: Date.now(),\r\n            name: EVENTS.KEYDOWN,\r\n            source: \"CuiKeysObserver\",\r\n            event: ev\r\n        })\r\n    }\r\n\r\n}","import { ICuiEventListener } from \"../models/interfaces\";\r\n\r\nexport class CuiMediaQueryListener implements ICuiEventListener<MediaQueryListEvent> {\r\n\r\n    private _mediaQuery: string;\r\n    private _callback: ((t: MediaQueryListEvent) => void) | undefined;\r\n    private _isInitialized: boolean;\r\n    private _inProgress: boolean;\r\n\r\n    #onEventBound: (ev: MediaQueryListEvent) => void;\r\n    constructor(mediaQuery: string) {\r\n        this._mediaQuery = mediaQuery;\r\n        this._isInitialized = false;\r\n        this._callback = undefined;\r\n        this._inProgress = false;\r\n\r\n        this.#onEventBound = this.event.bind(this);\r\n    }\r\n    setCallback(callback: (t: MediaQueryListEvent) => void): void {\r\n        this._callback = callback;\r\n    }\r\n\r\n    isInProgress(): boolean {\r\n        return this._inProgress;\r\n    }\r\n    attach(): void {\r\n        if (!window.matchMedia || this._isInitialized || !this._mediaQuery) {\r\n            return;\r\n        }\r\n        window.matchMedia(this._mediaQuery)\r\n            .addEventListener('change', this.#onEventBound)\r\n        this._isInitialized = true\r\n    }\r\n\r\n    detach(): void {\r\n        if (this._isInitialized) {\r\n            window.matchMedia(this._mediaQuery).removeEventListener('change', this.#onEventBound);\r\n            this._isInitialized = false\r\n        }\r\n    }\r\n\r\n    isAttached(): boolean {\r\n        return this._isInitialized;\r\n    }\r\n\r\n    private event(ev: MediaQueryListEvent): void {\r\n        if (this._inProgress || !this._callback) {\r\n            return\r\n        }\r\n        this._inProgress = true;\r\n        try {\r\n            this._callback(ev);\r\n        } catch (e) {\r\n            console.error(e)\r\n        } finally {\r\n            this._inProgress = false;\r\n        }\r\n    }\r\n}","import { ICuiPlugin } from \"../../core/models/interfaces\";\r\nimport { CuiCore } from \"../../core/models/core\";\r\nimport { getSystemLightMode } from \"../../core/utils/functions\";\r\nimport { CuiMediaQueryListener } from \"../../core/listeners/media\";\r\nimport { CuiPlugin, getPluginListenerExtension } from \"../base\";\r\n\r\nexport interface AutoLightPluginSetup {\r\n    autoLight: boolean;\r\n}\r\n\r\nexport function CuiAutoLightModePluginFn(setup: AutoLightPluginSetup): ICuiPlugin {\r\n    const _description = \"CuiAutoLightModePlugin\";\r\n    return new CuiPlugin({\r\n        name: 'auto-light',\r\n        description: _description,\r\n        setup: setup,\r\n        callback: (utils: CuiCore, setup: AutoLightPluginSetup) => {\r\n\r\n            function onChange(ev: MediaQueryListEvent) {\r\n                let autoLightSetup = utils.setup.plugins[_description] as AutoLightPluginSetup;\r\n                let autoLight = autoLightSetup?.autoLight ?? false;\r\n                if (autoLight) {\r\n                    utils.setLightMode(ev.matches ? \"dark\" : \"light\")\r\n                }\r\n            }\r\n\r\n            if (setup.autoLight && getSystemLightMode() === 'dark') {\r\n                utils.setLightMode('dark')\r\n            }\r\n\r\n            const listener = new CuiMediaQueryListener('(prefers-color-scheme: dark)');\r\n            listener.setCallback(onChange)\r\n            return [\r\n                [getPluginListenerExtension({\r\n                    listener: listener\r\n                })],\r\n                undefined\r\n            ]\r\n        }\r\n    })\r\n}","import { ICuiEventListener } from \"../models/interfaces\";\r\nimport { is } from \"../utils/functions\";\r\nimport { EVENTS } from \"../utils/statics\";\r\n\r\ninterface OnMoveCallback {\r\n    (ev: ICuiMoveData): void;\r\n}\r\n\r\ninterface IMoveListener {\r\n    onMove(data: OnMoveCallback): void\r\n    start(): void;\r\n    stop(): void;\r\n}\r\n\r\nexport type CuiMoveEventState = \"down\" | \"up\" | \"move\";\r\nexport interface ICuiMoveData {\r\n    x: number;\r\n    y: number;\r\n    moveX: number;\r\n    moveY: number;\r\n    type: CuiMoveEventState;\r\n    target: EventTarget | null;\r\n    event: MouseEvent | TouchEvent;\r\n}\r\n\r\nexport class CuiMoveEventListener implements ICuiEventListener<ICuiMoveData> {\r\n    private _element: HTMLElement | Document;\r\n    private _onEvent: ((t: ICuiMoveData) => void) | undefined;\r\n    private _isLocked: boolean;\r\n    private _isAttached: boolean;\r\n    private _preventDefault: boolean;\r\n    private _target: Element | undefined;\r\n    constructor(element?: HTMLElement) {\r\n        this._isLocked = false;\r\n        this._element = element ?? document.body;\r\n        this._isAttached = false;\r\n        this._preventDefault = false;\r\n        this._onEvent = undefined;\r\n        this._target = undefined;\r\n\r\n        this.onMouseDown = this.onMouseDown.bind(this);\r\n        this.onMouseUp = this.onMouseUp.bind(this)\r\n        this.onMouseMove = this.onMouseMove.bind(this)\r\n        this.onTouchStart = this.onTouchStart.bind(this)\r\n        this.onTouchEnd = this.onTouchEnd.bind(this)\r\n        this.onTouchMove = this.onTouchMove.bind(this)\r\n    }\r\n\r\n    setCallback(callback: (t: ICuiMoveData) => void): void {\r\n        this._onEvent = callback;\r\n    }\r\n\r\n    setTarget(element?: Element) {\r\n        this._target = element;\r\n    }\r\n    isInProgress(): boolean {\r\n        return this._isLocked;\r\n    }\r\n    preventDefault(flag: boolean) {\r\n        this._preventDefault = flag;\r\n    }\r\n    attach(): void {\r\n        if (this._isAttached) {\r\n            return;\r\n        }\r\n\r\n        //@ts-ignore\r\n        this._element.addEventListener('mousedown', this.onMouseDown, { passive: false } as any);\r\n        //@ts-ignore\r\n        this._element.addEventListener('mouseup', this.onMouseUp, { passive: false } as any);\r\n        //@ts-ignore\r\n        this._element.addEventListener('mousemove', this.onMouseMove, { passive: false } as any);\r\n        //@ts-ignore\r\n        this._element.addEventListener('touchstart', this.onTouchStart, { passive: false } as any);\r\n        //@ts-ignore\r\n        this._element.addEventListener('touchend', this.onTouchEnd, { passive: false } as any);\r\n        //@ts-ignore\r\n        this._element.addEventListener('touchmove', this.onTouchMove, { passive: false } as any);\r\n        this._isAttached = true;\r\n    }\r\n    detach(): void {\r\n        if (!this._isAttached) {\r\n            return;\r\n        }\r\n        //@ts-ignore\r\n        this._element.removeEventListener('mousedown', this.onMouseDown, { passive: false } as any);\r\n        //@ts-ignore\r\n        this._element.removeEventListener('mouseup', this.onMouseUp, { passive: false } as any);\r\n        //@ts-ignore\r\n        this._element.removeEventListener('mousemove', this.onMouseMove, { passive: false } as any);\r\n        //@ts-ignore\r\n        this._element.removeEventListener('touchstart', this.onTouchStart, { passive: false } as any);\r\n        //@ts-ignore\r\n        this._element.removeEventListener('touchend', this.onTouchEnd, { passive: false } as any);\r\n        //@ts-ignore\r\n        this._element.removeEventListener('touchmove', this.onTouchMove, { passive: false } as any);\r\n        this._isAttached = false;\r\n    }\r\n\r\n    isAttached(): boolean {\r\n        return this._isAttached\r\n    }\r\n\r\n    onMouseDown(ev: MouseEvent) {\r\n        if (this._isLocked) {\r\n            return;\r\n        }\r\n        if (this._target && !this._target.contains(ev.target as Node)) {\r\n            return;\r\n        }\r\n\r\n        this._isLocked = true;\r\n        this.publishMouseEvent(\"down\", ev)\r\n\r\n    }\r\n\r\n    onMouseUp(ev: MouseEvent) {\r\n        if (!this._isLocked) {\r\n            return;\r\n        }\r\n        this._isLocked = false;\r\n        this.publishMouseEvent(\"up\", ev)\r\n\r\n    }\r\n\r\n    onMouseMove(ev: MouseEvent) {\r\n        if (this._isLocked) {\r\n            this.publishMouseEvent(\"move\", ev)\r\n        }\r\n    }\r\n\r\n    onTouchStart(ev: TouchEvent) {\r\n        if (this._isLocked) {\r\n            return;\r\n        }\r\n        if (this._target && !this._target.contains(ev.target as Node)) {\r\n            return;\r\n        }\r\n        this._isLocked = true;\r\n        this.publishTouchEvent('down', ev);\r\n    }\r\n\r\n    onTouchEnd(ev: TouchEvent) {\r\n        if (!this._isLocked) {\r\n            return;\r\n        }\r\n        this._isLocked = false;\r\n        this.publishTouchEvent('up', ev);\r\n    }\r\n\r\n    onTouchMove(ev: TouchEvent) {\r\n        if (this._isLocked) {\r\n            this.publishTouchEvent('move', ev);\r\n        }\r\n    }\r\n\r\n    private publishMouseEvent(type: CuiMoveEventState, ev: MouseEvent) {\r\n        if (this._preventDefault && ev.cancelable) {\r\n            ev.preventDefault();\r\n        }\r\n        if (!is(this._onEvent)) { return }\r\n        // @ts-ignore\r\n        this._onEvent({\r\n            type: type,\r\n            x: ev.clientX,\r\n            y: ev.clientY,\r\n            moveX: ev.movementX,\r\n            moveY: ev.movementY,\r\n            target: ev.target,\r\n            event: ev,\r\n        })\r\n\r\n    }\r\n\r\n    private publishTouchEvent(type: CuiMoveEventState, ev: TouchEvent) {\r\n        if (this._preventDefault && ev.cancelable)\r\n            ev.preventDefault();\r\n        if (!is(this._onEvent)) {\r\n            return;\r\n        }\r\n        let touch = null;\r\n        if (ev.touches.length > 0) {\r\n            touch = ev.touches[0]\r\n        } else if (ev.changedTouches.length > 0) {\r\n            touch = ev.changedTouches[0]\r\n        }\r\n        // @ts-ignore - already checked\r\n        this._onEvent({\r\n            event: ev,\r\n            type: type,\r\n            target: ev.target,\r\n            //@ts-ignore\r\n            x: is(touch) ? touch.clientX : -1,\r\n            //@ts-ignore\r\n            y: is(touch) ? touch.clientY : -1,\r\n            moveX: -1,\r\n            moveY: -1\r\n        })\r\n\r\n    }\r\n\r\n}\r\n","import { ICuiEventBus } from \"src/core/bus/interfaces\";\r\nimport { ICuiMoveEvent } from \"src/core/models/events\";\r\nimport { CuiMoveEventListener, ICuiMoveData } from \"../../core/listeners/move\";\r\nimport { EVENTS } from \"../../core/utils/statics\";\r\n\r\nconst DEFAULT_GESTURE_TRESHOLD = 0.3;\r\ntype GlobalMoveGesture = 'up' | 'down' | 'left' | 'right' | 'none'\r\n\r\nexport class CuiMoveObserver {\r\n    #bus: ICuiEventBus;\r\n    #moveListener: CuiMoveEventListener;\r\n    #isLocked: boolean;\r\n    #eventId: string | null;\r\n    #firstEvent: ICuiMoveData | undefined;\r\n    #wasFirstEventSend: boolean;\r\n    #gesturesEnabled: boolean;\r\n    constructor(bus: ICuiEventBus, gestures: boolean) {\r\n        this.#bus = bus;\r\n        this.#moveListener = new CuiMoveEventListener();\r\n        this.#moveListener.setCallback(this.onMove.bind(this));\r\n        this.#firstEvent = undefined;\r\n        this.#isLocked = false;\r\n        this.#eventId = null;\r\n        this.#wasFirstEventSend = false;\r\n        this.#gesturesEnabled = gestures;\r\n    }\r\n\r\n    attach() {\r\n        if (!this.#moveListener.isAttached()) {\r\n            this.#moveListener.attach();\r\n            this.#eventId = this.#bus.on(EVENTS.MOVE_LOCK, this.onMoveLock.bind(this))\r\n        }\r\n    }\r\n\r\n    detach() {\r\n        if (this.#moveListener.isAttached()) {\r\n            this.#moveListener.detach();\r\n            this.#eventId != null && this.#bus.detach(EVENTS.MOVE_LOCK, this.#eventId);\r\n        }\r\n\r\n    }\r\n\r\n    isAttached() {\r\n        return this.#moveListener.isAttached();\r\n    }\r\n\r\n    private onMove(data: ICuiMoveData) {\r\n        if (this.#isLocked) {\r\n            return;\r\n        }\r\n        switch (data.type) {\r\n            case \"down\":\r\n                this.#firstEvent = data;\r\n                this.#wasFirstEventSend = false\r\n                break;\r\n            case \"move\":\r\n                if (this.#firstEvent && !this.#wasFirstEventSend) {\r\n                    this.pushMoveEvent(this.#firstEvent)\r\n                    this.#wasFirstEventSend = true;\r\n                }\r\n                this.pushMoveEvent(data)\r\n                break;\r\n            case \"up\":\r\n                this.pushMoveEvent(data)\r\n                if (this.#firstEvent) {\r\n                    if (this.#gesturesEnabled) {\r\n                        const { diffX, diffY } = this.getGestureDiff(this.#firstEvent, data);\r\n                        const gesture = this.calculateGesture(diffX, diffY);\r\n                        this.pushGestureEvent(gesture, diffX, diffY);\r\n                    }\r\n                    this.#firstEvent = undefined;\r\n                }\r\n                break;\r\n        }\r\n\r\n    }\r\n\r\n    private pushMoveEvent(data: ICuiMoveData) {\r\n        this.#bus.emit<ICuiMoveEvent>(EVENTS.GLOBAL_MOVE, null, {\r\n            ...data,\r\n            source: \"CuiMoveObserver\",\r\n            timestamp: Date.now(),\r\n            name: EVENTS.GLOBAL_MOVE\r\n        });\r\n    }\r\n\r\n    private onMoveLock(flag: boolean) {\r\n        this.#isLocked = flag;\r\n    }\r\n\r\n    private getGestureDiff(firstEvent: ICuiMoveData, lastEvent: ICuiMoveData) {\r\n        return {\r\n            diffX: lastEvent.x - firstEvent.x,\r\n            diffY: lastEvent.y - firstEvent.y\r\n        }\r\n    }\r\n\r\n    private calculateGesture(diffX: number, diffY: number): GlobalMoveGesture {\r\n        const tresholdX = window.innerWidth * DEFAULT_GESTURE_TRESHOLD;\r\n        const absDiffX = Math.abs(diffX);\r\n        const absDiffY = Math.abs(diffY);\r\n        if (absDiffX > absDiffY && absDiffX > tresholdX) {\r\n            return diffX > 0 ? \"right\" : \"left\";\r\n        }\r\n        const tresholdY = window.innerHeight * DEFAULT_GESTURE_TRESHOLD;\r\n        if (absDiffY > tresholdY) {\r\n            return diffY > 0 ? \"down\" : 'up';\r\n        }\r\n        return 'none';\r\n    }\r\n\r\n    private pushGestureEvent(type: GlobalMoveGesture, diffX: number, diffY: number) {\r\n        const eventName = this.getGestureEventName(type);\r\n        if (!eventName) {\r\n            return;\r\n        }\r\n        this.#bus.emit(eventName, null, {\r\n            timespstamp: Date.now(),\r\n            changeX: diffX,\r\n            changeY: diffY,\r\n            name: eventName,\r\n            source: \"CuiMoveObserver\"\r\n        })\r\n\r\n    }\r\n\r\n    private getGestureEventName(type: GlobalMoveGesture): string | null {\r\n        switch (type) {\r\n            case \"up\":\r\n                return EVENTS.GESTURE_UP;\r\n            case 'down':\r\n                return EVENTS.GESTURE_DOWN;\r\n            case \"left\":\r\n                return EVENTS.GESTURE_LEFT;\r\n            case \"right\":\r\n                return EVENTS.GESTURE_RIGHT;\r\n            default:\r\n                return null;\r\n        }\r\n    }\r\n}","import { createElementFromString, getIntOrDefault, is } from \"../utils/functions\";\r\n\r\nexport class IconBuilder {\r\n    _element: string;\r\n    _scale: number;\r\n    _appender: IconScaleAppender;\r\n\r\n    constructor(svgString: string) {\r\n        this._element = svgString;\r\n        this._scale = 1;\r\n        this._appender = new IconScaleAppender();\r\n    }\r\n\r\n    setScale(scale: number): IconBuilder {\r\n        this._scale = scale\r\n        return this\r\n    }\r\n\r\n    build(): Element | null {\r\n        let created = createElementFromString(this._element)\r\n        if (is(created) && this._scale) {\r\n            // @ts-ignore created is checked already\r\n            this._appender.append(created, this._scale)\r\n        }\r\n        return created\r\n    }\r\n}\r\n\r\nexport class IconScaleAppender {\r\n    append(element: Element, value: number): void {\r\n        let width = getIntOrDefault(element.getAttribute(\"width\"), 20)\r\n        let height = getIntOrDefault(element.getAttribute(\"height\"), 20);\r\n        element.setAttribute(\"width\", (width * value).toString())\r\n        element.setAttribute(\"height\", (height * value).toString())\r\n    }\r\n}","import { IconBuilder } from \"../../core/builders/icon\";\r\nimport { ElementBuilder } from \"../../core/builders/element\";\r\nimport { CuiCore } from \"../../core/models/core\";\r\nimport { are, is } from \"../../core/utils/functions\";\r\nimport { CuiNotificationType, ICuiNotification, ICuiNotificationAction } from \"./interfaces\";\r\nimport { CuiDevtoolFactory } from \"../../core/development/factory\";\r\n\r\n\r\n\r\nconst closeIcon = \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 20 20\\\" width=\\\"20\\\" height=\\\"20\\\"><path d=\\\"M 3,3 17,17\\\"></path><path d=\\\"M 17,3 3,17\\\"></path></svg>\";\r\n\r\n\r\nexport default async function getNotification(data: ICuiNotification, utils: CuiCore, cache: any, onClose: () => void): Promise<HTMLElement | undefined> {\r\n    let prefix = utils.setup.prefix;\r\n\r\n    if (!are(data.title, data.id)) {\r\n        return undefined;\r\n    }\r\n    const parts: ElementBuilder[] = [getHeader(data.title, cache, onClose)];\r\n    if (is(data.message)) {\r\n        //@ts-ignore message is defined\r\n        parts.push(getBody(data.message, cache))\r\n    }\r\n    if (is(data.actions)) {\r\n        //@ts-ignore actions is defined\r\n        parts.push(getFooter(data.actions, cache, onClose));\r\n    }\r\n\r\n    return new ElementBuilder('div').setClasses(cache.NOTIFICATION_CLS, cache.MARGIN_SMALL_VERTICAL, getClassByType(prefix, data.type)).setId(data.id).setRawChildren(...parts).build();\r\n\r\n}\r\n\r\nfunction getHeader(title: string, cache: any, onClose: () => void): ElementBuilder {\r\n    const titleElement = new ElementBuilder('span').setClasses(cache.NOTIFICATION_TITLE_CLS).setTextContent(title);\r\n    const iconCloseElement = new IconBuilder(closeIcon).build();\r\n    const closeElement = new ElementBuilder('a').setClasses(cache.ICON_CLS, cache.NOTIFICATION_CLOSE_CLS).onEvent('click', onClose);\r\n    if (iconCloseElement) {\r\n        closeElement.setChildren(iconCloseElement)\r\n    }\r\n    const header = new ElementBuilder('div').setClasses(cache.NOTIFICATION_HEADER_CLS).setRawChildren(titleElement, closeElement);\r\n    return header;\r\n}\r\n\r\nfunction getBody(message: string, cache: any): ElementBuilder {\r\n    return new ElementBuilder('div').setClasses(cache.NOTIFICATION_BODY_CLS).setRawChildren(new ElementBuilder('div').setTextContent(message));\r\n}\r\n\r\nfunction getFooter(actions: ICuiNotificationAction[], cache: any, onClose: () => void): ElementBuilder {\r\n    return new ElementBuilder('div').setClasses(cache.NOTIFICATION_FOOTER_CLS).setRawChildren(getActionsList(actions, onClose));\r\n}\r\n\r\nfunction getActionsList(actions: ICuiNotificationAction[], onClose: () => void): ElementBuilder {\r\n    return new ElementBuilder('ul').setRawChildren(...actions.map(action => {\r\n        return new ElementBuilder('li').setRawChildren(new ElementBuilder('a').onEvent('click', () => {\r\n            try {\r\n                action.callback();\r\n            } catch (e) {\r\n                const log = CuiDevtoolFactory.get(\"Notifications\");\r\n                log.exception(e, \"OnActionClick\");\r\n            } finally {\r\n                onClose();\r\n            }\r\n        }).setTextContent(action.name))\r\n    }));\r\n}\r\n\r\nfunction getClassByType(prefix: string, type?: CuiNotificationType) {\r\n    return `${prefix}-${type ?? 'default'}`;\r\n}","import { ElementBuilder } from \"../../core/builders/element\";\r\nimport { are, replacePrefix } from \"../../core/utils/functions\";\r\nimport { EVENTS } from \"../../core/utils/statics\";\r\nimport { ICuiPlugin } from \"../../core/models/interfaces\";\r\nimport { CuiCore } from \"../../core/models/core\";\r\nimport { CuiActionsHelper } from \"../../core/helpers/helpers\";\r\nimport { CuiClassAction } from \"../../core/utils/actions\";\r\nimport { ElementsHolder, ICuiNotification, ICuiNotificationPluginSetup } from \"./interfaces\";\r\nimport { validateNotificationData } from \"./helpers\";\r\nimport getNotification from \"./builder\";\r\nimport { CuiPlugin, getPluginEventExtension } from \"../base\";\r\n\r\n\r\nconst CONTAINER_ID = \"notifications-container\";\r\nconst CONTAINER_CLS = \"{prefix}-notification-container\";\r\n\r\nconst NOTIFICATION_CLS = '{prefix}-notification';\r\nconst NOTIFICATION_HEADER_CLS = '{prefix}-notification-header';\r\nconst NOTIFICATION_TITLE_CLS = '{prefix}-notification-title';\r\nconst NOTIFICATION_BODY_CLS = '{prefix}-notification-body';\r\nconst NOTIFICATION_FOOTER_CLS = '{prefix}-notification-footer';\r\nconst NOTIFICATION_ACTIVE_CLS = '{prefix}-active';\r\nconst NOTIFICATION_ICON_CLS = \"{prefix}-notification-icon\";\r\nconst NOTIFICATION_CLOSE_CLS = \"{prefix}-notification-close\";\r\nconst ICON_CLS = \"{prefix}-icon\";\r\n\r\nconst NOTIFICATION_ANIMATION_IN = \"{prefix}-notification-animation-in\";\r\nconst NOTIFICATION_ANIMATION_OUT = \"{prefix}-notification-animation-out\";\r\nconst MARGIN_SMALL_VERTICAL = \"{prefix}-margin-small-vertical\";\r\n\r\n\r\nexport function CuiNotificationPluginFn(setup: ICuiNotificationPluginSetup): ICuiPlugin {\r\n    const pluginName = 'notification-plugin';\r\n\r\n    function createCache(prefix: string) {\r\n        return {\r\n            \"NOTIFICATION_CLS\": replacePrefix(NOTIFICATION_CLS, prefix),\r\n            \"NOTIFICATION_HEADER_CLS\": replacePrefix(NOTIFICATION_HEADER_CLS, prefix),\r\n            \"NOTIFICATION_TITLE_CLS\": replacePrefix(NOTIFICATION_TITLE_CLS, prefix),\r\n            \"NOTIFICATION_BODY_CLS\": replacePrefix(NOTIFICATION_BODY_CLS, prefix),\r\n            \"NOTIFICATION_FOOTER_CLS\": replacePrefix(NOTIFICATION_FOOTER_CLS, prefix),\r\n            \"NOTIFICATION_ACTIVE_CLS\": replacePrefix(NOTIFICATION_ACTIVE_CLS, prefix),\r\n            \"NOTIFICATION_ANIMATION_IN\": replacePrefix(NOTIFICATION_ANIMATION_IN, prefix),\r\n            \"NOTIFICATION_ANIMATION_OUT\": replacePrefix(NOTIFICATION_ANIMATION_OUT, prefix),\r\n            \"NOTIFICATION_ICON_CLS\": replacePrefix(NOTIFICATION_ICON_CLS, prefix),\r\n            \"NOTIFICATION_CLOSE_CLS\": replacePrefix(NOTIFICATION_CLOSE_CLS, prefix),\r\n            \"ICON_CLS\": replacePrefix(ICON_CLS, prefix),\r\n            \"MARGIN_SMALL_VERTICAL\": replacePrefix(MARGIN_SMALL_VERTICAL, prefix),\r\n        }\r\n    }\r\n\r\n    return new CuiPlugin({\r\n        name: pluginName,\r\n        description: \"CuiNotificationPlugin\",\r\n        setup: setup,\r\n        callback: (core: CuiCore, setup: ICuiNotificationPluginSetup) => {\r\n            const _cache = createCache(core.setup.prefix);\r\n            const _actionsHelper = new CuiActionsHelper(core.interactions);\r\n            const _timeout = setup.timeout ?? 5000;\r\n            let _holder: ElementsHolder = {};\r\n            let _container: HTMLElement | null = null;\r\n\r\n            function getOrCreateContainer(core: CuiCore, root: HTMLElement) {\r\n                _container = document.getElementById(CONTAINER_ID);\r\n                if (!_container) {\r\n                    _container = new ElementBuilder('div').setClasses(replacePrefix(CONTAINER_CLS, core.setup.prefix)).build();\r\n                    root.appendChild(_container);\r\n                }\r\n            }\r\n\r\n            function setAutoClose(data: ICuiNotification): any {\r\n                return setTimeout(() => {\r\n                    onNotificationClose(data, true, false);\r\n                }, _timeout);\r\n            }\r\n\r\n            function addNotificationToTree(notifiactionElement: HTMLElement) {\r\n                //@ts-ignore utils is defined\r\n                core.interactions.mutate(() => {\r\n                    // Add to DOM treee\r\n                    //@ts-ignore container is defined\r\n                    if (_container.children.length === 0) {\r\n                        //@ts-ignore container is defined\r\n                        _container.appendChild(notifiactionElement)\r\n                    } else {\r\n                        //@ts-ignore container is defined\r\n                        _container.insertBefore(notifiactionElement, _container.firstChild);\r\n                    }\r\n                }, null)\r\n            }\r\n\r\n            function onNotificationClose(notification: ICuiNotification, fromTimeout: boolean, dissmissed: boolean) {\r\n                if (!notification) {\r\n                    return;\r\n                }\r\n                const holder = _holder[notification.id];\r\n                if (!holder) {\r\n                    return;\r\n                }\r\n\r\n                if (!fromTimeout) {\r\n                    clearTimeout(holder.timeoutId);\r\n                }\r\n\r\n                act(holder.element, _cache.NOTIFICATION_ANIMATION_OUT).then(() => {\r\n                    // @ts-ignore utils is defined\r\n                    core.bus.emit(EVENTS.NOTIFIED, null, { ...notification, dissmissed: dissmissed })\r\n                    holder.element.remove();\r\n                    delete _holder[notification.id];\r\n                })\r\n            }\r\n\r\n            async function act(element: HTMLElement, animationClass: string, timeout?: number): Promise<boolean> {\r\n                //@ts-ignore utils is ignored\r\n                const delay = timeout ?? core.setup.animationTime;\r\n                const action = new CuiClassAction(animationClass);\r\n                //@ts-ignore actionsHelper is defined\r\n                return _actionsHelper.performAction(element, action, delay ?? 0);\r\n            }\r\n\r\n\r\n            function onEvent(data: ICuiNotification) {\r\n\r\n                if (!validateNotificationData(data) || !_container) {\r\n                    return;\r\n                }\r\n\r\n                if (_holder[data.id]) {\r\n                    return;\r\n                }\r\n                // Create element\r\n                getNotification(data, core, _cache, () => {\r\n                    onNotificationClose(data, false, true);\r\n                }).then(notificationEl => {\r\n                    if (!notificationEl) {\r\n                        return;\r\n                    }\r\n                    addNotificationToTree(notificationEl)\r\n                    // Set timeout function\r\n                    let timeoutId = null;\r\n                    //  If auto option is not specifically set to false\r\n                    if (!(data.auto === false)) {\r\n                        timeoutId = setAutoClose(data);\r\n                    }\r\n                    // Setup holder\r\n                    _holder[data.id] = {\r\n                        element: notificationEl,\r\n                        timeoutId: timeoutId\r\n                    }\r\n                    // Call open\r\n                    act(notificationEl, _cache.NOTIFICATION_ANIMATION_IN).then(() => {\r\n                        notificationEl.classList.add(_cache.NOTIFICATION_ACTIVE_CLS);\r\n                    });\r\n                });\r\n            }\r\n\r\n            getOrCreateContainer(core, document.body);\r\n\r\n            return [\r\n                [getPluginEventExtension({\r\n                    name: EVENTS.NOTIFY,\r\n                    id: pluginName,\r\n                    callback: onEvent\r\n                })],\r\n                () => {\r\n                    if (_container)\r\n                        _container.remove();\r\n                }\r\n            ]\r\n\r\n        }\r\n    })\r\n}\r\n\r\n// export class CuiNotificationPlugin implements ICuiPlugin {\r\n//     description: string;\r\n//     name: string = 'notification-plugin';\r\n//     setup: any;\r\n//     private _utils: CuiUtils | undefined;\r\n//     private _container: HTMLElement | null;\r\n//     private _handleId: string | null;\r\n//     private _cache: any;\r\n//     private _holder: ElementsHolder;\r\n//     private _actionsHelper: CuiActionsHelper | undefined;\r\n//     private _timeout: number;\r\n\r\n//     constructor(setup: ICuiNotificationPluginSetup) {\r\n//         this.description = \"CuiNotificationPlugin\";\r\n//         this._container = null;\r\n//         this._utils = undefined;\r\n//         this._handleId = null;\r\n//         this._cache = {};\r\n//         this._holder = {};\r\n//         this._actionsHelper = undefined;\r\n//         this._timeout = setup.timeout ?? 5000;\r\n//     }\r\n\r\n//     init(utils: CuiUtils): void {\r\n//         this.createCache(utils.setup.prefix);\r\n//         this.getOrCreateContainer(utils, document.body);\r\n//         this._actionsHelper = new CuiActionsHelper(utils.interactions);\r\n//         this._utils = utils\r\n//         this._handleId = this._utils.bus.on(EVENTS.NOTIFY, this.onEvent.bind(this), { $cuid: this.name });\r\n//     }\r\n\r\n//     destroy(): void {\r\n//         if (this._container)\r\n//             this._container.remove();\r\n//         if (this._handleId && this._utils) {\r\n//             this._utils.bus.detach(EVENTS.NOTIFY, this._handleId);\r\n//         }\r\n//     }\r\n\r\n//     private onEvent(data: ICuiNotification) {\r\n//         if (!validateNotificationData(data) || !this._utils || !this._actionsHelper || !this._container) {\r\n//             return;\r\n//         }\r\n\r\n//         if (this._holder[data.id]) {\r\n//             return;\r\n//         }\r\n//         // Create element\r\n//         getNotification(data, this._utils, this._cache, () => {\r\n//             this.onNotificationClose(data, false, true);\r\n//         }).then(notificationEl => {\r\n//             if (!notificationEl) {\r\n//                 return;\r\n//             }\r\n//             this.addNotificationToTree(notificationEl)\r\n//             // Set timeout function\r\n//             let timeoutId = null;\r\n//             //  If auto option is not specifically set to false\r\n//             if (!(data.auto === false)) {\r\n//                 timeoutId = this.setAutoClose(data);\r\n//             }\r\n//             // Setup holder\r\n//             this._holder[data.id] = {\r\n//                 element: notificationEl,\r\n//                 timeoutId: timeoutId\r\n//             }\r\n//             // Call open\r\n//             this.act(notificationEl, this._cache.NOTIFICATION_ANIMATION_IN).then(() => {\r\n//                 notificationEl.classList.add(this._cache.NOTIFICATION_ACTIVE_CLS);\r\n//             });\r\n//         });\r\n//     }\r\n\r\n//     private setAutoClose(data: ICuiNotification): any {\r\n//         return setTimeout(() => {\r\n//             this.onNotificationClose(data, true, false);\r\n//         }, this._timeout);\r\n//     }\r\n\r\n//     private addNotificationToTree(notifiactionElement: HTMLElement) {\r\n//         //@ts-ignore utils is defined\r\n//         this._utils.interactions.mutate(() => {\r\n//             // Add to DOM treee\r\n//             //@ts-ignore container is defined\r\n//             if (this._container.children.length === 0) {\r\n//                 //@ts-ignore container is defined\r\n//                 this._container.appendChild(notifiactionElement)\r\n//             } else {\r\n//                 //@ts-ignore container is defined\r\n//                 this._container.insertBefore(notifiactionElement, this._container.firstChild);\r\n//             }\r\n//         }, null)\r\n//     }\r\n\r\n//     private onNotificationClose(notification: ICuiNotification, fromTimeout: boolean, dissmissed: boolean) {\r\n//         if (!notification || !this._actionsHelper || !this._utils) {\r\n//             return;\r\n//         }\r\n//         const holder = this._holder[notification.id];\r\n//         if (!holder) {\r\n//             return;\r\n//         }\r\n\r\n//         if (!fromTimeout) {\r\n//             clearTimeout(holder.timeoutId);\r\n//         }\r\n\r\n//         this.act(holder.element, this._cache.NOTIFICATION_ANIMATION_OUT).then(() => {\r\n//             // @ts-ignore utils is defined\r\n//             this._utils.bus.emit(EVENTS.NOTIFIED, null, { ...notification, dissmissed: dissmissed })\r\n//             holder.element.remove();\r\n//             delete this._holder[notification.id];\r\n//         })\r\n//     }\r\n\r\n//     private getOrCreateContainer(utils: CuiUtils, root: HTMLElement) {\r\n//         this._container = document.getElementById(CONTAINER_ID);\r\n//         if (!this._container) {\r\n//             this._container = new ElementBuilder('div').setClasses(replacePrefix(CONTAINER_CLS, utils.setup.prefix)).build();\r\n//             root.appendChild(this._container);\r\n//         }\r\n//     }\r\n\r\n//     private createCache(prefix: string) {\r\n//         this._cache = {\r\n//             \"NOTIFICATION_CLS\": replacePrefix(NOTIFICATION_CLS, prefix),\r\n//             \"NOTIFICATION_HEADER_CLS\": replacePrefix(NOTIFICATION_HEADER_CLS, prefix),\r\n//             \"NOTIFICATION_TITLE_CLS\": replacePrefix(NOTIFICATION_TITLE_CLS, prefix),\r\n//             \"NOTIFICATION_BODY_CLS\": replacePrefix(NOTIFICATION_BODY_CLS, prefix),\r\n//             \"NOTIFICATION_FOOTER_CLS\": replacePrefix(NOTIFICATION_FOOTER_CLS, prefix),\r\n//             \"NOTIFICATION_ACTIVE_CLS\": replacePrefix(NOTIFICATION_ACTIVE_CLS, prefix),\r\n//             \"NOTIFICATION_ANIMATION_IN\": replacePrefix(NOTIFICATION_ANIMATION_IN, prefix),\r\n//             \"NOTIFICATION_ANIMATION_OUT\": replacePrefix(NOTIFICATION_ANIMATION_OUT, prefix),\r\n//             \"NOTIFICATION_ICON_CLS\": replacePrefix(NOTIFICATION_ICON_CLS, prefix),\r\n//             \"NOTIFICATION_CLOSE_CLS\": replacePrefix(NOTIFICATION_CLOSE_CLS, prefix),\r\n//             \"ICON_CLS\": replacePrefix(ICON_CLS, prefix),\r\n//             \"MARGIN_SMALL_VERTICAL\": replacePrefix(MARGIN_SMALL_VERTICAL, prefix),\r\n//         }\r\n//     }\r\n\r\n//     async act(element: HTMLElement, animationClass: string, timeout?: number): Promise<boolean> {\r\n//         //@ts-ignore utils is ignored\r\n//         const delay = timeout ?? this._utils.setup.animationTime;\r\n//         const action = new CuiClassAction(animationClass);\r\n//         //@ts-ignore actionsHelper is defined\r\n//         return this._actionsHelper.performAction(element, action, delay ?? 0);\r\n//     }\r\n\r\n// }","import { are, is } from \"../../core/utils/functions\";\r\nimport { ICuiNotification } from \"./interfaces\";\r\n\r\nexport function validateNotificationData(data: ICuiNotification): boolean {\r\n    return is(data) && are(data.id, data.title);\r\n}","import { ICuiPlugin } from \"../../core/models/interfaces\";\r\nimport { CuiCore } from \"../../core/models/core\";\r\nimport { getSystemPrintMode } from \"../../core/utils/functions\";\r\nimport { CuiMediaQueryListener } from \"../../core/listeners/media\";\r\nimport { CuiPlugin, getPluginListenerExtension } from \"../base\";\r\n\r\nexport interface AutoPrintPluginSetup {\r\n    autoPrint: boolean;\r\n}\r\n\r\nexport function CuiAutoPrintModePluginFn(autoPrintInit: AutoPrintPluginSetup): ICuiPlugin {\r\n    const desc: string = \"CuiAutoPrintModePlugin\";\r\n    return new CuiPlugin({\r\n        name: 'auto-print',\r\n        description: desc,\r\n        setup: autoPrintInit,\r\n        callback: (utils: CuiCore, setup: AutoPrintPluginSetup) => {\r\n            const listener = new CuiMediaQueryListener('print');\r\n            listener.setCallback((t: MediaQueryListEvent) => {\r\n                setup = utils.setup.plugins[desc] as AutoPrintPluginSetup;\r\n                let autoPrint = setup?.autoPrint ?? false;\r\n                if (autoPrint) {\r\n                    if (t.matches) {\r\n                        utils.setPrintMode(true)\r\n                    } else {\r\n                        utils.setPrintMode(false)\r\n                    }\r\n                }\r\n            })\r\n\r\n            if (setup.autoPrint && getSystemPrintMode()) {\r\n                utils.setPrintMode(true)\r\n            }\r\n\r\n            return [[getPluginListenerExtension({\r\n                listener: listener\r\n            })], undefined]\r\n        }\r\n    })\r\n}","import { CuiWindowSize } from \"../../core/utils/types\";\r\nimport { calcWindowSize } from \"../../core/utils/functions\";\r\nimport { ICuiEventBus } from \"../../core/bus/interfaces\";\r\nimport { EVENTS } from \"../../core/utils/statics\";\r\nimport { CuiResizeData } from \"src/core/models/events\";\r\n\r\nexport interface ICuiResizable {\r\n    resize(data: CuiResizeData): Promise<boolean>;\r\n}\r\n\r\nexport interface ICuiResizableObserver {\r\n    observe(target: ICuiResizable): void;\r\n    unobserve(target: ICuiResizable): void;\r\n    connect(): void;\r\n    disconnect(): void;\r\n}\r\n\r\n\r\n\r\nexport class CuiResizeObserver implements ICuiResizableObserver {\r\n\r\n    #items: ICuiResizable[];\r\n    #promises: Promise<boolean>[];\r\n    #prevYValue: number;\r\n    #inProgress: boolean;\r\n    #previousSize: CuiWindowSize;\r\n    #threshold: number;\r\n    #bus: ICuiEventBus;\r\n    #listenerBoundCall: (ev: UIEvent) => void;\r\n    constructor(bus: ICuiEventBus, threshold?: number) {\r\n        this.#items = [];\r\n        this.#promises = [];\r\n        this.#prevYValue = window.innerWidth;\r\n        this.#inProgress = false;\r\n        this.#previousSize = calcWindowSize(window.innerWidth)\r\n        this.#threshold = threshold ?? 0;\r\n        this.#bus = bus;\r\n        this.#listenerBoundCall = this.listener.bind(this);\r\n    }\r\n\r\n    observe(target: ICuiResizable): void {\r\n        let idx = this.#items.findIndex(x => x === target)\r\n        if (idx < 0) {\r\n            this.#items.push(target);\r\n        }\r\n    }\r\n\r\n    unobserve(target: ICuiResizable): void {\r\n        let idx = this.#items.findIndex(x => x === target)\r\n        if (idx >= 0) {\r\n            this.#items.splice(idx, 1)\r\n        }\r\n    }\r\n    connect(): void {\r\n        window.addEventListener('resize', this.#listenerBoundCall)\r\n    }\r\n\r\n    disconnect(): void {\r\n        window.removeEventListener('resize', this.#listenerBoundCall)\r\n    }\r\n\r\n    private pushUpdateToItems(resizeData: CuiResizeData) {\r\n        if (this.#items.length < 1) {\r\n            return;\r\n        }\r\n        this.#promises = [];\r\n        this.#items.forEach(x => {\r\n            this.#promises.push(x.resize(resizeData))\r\n        })\r\n        Promise.all(this.#promises)\r\n        this.#promises = [];\r\n    }\r\n\r\n    private listener(ev: UIEvent) {\r\n        if (this.#inProgress) {\r\n            return;\r\n        }\r\n        this.#inProgress = true\r\n        const diff = window.innerWidth - this.#prevYValue;\r\n\r\n        if (Math.abs(diff) >= this.#threshold) {\r\n            const currentSize = calcWindowSize(window.innerWidth);\r\n            if (currentSize !== this.#previousSize) {\r\n                const resizeData: CuiResizeData = {\r\n                    current: currentSize,\r\n                    previous: this.#previousSize,\r\n                    width: window.innerWidth,\r\n                    height: window.innerHeight,\r\n                    timestamp: Date.now(),\r\n                    name: EVENTS.RESIZE,\r\n                    source: \"CuiResizeObserver\"\r\n                };\r\n                this.#bus.emit(EVENTS.RESIZE, \"\", resizeData)\r\n                this.pushUpdateToItems(resizeData);\r\n\r\n                this.#previousSize = currentSize;\r\n            }\r\n        }\r\n        this.#inProgress = false\r\n    }\r\n\r\n\r\n}","import { ICuiPlugin } from \"src/core/models/interfaces\";\r\nimport { CuiCore } from \"../../core/models/core\";\r\nimport { CuiPlugin } from \"../base\";\r\nimport { ICuiResizableObserver, CuiResizeObserver } from \"./observer\";\r\n\r\nexport interface CuiResizeObserverPluginSetup {\r\n    resizeThreshold?: number;\r\n}\r\n\r\nexport function CuiResizeObserverPluginFn(setup: CuiResizeObserverPluginSetup): ICuiPlugin {\r\n    return new CuiPlugin({\r\n        name: 'resize-observer-plugin',\r\n        description: \"CuiResizeObserverPlugin\",\r\n        setup: {\r\n            resizeThreshold: 20,\r\n            ...setup\r\n        },\r\n        callback: (utils: CuiCore, setup: CuiResizeObserverPluginSetup) => {\r\n            const resizeObserver: ICuiResizableObserver = new CuiResizeObserver(utils.bus, setup.resizeThreshold);\r\n            resizeObserver.connect();\r\n            return [\r\n                [], () => { resizeObserver.disconnect(); }\r\n            ]\r\n        }\r\n    })\r\n}","import { IUIInteractionProvider } from \"../../core/models/interfaces\";\r\nimport { is, sleep } from \"../../core/utils/functions\";\r\nimport { CLASSES } from \"../../core/utils/statics\";\r\n\r\nexport class CuiToastHandler {\r\n    #interactions: IUIInteractionProvider;\r\n    #selector: string;\r\n    #className: string;\r\n    #activeCls: string;\r\n    #animationTime: number;\r\n    #lock: boolean;\r\n    #animClsIn: string;\r\n    #animClsOut: string;\r\n    constructor(interaction: IUIInteractionProvider, prefix: string, animationTime: number) {\r\n        this.#interactions = interaction;\r\n        this.#selector = `.${prefix}-toast`;\r\n        this.#className = `${prefix}-toast`;\r\n        this.#activeCls = `${prefix}-active`;\r\n        this.#animationTime = animationTime;\r\n        this.#lock = false;\r\n        this.#animClsIn = `${prefix}-toast-animation-in`;\r\n        this.#animClsOut = `${prefix}-toast-animation-out`\r\n    }\r\n\r\n    async show(message: string): Promise<boolean> {\r\n        if (this.#lock) {\r\n            return false;\r\n        }\r\n        this.#lock = true;\r\n        let toastElement = document.querySelector(this.#selector);\r\n        if (!is(toastElement)) {\r\n            toastElement = document.createElement('div');\r\n            toastElement.classList.add(this.#className);\r\n            document.body.appendChild(toastElement);\r\n            await sleep(10);\r\n        }\r\n\r\n        this.#interactions.mutate(() => {\r\n            //@ts-ignore\r\n            toastElement.textContent = message;\r\n            //@ts-ignore\r\n            toastElement.classList.add(CLASSES.animProgress);\r\n            //@ts-ignore\r\n            toastElement.classList.add(this.#animClsIn);\r\n        }, this);\r\n\r\n        await sleep(this.#animationTime);\r\n        this.#interactions.mutate(() => {\r\n            //@ts-ignore\r\n            toastElement.classList.remove(CLASSES.animProgress);\r\n            //@ts-ignore\r\n            toastElement.classList.remove(this.#animClsIn);\r\n            //@ts-ignore\r\n            toastElement.classList.add(this.#activeCls);\r\n        }, this)\r\n        await sleep(3000);\r\n        this.#interactions.mutate(() => {\r\n            //@ts-ignore\r\n            toastElement.classList.add(CLASSES.animProgress);\r\n            //@ts-ignore\r\n            toastElement.classList.add(this.#animClsOut);\r\n        }, this)\r\n\r\n        setTimeout(() => {\r\n            this.#interactions.mutate(() => {\r\n                //@ts-ignore\r\n                toastElement.classList.remove(CLASSES.animProgress);\r\n                //@ts-ignore\r\n                toastElement.classList.remove(this.#animClsOut);\r\n                //@ts-ignore\r\n                toastElement.classList.remove(this.#activeCls);\r\n            }, this)\r\n            this.#lock = false;\r\n        }, this.#animationTime);\r\n        return true;\r\n    }\r\n}","import { EVENTS } from \"../../core/utils/statics\";\r\nimport { CuiCore } from \"../../core/models/core\";\r\nimport { CuiToastHandler } from \"./handler\";\r\nimport { CuiPlugin, getPluginEventExtension } from \"../base\";\r\nimport { ICuiPlugin } from \"src/core/models/interfaces\";\r\n\r\nexport interface CuiToastPluginSetup {}\r\n\r\nexport function CuiToastPlugin(setup?: CuiToastPluginSetup): ICuiPlugin {\r\n\tconst name: string = \"toast-plugin\";\r\n\r\n\treturn new CuiPlugin({\r\n\t\tname: name,\r\n\t\tdescription: \"CuiToastPlugin\",\r\n\t\tsetup: setup ?? {},\r\n\t\tcallback: (utils: CuiCore) => {\r\n\t\t\tconst toastHandler = new CuiToastHandler(\r\n\t\t\t\tutils.interactions,\r\n\t\t\t\tutils.setup.prefix,\r\n\t\t\t\tutils.setup.animationTime ?? 300\r\n\t\t\t);\r\n\r\n\t\t\tfunction onToast(message: string) {\r\n\t\t\t\tif (!toastHandler) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tutils.bus.emit(EVENTS.TOAST_SHOW, null, []);\r\n\t\t\t\ttoastHandler.show(message).then(() => {\r\n\t\t\t\t\tif (utils) utils.bus.emit(EVENTS.TOAST_HIDDEN, null, []);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\treturn [\r\n\t\t\t\t[\r\n\t\t\t\t\tgetPluginEventExtension({\r\n\t\t\t\t\t\tname: EVENTS.TOAST,\r\n\t\t\t\t\t\tid: name,\r\n\t\t\t\t\t\tcallback: onToast,\r\n\t\t\t\t\t}),\r\n\t\t\t\t],\r\n\t\t\t\tundefined,\r\n\t\t\t];\r\n\t\t},\r\n\t});\r\n}\r\n","import { ICuiDictionary, ICuiDictionaryItem } from \"../models/interfaces\";\r\nimport { ItemNotFoundError, ArgumentError } from \"../models/errors\";\r\nimport { is } from \"./functions\";\r\n\r\nexport class CuiDictionary<T> implements ICuiDictionary<T> {\r\n\r\n    private _keys: string[];\r\n    private _values: T[];\r\n    private _lock: boolean;\r\n\r\n    constructor(init?: ICuiDictionaryItem<T>[]) {\r\n        this._keys = []\r\n        this._values = []\r\n        this._lock = false;\r\n\r\n        if (init) {\r\n            init.forEach(x => {\r\n                if (!is(x.key)) {\r\n                    this._keys = []\r\n                    this._values = []\r\n                    throw new ArgumentError(\"Key is empty\");\r\n                }\r\n                this.add(x.key, x.value)\r\n            })\r\n        }\r\n    }\r\n\r\n    add(key: string, value: T): void {\r\n        this.throwOnEmptyKey(key)\r\n        this.lock(() => {\r\n            if (this.containsKey(key))\r\n                throw new Error(\"Key already exists\");\r\n            this._keys.push(key)\r\n            this._values.push(value)\r\n        })\r\n    }\r\n\r\n    remove(key: string): void {\r\n        this.throwOnEmptyKey(key);\r\n        this.lock(() => {\r\n            let index = this._keys.indexOf(key);\r\n            if (index < 0) {\r\n                return;\r\n            }\r\n            this._keys.splice(index, 1)\r\n            this._values.splice(index, 1)\r\n        })\r\n    }\r\n\r\n    get(key: string): T | undefined {\r\n        this.throwOnEmptyKey(key)\r\n        let value = undefined\r\n        this.lock(() => {\r\n            let index = this.indexOf(key)\r\n            if (index >= 0) {\r\n                value = this._values[index];\r\n            }\r\n        })\r\n        return value;\r\n    }\r\n\r\n    containsKey(key: string): boolean {\r\n        return is(key) && this.indexOf(key) >= 0\r\n    }\r\n\r\n    keys(): string[] {\r\n        return [...this._keys];\r\n    }\r\n    values(): T[] {\r\n        return [...this._values];\r\n    }\r\n\r\n    indexOf(key: string): number {\r\n        return is(key) ? this._keys.indexOf(key) : -1;\r\n    }\r\n\r\n    update(key: string, value: T): void {\r\n        this.throwOnEmptyKey(key)\r\n        this.lock(() => {\r\n            let index = this.indexOf(key)\r\n            if (index < 0) {\r\n                throw new ItemNotFoundError(`Item with key [${key}] not found`)\r\n            }\r\n            this._values[index] = value\r\n        })\r\n\r\n    }\r\n\r\n    clear() {\r\n        this.lock(() => {\r\n            this._values = [];\r\n            this._keys = [];\r\n        });\r\n\r\n    }\r\n\r\n    forEach(callback: (key: string, value: T) => void) {\r\n        this.lock(() => {\r\n            let len = this._keys.length;\r\n            for (let index = 0; index < len; index++) {\r\n                callback(this._keys[index], this._values[index]);\r\n            }\r\n        });\r\n    }\r\n\r\n    private checkLock(): void {\r\n        if (this._lock) {\r\n            throw new Error(\"You cannot alter dictionary when is locked!\");\r\n        }\r\n    }\r\n\r\n    private lock(callback: () => void) {\r\n        this.checkLock();\r\n        this._lock = true;\r\n        try {\r\n            callback();\r\n        } catch (e) {\r\n            throw e;\r\n        } finally {\r\n            this._lock = false;\r\n        }\r\n    }\r\n\r\n    private throwOnEmptyKey(key: string) {\r\n        if (!is(key)) {\r\n            throw new ArgumentError(\"Key is empty\");\r\n        }\r\n    }\r\n}","import { ICuiDictionary } from \"../../../core/models/interfaces\";\r\nimport { CuiDictionary } from \"../../../core/utils/dictionary\";\r\nimport { ICuiHandlerExtension } from \"./interfaces\";\r\n\r\nexport class CuiExtensionsHandler<T> {\r\n    #dict: ICuiDictionary<ICuiHandlerExtension<T>>;\r\n    constructor() {\r\n        this.#dict = new CuiDictionary();\r\n    }\r\n\r\n    add(module: ICuiHandlerExtension<T>): void {\r\n        this.#dict.add(module.type, module);\r\n    }\r\n\r\n    remove(type: string): void {\r\n        this.#dict.remove(type);\r\n    }\r\n\r\n    async init(args: T): Promise<boolean> {\r\n        let promises: Promise<boolean>[] = []\r\n        this.#dict.forEach((name, module) => {\r\n            if (module.init)\r\n                promises.push(module.init(args))\r\n        })\r\n        await Promise.all(promises);\r\n        return true;\r\n    }\r\n\r\n    async update(args: T): Promise<boolean> {\r\n        let promises: Promise<boolean>[] = []\r\n        this.#dict.forEach((name, module) => {\r\n            if (module.update) {\r\n                promises.push(module.update(args));\r\n            }\r\n        })\r\n        await Promise.all(promises);\r\n        return true;\r\n    }\r\n\r\n    async destroy(): Promise<boolean> {\r\n        let promises: Promise<boolean>[] = []\r\n        this.#dict.forEach((name, module) => {\r\n            if (module.destroy) {\r\n                promises.push(module.destroy());\r\n            }\r\n        })\r\n        await Promise.all(promises);\r\n        return true\r\n    }\r\n}","import { ICuiEventBus } from \"../../../core/bus/interfaces\";\r\nimport { EventBase } from \"../../../core/models/events\";\r\nimport { CuiHTMLElement, ICuiPair, IUIInteractionProvider } from \"../../../core/models/interfaces\";\r\n\r\nexport interface ICuiEventBusFacade {\r\n    emit<T extends EventBase>(event: string, data: T, source?: CuiHTMLElement): Promise<boolean>;\r\n    on<T>(event: string, callback: (t: T) => void): string | null;\r\n    detach(event: string, id: string | null): void;\r\n    detachEmittedEvents(): void;\r\n}\r\n\r\nexport interface ICuiInteractionsFacade {\r\n    mutate(callback: any, ...args: any[]): void;\r\n    fetch(callback: any, ...args: any[]): void;\r\n}\r\n\r\nexport interface ICuiInteractionsAsyncFacade<T> {\r\n    mutate(callback: (...args: any[]) => T, ...args: any[]): Promise<T>;\r\n    fetch(callback: (...args: any[]) => T, ...args: any[]): Promise<T>;\r\n}\r\n\r\nexport interface ICuiClassesHelper {\r\n    hasClass(cls: string, element: Element): boolean\r\n}\r\n\r\n\r\nexport interface ICuiClassesHelper {\r\n    hasClass(cls: string, element: Element): boolean;\r\n    setClass(cls: string, element: Element): void;\r\n    setClasses(classes: string[], element?: Element): void;\r\n    removeClass(cls: string, element: Element): void;\r\n    removeClasses(classes: string[], element?: Element): void;\r\n\r\n}\r\n\r\nexport interface ICuiClassesAsyncHelper {\r\n    removeClasses(element: Element, ...classes: string[]): void;\r\n    setClasses(element: Element, ...classes: string[]): void;\r\n}\r\n\r\nexport interface ICuiAttributesAsyncHelper {\r\n    removeAttribute(attributeName: string, element: Element): void;\r\n    removeAttributes(attributeName: string[], element: Element): void;\r\n    setAttribute(attributeName: string, value: string, element: Element): void;\r\n    setAttributes(attributes: ICuiPair<string, string>[], element: Element): void;\r\n}\r\n\r\nexport interface ICuiStyleHelper {\r\n    setStyle(property: string, value: string, element: any): void;\r\n    removeStyle(property: string, element: any): void;\r\n    clean(element: HTMLElement): void;\r\n}\r\n\r\nexport interface ICuiStyleAsyncHelper {\r\n    setStyle(property: string, value: string, element: any): void;\r\n    removeStyle(property: string, element: any): void;\r\n    setStyles(properties: ICuiPair<string, string>[], element: any): void;\r\n    removeStyles(properties: string[], element: any): void;\r\n    clean(element: HTMLElement): void;\r\n}\r\n\r\nexport function getEventBusFacade(cuid: string, bus: ICuiEventBus, target: HTMLElement): ICuiEventBusFacade {\r\n    const _emittedEvents: string[] = [];\r\n    return {\r\n        emit: async <T extends EventBase>(event: string, data: T, source?: CuiHTMLElement) => {\r\n            if (!_emittedEvents.includes(event))\r\n                _emittedEvents.push(event);\r\n\r\n            return bus.emit(event, cuid, {\r\n                ...data,\r\n                name: event,\r\n                timestamp: Date.now(),\r\n                source: source ?? target,\r\n            })\r\n        },\r\n        on: <T>(event: string, callback: (t: T) => void) => {\r\n            return bus.on(event, callback, target as any)\r\n        },\r\n        detach: (event: string, id: string | null) => {\r\n            if (id != null) {\r\n                bus.detach(event, id);\r\n                id = \"\";\r\n            }\r\n        },\r\n        detachEmittedEvents: () => {\r\n            _emittedEvents.forEach(event => {\r\n                bus.detachByCuid(event, cuid);\r\n            })\r\n        }\r\n    }\r\n}\r\n\r\nexport function getCuiHandlerInteractions<T>(interactions: IUIInteractionProvider, ctx?: T): ICuiInteractionsFacade {\r\n    return {\r\n        mutate: (callback: any, ...args: any[]) => {\r\n            interactions.mutate(callback, ctx ?? null, ...args)\r\n        },\r\n        fetch: (callback: any, ...args: any[]) => {\r\n            interactions.fetch(callback, ctx ?? null, ...args)\r\n        }\r\n    }\r\n}\r\n\r\nexport function cuiHandlerAsyncInteractions<T>(interactions: IUIInteractionProvider, ctx?: any): ICuiInteractionsAsyncFacade<T> {\r\n    return {\r\n        mutate: (callback: (...args: any[]) => T, ...args: any[]) => {\r\n            return new Promise((resolve, reject) => {\r\n                interactions.mutate(() => {\r\n                    try {\r\n                        resolve(callback(...args));\r\n                    } catch (e) {\r\n                        reject(e)\r\n                    }\r\n                }, ctx ?? null)\r\n            });\r\n        },\r\n        fetch: (callback: (...args: any[]) => T, ...args: any[]) => {\r\n            return new Promise((resolve, reject) => {\r\n                interactions.fetch(() => {\r\n                    try {\r\n                        resolve(callback(...args));\r\n                    } catch (e) {\r\n                        reject(e)\r\n                    }\r\n                }, ctx ?? null)\r\n            });\r\n        }\r\n    }\r\n}\r\n\r\n\r\nexport class ClassesHelper implements ICuiClassesHelper {\r\n\r\n    hasClass(cls: string, element: Element): boolean {\r\n        return cls && element.classList.contains(cls) ? true : false;\r\n    }\r\n\r\n    setClass(cls: string, element: Element): void {\r\n        this.setClasses([cls], element);\r\n    }\r\n\r\n    setClasses(classes: string[], element?: Element) {\r\n        if (element) {\r\n            element.classList.add(...classes)\r\n        }\r\n    }\r\n\r\n\r\n    removeClass(cls: string, element: Element) {\r\n        this.removeClasses([cls], element);\r\n    }\r\n\r\n    removeClasses(classes: string[], element?: Element) {\r\n        if (element) {\r\n            element.classList.remove(...classes)\r\n        }\r\n    }\r\n}\r\n\r\nexport class CuiClassesAsyncHelper implements ICuiClassesAsyncHelper {\r\n    private _interactions: IUIInteractionProvider;\r\n    private _classesHelper: ICuiClassesHelper;\r\n    constructor(interactions: IUIInteractionProvider, helper: ICuiClassesHelper) {\r\n        this._interactions = interactions;\r\n        this._classesHelper = helper;\r\n    }\r\n\r\n    removeClasses(element: Element, ...classes: string[]) {\r\n        this._interactions.mutate(this._classesHelper.removeClasses, this._classesHelper, classes, element);\r\n    }\r\n\r\n    setClasses(element: Element, ...classes: string[]) {\r\n        this._interactions.mutate(this._classesHelper.setClasses, this._classesHelper, classes, element);\r\n    }\r\n\r\n}\r\n\r\nexport class CuiAttributeHelper implements ICuiAttributesAsyncHelper {\r\n\r\n    private _interactions: IUIInteractionProvider;\r\n    constructor(interactions: IUIInteractionProvider) {\r\n        this._interactions = interactions;\r\n    }\r\n\r\n    removeAttribute(attributeName: string, element: Element): void {\r\n        this._interactions.mutate(() => {\r\n            element.removeAttribute(attributeName);\r\n        }, null)\r\n    }\r\n\r\n    setAttribute(attributeName: string, value: string, element: Element): void {\r\n        this._interactions.mutate(() => {\r\n            element.setAttribute(attributeName, value);\r\n        }, null)\r\n    }\r\n\r\n    removeAttributes(attributeName: string[], element: Element): void {\r\n        this._interactions.mutate(() => {\r\n            attributeName.forEach((attr) => {\r\n                if (!attr) {\r\n                    return;\r\n                }\r\n                element.removeAttribute(attr)\r\n            })\r\n        }, null)\r\n    }\r\n\r\n    setAttributes(attributes: ICuiPair<string, string>[], element: Element): void {\r\n        this._interactions.mutate(() => {\r\n            attributes.forEach((attr) => {\r\n                if (!attr.key) {\r\n                    return;\r\n                }\r\n                element.setAttribute(attr.key, attr.value)\r\n            })\r\n        }, null)\r\n    }\r\n\r\n}\r\n\r\nexport class CuiStyleHelper implements ICuiStyleHelper {\r\n    clean(element: HTMLElement): void {\r\n        if (!element || !element.hasAttribute('style')) {\r\n            return;\r\n        }\r\n        element.removeAttribute('style');\r\n\r\n    }\r\n\r\n    setStyle(property: string, value: string, element: any): void {\r\n        if (!element || !element['style']) {\r\n            return;\r\n        }\r\n        element.style[property] = value;\r\n    }\r\n\r\n    removeStyle(property: string, element: any): void {\r\n        if (!element || !element['style'] || !element['style'][property]) {\r\n            return;\r\n        }\r\n        delete element['style'][property];\r\n    }\r\n\r\n}\r\n\r\nexport class CuiStyleAsyncHelper implements ICuiStyleAsyncHelper {\r\n    private _interactions: IUIInteractionProvider;\r\n    private _helper: ICuiStyleHelper;\r\n    constructor(interactions: IUIInteractionProvider, helper: ICuiStyleHelper) {\r\n        this._interactions = interactions;\r\n        this._helper = helper;\r\n    }\r\n\r\n    setStyle(property: string, value: string, element: any): void {\r\n        this._interactions.mutate(this._helper.setStyle, this._helper, property, value, element);\r\n    }\r\n\r\n    removeStyle(property: string, element: any): void {\r\n        this._interactions.mutate(this._helper.removeStyle, this._helper, property, element);\r\n    }\r\n\r\n    setStyles(properties: ICuiPair<string, string>[], element: any): void {\r\n        if (!element['style']) {\r\n            return;\r\n        }\r\n        this._interactions.mutate(() => {\r\n            properties.forEach(prop => {\r\n                if (!prop.key) {\r\n                    return;\r\n                }\r\n                element[\"style\"][prop.key] = prop.value;\r\n            })\r\n        }, null);\r\n\r\n    }\r\n\r\n    removeStyles(properties: string[], element: any): void {\r\n        if (!element['style']) {\r\n            return;\r\n        }\r\n        this._interactions.mutate(() => {\r\n            properties.forEach(prop => {\r\n                if (!prop) {\r\n                    return;\r\n                }\r\n                delete element[\"style\"][prop];\r\n            })\r\n        }, null);\r\n    }\r\n\r\n    clean(element: HTMLElement) {\r\n        this._interactions.mutate(this._helper.clean, this._helper, element);\r\n    }\r\n}","import { CuiContext, ICuiComponentHandler, ICuiParsable } from \"../models/interfaces\";\r\nimport { CuiCore } from \"../models/core\";\r\nimport { ICuiComponentAction, CuiActionsFactory } from \"../utils/actions\";\r\nimport { getActiveClass, clone } from \"../utils/functions\";\r\nimport { ICuiDevelopmentTool } from \"../development/interfaces\";\r\nimport { CuiDevtoolFactory } from \"../development/factory\";\r\nimport { CuiExtensionsHandler } from \"./extensions/handler\";\r\nimport { ICuiHandlerExtension } from \"./extensions/interfaces\";\r\nimport { ClassesHelper, CuiClassesAsyncHelper, ICuiClassesAsyncHelper, ICuiClassesHelper } from \"./extensions/facades\";\r\n\r\nexport class CuiComponentHandlerProps {\r\n    log: ICuiDevelopmentTool;\r\n    core: CuiCore;\r\n    element: HTMLElement;\r\n    cuid: string;\r\n    activeClassName: string;\r\n    componentName: string;\r\n\r\n    constructor(componentName: string, element: HTMLElement, utils: CuiCore) {\r\n        this.log = CuiDevtoolFactory.get(componentName);\r\n        this.core = utils;\r\n        this.element = element;\r\n        this.cuid = (<any>element).$cuid;\r\n        this.activeClassName = getActiveClass(utils.setup.prefix);\r\n        this.componentName = componentName;\r\n    }\r\n}\r\n\r\nexport class CuiComponentBase extends CuiComponentHandlerProps implements CuiContext {\r\n\r\n    private _isLocked: boolean;\r\n\r\n    constructor(componentName: string, element: HTMLElement, utils: CuiCore) {\r\n        super(componentName, element, utils)\r\n        this._isLocked = false;\r\n    }\r\n\r\n    getEventName(name: string) {\r\n        return [name, this.cuid].join('-');\r\n    }\r\n\r\n    getId() {\r\n        return this.cuid;\r\n    }\r\n    /**\r\n     * Helper which checks whether element has an active flag set\r\n     */\r\n    isActive(): boolean {\r\n        return this.element.classList.contains(this.activeClassName);\r\n    }\r\n\r\n    lock(fName?: string): boolean {\r\n        if (this._isLocked) {\r\n            this.log.warning(\"Component is locked: \", fName ?? \"\");\r\n            return false;\r\n        }\r\n        this._isLocked = true;\r\n        return this._isLocked;\r\n    }\r\n\r\n    unlock(fName?: string): boolean {\r\n        if (!this._isLocked) {\r\n            this.log.warning(\"Component is not locked: \", fName ?? \"\");\r\n            return false;\r\n        }\r\n        this._isLocked = false;\r\n        return this._isLocked;\r\n    }\r\n\r\n    logInfo(message: string, functionName?: string) {\r\n        this.log.debug(message, functionName);\r\n    }\r\n\r\n    logWarning(message: string, functionName?: string) {\r\n        this.log.warning(message, functionName);\r\n    }\r\n\r\n    logError(message: string, functionName?: string, error?: Error) {\r\n        this.log.error(message, functionName);\r\n        if (error) {\r\n            this.log.exception(error, functionName)\r\n        }\r\n    }\r\n}\r\n\r\n\r\nexport abstract class CuiHandlerBase<T extends ICuiParsable> extends CuiComponentBase implements ICuiComponentHandler {\r\n    args: T;\r\n    prevArgs: T | undefined;\r\n    isInitialized: boolean;\r\n    classes: ICuiClassesHelper;\r\n    asyncClasses: ICuiClassesAsyncHelper;\r\n    activeAction: ICuiComponentAction;\r\n    attribute: string;\r\n    private _extensionHandler: CuiExtensionsHandler<T>;\r\n    constructor(componentName: string, element: HTMLElement, attribute: string, args: T, utils: CuiCore) {\r\n        super(componentName, element, utils);\r\n        this.args = args;\r\n        this.classes = new ClassesHelper();\r\n        this.asyncClasses = new CuiClassesAsyncHelper(utils.interactions, this.classes);\r\n        this.prevArgs = undefined;\r\n        this.isInitialized = false;\r\n        this.attribute = attribute;\r\n        this._extensionHandler = new CuiExtensionsHandler();\r\n        this.activeAction = CuiActionsFactory.get(this.activeClassName);\r\n    }\r\n\r\n    async handle(args: any): Promise<boolean> {\r\n        if (this.isInitialized) {\r\n            this.logWarning(\"Trying to initialize handler again\", 'handle');\r\n            return false;\r\n        }\r\n        if (!this.lock(\"handle\")) {\r\n            return false;\r\n        }\r\n        this.log.registerElement(this.element, this.cuid, this.componentName);\r\n        this.args.parse(args);\r\n        if (!this.element.classList.contains(this.attribute)) {\r\n            this.asyncClasses.setClasses(this.element, this.attribute)\r\n        }\r\n\r\n        this.logInfo(\"Init\", 'handle');\r\n        await this._extensionHandler.init(args);\r\n        return this.performLifecycleOp(\"onHandle\", this.onHandle(), () => {\r\n            this.unlock();\r\n            this.isInitialized = true;\r\n        });\r\n    }\r\n\r\n    async refresh(args: any): Promise<boolean> {\r\n        this.logInfo(\"Update\", 'refresh')\r\n        if (!this.isInitialized) {\r\n            this.logError(\"Cannot update not initialized component\", 'refresh');\r\n            return false;\r\n        }\r\n        if (!this.lock()) {\r\n            return false;\r\n        }\r\n        this.prevArgs = clone(this.args);\r\n        this.args.parse(args);\r\n        this.log.debug(\"Component update\", 'refresh');\r\n        await this._extensionHandler.update(args);\r\n        return this.performLifecycleOp(\"onRefresh\", this.onRefresh(), () => {\r\n            this.unlock();\r\n        });\r\n    }\r\n\r\n    async destroy(): Promise<boolean> {\r\n        this.logInfo(\"Destroy\", \"destroy\");\r\n        if (!this.isInitialized) {\r\n            this.logError(\"Cannot update not initialized component\", 'destroy');\r\n            return false;\r\n        }\r\n        if (!this.lock('destroy')) {\r\n            return false;\r\n        }\r\n        await this._extensionHandler.destroy();\r\n        return this.performLifecycleOp(\"onRemove\", this.onRemove(), () => {\r\n            this.log.unregisterElement(this.cuid, this.componentName);\r\n            this.isInitialized = false;\r\n            this.unlock();\r\n            //@ts-ignore - release the reference\r\n            this.element = null;\r\n        });\r\n    }\r\n\r\n    extend(extension: ICuiHandlerExtension<T>) {\r\n        if (this.isInitialized) {\r\n            throw (new Error(\"Cannot extend initialized handler\"))\r\n        }\r\n        this._extensionHandler.add(extension);\r\n    }\r\n\r\n\r\n    private async performLifecycleOp(method: string, operation: Promise<boolean>, onFinish: () => void): Promise<boolean> {\r\n        let result = false;\r\n        try {\r\n            result = await operation;\r\n        } catch (e) {\r\n            this.logError(\"An exception occured in\" + method, method, e)\r\n        } finally {\r\n            onFinish();\r\n        }\r\n        return result\r\n    }\r\n\r\n\r\n    // Abstract\r\n    abstract onHandle(): Promise<boolean>;\r\n    abstract onRefresh(): Promise<boolean>;\r\n    abstract onRemove(): Promise<boolean>;\r\n}","import { ICuiParsable } from \"../models/interfaces\";\r\nimport { enumerateObject, isStringTrue, measure } from \"./functions\";\r\n\r\nexport interface ValueCorrectors {\r\n    [name: string]: (value: any) => any;\r\n}\r\n\r\nexport interface CuiArgProp {\r\n    default?: any;\r\n    type?: string;\r\n    corrector?: (value: any) => any;\r\n}\r\n\r\nexport interface CuiArgProps {\r\n    [name: string]: CuiArgProp;\r\n}\r\n\r\nexport interface CuiAutoParseOptions {\r\n    main?: string;\r\n    props?: CuiArgProps;\r\n}\r\n\r\ninterface TypeParserCallbacks {\r\n    [type: string]: (value: any) => string | number | boolean | undefined;\r\n}\r\n\r\nconst parserCallbacks: TypeParserCallbacks = {\r\n    \"string\": (value: any) => value.trim().toLowerCase(),\r\n    'boolean': isStringTrue,\r\n    \"number\": (value: any) => {\r\n        const num = value.includes('.') ? parseFloat(value) : parseInt(value);\r\n        return isNaN(num) ? undefined : num;\r\n    }\r\n}\r\n\r\nexport class CuiAutoParseArgs implements ICuiParsable {\r\n    private _parser: TypeParser;\r\n    private _defaults: any;\r\n    private _defaultsLength: number;\r\n    private _options: CuiAutoParseOptions\r\n    constructor(options?: CuiAutoParseOptions) {\r\n        this._options = options ?? {};\r\n        this._parser = new TypeParser(this._options.props);\r\n        this._defaults = {};\r\n        this._defaultsLength = 0;\r\n    }\r\n\r\n    parse(args: any): void {\r\n        this.fillDefaultValues();\r\n        if (!args) {\r\n            return;\r\n        }\r\n\r\n        if (typeof args === 'string' && this._options.main) {\r\n            const currentType: string = typeof (this as any)[this._options.main];\r\n            (this as any)[this._options.main] = this._parser.parseValue(this._options.main, args, currentType);\r\n            return;\r\n        }\r\n\r\n        enumerateObject(this, (thisProp, thisValue) => {\r\n            const currentType: string = typeof thisValue;\r\n            // In case args doesn't have property, set default value set during object construction\r\n            if (!args[thisProp]) {\r\n                (this as any)[thisProp] = this._defaults[thisProp];\r\n                return;\r\n            }\r\n            // Case that value is in args, parse and adjust\r\n            const newVal = this._parser.parseValue(thisProp, args[thisProp], currentType);\r\n            if (newVal) {\r\n                (this as any)[thisProp] = newVal;\r\n            }\r\n        })\r\n    }\r\n\r\n    fillDefaultValues() {\r\n        if (this._defaultsLength === 0) {\r\n            enumerateObject(this, (prperty, value) => {\r\n                this._defaults[prperty] = value;\r\n            })\r\n            this._defaultsLength = Object.keys(this._defaults).length;\r\n        }\r\n    }\r\n}\r\n\r\n\r\n\r\nclass TypeParser {\r\n    private _props: CuiArgProps;\r\n    constructor(props?: CuiArgProps) {\r\n        this._props = props ?? {};\r\n    }\r\n\r\n    parseValue(name: string, value: any, type: string): string | number | boolean | undefined {\r\n        let prop = this._props[name];\r\n        let callback = parserCallbacks[prop?.type ?? type];\r\n        let newVal = callback?.(value);\r\n        if (!newVal) {\r\n            return prop?.default;\r\n        }\r\n        return prop?.corrector?.(newVal) ?? newVal;\r\n    }\r\n}","import { ICuiHandlerExtension } from \"src/core/handlers/extensions/interfaces\";\r\nimport { ICuiExtensionPerformer } from \"../interfaces\";\r\n\r\nexport interface CuiClickExtensionSetup {\r\n    type?: string;\r\n    element: HTMLElement;\r\n    performer: ICuiExtensionPerformer<MouseEvent>;\r\n}\r\n\r\nexport class CuiClickModule<T> implements ICuiHandlerExtension<T> {\r\n    type: string;\r\n    description: string;\r\n    element: HTMLElement;\r\n    private _perfromer: ICuiExtensionPerformer<MouseEvent>;\r\n\r\n    constructor(element: HTMLElement, args: T, performer: ICuiExtensionPerformer<MouseEvent>) {\r\n        this.type = 'click';\r\n        this.description = \"\";\r\n        this._perfromer = performer;\r\n        this.element = element;\r\n        this.onElementClick = this.onElementClick.bind(this);\r\n    }\r\n\r\n    async init(args: T): Promise<boolean> {\r\n\r\n        this.element.addEventListener('click', this.onElementClick)\r\n        return true;\r\n    }\r\n\r\n    async destroy(): Promise<boolean> {\r\n        this.element.removeEventListener('click', this.onElementClick)\r\n        return true;\r\n    }\r\n\r\n    private onElementClick(ev: MouseEvent) {\r\n        this._perfromer.perform(ev);\r\n    }\r\n}\r\n\r\n\r\nexport function clickExtension(setup: CuiClickExtensionSetup): ICuiHandlerExtension<any> {\r\n    function onClick(ev: MouseEvent) {\r\n        setup.performer.perform(ev);\r\n    }\r\n    return {\r\n        type: setup.type ?? 'click',\r\n        init: async () => {\r\n            setup.element.addEventListener('click', onClick);\r\n            return true;\r\n        },\r\n        destroy: async () => {\r\n            setup.element.removeEventListener('click', onClick);\r\n            return true;\r\n        }\r\n    }\r\n}","import { ICuiComponent, ICuiComponentHandler } from \"src/core/models/interfaces\";\r\nimport { CuiCore } from \"src/core/models/core\";\r\n\r\nexport interface CuiComponentBaseHookSetup {\r\n    name: string;\r\n    create: (element: HTMLElement, utils: CuiCore, prefix: string, attribute: string) => ICuiComponentHandler,\r\n    style?: () => string;\r\n    prefix?: string;\r\n}\r\n\r\nexport function CuiComponentBaseHook(setup: CuiComponentBaseHookSetup): ICuiComponent {\r\n    const _prefix = setup.prefix ?? 'cui';\r\n    const _attribute = _prefix + \"-\" + setup.name;\r\n    return {\r\n        attribute: _attribute,\r\n        get: (element: HTMLElement, utils: CuiCore) => setup.create(element, utils, _prefix, _attribute),\r\n        style: setup.style\r\n    }\r\n}","export class AriaAttributes {\r\n    public static setLabel(element: Element, label: string): void {\r\n        if (!element.hasAttribute('aria-label')) {\r\n            element.setAttribute('aria-label', label);\r\n        }\r\n    }\r\n\r\n    public static setAria(element: Element, attr: string, value: string) {\r\n        if (!element.hasAttribute(attr)) {\r\n            element.setAttribute(attr, value);\r\n        }\r\n    }\r\n\r\n    public static removeAria(element: Element, attr: string) {\r\n        if (element.hasAttribute(attr)) {\r\n            element.removeAttribute(attr);\r\n        }\r\n    }\r\n}","import { ICuiMoveData } from \"src/core/listeners/move\";\r\nimport { ICuiExtensionPerformer } from \"../interfaces\";\r\n\r\nexport interface ICuiMovePerformerSetup {\r\n\tonDown?: (ev: ICuiMoveData) => void;\r\n\tonMove?: (ev: ICuiMoveData) => void;\r\n\tonUp?: (ev: ICuiMoveData) => void;\r\n}\r\n\r\nexport interface ICuiDragPerformerSetup {\r\n\tonDown?: (ev: ICuiMoveData) => boolean;\r\n\tonMove?: (ev: ICuiMoveData) => void;\r\n\tonUp?: (ev: ICuiMoveData) => void;\r\n}\r\n\r\nexport interface ICuiBasePerformerSetup {\r\n\tonStart: (ev: ICuiMoveData) => Promise<boolean>;\r\n\tonMove?: (ev: ICuiMoveData) => void;\r\n\tonEnd?: (ev: ICuiMoveData) => void;\r\n}\r\n\r\nexport interface ICuiMoveExtensionPerformer\r\n\textends ICuiExtensionPerformer<ICuiMoveData> {\r\n\tsetEnabled(flag: boolean): void;\r\n}\r\n\r\nexport interface ICuiDragExtensionPerformer extends ICuiMoveExtensionPerformer {\r\n\tsetTimeout(value: number): void;\r\n}\r\n\r\nexport function moveExtensionPerformer(\r\n\tsetup: ICuiMovePerformerSetup\r\n): ICuiMoveExtensionPerformer {\r\n\treturn getBaseMovePerformer({\r\n\t\tonStart: async (ev: ICuiMoveData) => {\r\n\t\t\tif (setup.onDown) {\r\n\t\t\t\tsetup.onDown(ev);\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t},\r\n\t\tonMove: setup.onMove,\r\n\t\tonEnd: setup.onUp,\r\n\t});\r\n}\r\n\r\nexport function getDragMovePerformer(\r\n\tsetup: ICuiBasePerformerSetup\r\n): ICuiDragExtensionPerformer {\r\n\tlet dragStartTimeout = 100;\r\n\tlet timeoutId: any | null = null;\r\n\tfunction cancelTimeout() {\r\n\t\tif (timeoutId) {\r\n\t\t\tclearTimeout(timeoutId);\r\n\t\t\ttimeoutId = null;\r\n\t\t}\r\n\t}\r\n\r\n\tfunction call(ev: ICuiMoveData, callback?: (ev: ICuiMoveData) => void) {\r\n\t\tcancelTimeout();\r\n\t\tif (callback) {\r\n\t\t\tcallback(ev);\r\n\t\t}\r\n\t}\r\n\r\n\treturn {\r\n\t\t...getBaseMovePerformer({\r\n\t\t\tonStart: async (ev: ICuiMoveData) => {\r\n\t\t\t\tcancelTimeout();\r\n\t\t\t\tconsole.log(\"sssss\");\r\n\t\t\t\treturn new Promise((resolve) => {\r\n\t\t\t\t\ttimeoutId = setTimeout(() => {\r\n\t\t\t\t\t\ttimeoutId = null;\r\n\t\t\t\t\t\tconsole.log(\"start\");\r\n\t\t\t\t\t\tsetup.onStart(ev).then((status) => {\r\n\t\t\t\t\t\t\tresolve(status);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\t//resolve(setup.onStart(ev));\r\n\t\t\t\t\t}, dragStartTimeout);\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\tonMove: (ev) => call(ev, setup.onMove),\r\n\t\t\tonEnd: (ev) => call(ev, setup.onEnd),\r\n\t\t}),\r\n\t\tsetTimeout: (value: number) => {\r\n\t\t\tdragStartTimeout = value;\r\n\t\t},\r\n\t};\r\n}\r\n\r\nfunction getBaseMovePerformer(\r\n\tsetup: ICuiBasePerformerSetup\r\n): ICuiMoveExtensionPerformer {\r\n\tlet _isTracking = false;\r\n\tlet _isEnabled = true;\r\n\tlet _waiting = false;\r\n\treturn {\r\n\t\tperform: (ev: ICuiMoveData) => {\r\n\t\t\tif (!_isEnabled) {\r\n\t\t\t\t_isTracking = false;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tswitch (ev.type) {\r\n\t\t\t\tcase \"down\":\r\n\t\t\t\t\tconsole.log(\"down\");\r\n\t\t\t\t\tif (_isTracking) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t_waiting = true;\r\n\t\t\t\t\tsetup.onStart(ev).then((status: boolean) => {\r\n\t\t\t\t\t\t_waiting = false;\r\n\t\t\t\t\t\tif (status) _isTracking = true;\r\n\t\t\t\t\t});\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"move\":\r\n\t\t\t\t\tif (!_isTracking) return;\r\n\t\t\t\t\tif (setup.onMove) {\r\n\t\t\t\t\t\tsetup.onMove(ev);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"up\":\r\n\t\t\t\t\tif (!_isTracking && !_waiting) return;\r\n\t\t\t\t\tif (setup.onEnd) {\r\n\t\t\t\t\t\tsetup.onEnd(ev);\r\n\t\t\t\t\t}\r\n\t\t\t\t\t_isTracking = false;\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t},\r\n\t\tsetEnabled: (flag: boolean) => {\r\n\t\t\t_isEnabled = flag;\r\n\t\t},\r\n\t};\r\n}\r\n","import { ICuiClassesAsyncHelper, ICuiEventBusFacade } from \"../../core/handlers/extensions/facades\";\r\nimport { ICuiMoveData } from \"../../core/listeners/move\";\r\nimport { ICuiActionsHelper } from \"../../core/helpers/helpers\";\r\nimport { InteractiveEvent } from \"../../core/models/events\";\r\nimport { ICuiComponentAction } from \"../../core/utils/actions\";\r\nimport { AriaAttributes } from \"../../core/utils/aria\";\r\nimport { is } from \"../../core/utils/functions\";\r\nimport { CLASSES, EVENTS } from \"../../core/utils/statics\";\r\nimport { ICuiExtensionPerformer } from \"./interfaces\";\r\nimport { moveExtensionPerformer } from \"../extensions/move/performer\";\r\n\r\nexport interface ICuiActionPerformerSetup {\r\n    timeout?: number;\r\n    element?: Element,\r\n    actions?: ICuiComponentAction[];\r\n    active?: ICuiComponentAction;\r\n}\r\n\r\nexport interface ICuiActionPerformerCallbacks<T> {\r\n    onBefore?: (arg: T) => boolean;\r\n    onAfter?: () => void;\r\n    onFinish?: (arg: T) => void;\r\n}\r\n\r\nexport interface ICuiInterActionPerformerCallbacks<T> extends ICuiActionPerformerCallbacks<T> {\r\n    isActive: () => boolean;\r\n}\r\n\r\nexport interface ICuiActionExtensionPerformer<T> extends ICuiExtensionPerformer<T> {\r\n    updateSetup(setup: ICuiActionPerformerSetup): void;\r\n}\r\n\r\nexport interface CuiCallbackPerfromerSetup {\r\n    ignoreEmpty: boolean;\r\n}\r\n\r\n\r\n\r\nexport function callbackPerformer<T>(callback: (arg: T) => void, setup?: CuiCallbackPerfromerSetup): ICuiExtensionPerformer<T> {\r\n    return {\r\n        perform: (val: T) => {\r\n            if (setup && setup.ignoreEmpty === true && !is(val)) {\r\n                return;\r\n            }\r\n            callback(val)\r\n        }\r\n    }\r\n}\r\n\r\nexport function getActionsPerformer<T>(helper: ICuiActionsHelper, callbacks: ICuiActionPerformerCallbacks<T>, setup?: ICuiActionPerformerSetup): ICuiActionExtensionPerformer<T> {\r\n    let _setup = setup ?? {};\r\n    let localLock: boolean = false;\r\n\r\n    function onAfter() {\r\n        if (callbacks.onAfter)\r\n            callbacks.onAfter();\r\n        localLock = false;\r\n    }\r\n\r\n    return {\r\n        perform: (arg: T) => {\r\n            if (!_setup || !_setup.element || (callbacks.onBefore && !callbacks.onBefore(arg)) || localLock) {\r\n                return;\r\n            }\r\n            localLock = true;\r\n            let performResult = false;\r\n            helper.performActions(_setup.element, _setup.actions ?? [], _setup.timeout ?? 0, onAfter).then((result: boolean) => {\r\n                performResult = result\r\n            }).finally(() => {\r\n                if (performResult && callbacks.onFinish) {\r\n                    callbacks.onFinish(arg);\r\n                }\r\n            })\r\n        },\r\n\r\n        updateSetup: (setup: ICuiActionPerformerSetup) => {\r\n            _setup = {\r\n                ..._setup,\r\n                ...setup\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nexport function openActionsPerformer<T>(helper: ICuiActionsHelper, bus: ICuiEventBusFacade, callbacks: ICuiInterActionPerformerCallbacks<T>, setup: ICuiActionPerformerSetup): ICuiActionExtensionPerformer<T> {\r\n    const newCallbacks: ICuiActionPerformerCallbacks<T> = {\r\n        ...callbacks,\r\n        onBefore: (arg: T) => {\r\n            if (callbacks.isActive()) {\r\n                return false;\r\n            }\r\n            return !callbacks.onBefore || callbacks.onBefore(arg);\r\n        },\r\n        onAfter: () => {\r\n            if (setup.element) {\r\n                if (setup.active)\r\n                    setup.active.add(setup.element)\r\n                AriaAttributes.setAria(setup.element, 'aria-hidden', \"false\");\r\n            }\r\n\r\n            if (callbacks.onAfter) {\r\n                callbacks.onAfter();\r\n                return false;\r\n            }\r\n        },\r\n        onFinish: (arg: T) => {\r\n            bus.emit<InteractiveEvent<T>>(EVENTS.OPENED, {\r\n                state: arg,\r\n            })\r\n            if (callbacks.onFinish)\r\n                callbacks.onFinish(arg)\r\n        }\r\n    }\r\n    return getActionsPerformer(helper, newCallbacks, setup)\r\n}\r\n\r\nexport function closeActionsPerformer<T>(helper: ICuiActionsHelper, bus: ICuiEventBusFacade, callbacks: ICuiInterActionPerformerCallbacks<T>, setup: ICuiActionPerformerSetup): ICuiActionExtensionPerformer<T> {\r\n    const newCallbacks: ICuiInterActionPerformerCallbacks<T> = {\r\n        ...callbacks,\r\n        onBefore: (arg: T) => {\r\n            if (!callbacks.isActive()) {\r\n                return false;\r\n            }\r\n            return !callbacks.onBefore || callbacks.onBefore(arg);\r\n        },\r\n        onAfter: () => {\r\n            if (setup.element) {\r\n                if (setup.active)\r\n                    setup.active.remove(setup.element)\r\n                AriaAttributes.setAria(setup.element, 'aria-hidden', \"true\");\r\n            }\r\n            if (callbacks.onAfter) {\r\n                callbacks.onAfter();\r\n                return false;\r\n            }\r\n        },\r\n        onFinish: (arg: T) => {\r\n            bus.emit<InteractiveEvent<T>>(EVENTS.CLOSED, {\r\n                state: arg,\r\n            })\r\n            if (callbacks.onFinish)\r\n                callbacks.onFinish(arg)\r\n        }\r\n    }\r\n    return getActionsPerformer(helper, newCallbacks, setup)\r\n}\r\n\r\nexport interface ICuiSliderPerformerSetup {\r\n    start: () => boolean;\r\n    progress: (progress: ICuiSliderProgress) => void;\r\n    end: (progress: ICuiSliderProgress) => void;\r\n    adjustRatio?: (ratio: number) => number;\r\n    element: HTMLElement;\r\n    moveThreshold?: number;\r\n    prevent?: boolean;\r\n}\r\n\r\nexport interface ICuiSliderProgress {\r\n    ratio: number;\r\n    velocity: number;\r\n    acceleration: number;\r\n}\r\n\r\nexport function sliderPerformer(classeHelper: ICuiClassesAsyncHelper, setup: ICuiSliderPerformerSetup) {\r\n    let startX = 0;\r\n    let swipeRatio = 0;\r\n    const threshold = setup.moveThreshold ?? 0.01;\r\n    const preventDefault = setup.prevent === true;\r\n    let canMove: boolean = false;\r\n    let velocity: number = 0;\r\n    let lastTime: number = 0;\r\n\r\n    function passesThreshold(ratio: number) {\r\n        return ratio >= threshold;\r\n    }\r\n\r\n    function canPerformMove(ratio: number) {\r\n        return canMove && passesThreshold(Math.abs(ratio - swipeRatio))\r\n    }\r\n\r\n    function preventEventDefault(ev: ICuiMoveData) {\r\n        if (preventDefault && ev.event.cancelable) {\r\n            ev.event.preventDefault();\r\n        }\r\n    }\r\n\r\n    function calculateVelocity(distance: number, time: number): number {\r\n        return Math.abs(distance / time);\r\n    }\r\n\r\n    function calculateAcceleration(prev: number, current: number, time: number): number {\r\n        return Math.abs((current - prev) / time);\r\n    }\r\n\r\n    return moveExtensionPerformer({\r\n        onDown: (ev: ICuiMoveData) => {\r\n            if (!setup.element.contains(ev.target as Node)) {\r\n                return;\r\n            }\r\n            if (!setup.start()) {\r\n                canMove = false;\r\n                return\r\n            }\r\n            canMove = true;\r\n            startX = ev.x;\r\n            lastTime = performance.now();\r\n            classeHelper.setClasses(document.body, CLASSES.swipingOn);\r\n            preventEventDefault(ev);\r\n        },\r\n\r\n        onMove: (ev: ICuiMoveData) => {\r\n            const distance = (ev.x - startX);\r\n            const ratio = distance / setup.element.offsetWidth;\r\n            if (!canPerformMove(ratio)) {\r\n                return;\r\n            }\r\n            const dt = performance.now() - lastTime;\r\n            const newVelo = calculateVelocity((swipeRatio - ratio), dt);\r\n            const acceleration = calculateAcceleration(velocity, newVelo, dt);\r\n            swipeRatio = setup.adjustRatio ? setup.adjustRatio(ratio) : ratio;\r\n            setup.progress({ ratio: swipeRatio, velocity, acceleration });\r\n            lastTime = performance.now();\r\n            velocity = newVelo;\r\n            preventEventDefault(ev)\r\n\r\n        },\r\n        onUp: (ev: ICuiMoveData) => {\r\n            if (!canMove) return;\r\n            const distance = (ev.x - startX);\r\n            const dt = performance.now() - lastTime;\r\n            const newVelo = calculateVelocity(distance, dt);\r\n            const acceleration = calculateAcceleration(velocity, newVelo, dt);\r\n            setup.end({ ratio: swipeRatio, velocity, acceleration });\r\n            startX = 0;\r\n            swipeRatio = 0;\r\n            velocity = 0;\r\n            lastTime = 0;\r\n            canMove = false;\r\n            classeHelper.removeClasses(document.body, CLASSES.swipingOn);\r\n            preventEventDefault(ev);\r\n        }\r\n    })\r\n}","import { ICuiEventBusFacade } from \"src/core/handlers/extensions/facades\";\r\nimport { ICuiHandlerExtension } from \"src/core/handlers/extensions/interfaces\";\r\nimport { ICuiExtensionPerformer } from \"../interfaces\";\r\n\r\nexport interface CuiEventExtensionSetup<T> {\r\n    type?: string;\r\n    eventName: string;\r\n    performer: ICuiExtensionPerformer<T>;\r\n}\r\n\r\nexport class CuiEventExtension<T> implements ICuiHandlerExtension<any> {\r\n    type: string;\r\n    description: string;\r\n\r\n    private _eventId: string | null;\r\n    private _setup: CuiEventExtensionSetup<T>;\r\n    private _busFacade: ICuiEventBusFacade;\r\n    constructor(busFacade: ICuiEventBusFacade, setup: CuiEventExtensionSetup<T>) {\r\n        this.type = setup.type ?? setup.eventName;\r\n        this.description = \"\";\r\n        this._eventId = null;\r\n        this._setup = setup;\r\n        this._busFacade = busFacade;\r\n    }\r\n\r\n    async init(args: any): Promise<boolean> {\r\n        this._eventId = this._busFacade.on<T>(this._setup.eventName, this.onEvent.bind(this));\r\n        return true;\r\n    }\r\n\r\n\r\n    async destroy(): Promise<boolean> {\r\n        this._busFacade.detach(this._setup.eventName, this._eventId);\r\n        return true;\r\n    }\r\n\r\n    onEvent(arg: T) {\r\n        this._setup.performer.perform(arg);\r\n    }\r\n}\r\n\r\nexport function eventExtension<T>(bus: ICuiEventBusFacade, setup: CuiEventExtensionSetup<T>): ICuiHandlerExtension<any> {\r\n    let eventId: string | null = null;\r\n\r\n    function onEvent(arg: T) {\r\n        setup.performer.perform(arg);\r\n    }\r\n    return {\r\n        type: setup.type ?? setup.eventName,\r\n        description: \"\",\r\n        init: async (arg: any) => {\r\n            eventId = bus.on<T>(setup.eventName, onEvent);\r\n            return true;\r\n        },\r\n        destroy: async () => {\r\n            bus.detach(setup.eventName, eventId);\r\n            return true;\r\n        }\r\n    }\r\n}\r\n\r\n","import { ICuiComponent, ICuiSwitchable } from \"../../core/models/interfaces\";\r\nimport { CuiCore } from \"../../core/models/core\";\r\nimport { CuiHandlerBase } from \"../../core/handlers/base\";\r\nimport { replacePrefix, joinWithScopeSelector, getChildSelectorFromScoped, calculateNextIndex, queryAll } from \"../../core/utils/functions\";\r\nimport { EVENTS } from \"../../core/utils/statics\";\r\nimport { CuiAutoParseArgs } from \"../../core/utils/arguments\";\r\nimport { CuiAccordionEvent } from \"../../core/models/events\";\r\nimport { clickExtension } from \"../extensions/click/click\";\r\nimport { CuiClickableArgs } from \"../../core/models/arguments\";\r\nimport { getCuiHandlerInteractions, getEventBusFacade, ICuiEventBusFacade, ICuiInteractionsFacade } from \"../../core/handlers/extensions/facades\";\r\nimport { CuiComponentBaseHook } from \"../base\";\r\nimport { callbackPerformer } from \"../extensions/performers\";\r\nimport { eventExtension } from \"../extensions/event/event\";\r\n\r\nconst ACCORDION_TITLE_CLS = '> * > .{prefix}-accordion-title';\r\nconst ACCORDION_ITEMS_CLS = '> *';\r\n\r\n\r\nexport class CuiAccordionArgs extends CuiAutoParseArgs implements CuiClickableArgs {\r\n    single: boolean;\r\n    selector: string;\r\n    items: string;\r\n    timeout: number;\r\n    animation: boolean;\r\n    prevent: boolean;\r\n    stopPropagation: boolean;\r\n\r\n    constructor(prefix: string, timeout?: number) {\r\n        super({\r\n            props: {\r\n                \"selector\": { corrector: joinWithScopeSelector },\r\n                \"items\": { corrector: joinWithScopeSelector },\r\n            }\r\n        });\r\n        this.animation = false;\r\n        this.single = false;\r\n        this.selector = joinWithScopeSelector(replacePrefix(ACCORDION_TITLE_CLS, prefix));\r\n        this.items = joinWithScopeSelector(replacePrefix(ACCORDION_ITEMS_CLS, prefix));\r\n        this.timeout = timeout ?? 300;\r\n        this.prevent = false;\r\n        this.stopPropagation = false;\r\n    }\r\n}\r\n\r\nexport function CuiAccordionComponent(prefix?: string): ICuiComponent {\r\n    return CuiComponentBaseHook({\r\n        prefix: prefix,\r\n        name: \"accordion\",\r\n        create: (element: HTMLElement, utils: CuiCore, prefix: string, attribute: string) => {\r\n            return new CuiAccordionHandler(element, utils, attribute, prefix);\r\n        }\r\n    })\r\n}\r\n\r\nexport class CuiAccordionHandler extends CuiHandlerBase<CuiAccordionArgs> implements ICuiSwitchable {\r\n\r\n\r\n    private _currentIndex: number;\r\n    private _busFacade: ICuiEventBusFacade;\r\n    private _interactions: ICuiInteractionsFacade;\r\n\r\n    constructor(element: HTMLElement, utils: CuiCore, attribute: string, prefix: string) {\r\n        super(\"CuiAccordionHandler\", element, attribute, new CuiAccordionArgs(prefix, utils.setup.animationTime), utils);\r\n        //   this._items = [];\r\n\r\n        this._currentIndex = -1;\r\n        this._busFacade = getEventBusFacade(this.cuid, utils.bus, this.element);\r\n        this._interactions = getCuiHandlerInteractions(utils.interactions, this);\r\n        this.extend(clickExtension({\r\n            element: element,\r\n            performer: callbackPerformer(this.onElementClick.bind(this))\r\n        }));\r\n        this.extend(eventExtension(this._busFacade, {\r\n            eventName: EVENTS.SWITCH,\r\n            performer: callbackPerformer(this.switch.bind(this), { ignoreEmpty: true })\r\n        }));\r\n    }\r\n\r\n    async onHandle(): Promise<boolean> {\r\n        this._currentIndex = this.getOpenedIndex(this.queryItems());\r\n        return true;\r\n    }\r\n\r\n    async onRefresh(): Promise<boolean> {\r\n        return true;\r\n    }\r\n\r\n    async onRemove(): Promise<boolean> {\r\n        this._busFacade.detachEmittedEvents();\r\n        return true;\r\n    }\r\n\r\n    async switch(index: any): Promise<boolean> {\r\n        if (!this.lock()) {\r\n            return false;\r\n        }\r\n        this.log.debug(\"Switch to: \" + index);\r\n\r\n        const items = this.queryItems();\r\n        const nextIdx = calculateNextIndex(index, this._currentIndex, items.length)\r\n        if (nextIdx < 0) {\r\n            return false;\r\n        }\r\n        const current = items[nextIdx];\r\n        this._interactions.mutate(this.updateTargets, nextIdx, current, items);\r\n        this._currentIndex = nextIdx;\r\n        this._busFacade.emit<CuiAccordionEvent>(EVENTS.SWITCHED, {\r\n            index: index,\r\n            currentTarget: current,\r\n            previousTarget: null,\r\n            previous: -1\r\n        })\r\n        this.unlock();\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Toggles target and closes not needed is setup allows for that\r\n     * @param index - current index to remain opened\r\n     * @param target - target to toggle\r\n     * @param targets - all targets\r\n     */\r\n    private updateTargets(index: number, target: Element, targets: Element[]) {\r\n        if (this.toggleTarget(target) && this.args.single) {\r\n            this.closeAllExcept(index, targets)\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Sets or remove active class on target\r\n     * @param target target to toggle\r\n     * @returns Whethet target was opened or not\r\n     */\r\n    private toggleTarget(target: Element) {\r\n        if (this.classes.hasClass(this.activeClassName, target)) {\r\n            this.classes.removeClass(this.activeClassName, target)\r\n            return false;\r\n        }\r\n        this.classes.setClass(this.activeClassName, target)\r\n        return true\r\n    }\r\n\r\n    /**\r\n     * Closes all targets except the one that should remain opened\r\n     * @param currentIndex index of current target - to remain opened\r\n     * @param targets - list of targets to operate on\r\n     */\r\n    private closeAllExcept(currentIndex: number, targets: Element[]) {\r\n        targets.forEach((item: Element, index: number) => {\r\n            if (currentIndex !== index && this.classes.hasClass(this.activeClassName, item)) {\r\n                item.classList.remove(this.activeClassName)\r\n            }\r\n        })\r\n    }\r\n\r\n    /**\r\n     * Handles element click\r\n     * @param ev \r\n     */\r\n    private onElementClick(ev: MouseEvent) {\r\n        const target = ev.target as HTMLElement;\r\n        const selector = getChildSelectorFromScoped(this.args.selector);\r\n        if (target.matches(selector)) {\r\n            this._interactions.fetch(() => {\r\n                const foundIdx = this.findMatchingTrigger(target);\r\n                if (foundIdx > -1) {\r\n                    this.switch(foundIdx)\r\n                }\r\n            })\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Finds match\r\n     * @param target \r\n     * @returns index of matching element or -1\r\n     */\r\n    private findMatchingTrigger(target: HTMLElement): number {\r\n        let triggers = queryAll(this.element, this.args.selector);\r\n        return triggers.findIndex(trigger => trigger === target);\r\n    }\r\n\r\n    private queryItems(): Element[] {\r\n        return queryAll(this.element, this.args.items)\r\n    }\r\n\r\n    private getOpenedIndex(items: Element[]): number {\r\n        return items.findIndex(item => { this.classes.hasClass(this.activeClassName, item) })\r\n\r\n    }\r\n}","import { AnimatorError } from \"../models/errors\";\r\nimport { enumerateObject, getRangeValueOrDefault, is } from \"../utils/functions\";\r\nimport { ICuiPropertyAnimator, AnimatorPropertyValue, ComplexAnimatorProperty, ColorProperty, ColorAnimatorProperty } from \"./interfaces\";\r\n\r\n/**\r\n * Changes the opacity of the element from 0 to 1\r\n */\r\nexport class OpacityAnimator implements ICuiPropertyAnimator<AnimatorPropertyValue> {\r\n    prop: AnimatorPropertyValue\r\n\r\n    constructor() {\r\n        this.prop = { from: 0, to: 0 }\r\n    }\r\n\r\n    setProperty(prop: AnimatorPropertyValue): void {\r\n        if (!prop || !is(prop.from) || !is(prop.to)) {\r\n            throw new AnimatorError(\"[OpacityAnimator] Property has incorrect format\");\r\n        }\r\n        this.prop = prop;\r\n\r\n    }\r\n\r\n    perform(element: any, progress: number, factor: number) {\r\n        if (this.prop.to < 0) {\r\n            return;\r\n        }\r\n        if (element[\"style\"]) {\r\n            element.style.opacity = calcUnitValue(this.prop, progress);\r\n        }\r\n\r\n    }\r\n}\r\n\r\n/**\r\n * Changes any style property of the element\r\n */\r\nexport class PropertyAnimator implements ICuiPropertyAnimator<AnimatorPropertyValue> {\r\n    property: string;\r\n    prop: AnimatorPropertyValue\r\n    constructor(property: string) {\r\n        if (!is(property)) {\r\n            throw new AnimatorError(\"[PropertyAnimator] Valid property is required\");\r\n        }\r\n        this.property = property;\r\n        this.prop = {\r\n            from: 0,\r\n            to: 0\r\n        }\r\n    }\r\n\r\n    setProperty(prop: AnimatorPropertyValue) {\r\n        if (!prop || !is(prop.from) || !is(prop.to)) {\r\n            throw new AnimatorError(\"[PropertyAnimator] Property has incorrect format\");\r\n        }\r\n        this.prop = prop;\r\n    }\r\n\r\n    perform(element: any, progress: number, factor: number) {\r\n        if (!this.property) {\r\n            return;\r\n        }\r\n        if (element[\"style\"]) {\r\n            element.style[this.property] = calcUnitValue(this.prop, progress)\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * Changes transform property of the element. Supports mulitple properties at the time\r\n */\r\nexport class TransformAnimator implements ICuiPropertyAnimator<ComplexAnimatorProperty> {\r\n    prop: ComplexAnimatorProperty | undefined;\r\n    constructor() {\r\n        this.prop = undefined;\r\n    }\r\n\r\n    setProperty(prop: ComplexAnimatorProperty) {\r\n        if (!prop) {\r\n            throw new AnimatorError(\"[TransformAnimator] Property has incorrect format\");\r\n        }\r\n        this.prop = prop;\r\n    }\r\n\r\n    build(progress: number) {\r\n        let props: string[] = [];\r\n        for (let name in this.prop) {\r\n            let cur = this.prop[name];\r\n            props.push(this.buildSingle(name, calcNewValue(cur.from, cur.to, progress), cur.unit))\r\n        }\r\n        return props.join(\" \");\r\n    }\r\n\r\n    buildSingle(name: string, value: number, unit?: string) {\r\n        return `${name}(${prepUnitValue(value, unit)})`;\r\n    }\r\n\r\n    perform(element: any, progress: number) {\r\n        if (!this.prop) {\r\n            return;\r\n        }\r\n        if (element[\"style\"]) {\r\n            element.style.transform = this.build(progress);\r\n        }\r\n    }\r\n}\r\n\r\nexport class ColorAnimator implements ICuiPropertyAnimator<ColorAnimatorProperty> {\r\n    #from: ColorProperty;\r\n    #to: ColorProperty;\r\n    id: string;\r\n    constructor(id: string) {\r\n        this.#from = { red: 0, green: 0, blue: 0, alpha: 0 };\r\n        this.#to = { red: 0, green: 0, blue: 0, alpha: 0 };\r\n        this.id = id;\r\n    }\r\n\r\n    perform(element: any, progress: number, factor: number): void {\r\n        const newColor = {\r\n            red: calcNewValue(this.#from.red, this.#to.red, progress),\r\n            blue: calcNewValue(this.#from.blue, this.#to.blue, progress),\r\n            green: calcNewValue(this.#from.green, this.#to.green, progress),\r\n            alpha: calcNewValue(this.#from.alpha, this.#to.alpha, progress),\r\n        }\r\n\r\n        element.style[this.id] = `rgba(${newColor.red},${newColor.green},${newColor.blue},${newColor.alpha})`;\r\n    }\r\n\r\n    setProperty(prop: ColorAnimatorProperty): void {\r\n        this.#from = adjustColor(prop.from);\r\n        this.#to = adjustColor(prop.to);\r\n    }\r\n}\r\n\r\nexport class FilterAnimator implements ICuiPropertyAnimator<ComplexAnimatorProperty> {\r\n    property: ComplexAnimatorProperty;\r\n    constructor() {\r\n        this.property = {};\r\n    }\r\n    perform(element: any, progress: number, factor: number): void {\r\n        let filters: string[] = [];\r\n        enumerateObject(this.property, (filterName, setup: AnimatorPropertyValue) => {\r\n            filters.push(`${filterName}(${calcUnitValue(setup, progress)})`)\r\n        })\r\n\r\n        element.style['filter'] = filters.join(' ');\r\n    }\r\n    setProperty(prop: ComplexAnimatorProperty): void {\r\n        this.property = prop;\r\n    }\r\n}\r\n\r\nexport class PositionAnimator implements ICuiPropertyAnimator<ComplexAnimatorProperty> {\r\n    #x: AnimatorPropertyValue;\r\n    #y: AnimatorPropertyValue;\r\n    #id: string;\r\n    constructor(id?: string) {\r\n        this.#x = {\r\n            from: 0,\r\n            to: 0,\r\n        }\r\n        this.#y = {\r\n            from: 0,\r\n            to: 0,\r\n        }\r\n        this.#id = id ?? 'backgroundPosition';\r\n    }\r\n\r\n    perform(element: any, progress: number, factor: number): void {\r\n        let newX = calcUnitValue(this.#x, progress);\r\n        let newY = calcUnitValue(this.#y, progress);\r\n        element.style[this.#id] = newX + \" \" + newY;\r\n    }\r\n\r\n    setProperty(prop: ComplexAnimatorProperty): void {\r\n        const { x, y } = prop;\r\n        if (x) {\r\n            this.#x = x\r\n        }\r\n        if (y) {\r\n            this.#y = y;\r\n        }\r\n    }\r\n\r\n}\r\n\r\nfunction adjustColor(color: ColorProperty): ColorProperty {\r\n    return {\r\n        red: getRangeValueOrDefault(color.red, 0, 255, 0),\r\n        green: getRangeValueOrDefault(color.green, 0, 255, 0),\r\n        blue: getRangeValueOrDefault(color.blue, 0, 255, 0),\r\n        alpha: getRangeValueOrDefault(color.alpha, 0, 1, 1),\r\n    }\r\n}\r\n\r\nfunction calcNewValue(from: number, to: number, progress: number) {\r\n    return from + (to - from) * progress;\r\n}\r\n\r\nfunction prepUnitValue(value: number, unit?: string) {\r\n    return value + (unit ?? \"\");\r\n}\r\n\r\nfunction calcUnitValue(prop: AnimatorPropertyValue, progress: number) {\r\n    return prepUnitValue(calcNewValue(prop.from, prop.to, progress), prop.unit);\r\n}","import { is } from \"../utils/functions\";\r\nimport { ColorAnimator, FilterAnimator, OpacityAnimator, PropertyAnimator, TransformAnimator } from \"./animators\";\r\nimport { CuiTimeAnimationEngine } from \"./engine\";\r\nimport { ICuiPropertyAnimator, AnimatorPropertyValue, ComplexAnimatorProperty, ColorAnimatorProperty, ICuiTimingFunction } from \"./interfaces\";\r\n\r\nexport class AnimatorFactory {\r\n    static get(id: string): ICuiPropertyAnimator<AnimatorPropertyValue | ComplexAnimatorProperty | ColorAnimatorProperty> | undefined {\r\n        if (!is(id)) {\r\n            return undefined;\r\n        }\r\n        if (id.includes('color')) {\r\n            return new ColorAnimator(id);\r\n        }\r\n        switch (id) {\r\n            case \"opacity\":\r\n                return new OpacityAnimator();\r\n            case \"transform\":\r\n                return new TransformAnimator();\r\n            case \"filter\":\r\n                return new FilterAnimator();\r\n            default:\r\n                return new PropertyAnimator(id);\r\n        }\r\n    }\r\n}\r\n\r\nexport class CuiTimeAnimationEngines {\r\n    static get(timingFunction: ICuiTimingFunction) {\r\n        return new CuiTimeAnimationEngine(timingFunction);\r\n    }\r\n}","import { getRangeValue, is } from \"../utils/functions\";\r\nimport { CuiRAF } from \"../utils/statics\";\r\nimport { AnimatorFactory } from \"./factory\";\r\nimport { ICuiPropertyAnimator, AnimationProperty, AnimatorPropertyValue, ComplexAnimatorProperty, ICuiAnimationEngine, ICuiAnimationSetup, ICuiTimingFunction, ICuiSlideEngine } from \"./interfaces\";\r\n\r\nexport type PropsTypes = AnimatorPropertyValue | ComplexAnimatorProperty;\r\n\r\nexport class CuiTimeAnimationEngine implements ICuiAnimationEngine {\r\n    private _lock: boolean = false;\r\n    private _animationStart: number | null = null;\r\n    private _currentTimestamp: number | null = null;\r\n    private _timingFunction: ICuiTimingFunction;\r\n    constructor(calculator: ICuiTimingFunction) {\r\n        this._timingFunction = calculator;\r\n    }\r\n\r\n    animate(element: HTMLElement, animators: ICuiPropertyAnimator<PropsTypes>[], setup: ICuiAnimationSetup): Promise<boolean> {\r\n        return new Promise<boolean>((resolve, reject) => {\r\n            if (this._lock) {\r\n                resolve(false);\r\n                return;\r\n            }\r\n            this._lock = true;\r\n            this._animationStart = setup.progress * setup.timeout + 0.0001;\r\n            //@ts-ignore\r\n            CuiRAF(this.performAsync.bind(this, element, animators, setup, resolve, reject))\r\n        })\r\n    }\r\n\r\n    update(progress: number, element: HTMLElement, animators: ICuiPropertyAnimator<PropsTypes>[]) {\r\n        const progressValue = this._timingFunction.calculateProgress(progress);\r\n        this.setValues(progressValue, element, animators)\r\n    }\r\n\r\n    private finish(element: HTMLElement, resolve: any) {\r\n        this._animationStart = null;\r\n        this._currentTimestamp = null;\r\n        this._lock = false;\r\n        resolve(true);\r\n    }\r\n\r\n    private setValues(progress: number, element: HTMLElement, animators: ICuiPropertyAnimator<PropsTypes>[]) {\r\n        animators.forEach(animator => animator.perform(element, progress, 1));\r\n    }\r\n\r\n    private performAsync(element: HTMLElement, animators: ICuiPropertyAnimator<PropsTypes>[], setup: ICuiAnimationSetup, resolve: any, reject: any, timestamp: number) {\r\n        if (this._animationStart === null) {\r\n            this.finish(element, resolve);\r\n            return;\r\n        }\r\n        if (!this._currentTimestamp) {\r\n            this._currentTimestamp = timestamp;\r\n        }\r\n        const diff = timestamp - this._currentTimestamp;\r\n        this._animationStart = setup.revert ? this._animationStart - diff : this._animationStart + diff;\r\n        const timingprogress = this._animationStart / setup.timeout;\r\n        const progressValue = this._timingFunction.calculateProgress(timingprogress);\r\n        // Adjust progress value in case if calculator did not do it\r\n        const progress = getRangeValue(progressValue, 0, 1);\r\n        try {\r\n            this.setValues(progress, element, animators);\r\n        } catch (e) {\r\n            reject(e);\r\n        }\r\n        if (timingprogress > 0 && timingprogress < 1) {\r\n            this._currentTimestamp = timestamp;\r\n            //@ts-ignore\r\n            CuiRAF(this.performAsync.bind(this, element, animators, setup, resolve, reject))\r\n            return;\r\n        }\r\n        this.finish(element, resolve);\r\n    }\r\n}\r\n\r\nexport class CuiSwipeAnimationEngine implements ICuiSlideEngine {\r\n\r\n    private _element: HTMLElement | undefined;\r\n    private _animators: ICuiPropertyAnimator<PropsTypes>[];\r\n    private _animationEngine: ICuiAnimationEngine;\r\n\r\n    constructor(animationEngine: ICuiAnimationEngine, shouldCleanOnFinish?: boolean) {\r\n        this._element = undefined;\r\n        this._animators = [];\r\n        this._animationEngine = animationEngine;\r\n    }\r\n\r\n    move(progress: number): void {\r\n        if (!this._element || this._animators.length === 0) {\r\n            return;\r\n        }\r\n        this._animationEngine.update(progress, this._element as HTMLElement, this._animators);\r\n    }\r\n\r\n    setElement(element: HTMLElement) {\r\n        this._element = element;\r\n    }\r\n\r\n    setProps(props: AnimationProperty<PropsTypes>) {\r\n        if (!is(props)) {\r\n            return;\r\n        }\r\n        this._animators = [];\r\n        for (let prop in props) {\r\n            let animator = AnimatorFactory.get(prop);\r\n            if (!animator) return;\r\n            animator.setProperty(props[prop]);\r\n            this._animators.push(animator);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Perform single update on animators in RAF\r\n     * @param progress - progress value to be set to animators 0..1\r\n     */\r\n    updateAsync(progress: number) {\r\n        CuiRAF(this.move.bind(this, progress));\r\n    }\r\n\r\n    /**\r\n     * Finish swipe animation using animation engine\r\n     * @param progress - initial progress value 0..1\r\n     * @param timeout - time for animation to perform\r\n     * @param revert - whether animation should return back to 0 or progress to the end\r\n     */\r\n    async finish(setup: ICuiAnimationSetup): Promise<boolean> {\r\n        if (!this._element || this._animators.length === 0) {\r\n            return false;\r\n        }\r\n        return this._animationEngine.animate(this._element, this._animators, setup);\r\n    }\r\n}","import { ICuiTimingFunction, } from \"./interfaces\";\r\n\r\n/**\r\n * Forward: y = x\r\n * Backward: y = -x + 1  \r\n */\r\nexport function getLinearTimingFunction(): ICuiTimingFunction {\r\n    return {\r\n        calculateProgress: (currentTimeProgress: number) => {\r\n            return currentTimeProgress;\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * \r\n * @returns \r\n */\r\nexport function getSquareCalculator(): ICuiTimingFunction {\r\n\r\n    return {\r\n        calculateProgress: (currentTimeProgress: number) => {\r\n            return currentTimeProgress\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * \r\n * y = 2x - x^2\r\n */\r\nexport function getEaseTimingFunction(): ICuiTimingFunction {\r\n    return {\r\n        calculateProgress: (currentTimeProgress: number) => {\r\n            return (2 * currentTimeProgress) - Math.pow(currentTimeProgress, 2);\r\n        }\r\n    }\r\n}\r\n\r\n// export function getEaseOutCalculator(): ICuiTimingFunction {\r\n\r\n//     function calculate(start: number, progress: number): number {\r\n//         const a = (1 - start);\r\n//         return -(a * getParentSqaure(progress)) + 1;\r\n//     }\r\n\r\n//     function calcRevert(start: number, progress: number): number {\r\n//         return start * getParentSqaure(progress)\r\n//     }\r\n\r\n//     function getParentSqaure(x: number): number {\r\n//         return Math.pow(x, 2) - 2 * x + 1;\r\n//     }\r\n\r\n//     return {\r\n//         calculateProgress: (dt: number, data: ICuiAnimationPerform) => {\r\n//             let startDist = data.velocity * data.timeout;\r\n//             const progress = data.revert ? calcRevert(startDist, data.animationProgress) : calculate(startDist, data.animationProgress)\r\n//             return {\r\n//                 ...data,\r\n//                 progress: progress + 0.0001\r\n//             };\r\n//         }\r\n//     }\r\n\r\n\r\n// }","import { AnimationDefinition, SWIPE_ANIMATIONS_DEFINITIONS } from \"../../core/animation/definitions\";\r\nimport { CuiHandlerBase } from \"../../core/handlers/base\";\r\nimport { CuiTimeAnimationEngine, CuiSwipeAnimationEngine } from \"../../core/animation/engine\";\r\nimport { AriaAttributes } from \"../../core/utils/aria\";\r\nimport { replacePrefix } from \"../../core/utils/functions\";\r\nimport { ICuiComponent } from \"../../core/models/interfaces\";\r\nimport { CuiCore } from \"../../core/models/core\";\r\nimport { EVENTS } from \"../../core/utils/statics\";\r\nimport { CuiAutoParseArgs } from \"../../core/utils/arguments\";\r\nimport { CuiComponentBaseHook } from \"../base\";\r\nimport { ICuiMoveExtensionPerformer } from \"../extensions/move/performer\";\r\nimport { getEventBusFacade, getCuiHandlerInteractions, ICuiEventBusFacade, ICuiInteractionsFacade } from \"../../core/handlers/extensions/facades\";\r\nimport { eventExtension } from \"../extensions/event/event\";\r\nimport { closeActionsPerformer, ICuiActionExtensionPerformer, ICuiSliderProgress, sliderPerformer } from \"../extensions/performers\";\r\nimport { getActionsHelper } from \"../../core/helpers/helpers\";\r\nimport { CuiActionsListFactory } from \"../../core/utils/actions\";\r\nimport { getLinearTimingFunction } from \"../../core/animation/calculators\";\r\nimport { ICuiSlideEngine } from \"src/core/animation/interfaces\";\r\n\r\n//const BANNER_OPEN_ANIMATION: string = \".{prefix}-animation-fade-in\";\r\nconst BANNER_CLOSE_ANIMATION: string = \".{prefix}-animation-fade-out\";\r\n\r\nexport class CuiBannerArgs extends CuiAutoParseArgs {\r\n    timeout: number;\r\n    closeAct: string;\r\n    swipe: boolean;\r\n\r\n    constructor(prefix: string, timeout?: number) {\r\n        super();\r\n\r\n        this.timeout = timeout ?? 300;\r\n        this.swipe = false;\r\n        this.closeAct = replacePrefix(BANNER_CLOSE_ANIMATION, prefix);\r\n    }\r\n}\r\n\r\nexport function CuiBannerComponent(prefix?: string): ICuiComponent {\r\n    return CuiComponentBaseHook({\r\n        prefix: prefix,\r\n        name: \"banner\",\r\n        create: (element: HTMLElement, utils: CuiCore, prefix: string, attribute: string) => {\r\n            return new CuiBannerHandler(element, utils, attribute, prefix);\r\n        }\r\n    })\r\n}\r\n\r\nexport class CuiBannerHandler extends CuiHandlerBase<CuiBannerArgs> {\r\n\r\n    private _swipeEngine: ICuiSlideEngine;\r\n    private _swipeAnimation: AnimationDefinition;\r\n    private _movePerformer: ICuiMoveExtensionPerformer;\r\n    private _busFacade: ICuiEventBusFacade;\r\n    private _closeActionPerformer: ICuiActionExtensionPerformer<any>;\r\n    private _interactions: ICuiInteractionsFacade;\r\n    constructor(element: HTMLElement, utils: CuiCore, attribute: string, prefix: string) {\r\n        super(\"CuiBannerHandler\", element, attribute, new CuiBannerArgs(prefix, utils.setup.animationTime), utils);\r\n        this._swipeEngine = new CuiSwipeAnimationEngine(new CuiTimeAnimationEngine(getLinearTimingFunction()));\r\n        this._swipeEngine.setElement(this.element)\r\n        this._swipeAnimation = SWIPE_ANIMATIONS_DEFINITIONS[\"fade\"];\r\n        this._interactions = getCuiHandlerInteractions(utils.interactions);\r\n        this._busFacade = getEventBusFacade(this.getId(), utils.bus, element);\r\n        this._movePerformer = sliderPerformer(this.asyncClasses, {\r\n            start: () => { return true },\r\n            progress: this.onMove.bind(this),\r\n            end: this.onUp.bind(this),\r\n            element: element\r\n        })\r\n\r\n        this._closeActionPerformer = closeActionsPerformer(getActionsHelper(utils.interactions), this._busFacade, {\r\n            isActive: this.isActive.bind(this),\r\n            onFinish: () => {\r\n                this._movePerformer.setEnabled(false);\r\n            }\r\n        }, {\r\n            element: element,\r\n            active: this.activeAction\r\n        })\r\n\r\n        this.extend(eventExtension(this._busFacade, {\r\n            eventName: EVENTS.CLOSE,\r\n            performer: this._closeActionPerformer,\r\n        }))\r\n\r\n        this.extend(eventExtension(this._busFacade, {\r\n            eventName: EVENTS.GLOBAL_MOVE,\r\n            performer: this._movePerformer\r\n        }))\r\n\r\n    }\r\n\r\n    async onHandle(): Promise<boolean> {\r\n        this._interactions.mutate(() => {\r\n            if (!this.classes.hasClass(this.activeClassName, this.element))\r\n                this.classes.setClass(this.activeClassName, this.element)\r\n            AriaAttributes.setAria(this.element, 'aria-expanded', 'true');\r\n            AriaAttributes.setAria(this.element, 'aria-hidden', 'false');\r\n        })\r\n        this.updateSetup();\r\n        return true;\r\n    }\r\n    async onRefresh(): Promise<boolean> {\r\n        this.updateSetup();\r\n        return true;\r\n    }\r\n    async onRemove(): Promise<boolean> {\r\n        this._busFacade.detachEmittedEvents();\r\n        return true;\r\n    }\r\n\r\n    private updateSetup() {\r\n        this._movePerformer.setEnabled(this.args.swipe);\r\n        this._closeActionPerformer.updateSetup({\r\n            timeout: this.args.timeout,\r\n            actions: CuiActionsListFactory.get(this.args.closeAct)\r\n        })\r\n    }\r\n\r\n    private onMove(data: ICuiSliderProgress) {\r\n        this._swipeEngine.setProps(data.ratio > 0 ? this._swipeAnimation.current.right : this._swipeAnimation.current.left);\r\n        this._interactions.mutate(() => {\r\n            this._swipeEngine.move(Math.abs(data.ratio));\r\n        })\r\n    }\r\n\r\n    private onUp(data: ICuiSliderProgress) {\r\n        let absRatio = Math.abs(data.ratio);\r\n        let back = absRatio <= 0.4;\r\n        // Lock component until animation is finished\r\n        const minVelo = 1 / this.args.timeout;\r\n        const v = data.velocity > minVelo ? data.velocity : minVelo;\r\n\r\n        this._swipeEngine.finish({ progress: absRatio, acceleration: data.acceleration, velocity: v, timeout: this.args.timeout, revert: back }).then(status => {\r\n            if (!status || back) {\r\n                return\r\n            }\r\n            this.asyncClasses.removeClasses(this.element, this.activeClassName)\r\n            AriaAttributes.setAria(this.element, 'aria-expanded', 'false');\r\n            AriaAttributes.setAria(this.element, 'aria-hidden', 'true');\r\n            this._movePerformer.setEnabled(false);\r\n        });\r\n    }\r\n}","import { CuiCore } from \"../../core/models/core\";\r\nimport { CuiHandlerBase } from \"../../core/handlers/base\";\r\nimport { is, getRangeValue } from \"../../core/utils/functions\";\r\nimport { ICONS, EVENTS } from \"../../core/utils/statics\";\r\nimport { IconBuilder } from \"../../core/builders/icon\";\r\nimport { CuiAutoParseArgs } from \"../../core/utils/arguments\";\r\nimport { CuiComponentBaseHook } from \"../base\";\r\nimport { eventExtension } from \"../extensions/event/event\";\r\nimport { getEventBusFacade, getCuiHandlerInteractions, ICuiEventBusFacade, ICuiInteractionsFacade } from \"../../core/handlers/extensions/facades\";\r\nimport { callbackPerformer } from \"../extensions/performers\";\r\n\r\nexport interface CuiCircleProgressChnaged {\r\n    timestamp: number;\r\n    progress: number;\r\n}\r\n\r\nexport class CuiCircleArgs extends CuiAutoParseArgs {\r\n    progress: number;\r\n    constructor() {\r\n        super();\r\n        this.progress = 0;\r\n    }\r\n}\r\n\r\nexport function CuiCircleComponent(prefix?: string) {\r\n    ICONS['special_circle_progress'] = \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\"  class=\\\"circle-progress\\\" viewBox=\\\"0 0 100 100\\\" width=\\\"100\\\" height=\\\"100\\\"><path class=\\\"circle-progress-path\\\" d=\\\"M 50,5.3660047 A 44.867708,44.633994 0 0 1 94.867709,49.999997 44.867708,44.633994 0 0 1 50,94.633995 44.867708,44.633994 0 0 1 5.1322908,50.000001 44.867708,44.633994 0 0 1 50,5.3660047\\\"></path></svg>\";\r\n\r\n    return CuiComponentBaseHook({\r\n        name: 'circle-progress',\r\n        prefix: prefix,\r\n        create: (element: HTMLElement, utils: CuiCore, prefix: string, attribute: string) => {\r\n            return new CuiCircleHandler(element, utils, attribute);\r\n        }\r\n    })\r\n}\r\n\r\nexport class CuiCircleHandler extends CuiHandlerBase<CuiCircleArgs> {\r\n    private _factor: number;\r\n    private _full: number;\r\n    private _path: any;\r\n\r\n    private _busFacade: ICuiEventBusFacade;\r\n    private _interactions: ICuiInteractionsFacade;\r\n    constructor(element: HTMLElement, utils: CuiCore, attribute: string) {\r\n        super(\"CuiCircleHandler\", element, attribute, new CuiCircleArgs(), utils);\r\n        this._factor = this._full = 0;\r\n        this._path = null\r\n        this._busFacade = getEventBusFacade(this.cuid, utils.bus, element);\r\n        this._interactions = getCuiHandlerInteractions(utils.interactions, this);\r\n\r\n        this.extend(eventExtension(this._busFacade, {\r\n            eventName: EVENTS.PROGRESS_CHANGE,\r\n            performer: callbackPerformer(this.onSetProgress.bind(this))\r\n        }))\r\n    }\r\n\r\n    async onHandle(): Promise<boolean> {\r\n        const iconSvg = new IconBuilder(ICONS['special_circle_progress']).build();\r\n        if (!is(iconSvg)) {\r\n            this.logError(\"SVG circle was not created\", \"onInit\")\r\n            return false;\r\n        }\r\n        const svg = this.element.querySelector('svg')\r\n        if (is(svg)) {\r\n            //@ts-ignore svg checked\r\n            svg.remove();\r\n        }\r\n        //@ts-ignore iconSvg checked\r\n        this.element.appendChild(iconSvg);\r\n        this._path = this.element.querySelector('.circle-progress-path');\r\n        this._full = this._path.getTotalLength();\r\n        this._factor = this._full / 100;\r\n        this._interactions.fetch(this.readStyle)\r\n\r\n        return true;\r\n    }\r\n\r\n    async onRefresh(): Promise<boolean> {\r\n        this._interactions.fetch(this.readStyle)\r\n        this._busFacade.emit(EVENTS.PROGRESS_CHANGED, {\r\n            timestamp: Date.now(),\r\n            progress: this.args.progress\r\n        })\r\n        return true;\r\n    }\r\n\r\n    async onRemove(): Promise<boolean> {\r\n        this._busFacade.detachEmittedEvents();\r\n        return true;\r\n    }\r\n\r\n    onSetProgress(val: any) {\r\n        if (is(val)) {\r\n            this.element.setAttribute(this.attribute, val);\r\n        }\r\n    }\r\n\r\n    private updateStyle(value: number) {\r\n        this._path.style.strokeDashoffset = value;\r\n    }\r\n\r\n    private readStyle(): void {\r\n        if (this.prevArgs && this.args.progress === this.prevArgs.progress) {\r\n            return;\r\n        }\r\n        const progress = getRangeValue(this.args.progress, 0, 100);\r\n\r\n        this._interactions.mutate(this.updateStyle, this._full - this._factor * progress);\r\n    }\r\n\r\n}","import { CuiCore } from \"../../core/models/core\";\r\nimport { CuiHandlerBase } from \"../../core/handlers/base\";\r\nimport { is, getParentCuiElement, are } from \"../../core/utils/functions\";\r\nimport { CuiActionsListFactory } from \"../../core/utils/actions\";\r\nimport { EVENTS } from \"../../core/utils/statics\";\r\nimport { CuiAutoParseArgs } from \"../../core/utils/arguments\";\r\nimport { CuiClickableArgs } from \"../../core/models/arguments\";\r\nimport { clickExtension } from \"../extensions/click/click\";\r\nimport { InteractionEvent } from \"../../core/models/events\";\r\nimport { getEventBusFacade, ICuiEventBusFacade } from \"../../core/handlers/extensions/facades\";\r\nimport { eventExtension } from \"../extensions/event/event\";\r\nimport { CuiActionsHelper } from \"../../core/helpers/helpers\";\r\nimport { CuiComponentBaseHook } from \"../base\";\r\nimport { callbackPerformer } from \"../extensions/performers\";\r\n\r\nexport class CuiCloseArgs extends CuiAutoParseArgs implements CuiClickableArgs {\r\n    target: string;\r\n    action: string;\r\n    timeout: number;\r\n    state: string;\r\n    prevent: boolean;\r\n    stopPropagation: boolean;\r\n\r\n    constructor(timeout?: number) {\r\n        super({\r\n            main: \"target\"\r\n        });\r\n        this.target = \"\";\r\n        this.action = \"\";\r\n        this.prevent = false;\r\n        this.stopPropagation = false;\r\n        this.state = \"\";\r\n        this.timeout = timeout ?? 300;\r\n    }\r\n\r\n}\r\n\r\nexport function CuiCloseComponent(prefix?: string) {\r\n    return CuiComponentBaseHook({\r\n        prefix: prefix,\r\n        name: \"close\",\r\n        create: (element: HTMLElement, utils: CuiCore, prefix: string, attribute: string) => {\r\n            return new CuiCloseHandler(element, utils, attribute);\r\n        }\r\n    })\r\n}\r\n\r\nexport class CuiCloseHandler extends CuiHandlerBase<CuiCloseArgs> {\r\n    private _busFacade: ICuiEventBusFacade;\r\n    private _actionsHelper: CuiActionsHelper;\r\n    constructor(element: HTMLElement, utils: CuiCore, attribute: string) {\r\n        super(\"CuiCloseHandler\", element, attribute, new CuiCloseArgs(utils.setup.animationTime), utils);\r\n        this._busFacade = getEventBusFacade(this.cuid, utils.bus, element);\r\n        this._actionsHelper = new CuiActionsHelper(utils.interactions);\r\n\r\n        this.extend(clickExtension({\r\n            element: element,\r\n            performer: callbackPerformer(this.onClose.bind(this))\r\n        }))\r\n        this.extend(eventExtension(this._busFacade, {\r\n            eventName: EVENTS.CLOSE,\r\n            performer: callbackPerformer(() => this.onClose(null))\r\n        }))\r\n    }\r\n\r\n    async onHandle(): Promise<boolean> {\r\n        return true;\r\n    }\r\n\r\n    async onRefresh(): Promise<boolean> {\r\n        return true;\r\n    }\r\n    async onRemove(): Promise<boolean> {\r\n        this._busFacade.detachEmittedEvents();\r\n        return true;\r\n    }\r\n\r\n    onClose(ev: MouseEvent | null) {\r\n        if (!this.lock()) {\r\n            return;\r\n        }\r\n        const target = this.getTarget();\r\n        if (!is(target)) {\r\n            this.log.warning(`Target ${this.args.target} not found`, 'onClick')\r\n            return;\r\n        }\r\n\r\n        //@ts-ignore target is checked\r\n        this.run(target).then((result) => {\r\n            if (result)\r\n                this.emitClose(ev);\r\n        }).catch((e) => {\r\n            this.log.exception(e);\r\n        }).finally(() => {\r\n            this.unlock();\r\n        })\r\n    }\r\n\r\n    private async run(target: Element): Promise<boolean> {\r\n        let cuiId = (target as any).$cuid;\r\n        if (is(cuiId)) {\r\n            await this.core.bus.emit(EVENTS.CLOSE, cuiId, this.args.state);\r\n            return false;\r\n        } else if (are(this.args.action, this.args.timeout)) {\r\n            let actions = CuiActionsListFactory.get(this.args.action);\r\n            return this._actionsHelper.performActions(target, actions, this.args.timeout, () => {\r\n                this.classes.removeClass(this.activeClassName, target)\r\n            });\r\n        } else {\r\n            this.asyncClasses.removeClasses(target, this.activeClassName);\r\n            return true;\r\n        }\r\n    }\r\n\r\n    private getTarget(): Element | undefined {\r\n        if (!is(this.args.target)) {\r\n            return getParentCuiElement(this.element);\r\n        }\r\n        return document.querySelector(this.args.target) ?? getParentCuiElement(this.element);\r\n    }\r\n\r\n    private emitClose(ev: MouseEvent | null) {\r\n        this._busFacade.emit<InteractionEvent<string>>(EVENTS.CLOSED, {\r\n            state: this.args.state,\r\n            event: ev\r\n        })\r\n    }\r\n}","import { ICuiEventBusFacade } from \"src/core/handlers/extensions/facades\";\r\nimport { ICuiHandlerExtension } from \"../../../core/handlers/extensions/interfaces\";\r\nimport { KeyDownEvent } from \"../../../core/models/events\";\r\nimport { isInViewport } from \"../../../core/utils/functions\";\r\nimport { EVENTS } from \"../../../core/utils/statics\";\r\nimport { ICuiExtensionPerformer } from \"../interfaces\";\r\n\r\nexport class ICuiKeysExtensionOptions {\r\n    allowRepeatedEvent?: boolean;\r\n    onlyWhenInViewport?: boolean;\r\n}\r\n\r\nexport class CuiKeysHandlerExtension implements ICuiHandlerExtension<any> {\r\n    type: string;\r\n    description: string;\r\n    private _performer: ICuiExtensionPerformer<KeyDownEvent>;\r\n    private _eventId: string | null;\r\n    private _options: ICuiKeysExtensionOptions;\r\n    private _busFacade: ICuiEventBusFacade;\r\n    private _element: HTMLElement;\r\n\r\n    constructor(element: HTMLElement, busFacade: ICuiEventBusFacade, performer: ICuiExtensionPerformer<KeyDownEvent>, options?: ICuiKeysExtensionOptions) {\r\n        this.type = \"keys\";\r\n        this.description = \"\";\r\n\r\n        this._busFacade = busFacade;\r\n        this._performer = performer;\r\n        this._eventId = null;\r\n        this._element = element;\r\n        this._options = {\r\n            allowRepeatedEvent: options?.allowRepeatedEvent ?? false,\r\n            onlyWhenInViewport: options?.onlyWhenInViewport ?? true,\r\n        }\r\n    }\r\n\r\n    async init(args: any): Promise<boolean> {\r\n        this._eventId = this._busFacade.on<KeyDownEvent>(EVENTS.KEYDOWN, this.onKeyDown.bind(this));\r\n        return true;\r\n    }\r\n\r\n    async update(args: any) {\r\n        //  this.args = args;\r\n        return true;\r\n    }\r\n\r\n    async destroy(): Promise<boolean> {\r\n        if (this._eventId)\r\n            this._busFacade.detach(EVENTS.KEYDOWN, this._eventId)\r\n        this._eventId = null;\r\n        return true;\r\n    }\r\n\r\n    onKeyDown(ev: KeyDownEvent) {\r\n        if (!(this._options.onlyWhenInViewport && isInViewport(this._element)) || (this._options.allowRepeatedEvent && !ev.event.repeat)) {\r\n            return;\r\n        }\r\n        this._performer.perform(ev);\r\n    }\r\n\r\n}","import { KeyDownEvent } from \"../../../core/models/events\";\r\nimport { ICuiKeysCombo, ICuiPair } from \"../../../core/models/interfaces\";\r\nimport { matchesKeyCombo } from \"../../../core/utils/functions\";\r\nimport { ICuiExtensionPerformer } from \"../interfaces\";\r\n\r\nexport interface ICuiKeyActionPerformer extends ICuiExtensionPerformer<KeyDownEvent> {\r\n    setCallback(callback: (index: string) => void): void;\r\n    setKeyCombos(combo: ICuiPair<string, ICuiKeysCombo>[]): void;\r\n\r\n}\r\n\r\nexport function getCuiKeyActionPerformer(callback: (index: string, event: KeyDownEvent) => void): ICuiKeyActionPerformer {\r\n    let _keyCombos: ICuiPair<string, ICuiKeysCombo>[] = [];\r\n    let _callback: (index: string, event: KeyDownEvent) => void = callback;\r\n    return {\r\n        perform: (ev: KeyDownEvent) => {\r\n            for (const combo of _keyCombos) {\r\n                if (matchesKeyCombo(ev.event, combo.value)) {\r\n                    _callback(combo.key, ev);\r\n                    return;\r\n                }\r\n            }\r\n        },\r\n\r\n        setKeyCombos(combo: ICuiPair<string, ICuiKeysCombo>[]) {\r\n            _keyCombos = combo;\r\n        },\r\n\r\n        setCallback: (callback: (index: string, event: KeyDownEvent) => void) => {\r\n            _callback = callback;\r\n        }\r\n    }\r\n}","import { ICuiStyleHelper } from \"src/core/handlers/extensions/facades\";\r\nimport { ICuiKeysCombo, ICuiPair } from \"src/core/models/interfaces\";\r\nimport { ICuiParser } from \"src/core/utils/parsers/interfaces\";\r\nimport { ICuiScrollFreezeHelper } from \"./interfaces\";\r\n\r\nexport function getScrollFreezeHelper(style: ICuiStyleHelper): ICuiScrollFreezeHelper {\r\n    let _scrollY: number = 0;\r\n    return {\r\n        getScroll: () => {\r\n            _scrollY = window.pageYOffset;\r\n        },\r\n        freeze: () => {\r\n            style.setStyle('top', `-${_scrollY}px`, document.body);\r\n        },\r\n        release: () => {\r\n            style.removeStyle('top', document.body);\r\n            window.scrollTo(0, (_scrollY || 0) * -1);\r\n            _scrollY = 0;\r\n        }\r\n    }\r\n}\r\n\r\nexport function getKeyCloseCombos(parser: ICuiParser<string, ICuiKeysCombo>, escClose: boolean, ...combos: string[]): ICuiPair<string, ICuiKeysCombo>[] {\r\n    const comboList: ICuiPair<string, ICuiKeysCombo>[] = [];\r\n    if (escClose) {\r\n        comboList.push({ key: \"close\", value: parser.parse(\"Escape\") })\r\n    }\r\n    if (combos) {\r\n        combos.forEach(c => {\r\n            if (c) {\r\n                comboList.push({ key: \"close\", value: parser.parse(c) })\r\n            }\r\n        })\r\n    }\r\n    return comboList;\r\n}\r\n\r\nexport function getDefaultSwitchKeyCombo(key?: string): ICuiKeysCombo {\r\n    return {\r\n        isAlt: true,\r\n        isCtrl: true,\r\n        isShift: false,\r\n        key: key\r\n    }\r\n}","import { ICuiKeysCombo } from \"src/core/models/interfaces\";\r\nimport { splitText } from \"../functions\";\r\nimport { ICuiParser, ICuiParserCallbacks } from \"./interfaces\";\r\n\r\n// export class CuiKeysComboParser implements ICuiParser<string, ICuiKeysCombo> {\r\n//     private _splitBy: string;\r\n//     private _handlers: ICuiParserCallbacks<ICuiKeysCombo, string>;\r\n//     constructor(handlers: ICuiParserCallbacks<ICuiKeysCombo, string>, splitBy?: string) {\r\n//         this._splitBy = splitBy ?? \"+\";\r\n//         this._handlers = handlers;\r\n//     }\r\n\r\n//     parse(value: string): ICuiKeysCombo {\r\n//         return splitText(value, this._splitBy).reduce((result: ICuiKeysCombo, item: string) => {\r\n//             return this.getResult(result, item);\r\n//         }, { isCtrl: false, isAlt: false, isShift: false });\r\n//     }\r\n\r\n//     private getResult(input: ICuiKeysCombo, item: string): ICuiKeysCombo {\r\n//         let itemPrep = item.trim();\r\n//         const handler = this._handlers[itemPrep.toLowerCase()];\r\n//         if (handler) {\r\n//             input = handler(input, itemPrep);\r\n//         } else {\r\n//             input.key = itemPrep;\r\n//         }\r\n//         return input;\r\n//     }\r\n// }\r\n\r\nexport function getCuiKeysComboParser(splitBy?: string): ICuiParser<string, ICuiKeysCombo> {\r\n    let _handlers = KeyComboParsers;\r\n    let _splitBy = splitBy ?? \"+\";\r\n    function getResult(input: ICuiKeysCombo, item: string): ICuiKeysCombo {\r\n        let itemPrep = item.trim();\r\n        const handler = _handlers[itemPrep.toLowerCase()];\r\n        if (handler) {\r\n            input = handler(input, itemPrep);\r\n        } else {\r\n            input.key = itemPrep;\r\n        }\r\n        return input;\r\n    }\r\n    return {\r\n        parse: (value: string) => {\r\n            return splitText(value, _splitBy).reduce((result: ICuiKeysCombo, item: string) => {\r\n                return getResult(result, item);\r\n            }, { isCtrl: false, isAlt: false, isShift: false });\r\n        }\r\n    }\r\n\r\n}\r\n\r\n\r\nexport function AltParser(input: ICuiKeysCombo, item: string): ICuiKeysCombo {\r\n    input.isAlt = true;\r\n    return input\r\n}\r\n\r\nexport function CtrlParser(input: ICuiKeysCombo, item: string): ICuiKeysCombo {\r\n    input.isCtrl = true;\r\n    return input\r\n}\r\n\r\nexport function ShiftParser(input: ICuiKeysCombo, item: string): ICuiKeysCombo {\r\n    input.isShift = true;\r\n    return input\r\n}\r\n\r\nexport const KeyComboParsers: ICuiParserCallbacks<ICuiKeysCombo, string> = {\r\n    'ctrl': CtrlParser,\r\n    'alt': AltParser,\r\n    'shift': ShiftParser\r\n\r\n}","import { ICuiKeysCombo } from \"../../core/models/interfaces\";\r\nimport { CuiCore } from \"../../core/models/core\";\r\nimport { replacePrefix } from \"../../core/utils/functions\";\r\nimport { AriaAttributes } from \"../../core/utils/aria\";\r\nimport { CuiHandlerBase } from \"../../core/handlers/base\";\r\nimport { CuiAutoParseArgs } from \"../../core/utils/arguments\";\r\nimport { getActionsHelper } from \"../../core/helpers/helpers\";\r\nimport { getEventBusFacade, CuiStyleHelper, ICuiEventBusFacade } from \"../../core/handlers/extensions/facades\";\r\nimport { eventExtension } from \"../extensions/event/event\";\r\nimport { EVENTS } from \"../../core/utils/statics\";\r\nimport { closeActionsPerformer, ICuiActionExtensionPerformer, openActionsPerformer } from \"../extensions/performers\";\r\nimport { CuiKeysHandlerExtension } from \"../extensions/keys/keys\";\r\nimport { getCuiKeyActionPerformer, ICuiKeyActionPerformer } from \"../extensions/keys/performer\";\r\nimport { ICuiScrollFreezeHelper } from \"../extensions/helpers/interfaces\";\r\nimport { getKeyCloseCombos, getScrollFreezeHelper } from \"../extensions/helpers/helpers\";\r\nimport { CuiComponentBaseHook } from \"../base\";\r\nimport { CuiActionsListFactory } from \"../../core/utils/actions\";\r\nimport { ICuiParser } from \"../../core/utils/parsers/interfaces\";\r\nimport { getCuiKeysComboParser } from \"../../core/utils/parsers/keys\";\r\n\r\nconst COVER_OPEN_ANIMATION_CLASS = '.{prefix}-dialog-default-in';\r\nconst COVER_CLOSE_ANIMATION_CLASS = '.{prefix}-dialog-default-out';\r\nconst bodyClass = '{prefix}-cover-open';\r\n\r\nexport interface CuiDialogEvent {\r\n    timestamp: number;\r\n}\r\n\r\nexport class CuiCoverArgs extends CuiAutoParseArgs {\r\n    escClose: boolean;\r\n    timeout: number;\r\n    openAct: string;\r\n    closeAct: string;\r\n    keyClose: string;\r\n\r\n    constructor(prefix: string, defTimeout?: number) {\r\n        super();\r\n        this.escClose = false;\r\n        this.timeout = defTimeout ?? 300;\r\n        this.openAct = replacePrefix(COVER_OPEN_ANIMATION_CLASS, prefix);\r\n        this.closeAct = replacePrefix(COVER_CLOSE_ANIMATION_CLASS, prefix);\r\n        this.keyClose = \"\";\r\n    }\r\n\r\n}\r\n\r\nexport function CuiCoverComponent(prefix?: string) {\r\n    return CuiComponentBaseHook({\r\n        prefix: prefix,\r\n        name: \"cover\",\r\n        create: (element: HTMLElement, utils: CuiCore, prefix: string, attribute: string) => {\r\n            return new CuiCoverHandler(element, utils, attribute, prefix);\r\n        }\r\n    })\r\n}\r\n\r\nexport class CuiCoverHandler extends CuiHandlerBase<CuiCoverArgs> {\r\n\r\n    private _bodyClass: string;\r\n    private _busFacade: ICuiEventBusFacade;\r\n    private _openActionPerformer: ICuiActionExtensionPerformer<any>;\r\n    private _closeActionPerformer: ICuiActionExtensionPerformer<any>;\r\n    private _keysPerformer: ICuiKeyActionPerformer;\r\n    private _freezeHelper: ICuiScrollFreezeHelper;\r\n    private _keyComboParser: ICuiParser<string, ICuiKeysCombo>;\r\n\r\n    constructor(element: HTMLElement, utils: CuiCore, attribute: string, prefix: string) {\r\n        super(\"CuiCoverHandler\", element, attribute, new CuiCoverArgs(prefix, utils.setup.animationTimeLong), utils);\r\n        this._bodyClass = replacePrefix(bodyClass, prefix);\r\n\r\n        this._busFacade = getEventBusFacade(this.cuid, utils.bus, element);\r\n        this._keysPerformer = getCuiKeyActionPerformer(this.closeOutside.bind(this));\r\n        this._freezeHelper = getScrollFreezeHelper(new CuiStyleHelper());\r\n        this._keyComboParser = getCuiKeysComboParser();\r\n        const actionsHelper = getActionsHelper(utils.interactions);\r\n        this._openActionPerformer = openActionsPerformer(actionsHelper, this._busFacade, {\r\n            isActive: this.isActive.bind(this),\r\n            onBefore: this.onBeforeOpen.bind(this),\r\n            onAfter: this.onAfterOpen.bind(this),\r\n        }, {\r\n            element: element,\r\n            active: this.activeAction\r\n        })\r\n\r\n        this._closeActionPerformer = closeActionsPerformer(actionsHelper, this._busFacade, {\r\n            isActive: this.isActive.bind(this),\r\n            onAfter: this.onAfterClose.bind(this),\r\n        }, {\r\n            active: this.activeAction,\r\n            element: element\r\n        })\r\n        this.extend(eventExtension(this._busFacade, {\r\n            eventName: EVENTS.OPEN,\r\n            performer: this._openActionPerformer\r\n        }))\r\n        this.extend(eventExtension(this._busFacade, {\r\n            eventName: EVENTS.CLOSE,\r\n            performer: this._closeActionPerformer\r\n        }))\r\n        // this.extend(eventExtension(this._busFacade, {\r\n        //     eventName: EVENTS.WINDOW_CLICK,\r\n        //     performer: callbackPerformer(this.closeOutside.bind(this))\r\n        // }))\r\n        this.extend(new CuiKeysHandlerExtension(element, this._busFacade, this._keysPerformer))\r\n    }\r\n\r\n    async onHandle(): Promise<boolean> {\r\n        AriaAttributes.setAria(this.element, 'aria-modal', \"\");\r\n        this.updateSetup();\r\n        return true;\r\n    }\r\n\r\n    async onRefresh(): Promise<boolean> {\r\n        this.updateSetup();\r\n        return true;\r\n    }\r\n\r\n    async onRemove(): Promise<boolean> {\r\n        this._busFacade.detachEmittedEvents();\r\n        return true\r\n    }\r\n\r\n    private updateSetup() {\r\n        this._openActionPerformer.updateSetup({\r\n            timeout: this.args.timeout,\r\n            actions: CuiActionsListFactory.get(this.args.openAct)\r\n        })\r\n        this._closeActionPerformer.updateSetup({\r\n            timeout: this.args.timeout,\r\n            actions: CuiActionsListFactory.get(this.args.closeAct)\r\n        })\r\n        this._keysPerformer.setKeyCombos(getKeyCloseCombos(this._keyComboParser, this.args.escClose, this.args.keyClose))\r\n    }\r\n\r\n    private closeOutside() {\r\n        this._closeActionPerformer.perform(null);\r\n    }\r\n\r\n    onBeforeOpen(): boolean {\r\n        if (this.isAnyActive()) {\r\n            return false;\r\n        }\r\n\r\n        this._freezeHelper.getScroll();\r\n\r\n        return true;\r\n    }\r\n\r\n    onAfterOpen(): void {\r\n        this.classes.setClass(this._bodyClass, document.body)\r\n        this._freezeHelper.freeze();\r\n        this.classes.setClass(this.activeClassName, this.element)\r\n        AriaAttributes.setAria(this.element, 'aria-hidden', \"false\");\r\n        AriaAttributes.setAria(this.element, 'aria-expanded', 'true');\r\n    }\r\n\r\n    onAfterClose(): void {\r\n        this._freezeHelper.release();\r\n        this.classes.removeClass(this._bodyClass, document.body);\r\n        AriaAttributes.setAria(this.element, 'aria-hidden', \"true\");\r\n        AriaAttributes.setAria(this.element, 'aria-expanded', 'false');\r\n    }\r\n\r\n    private isAnyActive(): boolean {\r\n        return this.classes.hasClass(this._bodyClass, document.body);\r\n    }\r\n}\r\n\r\n","import { GlobalClickEvent } from \"src/core/models/events\";\r\nimport { ICuiExtensionPerformer } from \"../interfaces\";\r\n\r\nexport interface ICuiWindowClickPerformer extends ICuiExtensionPerformer<GlobalClickEvent> {\r\n    setEnabled(flag: boolean): void;\r\n}\r\n\r\nexport function getCuiWindowClickPerformer(callback: (arg: GlobalClickEvent) => void): ICuiWindowClickPerformer {\r\n    let _isEnabled = false;\r\n    return {\r\n        perform: (arg: GlobalClickEvent) => {\r\n            if (!_isEnabled) {\r\n                return;\r\n            }\r\n            callback(arg);\r\n        },\r\n        setEnabled: (flag: boolean) => {\r\n            _isEnabled = flag;\r\n        }\r\n    }\r\n}\r\n\r\nexport function getAdvancedCuiWindowClickPerformer(callback: (arg: GlobalClickEvent) => void, target?: Node): ICuiWindowClickPerformer {\r\n    function nodeCallback(arg: GlobalClickEvent) {\r\n        if (!target || !target.contains((arg.ev.target as Node))) {\r\n            callback(arg)\r\n        }\r\n    }\r\n    return getCuiWindowClickPerformer(nodeCallback)\r\n}","import { ICuiComponent, ICuiKeysCombo } from \"../../core/models/interfaces\";\r\nimport { CuiCore } from \"../../core/models/core\";\r\nimport { replacePrefix } from \"../../core/utils/functions\";\r\nimport { EVENTS } from \"../../core/utils/statics\";\r\nimport { AriaAttributes } from \"../../core/utils/aria\";\r\nimport { CuiHandlerBase } from \"../../core/handlers/base\";\r\nimport { CuiAutoParseArgs } from \"../../core/utils/arguments\";\r\nimport { CuiComponentBaseHook } from \"../base\";\r\nimport { getEventBusFacade, CuiStyleHelper, getCuiHandlerInteractions, ICuiEventBusFacade, ICuiInteractionsFacade } from \"../../core/handlers/extensions/facades\";\r\nimport { eventExtension } from \"../extensions/event/event\";\r\nimport { closeActionsPerformer, ICuiActionExtensionPerformer, openActionsPerformer } from \"../extensions/performers\";\r\nimport { ICuiParser } from \"../../core/utils/parsers/interfaces\";\r\nimport { ICuiScrollFreezeHelper } from \"../extensions/helpers/interfaces\";\r\nimport { getCuiKeyActionPerformer, ICuiKeyActionPerformer } from \"../extensions/keys/performer\";\r\nimport { getActionsHelper } from \"../../core/helpers/helpers\";\r\nimport { getCuiKeysComboParser } from \"../../core/utils/parsers/keys\";\r\nimport { getKeyCloseCombos, getScrollFreezeHelper } from \"../extensions/helpers/helpers\";\r\nimport { CuiKeysHandlerExtension } from \"../extensions/keys/keys\";\r\nimport { CuiActionsListFactory } from \"../../core/utils/actions\";\r\nimport { getAdvancedCuiWindowClickPerformer, ICuiWindowClickPerformer } from \"../extensions/window/performer\";\r\n\r\nconst DIALOG_OPEN_ANIMATION_CLASS = '.{prefix}-dialog-default-in';\r\nconst DIALOG_CLOSE_ANIMATION_CLASS = '.{prefix}-dialog-default-out';\r\nconst bodyClass = '{prefix}-dialog-open';\r\nconst CONTAINER = '.{prefix}-dialog-container';\r\n\r\nexport interface CuiDialogEvent {\r\n    timestamp: number;\r\n}\r\n\r\nexport class CuiDialogArgs extends CuiAutoParseArgs {\r\n    escClose: boolean;\r\n    outClose: boolean;\r\n    timeout: number;\r\n    openAct: string;\r\n    closeAct: string;\r\n    keyClose: string;\r\n\r\n    constructor(prefix: string, defTimeout?: number) {\r\n        super();\r\n\r\n        this.escClose = false;\r\n        this.outClose = false;\r\n        this.timeout = defTimeout ?? 300;\r\n        this.openAct = replacePrefix(DIALOG_OPEN_ANIMATION_CLASS, prefix);\r\n        this.closeAct = replacePrefix(DIALOG_CLOSE_ANIMATION_CLASS, prefix);\r\n        this.keyClose = \"\";\r\n    }\r\n}\r\n\r\n\r\nexport function CuiDialogComponent(prefix?: string): ICuiComponent {\r\n    return CuiComponentBaseHook({\r\n        prefix: prefix,\r\n        name: \"dialog\",\r\n        create: (element: HTMLElement, utils: CuiCore, prefix: string, attribute: string) => {\r\n            return new CuiDialogHandler(element, utils, attribute, prefix);\r\n        }\r\n    })\r\n}\r\n\r\nexport class CuiDialogHandler extends CuiHandlerBase<CuiDialogArgs> {\r\n\r\n    private _bodyClass: string;\r\n    private _busFacade: ICuiEventBusFacade;\r\n    private _interactions: ICuiInteractionsFacade;\r\n    private _openActionPerformer: ICuiActionExtensionPerformer<any>;\r\n    private _closeActionPerformer: ICuiActionExtensionPerformer<any>;\r\n    private _keysPerformer: ICuiKeyActionPerformer;\r\n    private _freezeHelper: ICuiScrollFreezeHelper;\r\n    private _keyComboParser: ICuiParser<string, ICuiKeysCombo>;\r\n    private _windowClickPerformer: ICuiWindowClickPerformer;\r\n\r\n    constructor(element: HTMLElement, utils: CuiCore, attribute: string, prefix: string) {\r\n        super(\"CuiDialogHandler\", element, attribute, new CuiDialogArgs(prefix, utils.setup.animationTimeLong), utils);\r\n        this._bodyClass = replacePrefix(bodyClass, prefix);\r\n        const container = element.querySelector(replacePrefix(CONTAINER, prefix));\r\n        if (!utils.isPlugin(\"keys-plugin\")) {\r\n            this.logWarning(\"KeyObserver plugin is not available, escClose and keyClose will not work\")\r\n        }\r\n        this._busFacade = getEventBusFacade(this.cuid, utils.bus, element);\r\n        this._keysPerformer = getCuiKeyActionPerformer(this.closeOutside.bind(this));\r\n        this._freezeHelper = getScrollFreezeHelper(new CuiStyleHelper());\r\n        this._keyComboParser = getCuiKeysComboParser();\r\n        this._interactions = getCuiHandlerInteractions(utils.interactions);\r\n        const actionsHelper = getActionsHelper(utils.interactions);\r\n        this._windowClickPerformer = getAdvancedCuiWindowClickPerformer(this.closeOutside.bind(this), container ?? undefined);\r\n        this._openActionPerformer = openActionsPerformer(actionsHelper, this._busFacade, {\r\n            isActive: this.isActive.bind(this),\r\n            onBefore: this.onBeforeOpen.bind(this),\r\n            onAfter: this.onAfterOpen.bind(this),\r\n        }, {\r\n            element: element,\r\n            active: this.activeAction\r\n        })\r\n\r\n        this._closeActionPerformer = closeActionsPerformer(actionsHelper, this._busFacade, {\r\n            isActive: this.isActive.bind(this),\r\n            onAfter: this.onAfterClose.bind(this),\r\n        }, {\r\n            element: element,\r\n            active: this.activeAction\r\n        })\r\n        this.extend(eventExtension(this._busFacade, {\r\n            eventName: EVENTS.OPEN,\r\n            performer: this._openActionPerformer\r\n        }))\r\n        this.extend(eventExtension(this._busFacade, {\r\n            eventName: EVENTS.CLOSE,\r\n            performer: this._closeActionPerformer\r\n        }))\r\n        this.extend(eventExtension(this._busFacade, {\r\n            eventName: EVENTS.WINDOW_CLICK,\r\n            performer: this._windowClickPerformer\r\n        }))\r\n        this.extend(new CuiKeysHandlerExtension(element, this._busFacade, this._keysPerformer))\r\n    }\r\n\r\n    async onHandle(): Promise<boolean> {\r\n        this._interactions.mutate(() => {\r\n            AriaAttributes.setAria(this.element, 'aria-modal', \"\");\r\n        })\r\n\r\n        this.updateSetup();\r\n        return true;\r\n    }\r\n    async onRefresh(): Promise<boolean> {\r\n        this.updateSetup();\r\n        return true;\r\n    }\r\n\r\n    async onRemove(): Promise<boolean> {\r\n        this._busFacade.detachEmittedEvents();\r\n        return true;\r\n    }\r\n\r\n    private updateSetup() {\r\n        this._openActionPerformer.updateSetup({\r\n            timeout: this.args.timeout,\r\n            actions: CuiActionsListFactory.get(this.args.openAct)\r\n        })\r\n        this._closeActionPerformer.updateSetup({\r\n            timeout: this.args.timeout,\r\n            actions: CuiActionsListFactory.get(this.args.closeAct)\r\n        })\r\n        this._keysPerformer.setKeyCombos(getKeyCloseCombos(this._keyComboParser, this.args.escClose, this.args.keyClose))\r\n        this._windowClickPerformer.setEnabled(this.args.outClose);\r\n    }\r\n\r\n    private closeOutside() {\r\n        this._closeActionPerformer.perform(null);\r\n    }\r\n\r\n    onBeforeOpen(): boolean {\r\n        if (this.isAnyActive()) {\r\n            return false;\r\n        }\r\n        this._freezeHelper.getScroll();\r\n        return true;\r\n    }\r\n\r\n    onAfterOpen(): void {\r\n        this._freezeHelper.freeze();\r\n        this.asyncClasses.setClasses(document.body, this._bodyClass)\r\n    }\r\n\r\n    onAfterClose(): void {\r\n        this._freezeHelper.release();\r\n        this.asyncClasses.removeClasses(document.body, this._bodyClass);\r\n    }\r\n\r\n    onBeforeClose(): boolean {\r\n        return true;\r\n    }\r\n\r\n    private isAnyActive(): boolean {\r\n        return this.classes.hasClass(this._bodyClass, document.body);\r\n    }\r\n\r\n}","import { ICuiEventListener } from \"../models/interfaces\";\r\nimport { are } from \"../utils/functions\";\r\n\r\nexport interface CuiHoverEvent {\r\n    isHovering: boolean;\r\n    event: MouseEvent;\r\n    timestamp: number;\r\n}\r\nexport class CuiHoverListener implements ICuiEventListener<CuiHoverEvent> {\r\n    private _target: Element;\r\n    private _callback: ((t: CuiHoverEvent) => void) | undefined;\r\n    private _inProgress: boolean;\r\n    private _isHovering: boolean;\r\n    private _isAttached: boolean;\r\n    private _onOverBound: (ev: MouseEvent) => void;\r\n    private _onMoveBound: (ev: MouseEvent) => void;\r\n    private _onOutBound: (ev: MouseEvent) => void;\r\n\r\n    constructor(target: Element) {\r\n        this._target = target;\r\n        this._inProgress = false;\r\n        this._isHovering = false;\r\n        this._isAttached = false;\r\n        this._callback = undefined;\r\n\r\n        this._onMoveBound = this.onMouseMove.bind(this);\r\n        this._onOutBound = this.onMouseOut.bind(this);\r\n        this._onOverBound = this.onMouseOver.bind(this);\r\n\r\n    }\r\n\r\n    setCallback(callback: (t: CuiHoverEvent) => void): void {\r\n        this._callback = callback;\r\n    }\r\n\r\n    isInProgress(): boolean {\r\n        return this._inProgress;\r\n    }\r\n    attach(): void {\r\n        // @ts-ignore\r\n        this._target.addEventListener(\"mouseover\", this._onOverBound);\r\n        // @ts-ignore\r\n        this._target.addEventListener(\"mousemove\", this._onMoveBound);\r\n        // @ts-ignore\r\n        this._target.addEventListener(\"mouseout\", this._onOutBound);\r\n        this._isAttached = true;\r\n    }\r\n\r\n    detach(): void {\r\n        // @ts-ignore\r\n        this._target.removeEventListener(\"mouseover\", this._onOverBound);\r\n        // @ts-ignore\r\n        this._target.removeEventListener(\"mousemove\", this._onMoveBound);\r\n        // @ts-ignore\r\n        this._target.removeEventListener(\"mouseout\", this._onOutBound);\r\n        this._isAttached = false;\r\n    }\r\n\r\n    private emit(mouseEvent: MouseEvent, force: boolean) {\r\n        if (!are(this._callback)) {\r\n            return;\r\n        }\r\n        if (!force && this._inProgress) {\r\n            return;\r\n        }\r\n        this._inProgress = true;\r\n        window.requestAnimationFrame(this.invoke.bind(this, {\r\n            isHovering: this._isHovering,\r\n            event: mouseEvent,\r\n            timestamp: Date.now()\r\n        }))\r\n    }\r\n\r\n    isAttached() {\r\n        return this._isAttached;\r\n    }\r\n    private invoke(ev: CuiHoverEvent) {\r\n        if (this._callback)\r\n            this._callback(ev);\r\n        this._inProgress = false;\r\n    }\r\n\r\n    private onMouseOver(ev: MouseEvent) {\r\n        this._isHovering = true;\r\n        this.emit(ev, true);\r\n    }\r\n\r\n    private onMouseOut(ev: MouseEvent) {\r\n        this._isHovering = false;\r\n        this.emit(ev, true);\r\n    }\r\n\r\n    private onMouseMove(ev: MouseEvent) {\r\n        this.emit(ev, false);\r\n    }\r\n}","import { CuiPositionError } from \"../models/errors\";\r\nimport { is } from \"../utils/functions\";\r\nimport { ElementBox, ICuiPositionEvaluator } from \"./interfaces\";\r\n\r\nexport class CuiBasePositionEvaluator implements ICuiPositionEvaluator {\r\n    private _box: ElementBox | undefined;\r\n    private _targetWidth: number;\r\n    private _targetHeight: number;\r\n    private _margin: number;\r\n    constructor() {\r\n        this._targetHeight = -1;\r\n        this._targetWidth = -1;\r\n        this._box = undefined;\r\n        this._margin = 0;\r\n    }\r\n\r\n\r\n    setElementBox(box: ElementBox): void {\r\n        this._box = box;\r\n    }\r\n\r\n    setTarget(targetBox: ElementBox): void {\r\n        this._targetWidth = targetBox.width;\r\n        this._targetHeight = targetBox.height;\r\n    }\r\n\r\n    setMargin(value: number) {\r\n        this._margin = value;\r\n    }\r\n\r\n    getVerticalPosition(value: string): number {\r\n        switch (value) {\r\n            case 'top':\r\n                return this.getTopPosition();\r\n            case \"bottom\":\r\n                return this.getBottomPosition();\r\n            case \"middle\":\r\n                return this.getMiddlePosition();\r\n            default:\r\n                return -1;\r\n        }\r\n    }\r\n\r\n    getHorizontalPosition(value: string): number {\r\n        switch (value) {\r\n            case 'left':\r\n                return this.getLeftPosition();\r\n            case \"right\":\r\n                return this.getRightPosition();\r\n            case \"center\":\r\n                return this.getCenterPosition();\r\n            default:\r\n                return -1;\r\n        }\r\n    }\r\n\r\n    getAutoVerticalPosition(initial: string): [number, string] {\r\n        let innerHeight = window.innerHeight;\r\n        let number = this.getVerticalPosition(initial);\r\n\r\n        if ((initial === 'top' || initial === \"middle\") && number < 0) {\r\n            return [this.getVerticalPosition(\"bottom\"), \"bottom\"]\r\n        } else if ((initial === \"bottom\" || initial === \"middle\") && number + this._targetHeight > innerHeight) {\r\n            return [this.getVerticalPosition(\"top\"), \"top\"]\r\n        }\r\n        return [number, initial];\r\n    }\r\n\r\n    getAutoHorizontalPosition(initial: string): [number, string] {\r\n        let innerWidth = window.innerWidth;\r\n        let number = this.getHorizontalPosition(initial);\r\n\r\n        if ((initial === 'right' || initial === \"center\") && number < 0) {\r\n            return [this.getHorizontalPosition(\"left\"), \"left\"]\r\n        } else if ((initial === 'left' || initial === \"center\") && number + this._targetWidth > innerWidth) {\r\n            return [this.getHorizontalPosition(\"right\"), \"right\"]\r\n        }\r\n        return [number, initial];\r\n    }\r\n\r\n    private getTopPosition(): number {\r\n        this.throwIfNotValid(\"getTopPosition\");\r\n        // @ts-ignore - already checked in validate\r\n        return this._box.top - this._margin - this._targetHeight;\r\n    }\r\n\r\n    private getBottomPosition(): number {\r\n        this.throwIfNotValid(\"getBottomPosition\");\r\n        // @ts-ignore - already checked in validate\r\n        return this._box.top + this._box.height + this._margin;\r\n    }\r\n\r\n    private getMiddlePosition(): number {\r\n        this.throwIfNotValid(\"getMiddlePosition\");\r\n        // @ts-ignore - already checked in validate\r\n        return (this._box.top + this._box.height / 2) - this._targetHeight / 2;\r\n    }\r\n\r\n    private getLeftPosition(): number {\r\n        this.throwIfNotValid(\"getLeftPosition\");\r\n        // @ts-ignore - already checked in validate\r\n        return this._box.left;\r\n    }\r\n\r\n    private getRightPosition(): number {\r\n        this.throwIfNotValid(\"getRightPosition\");\r\n        // @ts-ignore - already checked in validate\r\n        return this._box.left + this._box.width - this._targetWidth;\r\n    }\r\n\r\n    private getCenterPosition(): number {\r\n        this.throwIfNotValid(\"getCenterPosition\");\r\n        // @ts-ignore - already checked in validate\r\n        return (this._box.left + this._box.width / 2) - this._targetWidth / 2;\r\n    }\r\n\r\n    private validate(): boolean {\r\n        return is(this._box) && this._targetHeight > 0 && this._targetWidth > 0;\r\n    }\r\n\r\n\r\n\r\n    private throwIfNotValid(method: string): void {\r\n        if (!this.validate()) {\r\n            throw new CuiPositionError(`[${method}] Position cannot be calculated: missing data [width: ${this._targetWidth}][height: ${this._targetHeight}]`)\r\n        }\r\n    }\r\n}","import { CuiDevtoolFactory } from \"../development/factory\";\r\nimport { ICuiDevelopmentTool } from \"../development/interfaces\";\r\nimport { is } from \"../utils/functions\";\r\nimport { CuiBasePositionEvaluator } from \"./evaluator\";\r\nimport { ElementBox, ICuiPositionCalculator, ICuiPositionEvaluator } from \"./interfaces\";\r\n\r\nexport class CuiBasePositionCalculator implements ICuiPositionCalculator {\r\n    private _static: string;\r\n    private _preferred: string;\r\n    private _evaluator: ICuiPositionEvaluator;\r\n    private _log: ICuiDevelopmentTool;\r\n    constructor(evaluator?: ICuiPositionEvaluator) {\r\n        this._preferred = \"top-center\";\r\n        this._static = \"\";\r\n        this._evaluator = evaluator ?? new CuiBasePositionEvaluator();\r\n        this._log = CuiDevtoolFactory.get(\"CuiBasePositionCalculator\");\r\n    }\r\n\r\n    setMargin(value: number): void {\r\n        this._evaluator.setMargin(value);\r\n    }\r\n\r\n    setPreferred(position: string): void {\r\n        this._preferred = position\r\n    }\r\n\r\n    setStatic(position: string): void {\r\n        this._static = position;\r\n    }\r\n\r\n    //targetWidth: number, targetHeight: number\r\n    calculate(elementBox: ElementBox, targetBox: ElementBox): [number, number, string] {\r\n        this._evaluator.setElementBox(elementBox)\r\n        this._evaluator.setTarget(targetBox);\r\n\r\n        if (is(this._static)) {\r\n            this._log.debug(\"Evaluating static position\")\r\n            const [vertical, horizontal] = this.parse(this._static);\r\n            return [this._evaluator.getHorizontalPosition(horizontal), this._evaluator.getVerticalPosition(vertical), this._static];\r\n        }\r\n\r\n        let [vertical, horizontal]: string[] = [\"\", \"\"];\r\n        if (is(this._preferred)) {\r\n            this._log.debug(\"Evaluating auto position\");\r\n            [vertical, horizontal] = this.parse(this._preferred);\r\n        }\r\n        vertical = vertical ?? \"top\";\r\n        horizontal = horizontal ?? \"center\";\r\n        this._log.debug(\"Calculating position: \" + vertical + \"-\" + horizontal)\r\n        const [outVNum, outVPos] = this._evaluator.getAutoVerticalPosition(vertical);\r\n        const [outHNum, outHPos] = this._evaluator.getAutoHorizontalPosition(horizontal);\r\n        this._log.debug(\"Calculated position: \" + outVPos + \"-\" + outHPos)\r\n        return [outHNum, outVNum, outVPos + \"-\" + outHPos];\r\n    }\r\n\r\n    private parse(position: string): string[] {\r\n        return position.split(\"-\");\r\n    }\r\n}","import { are, is } from \"./functions\";\r\n\r\nexport interface ICuiTask {\r\n    start(): void;\r\n    stop(): void;\r\n    getId(): any;\r\n    setCallback(callback: () => void): void;\r\n    setTimeout(timeout: number): void;\r\n}\r\n\r\nexport class CuiTaskRunner implements ICuiTask {\r\n    private _taskId: any;\r\n    private _autoRenew: boolean;\r\n    private _timeout: number;\r\n    private _callback: (() => void) | undefined;\r\n\r\n    constructor(timeout: number, autoRenew: boolean, callback?: () => void) {\r\n        this._autoRenew = autoRenew;\r\n        this._timeout = timeout;\r\n        this._callback = callback;\r\n    }\r\n    start(): void {\r\n        if (!this.canRun()) {\r\n            return;\r\n        }\r\n        this.stop();\r\n        this._taskId = setTimeout(() => {\r\n            //@ts-ignore - already checked in canRun\r\n            this._callback();\r\n            this._taskId = null;\r\n            if (this._autoRenew) {\r\n                this.start();\r\n            }\r\n        }, this._timeout);\r\n    }\r\n\r\n    stop(): void {\r\n        if (this._taskId) {\r\n            clearTimeout(this._taskId);\r\n            this._taskId = null\r\n        }\r\n    }\r\n\r\n    getId() {\r\n        return this._taskId;\r\n    }\r\n\r\n    private canRun(): boolean {\r\n        return is(this._callback) && this._timeout > 0;\r\n    }\r\n\r\n    setCallback(callback: () => void) {\r\n        this._callback = callback;\r\n    }\r\n\r\n    setTimeout(timeout: number) {\r\n        this._timeout = timeout;\r\n    }\r\n\r\n}","import { ICuiHandlerExtension } from \"src/core/handlers/extensions/interfaces\";\r\nimport { CuiHoverEvent, CuiHoverListener } from \"../../../core/listeners/hover\";\r\nimport { ICuiExtensionPerformer } from \"../interfaces\";\r\n\r\nexport interface ICuiHoverExtensionSetup<T extends CuiHoverEvent> {\r\n    element: HTMLElement,\r\n    type?: string;\r\n    performer: ICuiExtensionPerformer<T>;\r\n}\r\n\r\nexport class CuiHoverModule implements ICuiHandlerExtension<any> {\r\n    type: string;\r\n    description: string;\r\n\r\n    private _hoverListener: CuiHoverListener;\r\n    private _onHover: (ev: CuiHoverEvent) => void;\r\n\r\n    constructor(element: HTMLElement, onHover: (ev: CuiHoverEvent) => void) {\r\n        this.type = 'hover';\r\n        this.description = \"\";\r\n        this._onHover = onHover;\r\n        this._hoverListener = new CuiHoverListener(element);\r\n        this._hoverListener.setCallback(this.onHover.bind(this));\r\n    }\r\n\r\n    async init(args: any): Promise<boolean> {\r\n        this._hoverListener.attach();\r\n        return true;\r\n    }\r\n\r\n    async destroy(): Promise<boolean> {\r\n        this._hoverListener.detach();\r\n        return true;\r\n    }\r\n\r\n    private onHover(ev: CuiHoverEvent) {\r\n        this._onHover(ev);\r\n    }\r\n}\r\n\r\n\r\nexport function hoverExtension<T extends CuiHoverEvent>(setup: ICuiHoverExtensionSetup<T>): ICuiHandlerExtension<any> {\r\n    const _hoverListener = new CuiHoverListener(setup.element);\r\n\r\n    function onHover(arg: T) {\r\n        setup.performer.perform(arg);\r\n    }\r\n    return {\r\n        type: setup.type ?? 'hover',\r\n        init: async () => {\r\n            //@ts-ignore\r\n            _hoverListener.setCallback(onHover);\r\n            _hoverListener.attach();\r\n            return true;\r\n        },\r\n        destroy: async () => {\r\n            _hoverListener.detach();\r\n            return true;\r\n        }\r\n    }\r\n}","import {\r\n\tICuiComponent,\r\n\tICuiOpenable,\r\n\tICuiClosable,\r\n\tCuiElement,\r\n} from \"../../core/models/interfaces\";\r\nimport { CuiCore } from \"../../core/models/core\";\r\nimport { CuiHandlerBase } from \"../../core/handlers/base\";\r\nimport {\r\n\tis,\r\n\tjoinWithScopeSelector,\r\n\treplacePrefix,\r\n} from \"../../core/utils/functions\";\r\nimport { EVENTS } from \"../../core/utils/statics\";\r\nimport { AriaAttributes } from \"../../core/utils/aria\";\r\nimport { CuiHoverListener, CuiHoverEvent } from \"../../core/listeners/hover\";\r\nimport { ICuiPositionCalculator } from \"../../core/position/interfaces\";\r\nimport { CuiBasePositionCalculator } from \"../../core/position/calculator\";\r\nimport { CuiTaskRunner, ICuiTask } from \"../../core/utils/task\";\r\nimport {\r\n\tICuiComponentAction,\r\n\tCuiActionsListFactory,\r\n} from \"../../core/utils/actions\";\r\nimport { CuiAutoParseArgs } from \"../../core/utils/arguments\";\r\nimport { CuiHoverModule } from \"../extensions/hover/hover\";\r\nimport { CuiComponentBaseHook } from \"../base\";\r\nimport {\r\n\tgetAdvancedCuiWindowClickPerformer,\r\n\tICuiWindowClickPerformer,\r\n} from \"../extensions/window/performer\";\r\nimport { eventExtension } from \"../extensions/event/event\";\r\nimport {\r\n\tgetEventBusFacade,\r\n\tgetCuiHandlerInteractions,\r\n\tICuiEventBusFacade,\r\n\tICuiInteractionsFacade,\r\n} from \"../../core/handlers/extensions/facades\";\r\nimport { callbackPerformer } from \"../extensions/performers\";\r\n\r\nconst bodyClass = \"{prefix}-drop-open\";\r\nconst DROP_POSITION = \"{prefix}-drop-position-\";\r\nconst DROP_TRIGGER = \"{prefix}-drop-trigger\";\r\nconst DROP_DEFAULT_TRIGGER = \"> a, button\";\r\nconst DROP_DEFAULT_ANIMATION_CLS = \"{prefix}-drop-animation-in\";\r\n\r\nexport interface CuiDropEvent {\r\n\ttimestamp: number;\r\n}\r\n\r\nexport class CuiDropArgs extends CuiAutoParseArgs {\r\n\tmode: \"click\" | \"hover\";\r\n\ttrigger: string;\r\n\tprevent: boolean;\r\n\tautoClose: boolean;\r\n\toutClose: boolean;\r\n\tpos: string;\r\n\taction: string;\r\n\ttimeout: number;\r\n\tmargin: number;\r\n\r\n\tconstructor(prefix: string) {\r\n\t\tsuper({\r\n\t\t\tprops: {\r\n\t\t\t\ttrigger: { corrector: joinWithScopeSelector },\r\n\t\t\t},\r\n\t\t});\r\n\t\tthis.mode = \"click\";\r\n\t\tthis.trigger = joinWithScopeSelector(DROP_DEFAULT_TRIGGER);\r\n\t\tthis.autoClose = false;\r\n\t\tthis.outClose = true;\r\n\t\tthis.prevent = false;\r\n\t\tthis.pos = \"\";\r\n\t\tthis.action = replacePrefix(DROP_DEFAULT_ANIMATION_CLS, prefix);\r\n\t\tthis.timeout = 3000;\r\n\t\tthis.margin = 8;\r\n\t}\r\n}\r\n\r\nexport function CuiDropComponent(prefix?: string): ICuiComponent {\r\n\treturn CuiComponentBaseHook({\r\n\t\tprefix: prefix,\r\n\t\tname: \"drop\",\r\n\t\tcreate: (\r\n\t\t\telement: HTMLElement,\r\n\t\t\tutils: CuiCore,\r\n\t\t\tprefix: string,\r\n\t\t\tattribute: string\r\n\t\t) => {\r\n\t\t\treturn new CuiDropHandler(element, utils, attribute, prefix);\r\n\t\t},\r\n\t});\r\n}\r\n\r\nexport class CuiDropHandler\r\n\textends CuiHandlerBase<CuiDropArgs>\r\n\timplements ICuiOpenable, ICuiClosable\r\n{\r\n\tprivate _prefix: string;\r\n\tprivate _bodyClass: string;\r\n\tprivate _triggerHoverListener: CuiHoverListener | undefined;\r\n\tprivate _trigger: Element;\r\n\tprivate _positionCalculator: ICuiPositionCalculator;\r\n\tprivate _posClass: string;\r\n\tprivate _autoTask: ICuiTask;\r\n\tprivate _actions: ICuiComponentAction[];\r\n\r\n\tprivate _busFacade: ICuiEventBusFacade;\r\n\tprivate _interactions: ICuiInteractionsFacade;\r\n\tprivate _windowClickPerformer: ICuiWindowClickPerformer;\r\n\tconstructor(\r\n\t\telement: HTMLElement,\r\n\t\tutils: CuiCore,\r\n\t\tattribute: string,\r\n\t\tprefix: string\r\n\t) {\r\n\t\tsuper(\r\n\t\t\t\"CuiDropHandler\",\r\n\t\t\telement,\r\n\t\t\tattribute,\r\n\t\t\tnew CuiDropArgs(prefix),\r\n\t\t\tutils\r\n\t\t);\r\n\t\tthis._prefix = prefix;\r\n\t\tthis._bodyClass = replacePrefix(bodyClass, prefix);\r\n\t\tthis.onTriggerClick = this.onTriggerClick.bind(this);\r\n\t\tthis._positionCalculator = new CuiBasePositionCalculator();\r\n\t\tthis._positionCalculator.setMargin(8);\r\n\t\tthis._positionCalculator.setPreferred(\"bottom-left\");\r\n\t\tthis._posClass = \"\";\r\n\t\tthis._triggerHoverListener = undefined;\r\n\t\tthis._trigger = this.element;\r\n\t\tthis._actions = [];\r\n\t\tthis._autoTask = new CuiTaskRunner(\r\n\t\t\tthis.args.timeout,\r\n\t\t\tfalse,\r\n\t\t\tthis.close.bind(this)\r\n\t\t);\r\n\t\tthis._windowClickPerformer = getAdvancedCuiWindowClickPerformer(\r\n\t\t\tthis.close.bind(this),\r\n\t\t\telement\r\n\t\t);\r\n\t\tthis._busFacade = getEventBusFacade(this.cuid, utils.bus, element);\r\n\t\tthis._interactions = getCuiHandlerInteractions(utils.interactions);\r\n\r\n\t\tif (!utils.isPlugin(\"click-plugin\")) {\r\n\t\t\tthis.logWarning(\r\n\t\t\t\t\"Window click plugin is not available: outClose will not work\"\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tthis.extend(\r\n\t\t\tnew CuiHoverModule(this.element, this.onElementHover.bind(this))\r\n\t\t);\r\n\t\tthis.extend(\r\n\t\t\teventExtension(this._busFacade, {\r\n\t\t\t\teventName: EVENTS.WINDOW_CLICK,\r\n\t\t\t\tperformer: this._windowClickPerformer,\r\n\t\t\t})\r\n\t\t);\r\n\t\tthis.extend(\r\n\t\t\teventExtension(this._busFacade, {\r\n\t\t\t\teventName: EVENTS.OPEN,\r\n\t\t\t\tperformer: callbackPerformer(this.open.bind(this)),\r\n\t\t\t})\r\n\t\t);\r\n\t\tthis.extend(\r\n\t\t\teventExtension(this._busFacade, {\r\n\t\t\t\teventName: EVENTS.CLOSE,\r\n\t\t\t\tperformer: callbackPerformer(this.close.bind(this)),\r\n\t\t\t})\r\n\t\t);\r\n\t}\r\n\r\n\tasync onHandle(): Promise<boolean> {\r\n\t\tthis._trigger = this.acquireTrigger();\r\n\t\tthis._triggerHoverListener = new CuiHoverListener(this._trigger);\r\n\t\tthis._triggerHoverListener.setCallback(this.onHoverEvent.bind(this));\r\n\t\tthis._triggerHoverListener.attach();\r\n\t\t//@ts-ignore\r\n\t\tthis._trigger.addEventListener(\"click\", this.onTriggerClick);\r\n\t\t// this.setTriggerEvent();\r\n\r\n\t\tthis.setDataFromArgs();\r\n\r\n\t\tthis._interactions.mutate(() => {\r\n\t\t\tAriaAttributes.setAria(this.element, \"aria-dropdown\", \"\");\r\n\t\t});\r\n\r\n\t\treturn true;\r\n\t}\r\n\r\n\tasync onRefresh(): Promise<boolean> {\r\n\t\tif (this.prevArgs && this.args.trigger !== this.prevArgs.trigger) {\r\n\t\t\tif (\r\n\t\t\t\tthis._triggerHoverListener &&\r\n\t\t\t\tthis._triggerHoverListener.isAttached()\r\n\t\t\t) {\r\n\t\t\t\tthis._triggerHoverListener.detach();\r\n\t\t\t} else if (this.prevArgs && this.prevArgs.mode === \"click\") {\r\n\t\t\t\t//@ts-ignore\r\n\t\t\t\tthis._trigger.removeEventListener(\"click\", this.onTriggerClick);\r\n\t\t\t}\r\n\t\t\tthis._trigger = this.acquireTrigger();\r\n\t\t\tthis._triggerHoverListener = new CuiHoverListener(this._trigger);\r\n\t\t\tthis._triggerHoverListener.setCallback(\r\n\t\t\t\tthis.onHoverEvent.bind(this)\r\n\t\t\t);\r\n\t\t\tthis._triggerHoverListener.attach();\r\n\t\t\t//@ts-ignore\r\n\t\t\tthis._trigger.addEventListener(\"click\", this.onTriggerClick);\r\n\t\t}\r\n\r\n\t\tthis.setDataFromArgs();\r\n\t\treturn true;\r\n\t}\r\n\tasync onRemove(): Promise<boolean> {\r\n\t\tthis._busFacade.detachEmittedEvents();\r\n\t\treturn true;\r\n\t}\r\n\r\n\tprivate setDataFromArgs() {\r\n\t\tthis._positionCalculator.setStatic(this.args.pos);\r\n\t\tthis._positionCalculator.setMargin(this.args.margin);\r\n\t\tthis._autoTask.setTimeout(this.args.timeout);\r\n\t\tthis._actions = CuiActionsListFactory.get(this.args.action);\r\n\t\tthis._windowClickPerformer.setEnabled(this.args.outClose);\r\n\t}\r\n\t/**\r\n\t * Api Method open\r\n\t */\r\n\tasync open(): Promise<boolean> {\r\n\t\tif (this.isActive()) {\r\n\t\t\treturn this.close();\r\n\t\t}\r\n\t\tif (this.isAnyActive()) {\r\n\t\t\tawait this.findAndCloseOpenedDrop();\r\n\t\t}\r\n\r\n\t\tif (!this.lock(\"open\")) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tthis.log.debug(`Drop ${this.cuid}`, \"open\");\r\n\t\tthis.onOpen();\r\n\r\n\t\treturn true;\r\n\t}\r\n\r\n\t/**\r\n\t * Api Method close\r\n\t */\r\n\tasync close(): Promise<boolean> {\r\n\t\tif (!this.isActive()) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tif (!this.lock(\"close\")) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tthis.logInfo(`Drop ${this.cuid}`, \"close\");\r\n\t\tthis.onClose();\r\n\t\tthis._busFacade.emit(EVENTS.CLOSED, {\r\n\t\t\ttimestamp: Date.now(),\r\n\t\t});\r\n\t\treturn true;\r\n\t}\r\n\r\n\t/**\r\n\t * Set of actions performed during drop open\r\n\t */\r\n\tonOpen() {\r\n\t\tthis.classes.setClass(this.activeClassName, this.element);\r\n\t\tthis._interactions.mutate(() => {\r\n\t\t\tconst box = this._trigger.getBoundingClientRect();\r\n\t\t\ttry {\r\n\t\t\t\tconst [x, y, pos] = this._positionCalculator.calculate(\r\n\t\t\t\t\tbox,\r\n\t\t\t\t\tthis.element.getBoundingClientRect()\r\n\t\t\t\t);\r\n\t\t\t\tthis.element.style.top = `${y - box.top}px`;\r\n\t\t\t\tthis.element.style.left = `${x - box.left}px`;\r\n\t\t\t\tthis._posClass = replacePrefix(\r\n\t\t\t\t\tDROP_POSITION + pos,\r\n\t\t\t\t\tthis._prefix\r\n\t\t\t\t);\r\n\t\t\t\tthis.toggleActions();\r\n\t\t\t\tthis.classes.setClass(this._posClass, this.element);\r\n\t\t\t\tthis.classes.setClass(this._bodyClass, document.body);\r\n\t\t\t\tAriaAttributes.setAria(this.element, \"aria-expanded\", \"true\");\r\n\t\t\t} catch (e) {\r\n\t\t\t\tthis.log.exception(e);\r\n\t\t\t} finally {\r\n\t\t\t\tthis.unlock();\r\n\t\t\t\tthis._busFacade.emit(EVENTS.OPENED, {\r\n\t\t\t\t\ttimestamp: Date.now(),\r\n\t\t\t\t});\r\n\t\t\t\tthis.runAutoCloseTask();\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Set of actions performed during drop close\r\n\t */\r\n\tonClose() {\r\n\t\tthis._interactions.mutate(() => {\r\n\t\t\tthis.classes.removeClass(this.activeClassName, this.element);\r\n\t\t\tthis.classes.removeClass(this._bodyClass, document.body);\r\n\t\t\tthis.toggleActions();\r\n\t\t\tthis.classes.removeClass(this._posClass, this.element);\r\n\t\t\tAriaAttributes.setAria(this.element, \"aria-expanded\", \"false\");\r\n\t\t\tthis.unlock();\r\n\t\t});\r\n\t}\r\n\r\n\tprivate isAnyActive(): boolean {\r\n\t\treturn this.classes.hasClass(this._bodyClass, document.body);\r\n\t}\r\n\r\n\t/**\r\n\t * Finds and opens other active drop element\r\n\t */\r\n\tasync findAndCloseOpenedDrop(): Promise<boolean> {\r\n\t\tconst opened = document.querySelector(\r\n\t\t\t`[${this.attribute}].${this.activeClassName}`\r\n\t\t);\r\n\t\tif (!is(opened)) {\r\n\t\t\tthis.log.warning(\"Opened drop was not found\");\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\t//@ts-ignore opened checked\r\n\t\tconst handler = (<CuiElement>(opened as any)).$handlers[\r\n\t\t\tthis.attribute\r\n\t\t] as any;\r\n\t\tif (!is(handler)) {\r\n\t\t\tthis.log.warning(\"Drop handler was not found in the element\");\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\treturn handler.close();\r\n\t}\r\n\r\n\t/**\r\n\t * Invoked when trigger button is clicked\r\n\t * @param ev\r\n\t */\r\n\tprivate onTriggerClick(ev: MouseEvent) {\r\n\t\tif (this.args.mode !== \"click\") {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (this.isActive()) {\r\n\t\t\tthis.close();\r\n\t\t} else {\r\n\t\t\tthis.open();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Invoked when trigger button is hovered on\r\n\t * @param ev\r\n\t */\r\n\tprivate onHoverEvent(ev: CuiHoverEvent) {\r\n\t\tif (this.args.mode !== \"hover\") {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (ev.isHovering && !this.isActive()) {\r\n\t\t\tthis.open();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Method triggered when opened element is hovered on\r\n\t * @param ev\r\n\t */\r\n\tprivate onElementHover(ev: CuiHoverEvent) {\r\n\t\tif (ev.isHovering) {\r\n\t\t\tthis._autoTask.stop();\r\n\t\t} else if (!ev.isHovering && this.args.autoClose) {\r\n\t\t\tthis.runAutoCloseTask();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Runs auto-close task on opened element\r\n\t */\r\n\tprivate runAutoCloseTask() {\r\n\t\tif (!this.args.autoClose) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis._autoTask.start();\r\n\t}\r\n\r\n\tprivate toggleActions() {\r\n\t\tthis._actions.forEach((action) => {\r\n\t\t\taction.toggle(this.element);\r\n\t\t});\r\n\t}\r\n\r\n\tprivate acquireTrigger(): Element {\r\n\t\tlet ret = null;\r\n\t\tif (!this.element.parentElement) {\r\n\t\t\tret = document.querySelector(this.args.trigger);\r\n\t\t} else\r\n\t\t\tret = this.element.parentElement.querySelector(this.args.trigger);\r\n\t\treturn ret ?? this.element;\r\n\t}\r\n}\r\n","import { ICuiInteractionsFacade, ICuiStyleHelper } from \"src/core/handlers/extensions/facades\";\r\nimport { ICuiMoveData } from \"src/core/listeners/move\";\r\n\r\nexport interface ICuiFloatActionCalculator {\r\n    calculate(x: number, y: number, diffX: number, diffY: number): [number, number];\r\n}\r\n\r\n\r\nexport interface ICuiFloatSwipingAction {\r\n    init: (ev: ICuiMoveData) => void;\r\n    move: (x: number, y: number, diffX: number, diffY: number) => void;\r\n}\r\n\r\ninterface ICuiFloatActionCallbacks {\r\n    [id: string]: (interactions: ICuiInteractionsFacade, styles: ICuiStyleHelper) => ((x: number, y: number, element: HTMLElement) => void);\r\n}\r\n\r\nexport class BasePositionCalculator implements ICuiFloatActionCalculator {\r\n\r\n    calculate(x: number, y: number, diffX: number, diffY: number): [number, number] {\r\n        return [x, y];\r\n    }\r\n\r\n}\r\n\r\nexport class OptionalPositionCalculator implements ICuiFloatActionCalculator {\r\n    #element: HTMLElement;\r\n    constructor(element: HTMLElement) {\r\n        this.#element = element;\r\n    }\r\n    calculate(x: number, y: number, diffX: number, diffY: number): [number, number] {\r\n        let newX = this.#element.offsetLeft + diffX;\r\n        let newY = this.#element.offsetTop + diffY;\r\n        return [newX, newY];\r\n    }\r\n\r\n}\r\n\r\nexport class BaseResizeCalculator implements ICuiFloatActionCalculator {\r\n    #element: HTMLElement;\r\n    constructor(element: HTMLElement) {\r\n        this.#element = element;\r\n    }\r\n    calculate(x: number, y: number, diffX: number, diffY: number): [number, number] {\r\n        let width = x - this.#element.offsetLeft;\r\n        let height = y - this.#element.offsetTop;\r\n        return [width, height];\r\n    }\r\n}\r\n\r\nexport class OptionalResizeCalculator implements ICuiFloatActionCalculator {\r\n    #element: HTMLElement;\r\n    constructor(element: HTMLElement) {\r\n        this.#element = element;\r\n    }\r\n    calculate(x: number, y: number, diffX: number, diffY: number): [number, number] {\r\n        let width = this.#element.offsetWidth + diffX;\r\n        let height = this.#element.offsetHeight + diffY;\r\n        return [width, height];\r\n    }\r\n}\r\n\r\n\r\nexport function getMoveAction(type: string, calculator: ICuiFloatActionCalculator, element: HTMLElement, interactions: ICuiInteractionsFacade, styles: ICuiStyleHelper): ICuiFloatSwipingAction | undefined {\r\n    const callback = floatCallbacks[type];\r\n    if (!callback) {\r\n        return undefined;\r\n    }\r\n    return floatActionBase(calculator, element, callback(interactions, styles))\r\n\r\n}\r\n\r\nfunction fitsWindow(top: number, left: number, width: number, height: number) {\r\n    return (top + height < window.innerHeight - 10) &&\r\n        (top > 10) && (left > 10) &&\r\n        (left + width < window.innerWidth - 10);\r\n}\r\n\r\nconst floatCallbacks: ICuiFloatActionCallbacks = {\r\n    'resize': onResizeSwipe,\r\n    'move': onMoveSwipe\r\n}\r\n\r\nfunction floatActionBase(calculator: ICuiFloatActionCalculator, element: HTMLElement, onMove: (x: number, y: number, element: HTMLElement) => void): ICuiFloatSwipingAction {\r\n    return {\r\n        init: (ev: ICuiMoveData) => {\r\n            ev.event.preventDefault();\r\n        },\r\n        move: (x: number, y: number, diffX: number, diffY: number) => {\r\n            const [newX, newY] = calculator.calculate(x, y, diffX, diffY)\r\n            if (fitsWindow(newY, newX, element.offsetWidth, element.offsetHeight)) {\r\n                onMove(newX, newY, element);\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n\r\n\r\nfunction onResizeSwipe(interactions: ICuiInteractionsFacade, styles: ICuiStyleHelper) {\r\n    return (x: number, y: number, element: HTMLElement) => {\r\n        interactions.mutate(() => {\r\n            styles.setStyle('width', x + \"px\", element);\r\n            styles.setStyle('height', y + \"px\", element);\r\n        })\r\n    }\r\n}\r\n\r\nfunction onMoveSwipe(_interactions: ICuiInteractionsFacade, styles: ICuiStyleHelper) {\r\n    return (x: number, y: number, element: HTMLElement) => {\r\n        _interactions.mutate(() => {\r\n            styles.setStyle('left', x + \"px\", element);\r\n            styles.setStyle('top', y + \"px\", element);\r\n        })\r\n    }\r\n}","import { ICuiHandlerExtension } from \"src/core/handlers/extensions/interfaces\";\r\nimport { ICuiEventListener } from \"src/core/models/interfaces\";\r\n\r\nexport interface ICuiListenerExtensionSetup<T> {\r\n    listener: ICuiEventListener<T>;\r\n    type: string;\r\n}\r\n\r\n\r\nexport function listenerExtension<T>(setup: ICuiListenerExtensionSetup<T>): ICuiHandlerExtension<any> {\r\n    return {\r\n        type: setup.type,\r\n        init: async () => {\r\n            if (!setup.listener.isAttached())\r\n                setup.listener.attach();\r\n\r\n            return true;\r\n        },\r\n        destroy: async () => {\r\n            if (setup.listener.isAttached())\r\n                setup.listener.detach();\r\n            return true;\r\n        }\r\n    }\r\n}","import { ICuiHandlerExtension } from \"../../../core/handlers/extensions/interfaces\";\r\nimport { CuiMoveEventListener, ICuiMoveData } from \"../../../core/listeners/move\";\r\nimport { ICuiExtensionPerformer } from \"../interfaces\";\r\nimport { listenerExtension } from \"../listener/listener\";\r\n\r\nexport interface ICuiMoveExtensionSetup {\r\n    root?: HTMLElement;\r\n    target?: HTMLElement;\r\n    preventDefault?: boolean;\r\n    performer: ICuiExtensionPerformer<ICuiMoveData>;\r\n}\r\n\r\nexport function moveExtension(setup: ICuiMoveExtensionSetup): ICuiHandlerExtension<any> {\r\n    const listener = new CuiMoveEventListener(setup.root);\r\n    listener.setTarget(setup.target)\r\n    listener.preventDefault(setup.preventDefault === true);\r\n    listener.setCallback((ev: ICuiMoveData) => {\r\n        setup.performer.perform(ev);\r\n    })\r\n\r\n    return listenerExtension({\r\n        type: \"move\",\r\n        listener: listener\r\n    })\r\n}","import { ICuiComponent, ICuiKeysCombo } from \"../../core/models/interfaces\";\r\nimport { CuiCore } from \"../../core/models/core\";\r\nimport { replacePrefix } from \"../../core/utils/functions\";\r\nimport { AriaAttributes } from \"../../core/utils/aria\";\r\nimport { CuiHandlerBase } from \"../../core/handlers/base\";\r\nimport { ICuiMoveData } from \"../../core/listeners/move\";\r\nimport { BasePositionCalculator, BaseResizeCalculator, getMoveAction, ICuiFloatActionCalculator, ICuiFloatSwipingAction } from \"./helpers\";\r\nimport { CLASSES, EVENTS } from \"../../core/utils/statics\";\r\nimport { CuiAutoParseArgs } from \"../../core/utils/arguments\";\r\nimport { moveExtension } from \"../extensions/move/move\";\r\nimport { ICuiMoveExtensionPerformer, moveExtensionPerformer } from \"../extensions/move/performer\";\r\nimport { eventExtension } from \"../extensions/event/event\";\r\nimport { getEventBusFacade, CuiStyleHelper, getCuiHandlerInteractions, ICuiEventBusFacade, ICuiInteractionsFacade, ICuiStyleHelper } from \"../../core/handlers/extensions/facades\";\r\nimport { closeActionsPerformer, ICuiActionExtensionPerformer, openActionsPerformer } from \"../extensions/performers\";\r\nimport { getActionsHelper } from \"../../core/helpers/helpers\";\r\nimport { CuiKeysHandlerExtension } from \"../extensions/keys/keys\";\r\nimport { getCuiKeyActionPerformer, ICuiKeyActionPerformer } from \"../extensions/keys/performer\";\r\nimport { CuiActionsListFactory } from \"../../core/utils/actions\";\r\nimport { getKeyCloseCombos } from \"../extensions/helpers/helpers\";\r\nimport { getCuiKeysComboParser } from \"../../core/utils/parsers/keys\";\r\nimport { ICuiParser } from \"../../core/utils/parsers/interfaces\";\r\nimport { CuiComponentBaseHook } from \"../base\";\r\n\r\nconst FLOAT_OPEN_ANIMATION_CLASS = '.{prefix}-float-default-in';\r\nconst FLOAT_CLOSE_ANIMATION_CLASS = '.{prefix}-float-default-out';\r\nconst MOVE = '.{prefix}-float-move';\r\nconst RESIZE = '.{prefix}-float-resize';\r\n\r\n\r\nexport class CuiFloatArgs extends CuiAutoParseArgs {\r\n    escClose: boolean;\r\n    timeout: number;\r\n    openAct: string;\r\n    closeAct: string;\r\n    keyClose: string;\r\n\r\n    constructor(prefix: string, defTimeout?: number) {\r\n        super();\r\n        this.escClose = false;\r\n        this.keyClose = \"\";\r\n        this.openAct = replacePrefix(FLOAT_OPEN_ANIMATION_CLASS, prefix);\r\n        this.closeAct = replacePrefix(FLOAT_CLOSE_ANIMATION_CLASS, prefix);\r\n        this.timeout = defTimeout ?? 300;\r\n    }\r\n}\r\n\r\nexport function CuiFloatComponent(prefix?: string): ICuiComponent {\r\n    return CuiComponentBaseHook({\r\n        prefix: prefix,\r\n        name: \"float\",\r\n        create: (element: HTMLElement, utils: CuiCore, prefix: string, attribute: string) => {\r\n            return new CuiFloatHandler(element, utils, attribute, prefix);\r\n        }\r\n    })\r\n}\r\n\r\nexport class CuiFloatHandler extends CuiHandlerBase<CuiFloatArgs> {\r\n\r\n    _prevX: number;\r\n    _prevY: number;\r\n    _prefix: string;\r\n    _positionCalculator: ICuiFloatActionCalculator;\r\n    _resizeCalculator: ICuiFloatActionCalculator;\r\n    _resizeBtn: HTMLElement | null;\r\n    _moveBtn: HTMLElement | null;\r\n\r\n    _movePerformer: ICuiMoveExtensionPerformer;\r\n    _busFacade: ICuiEventBusFacade;\r\n    _openActionPerformer: ICuiActionExtensionPerformer<any>;\r\n    _closeActionPerformer: ICuiActionExtensionPerformer<any>;\r\n    _keysPerformer: ICuiKeyActionPerformer;\r\n    _currentAction: ICuiFloatSwipingAction | undefined;\r\n    _interactions: ICuiInteractionsFacade;\r\n    _styles: ICuiStyleHelper;\r\n    _keyComboParser: ICuiParser<string, ICuiKeysCombo>;\r\n\r\n    constructor(element: HTMLElement, utils: CuiCore, attribute: string, prefix: string) {\r\n        super(\"CuiFloatHandler\", element, attribute, new CuiFloatArgs(prefix, utils.setup.animationTime), utils);\r\n        this._prevX = 0;\r\n        this._prevY = 0;\r\n        this._positionCalculator = new BasePositionCalculator();\r\n        this._resizeCalculator = new BaseResizeCalculator(element as HTMLElement)\r\n        this._prefix = prefix;\r\n        this._moveBtn = null;\r\n        this._resizeBtn = null;\r\n        this._currentAction = undefined;\r\n        this._interactions = getCuiHandlerInteractions(utils.interactions);\r\n        this._styles = new CuiStyleHelper();\r\n        this._busFacade = getEventBusFacade(this.getId(), utils.bus, element);\r\n        this._keysPerformer = getCuiKeyActionPerformer(this.onCloseAction.bind(this));\r\n        this._keyComboParser = getCuiKeysComboParser();\r\n        this._movePerformer = moveExtensionPerformer({\r\n            onDown: this.onMouseDown.bind(this),\r\n            onMove: this.onMouseMove.bind(this),\r\n            onUp: this.onMouseUp.bind(this),\r\n        })\r\n        this._movePerformer.setEnabled(false);\r\n\r\n        const actionsHelper = getActionsHelper(utils.interactions);\r\n        this._openActionPerformer = openActionsPerformer(actionsHelper, this._busFacade, {\r\n            isActive: this.isActive.bind(this),\r\n            onFinish: () => {\r\n                this._movePerformer.setEnabled(true);\r\n            }\r\n        }, {\r\n            active: this.activeAction,\r\n            element: element\r\n        })\r\n\r\n        this._closeActionPerformer = closeActionsPerformer(actionsHelper, this._busFacade, {\r\n            isActive: this.isActive.bind(this),\r\n            onFinish: () => {\r\n                this._movePerformer.setEnabled(false);\r\n            }\r\n        }, {\r\n            active: this.activeAction,\r\n            element: element\r\n        })\r\n\r\n        if (!utils.isPlugin(\"keys-plugin\")) {\r\n            this.logWarning(\"KeyObserver plugin is not available, escClose and keyClose will not work\")\r\n        }\r\n\r\n        this.extend(moveExtension({\r\n            performer: this._movePerformer\r\n        }))\r\n\r\n        this.extend(eventExtension(this._busFacade, {\r\n            eventName: EVENTS.OPEN,\r\n            performer: this._openActionPerformer,\r\n        }));\r\n\r\n        this.extend(eventExtension(this._busFacade, {\r\n            eventName: EVENTS.CLOSE,\r\n            performer: this._closeActionPerformer,\r\n        }))\r\n\r\n        this.extend(new CuiKeysHandlerExtension(element, this._busFacade, this._keysPerformer))\r\n    }\r\n\r\n    async onHandle(): Promise<boolean> {\r\n        AriaAttributes.setAria(this.element, 'aria-modal', \"\");\r\n        this._moveBtn = this.element.querySelector(replacePrefix(MOVE, this._prefix))\r\n        this._resizeBtn = this.element.querySelector(replacePrefix(RESIZE, this._prefix))\r\n        this.updateSetups();\r\n        return true;\r\n    }\r\n\r\n    async onRefresh(): Promise<boolean> {\r\n        this.updateSetups();\r\n        return true;\r\n    }\r\n\r\n    async onRemove(): Promise<boolean> {\r\n        this._busFacade.detachEmittedEvents();\r\n        return true;\r\n    }\r\n\r\n    updateSetups() {\r\n        this._closeActionPerformer.updateSetup({\r\n            timeout: this.args.timeout,\r\n            actions: CuiActionsListFactory.get(this.args.closeAct)\r\n        })\r\n        this._openActionPerformer.updateSetup({\r\n            timeout: this.args.timeout,\r\n            actions: CuiActionsListFactory.get(this.args.openAct)\r\n        })\r\n        this._keysPerformer.setKeyCombos(getKeyCloseCombos(this._keyComboParser, this.args.escClose, this.args.keyClose))\r\n    }\r\n\r\n    private onMouseDown(ev: ICuiMoveData) {\r\n        let type: string = \"\";\r\n        let calculator = undefined;\r\n        if (ev.target === this._moveBtn) {\r\n            type = 'move';\r\n            calculator = this._positionCalculator;\r\n        } else if (ev.target === this._resizeBtn) {\r\n            type = \"resize\"\r\n            calculator = this._resizeCalculator;\r\n        } else {\r\n            return\r\n        }\r\n        this._currentAction = getMoveAction(type, calculator, this.element, this._interactions, this._styles)\r\n        if (this._currentAction) {\r\n            this._currentAction.init(ev);\r\n        }\r\n        this._prevX = ev.x;\r\n        this._prevY = ev.y;\r\n        this.asyncClasses.setClasses(document.body, CLASSES.swipingOn);\r\n        // Lock global move handler\r\n        this.core.bus.emit(EVENTS.MOVE_LOCK, null, true);\r\n    }\r\n\r\n    private onMouseMove(ev: ICuiMoveData) {\r\n\r\n        if (this._currentAction) {\r\n            this._currentAction.move(ev.x, ev.y, (ev.x - this._prevX), (ev.y - this._prevY));\r\n        }\r\n\r\n        this._prevX = ev.x;\r\n        this._prevY = ev.y;\r\n        ev.event.preventDefault();\r\n    }\r\n\r\n\r\n    private onMouseUp(ev: ICuiMoveData) {\r\n\r\n        this._currentAction = undefined;\r\n        this.asyncClasses.removeClasses(document.body, CLASSES.swipingOn);\r\n        // Unlock global handler\r\n        this.core.bus.emit(EVENTS.MOVE_LOCK, null, false);\r\n    }\r\n\r\n    private onCloseAction() {\r\n        this._closeActionPerformer.perform(\"keys\");\r\n    }\r\n}","import { CuiCore } from \"../../core/models/core\";\r\nimport { CuiHandlerBase } from \"../../core/handlers/base\";\r\nimport { ICONS } from \"../../core/utils/statics\";\r\nimport { is } from \"../../core/utils/functions\";\r\nimport { IconBuilder } from \"../../core/builders/icon\";\r\nimport { CuiAutoParseArgs } from \"../../core/utils/arguments\";\r\nimport { CuiComponentBaseHook } from \"../base\";\r\nimport {\r\n\tgetCuiHandlerInteractions,\r\n\tICuiInteractionsFacade,\r\n} from \"../../core/handlers/extensions/facades\";\r\n\r\nexport class CuiIconArgs extends CuiAutoParseArgs {\r\n\ticon: string;\r\n\tscale: number;\r\n\r\n\tconstructor() {\r\n\t\tsuper({\r\n\t\t\tmain: \"icon\",\r\n\t\t});\r\n\t\tthis.icon = \"\";\r\n\t\tthis.scale = 1;\r\n\t}\r\n}\r\n\r\nexport function CuiIconComponent(prefix?: string) {\r\n\treturn CuiComponentBaseHook({\r\n\t\tname: \"icon\",\r\n\t\tprefix: prefix,\r\n\t\tcreate: (\r\n\t\t\telement: HTMLElement,\r\n\t\t\tutils: CuiCore,\r\n\t\t\tprefix: string,\r\n\t\t\tattribute: string\r\n\t\t) => {\r\n\t\t\treturn new CuiIconHandler(element, utils, attribute);\r\n\t\t},\r\n\t});\r\n}\r\n\r\nexport class CuiIconHandler extends CuiHandlerBase<CuiIconArgs> {\r\n\tprivate _interactions: ICuiInteractionsFacade;\r\n\tconstructor(element: HTMLElement, utils: CuiCore, attribute: string) {\r\n\t\tsuper(\"CuiIconHandler\", element, attribute, new CuiIconArgs(), utils);\r\n\t\tthis._interactions = getCuiHandlerInteractions(\r\n\t\t\tutils.interactions,\r\n\t\t\tthis\r\n\t\t);\r\n\t}\r\n\r\n\tasync onHandle(): Promise<boolean> {\r\n\t\tthis.addIcon(this.args.icon);\r\n\t\treturn true;\r\n\t}\r\n\r\n\tasync onRefresh(): Promise<boolean> {\r\n\t\tif (!this.prevArgs || this.args.icon === this.prevArgs.icon) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tthis.addIcon(this.args.icon);\r\n\t\treturn true;\r\n\t}\r\n\r\n\tasync onRemove(): Promise<boolean> {\r\n\t\tconst svg = this.element.querySelectorAll(\"svg\");\r\n\t\tif (is(svg)) {\r\n\t\t\t//@ts-ignore checked\r\n\t\t\tsvg.remove();\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\r\n\tprivate addIcon(icon: string) {\r\n\t\tconst iconStr = icon ? ICONS[icon] : null;\r\n\t\tif (!iconStr) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst iconSvg = new IconBuilder(iconStr)\r\n\t\t\t.setScale(this.args.scale)\r\n\t\t\t.build();\r\n\t\tif (!iconSvg) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst svgs = this.element.querySelectorAll(\"svg\");\r\n\t\tthis._interactions.mutate(() => {\r\n\t\t\tfor (let svg of svgs) {\r\n\t\t\t\tsvg.remove();\r\n\t\t\t}\r\n\t\t\tif (this.element.childNodes.length > 0) {\r\n\t\t\t\tthis.insertBefore(iconSvg);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis.appendChild(iconSvg);\r\n\t\t});\r\n\t}\r\n\r\n\tprivate insertBefore(iconElement: Element) {\r\n\t\tthis.element.insertBefore(iconElement, this.element.firstChild);\r\n\t}\r\n\r\n\tprivate appendChild(iconElement: Element) {\r\n\t\tthis.element.appendChild(iconElement);\r\n\t}\r\n}\r\n","\r\nimport { CuiHandlerBase, } from \"../../core/handlers/base\";\r\nimport { AriaAttributes } from \"../../core/utils/aria\";\r\nimport { ICuiKeysCombo } from \"../../core/models/interfaces\";\r\nimport { CuiCore } from \"../../core/models/core\";\r\nimport { replacePrefix, getName } from \"../../core/utils/functions\";\r\nimport { CuiAutoParseArgs } from \"../../core/utils/arguments\";\r\nimport { getEventBusFacade, CuiStyleHelper, getCuiHandlerInteractions, ICuiEventBusFacade, ICuiInteractionsFacade } from \"../../core/handlers/extensions/facades\";\r\nimport { getAdvancedCuiWindowClickPerformer, ICuiWindowClickPerformer } from \"../extensions/window/performer\";\r\nimport { eventExtension } from \"../extensions/event/event\";\r\nimport { EVENTS } from \"../../core/utils/statics\";\r\nimport { CuiComponentBaseHook } from \"../base\";\r\nimport { closeActionsPerformer, ICuiActionExtensionPerformer, openActionsPerformer } from \"../extensions/performers\";\r\nimport { ICuiParser } from \"../../core/utils/parsers/interfaces\";\r\nimport { ICuiScrollFreezeHelper } from \"../extensions/helpers/interfaces\";\r\nimport { getCuiKeyActionPerformer, ICuiKeyActionPerformer } from \"../extensions/keys/performer\";\r\nimport { getActionsHelper } from \"../../core/helpers/helpers\";\r\nimport { getCuiKeysComboParser } from \"../../core/utils/parsers/keys\";\r\nimport { getKeyCloseCombos, getScrollFreezeHelper } from \"../extensions/helpers/helpers\";\r\nimport { CuiKeysHandlerExtension } from \"../extensions/keys/keys\";\r\nimport { CuiActionsListFactory } from \"../../core/utils/actions\";\r\n\r\nconst OFFCANVAS_RIGHT_ANIM_DEFAULT_IN = \".{prefix}-offcanvas-default-right-in\";\r\nconst OFFCANVAS_RIGHT_ANIM_DEFAULT_OUT = \".{prefix}-offcanvas-default-right-out\";\r\nconst OFFCANVAS_LEFT_ANIM_DEFAULT_IN = \".{prefix}-offcanvas-default-left-in\";\r\nconst OFFCANVAS_LEFT_ANIM_DEFAULT_OUT = \".{prefix}-offcanvas-default-left-out\";\r\n\r\nconst OFFCANVAS_BODY = \"{prefix}-off-canvas-open\";\r\nconst OFFCANVAS_CONTAINER_CLS = '.{prefix}-off-canvas-container';\r\n\r\nexport class CuiOffCanvasArgs extends CuiAutoParseArgs {\r\n    escClose: boolean;\r\n    outClose: boolean;\r\n    openAct: string;\r\n    closeAct: string;\r\n    keyClose: string;\r\n    position: 'left' | 'right';\r\n    timeout: number;\r\n\r\n    #prefix: string;\r\n    constructor(prefix: string, timeout?: number) {\r\n        super();\r\n        this.#prefix = prefix;\r\n\r\n        this.escClose = false;\r\n        this.position = 'right';\r\n        this.openAct = this.getDefaultOpenClass();\r\n        this.closeAct = this.getDefaultCloseClass();\r\n        this.timeout = timeout ?? 300;\r\n        this.outClose = false;\r\n        this.keyClose = \"\";\r\n    }\r\n\r\n    getDefaultOpenClass(): string {\r\n        return replacePrefix(this.position === 'right' ? OFFCANVAS_RIGHT_ANIM_DEFAULT_IN : OFFCANVAS_LEFT_ANIM_DEFAULT_IN, this.#prefix);\r\n    }\r\n\r\n    getDefaultCloseClass(): string {\r\n        return replacePrefix(this.position === 'right' ? OFFCANVAS_RIGHT_ANIM_DEFAULT_OUT : OFFCANVAS_LEFT_ANIM_DEFAULT_OUT, this.#prefix);\r\n    }\r\n}\r\n\r\nexport function CuiOffCanvasComponent(prefix?: string) {\r\n    return CuiComponentBaseHook({\r\n        prefix: prefix,\r\n        name: \"off-canvas\",\r\n        create: (element: HTMLElement, utils: CuiCore, prefix: string, attribute: string) => {\r\n            return new CuiOffCanvasHandler(element, utils, attribute, prefix);\r\n        }\r\n    })\r\n}\r\n\r\nexport class CuiOffCanvasHandler extends CuiHandlerBase<CuiOffCanvasArgs>  {\r\n\r\n    private _prefix: string;\r\n    private _bodyClass: string;\r\n    private _interactions: ICuiInteractionsFacade;\r\n    private _busFacade: ICuiEventBusFacade;\r\n    private _openActionPerformer: ICuiActionExtensionPerformer<any>;\r\n    private _closeActionPerformer: ICuiActionExtensionPerformer<any>;\r\n    private _keysPerformer: ICuiKeyActionPerformer;\r\n    private _freezeHelper: ICuiScrollFreezeHelper;\r\n    private _keyComboParser: ICuiParser<string, ICuiKeysCombo>;\r\n    private _windowClickPerformer: ICuiWindowClickPerformer;\r\n\r\n\r\n    constructor(element: HTMLElement, utils: CuiCore, attribute: string, prefix: string) {\r\n        super(\"CuiOffCanvasHandler\", element, attribute, new CuiOffCanvasArgs(prefix, utils.setup.animationTime), utils);\r\n        this._prefix = prefix;\r\n        const container = element.querySelector(replacePrefix(OFFCANVAS_CONTAINER_CLS, prefix));\r\n        this._bodyClass = replacePrefix(OFFCANVAS_BODY, prefix);\r\n        this._busFacade = getEventBusFacade(this.cuid, utils.bus, element);\r\n        this._keysPerformer = getCuiKeyActionPerformer(this.closeOutside.bind(this));\r\n        this._freezeHelper = getScrollFreezeHelper(new CuiStyleHelper());\r\n        this._keyComboParser = getCuiKeysComboParser();\r\n        const actionsHelper = getActionsHelper(utils.interactions);\r\n        this._windowClickPerformer = getAdvancedCuiWindowClickPerformer(this.closeOutside.bind(this), container ?? undefined);\r\n        this._interactions = getCuiHandlerInteractions(utils.interactions, this);\r\n\r\n        if (!utils.isPlugin(\"click-plugin\")) {\r\n            this.logWarning(\"WindowClick plugin is not available, outClose will not work\")\r\n        }\r\n        if (!utils.isPlugin(\"keys-plugin\")) {\r\n            this.logWarning(\"KeyObserver plugin is not available, escClose and keyClose will not work\")\r\n        }\r\n\r\n        this._openActionPerformer = openActionsPerformer(actionsHelper, this._busFacade, {\r\n            isActive: this.isActive.bind(this),\r\n            onBefore: this.onBeforeOpen.bind(this),\r\n            onAfter: this.onAfterOpen.bind(this),\r\n        }, {\r\n            element: element,\r\n            active: this.activeAction\r\n        })\r\n\r\n        this._closeActionPerformer = closeActionsPerformer(actionsHelper, this._busFacade, {\r\n            isActive: this.isActive.bind(this),\r\n            onAfter: this.onAfterClose.bind(this),\r\n        }, {\r\n            element: element,\r\n            active: this.activeAction\r\n        })\r\n        this.extend(eventExtension(this._busFacade, {\r\n            eventName: EVENTS.OPEN,\r\n            performer: this._openActionPerformer\r\n        }))\r\n        this.extend(eventExtension(this._busFacade, {\r\n            eventName: EVENTS.CLOSE,\r\n            performer: this._closeActionPerformer\r\n        }))\r\n        this.extend(eventExtension(this._busFacade, {\r\n            eventName: EVENTS.WINDOW_CLICK,\r\n            performer: this._windowClickPerformer\r\n        }))\r\n        this.extend(new CuiKeysHandlerExtension(element, this._busFacade, this._keysPerformer))\r\n    }\r\n\r\n    async onHandle(): Promise<boolean> {\r\n        this._interactions.mutate(() => {\r\n            this.setPositionLeft();\r\n            AriaAttributes.setAria(this.element, 'aria-modal', \"\");\r\n        })\r\n        this.updateSetup()\r\n        return true;\r\n    }\r\n    async onRefresh(): Promise<boolean> {\r\n        this.updateSetup();\r\n        return true;\r\n    }\r\n    async onRemove(): Promise<boolean> {\r\n        this._busFacade.detachEmittedEvents();\r\n        return true;\r\n    }\r\n\r\n    private updateSetup() {\r\n        this._openActionPerformer.updateSetup({\r\n            timeout: this.args.timeout,\r\n            actions: CuiActionsListFactory.get(this.args.openAct)\r\n        })\r\n        this._closeActionPerformer.updateSetup({\r\n            timeout: this.args.timeout,\r\n            actions: CuiActionsListFactory.get(this.args.closeAct)\r\n        })\r\n        this._keysPerformer.setKeyCombos(getKeyCloseCombos(this._keyComboParser, this.args.escClose, this.args.keyClose))\r\n        this._windowClickPerformer.setEnabled(this.args.outClose);\r\n    }\r\n\r\n\r\n    private closeOutside() {\r\n        this._closeActionPerformer.perform(null);\r\n    }\r\n\r\n    onBeforeOpen(): boolean {\r\n        if (this.isAnyActive()) {\r\n            return false;\r\n        }\r\n        this._freezeHelper.getScroll();\r\n        return true;\r\n    }\r\n\r\n    onAfterOpen(): void {\r\n        this._freezeHelper.freeze();\r\n        this.asyncClasses.setClasses(document.body, this._bodyClass)\r\n    }\r\n\r\n    onAfterClose(): void {\r\n        this._freezeHelper.release();\r\n        this.asyncClasses.removeClasses(document.body, this._bodyClass);\r\n    }\r\n\r\n    onBeforeClose(): boolean {\r\n        return true;\r\n    }\r\n\r\n\r\n    isAnyActive(): boolean {\r\n        return this.classes.hasClass(this._bodyClass, document.body);\r\n    }\r\n\r\n    setPositionLeft() {\r\n        let cls = getName(this._prefix, 'left');\r\n        if (this.args.position === 'left' && !this.classes.hasClass(cls, this.element)) {\r\n            this.classes.setClass(cls, this.element)\r\n        } else if (this.args.position == 'right' && this.classes.hasClass(cls, this.element)) {\r\n            this.classes.removeClass(cls, this.element)\r\n        }\r\n    }\r\n}","export interface ICuiOffsetMode {\r\n    matches(top: number, left: number, offsetX: number, offsetY: number): boolean;\r\n}\r\n\r\nexport class CuiOffsetStaticMode implements ICuiOffsetMode {\r\n\r\n    matches(top: number, left: number, offsetX: number, offsetY: number): boolean {\r\n        return (offsetX > 0 && left >= offsetX) ||\r\n            (offsetY > 0 && top >= offsetY)\r\n    }\r\n\r\n}\r\n\r\n/**\r\n * Dynamically calculates whether to trigger or untrigger an action.\r\n * If current value exceedes offset and threshold action is triggered.\r\n * If action was triggered and current move is lower than threshold action is untriggered\r\n * \r\n * Example: If offsetY is 100, then first after 100 action is set on. It is kept when scrolling down.\r\n * If user decides to scroll up and difference between turning point and current is bigger than threshold then action is set off.\r\n *  \r\n * Example usage is with navbar - it shall disappear after offset and return back when user scrolls up. \r\n */\r\nexport class CuiOffsetDynamicMode implements ICuiOffsetMode {\r\n    #pointLeft: number;\r\n    #pointTop: number;\r\n    #prevDiffY: number;\r\n    #prevDiffX: number;\r\n    #wasTriggeredX: boolean;\r\n    #wasTriggeredY: boolean;\r\n    #threshold: number;\r\n    constructor() {\r\n        this.#pointLeft = 0;\r\n        this.#pointTop = 0;\r\n        this.#prevDiffX = 0;\r\n        this.#prevDiffY = 0;\r\n        this.#threshold = 100;\r\n        this.#wasTriggeredX = false;\r\n        this.#wasTriggeredY = false;\r\n    }\r\n    matches(top: number, left: number, offsetX: number, offsetY: number): boolean {\r\n        return this.fitsOffsetY(top, offsetY) || this.fitsOffsetX(left, offsetX);\r\n    }\r\n\r\n\r\n    private fitsOffsetX(left: number, offsetX: number) {\r\n        if (offsetX <= 0)\r\n            return false;\r\n        let diffX = left - this.#pointLeft;\r\n        if (left >= offsetX && diffX > this.#threshold) {\r\n            this.#wasTriggeredX = true;\r\n        } else if (this.#wasTriggeredX && diffX < -this.#threshold) {\r\n            this.#wasTriggeredX = false;\r\n        }\r\n        if (diffX < 0 && this.#prevDiffX < diffX || diffX >= 0 && this.#prevDiffX > diffX) {\r\n            this.#pointLeft = left;\r\n        }\r\n        this.#prevDiffX = diffX;\r\n        return this.#wasTriggeredX;\r\n    }\r\n\r\n    private fitsOffsetY(top: number, offsetY: number) {\r\n        if (offsetY <= 0) {\r\n            return false;\r\n        }\r\n        let diffY = top - this.#pointTop;\r\n        if (top >= offsetY && diffY > this.#threshold) {\r\n            this.#wasTriggeredY = true;\r\n        } else if (this.#wasTriggeredY && diffY < -this.#threshold) {\r\n            this.#wasTriggeredY = false;\r\n        }\r\n        if (diffY < 0 && this.#prevDiffY < diffY || diffY >= 0 && this.#prevDiffY > diffY) {\r\n            this.#pointTop = top;\r\n        }\r\n        this.#prevDiffY = diffY;\r\n        return this.#wasTriggeredY;\r\n    }\r\n}\r\n\r\n\r\nexport class CuiOffsetModeFactory {\r\n    static get(mode: string) {\r\n        if (mode === 'dynamic') {\r\n            return new CuiOffsetDynamicMode();\r\n        }\r\n        return new CuiOffsetStaticMode();\r\n    }\r\n}","\r\nexport type CuiElementBoxType = Element | HTMLElement | Window;\r\n\r\nexport interface ICuiElementBox {\r\n    getHeight(): number;\r\n    getWidth(): number;\r\n    getTop(): number;\r\n    getLeft(): number;\r\n    getScrollHeight(): number;\r\n    getScrollWidth(): number;\r\n    getScrollTop(): number;\r\n    getScrollLeft(): number;\r\n    queryAll(selector: string): HTMLElement[];\r\n    get(): CuiElementBoxType;\r\n    scrollTo(scrollObj: ScrollToOptions): void;\r\n}\r\n\r\nexport class CuiElementBoxFactory {\r\n    static get(element: CuiElementBoxType): ICuiElementBox {\r\n        if (element instanceof Window) {\r\n            return new WindowElementBox();\r\n        } else if (element instanceof HTMLElement) {\r\n            return new HTMLElementBox(element);\r\n        }\r\n        return new ElementBox(element);\r\n    }\r\n}\r\n\r\nexport class ElementBox implements ICuiElementBox {\r\n    private _box: DOMRect;\r\n    private _element: Element;\r\n    constructor(element: Element) {\r\n        this._element = element;\r\n        this._box = element.getBoundingClientRect();\r\n    }\r\n\r\n    getHeight(): number {\r\n        return this._box.height;\r\n    }\r\n    getWidth(): number {\r\n        return this._box.width;\r\n    }\r\n    getTop(): number {\r\n        return this._box.top;\r\n    }\r\n    getLeft(): number {\r\n        return this._box.left;\r\n    }\r\n    getScrollHeight(): number {\r\n        return this._element.scrollHeight;\r\n    }\r\n\r\n    getScrollWidth(): number {\r\n        return this._element.scrollWidth;\r\n    }\r\n\r\n    getScrollTop(): number {\r\n        return this._element.scrollTop;\r\n    }\r\n\r\n    getScrollLeft(): number {\r\n        return this._element.scrollLeft;\r\n    }\r\n\r\n    queryAll(selector: string): HTMLElement[] {\r\n        return [...this._element.querySelectorAll<HTMLElement>(selector)];\r\n    }\r\n\r\n    get(): CuiElementBoxType {\r\n        return this._element;\r\n    }\r\n\r\n    scrollTo(options: ScrollToOptions) {\r\n        this._element.scrollTo(options);\r\n    }\r\n}\r\n\r\nexport class HTMLElementBox implements ICuiElementBox {\r\n    private _element: HTMLElement;\r\n    constructor(element: HTMLElement) {\r\n        this._element = element;\r\n    }\r\n\r\n    getHeight(): number {\r\n        return this._element.offsetHeight;\r\n    }\r\n    getWidth(): number {\r\n        return this._element.offsetWidth;\r\n    }\r\n    getTop(): number {\r\n        return this._element.offsetTop;\r\n    }\r\n    getLeft(): number {\r\n        return this._element.offsetLeft;\r\n    }\r\n\r\n    getScrollHeight(): number {\r\n        return this._element.scrollHeight;\r\n    }\r\n\r\n    getScrollWidth(): number {\r\n        return this._element.scrollWidth;\r\n    }\r\n\r\n    getScrollTop(): number {\r\n        return this._element.scrollTop;\r\n    }\r\n\r\n    getScrollLeft(): number {\r\n        return this._element.scrollLeft;\r\n    }\r\n\r\n    queryAll(selector: string): HTMLElement[] {\r\n        return [...this._element.querySelectorAll<HTMLElement>(selector)];\r\n    }\r\n    get(): CuiElementBoxType {\r\n        return this._element;\r\n    }\r\n\r\n    scrollTo(options: ScrollToOptions) {\r\n        this._element.scrollTo(options);\r\n    }\r\n}\r\n\r\nexport class WindowElementBox implements ICuiElementBox {\r\n    getHeight(): number {\r\n        return window.innerHeight;\r\n    }\r\n    getWidth(): number {\r\n        return window.innerWidth;\r\n    }\r\n    getTop(): number {\r\n        return 0;\r\n    }\r\n    getLeft(): number {\r\n        return 0;\r\n    }\r\n\r\n    getScrollHeight(): number {\r\n        return window.innerHeight;\r\n    }\r\n\r\n    getScrollWidth(): number {\r\n        return window.innerWidth;\r\n    }\r\n\r\n    getScrollTop(): number {\r\n        return window.pageYOffset;\r\n    }\r\n    getScrollLeft(): number {\r\n        return window.pageXOffset;\r\n    }\r\n    queryAll(selector: string): HTMLElement[] {\r\n        return [...document.querySelectorAll(selector)] as any[];\r\n    }\r\n\r\n    get(): CuiElementBoxType {\r\n        return window;\r\n    }\r\n\r\n    scrollTo(options: ScrollToOptions) {\r\n        window.scrollTo(options);\r\n    }\r\n\r\n}\r\n\r\n","import { CuiElementBoxFactory, CuiElementBoxType, ICuiElementBox } from \"../models/elements\";\r\nimport { ICuiEventListener } from \"../models/interfaces\";\r\nimport { getRangeValueOrDefault, is } from \"../utils/functions\";\r\nimport { CuiTaskRunner, ICuiTask } from \"../utils/task\";\r\n\r\nconst DEFAULT_SCROLL_END_TIMEOUT: number = 50;\r\n\r\nexport interface CuiScrollEvent {\r\n    base: Event | undefined;\r\n    top: number;\r\n    left: number;\r\n    initial: boolean;\r\n    scrolling: boolean;\r\n    source: string;\r\n}\r\n\r\nexport class CuiScrollListener implements ICuiEventListener<CuiScrollEvent> {\r\n    private _target: CuiElementBoxType;\r\n    private _inProgress: boolean;\r\n    private _threshold: number;\r\n    private _prevX: number;\r\n    private _prevY: number;\r\n    private _callback: ((ev: CuiScrollEvent) => void) | undefined;\r\n    private _isAttached: boolean;\r\n    private _box: ICuiElementBox;\r\n    private _task: ICuiTask;\r\n    private _listener: (ev: Event) => void;\r\n    constructor(target: CuiElementBoxType, threshold?: number) {\r\n        this._target = target;\r\n        this._box = CuiElementBoxFactory.get(target);\r\n        this._inProgress = false;\r\n        this._threshold = getRangeValueOrDefault(threshold, 0, 100, 0);\r\n        this._prevX = this._prevY = 0;\r\n        this._isAttached = false;\r\n        this._callback = undefined;\r\n        this._task = new CuiTaskRunner(DEFAULT_SCROLL_END_TIMEOUT, false, this.onScrollFinish.bind(this));\r\n\r\n        this._listener = this.listener.bind(this);\r\n    }\r\n\r\n    setCallback(callback: (ev: CuiScrollEvent) => void) {\r\n        this._callback = callback;\r\n    }\r\n\r\n    attach() {\r\n        this._target.addEventListener('scroll', this._listener)\r\n        this._isAttached = true;\r\n        this.listener(undefined, true, \"init\");\r\n    }\r\n\r\n    detach() {\r\n        this._target.removeEventListener('scroll', this._listener)\r\n        this._task.stop();\r\n        this._isAttached = false;\r\n    }\r\n\r\n    setTarget(target: CuiElementBoxType) {\r\n        if (target !== this._target) {\r\n            this.detach();\r\n            this._target = target;\r\n            this.attach();\r\n        }\r\n    }\r\n\r\n    setThreshold(threshold: number) {\r\n        this._threshold = getRangeValueOrDefault(threshold, 0, 100, 0);\r\n    }\r\n\r\n    isInProgress(): boolean {\r\n        return this._inProgress;\r\n    }\r\n\r\n    isAttached(): boolean {\r\n        return this._isAttached;\r\n    }\r\n\r\n    private listener(ev?: Event, initial?: boolean, source?: string) {\r\n        if (!is(this._callback)) {\r\n            return;\r\n        }\r\n        let left = this._box.getScrollLeft();\r\n        let top = this._box.getScrollTop();\r\n        this._prevX += left;\r\n        this._prevY += top;\r\n        if (this._inProgress || (!this.passedThreshold() && is(ev))) {\r\n            return;\r\n        }\r\n        this._inProgress = true;\r\n        // @ts-ignore - callback already checked\r\n        this._callback({\r\n            base: ev,\r\n            top: top,\r\n            left: left,\r\n            initial: initial ?? false,\r\n            scrolling: is(ev),\r\n            source: source ?? \"event\"\r\n        })\r\n        if (is(ev))\r\n            this._task.start();\r\n        this._inProgress = false\r\n        this._prevX = 0;\r\n        this._prevY = 0;\r\n    }\r\n\r\n    private passedThreshold() {\r\n        return this._threshold <= 0 || (this._prevX >= this._threshold || this._prevY >= this._threshold);\r\n    }\r\n\r\n    private onScrollFinish() {\r\n        this.listener(undefined, false, \"task\");\r\n    }\r\n}","import { ICuiHandlerExtension } from \"../../../core/handlers/extensions/interfaces\";\r\nimport { CuiScrollEvent, CuiScrollListener } from \"../../../core/listeners/scroll\";\r\nimport { CuiElementBoxType } from \"../../../core/models/elements\";\r\nimport { ICuiExtensionPerformer } from \"../interfaces\";\r\nimport { listenerExtension } from \"../listener/listener\";\r\n\r\nexport interface ICuiScrollExtensionOptions {\r\n    element: CuiElementBoxType;\r\n    type?: string;\r\n    threshold: number;\r\n    performer: ICuiExtensionPerformer<CuiScrollEvent>;\r\n}\r\n\r\nexport function getCuiScrollExtension(setup: ICuiScrollExtensionOptions): ICuiHandlerExtension<any> {\r\n    const _scrollListener = new CuiScrollListener(setup.element, setup.threshold)\r\n    _scrollListener.setCallback(onScroll);\r\n\r\n    function onScroll(ev: CuiScrollEvent) {\r\n        setup.performer.perform(ev);\r\n    }\r\n\r\n    return listenerExtension({\r\n        listener: _scrollListener,\r\n        type: setup.type ?? 'scroll'\r\n    })\r\n}","import { CuiIntersectionResult } from \"../../../core/intersection/interfaces\";\r\nimport { CuiScrollEvent } from \"../../../core/listeners/scroll\";\r\nimport { CuiElementBoxFactory, CuiElementBoxType, ICuiElementBox } from \"../../../core/models/elements\";\r\nimport { getRangeValue, is } from \"../../../core/utils/functions\";\r\nimport { ICuiExtensionPerformer } from \"../interfaces\";\r\n\r\nexport interface ICuiBaseScrollPerfromerOptions {\r\n    callback: (ev: CuiScrollEvent) => void;\r\n}\r\n\r\nexport interface ICuiIntersectionPerfromerOptions {\r\n    callback: (ev: CuiIntersectionResult) => void;\r\n    element: CuiElementBoxType;\r\n}\r\n\r\nexport interface ICuiIntersectionPerformer extends ICuiExtensionPerformer<CuiScrollEvent> {\r\n    setChildren(children: HTMLElement[]): void;\r\n    callInitialEvent(): void\r\n}\r\n\r\nexport function getBaseScrollPerformer(options: ICuiBaseScrollPerfromerOptions): ICuiExtensionPerformer<CuiScrollEvent> {\r\n    return {\r\n        perform: (ev: CuiScrollEvent) => {\r\n            options.callback(ev)\r\n        }\r\n    }\r\n}\r\n\r\nexport function getCuiIntersectionPerformer(setup: ICuiIntersectionPerfromerOptions): ICuiIntersectionPerformer {\r\n    let _children: HTMLElement[] = [];\r\n    let _box: ICuiElementBox = CuiElementBoxFactory.get(setup.element);\r\n\r\n    function onScroll(ev: CuiScrollEvent) {\r\n        if (!is(_children)) {\r\n            return;\r\n        }\r\n        setup.callback(prepareCallbackResult(ev))\r\n    }\r\n\r\n    function prepareCallbackResult(ev: CuiScrollEvent): CuiIntersectionResult {\r\n        let parentBottom = ev.top + _box.getHeight();\r\n        let parentRight = ev.left + _box.getWidth();\r\n        let result: CuiIntersectionResult = {\r\n            ev: ev.base,\r\n            top: ev.top,\r\n            left: ev.left,\r\n            scrolling: ev.scrolling ?? false,\r\n            initial: ev.initial ?? false,\r\n            source: ev.source,\r\n            items: _children.map((child: HTMLElement, index: number) => {\r\n                let verticalRatio = calcChildVerticalRatio(child, ev.top, parentBottom)\r\n                let horizontalRatio = calcChildHorizontalRatio(child, ev.left, parentRight);\r\n                return {\r\n                    verticalRatio: verticalRatio,\r\n                    horizontalRatio: horizontalRatio,\r\n                    element: child\r\n                }\r\n            })\r\n        };\r\n\r\n        return result;\r\n    }\r\n\r\n    function calcChildVerticalRatio(child: HTMLElement, currentTop: number, currentBottom: number): number {\r\n        let childBottom = child.offsetTop + child.offsetHeight;\r\n        // Simulated top if view top is outside of parent then takes parent top\r\n        let symTop = currentTop > child.offsetTop ? currentTop : child.offsetTop;\r\n        // Simulated bottom if view bottom is outside of parent then takes parent bottom\r\n        let symBottom = currentBottom < childBottom ? currentBottom : childBottom;\r\n        // Calculates amount of pixels that are in view\r\n        let diff = symBottom - symTop;\r\n        // Calculates ratio - how much of a child is in parent view\r\n        let ratio = diff / child.offsetHeight;\r\n        return getRangeValue(ratio, 0, 1);\r\n    }\r\n\r\n    function calcChildHorizontalRatio(child: HTMLElement, currentLeft: number, currentRight: number): number {\r\n        let childRight = child.offsetLeft + child.offsetWidth;\r\n        // Simulated top if view left is outside of parent then takes parent left\r\n        let symLeft = currentLeft > child.offsetLeft ? currentLeft : child.offsetLeft;\r\n        // Simulated bottom if view right is outside of parent then takes parent right\r\n        let symRight = currentRight < childRight ? currentRight : childRight;\r\n        // Calculates amount of pixels that are in view\r\n        let diff = symRight - symLeft;\r\n        // Calculates ratio - how much of a child is in parent view\r\n        let ratio = diff / child.offsetWidth;\r\n        return getRangeValue(ratio, 0, 1);\r\n    }\r\n\r\n    return {\r\n        ...getBaseScrollPerformer({\r\n            callback: onScroll\r\n        }),\r\n        setChildren: (children: HTMLElement[]) => {\r\n            _children = children;\r\n        },\r\n        callInitialEvent: () => {\r\n            onScroll({\r\n                base: undefined,\r\n                initial: true,\r\n                scrolling: false,\r\n                left: _box.getScrollLeft(),\r\n                top: _box.getScrollTop(),\r\n                source: \"performer\"\r\n            })\r\n        }\r\n    }\r\n}","import { CuiScrollEvent } from \"src/core/listeners/scroll\";\r\nimport { getBaseScrollPerformer } from \"../extensions/scroll/performers\";\r\n\r\nexport interface ICuiOffsetPerformerSetup {\r\n    callback: (ev: CuiScrollEvent) => void;\r\n    threshold: number;\r\n}\r\n\r\nexport function getOffsetPerformer(setup: ICuiOffsetPerformerSetup) {\r\n    let _prevX: number = 0;\r\n    let _prevY: number = 0;\r\n    function onScroll(ev: CuiScrollEvent) {\r\n        if (_exceededThreshold(ev.left, ev.top)) {\r\n            setup.callback(ev);\r\n            _prevX = ev.left;\r\n            _prevY = ev.top;\r\n            return;\r\n        }\r\n    }\r\n\r\n    function _exceededThreshold(x: number, y: number): boolean {\r\n        return Math.abs(x - _prevX) > setup.threshold || Math.abs(y - _prevY) > setup.threshold;\r\n    }\r\n\r\n    return getBaseScrollPerformer({\r\n        callback: onScroll\r\n    })\r\n}","import { ICuiComponent } from \"../../core/models/interfaces\";\r\nimport { CuiCore } from \"../../core/models/core\";\r\nimport { CuiHandlerBase } from \"../../core/handlers/base\";\r\nimport { CuiScrollEvent } from \"../../core/listeners/scroll\";\r\nimport { ICuiComponentAction, CuiActionsListFactory } from \"../../core/utils/actions\";\r\nimport { are, getRangeValue } from \"../../core/utils/functions\";\r\nimport { CuiOffsetModeFactory, ICuiOffsetMode } from \"./modes\";\r\nimport { ATTRIBUTES, EVENTS } from \"../../core/utils/statics\";\r\nimport { CuiAutoParseArgs } from \"../../core/utils/arguments\";\r\nimport { CuiComponentBaseHook } from \"../base\";\r\nimport { getEventBusFacade, getCuiHandlerInteractions, ICuiEventBusFacade, ICuiInteractionsFacade } from \"../../core/handlers/extensions/facades\";\r\nimport { getCuiScrollExtension } from \"../extensions/scroll/scroll\";\r\nimport { CuiElementBoxFactory, ICuiElementBox } from \"../../core/models/elements\";\r\nimport { getOffsetPerformer } from \"./performer\";\r\nimport { ICuiExtensionPerformer } from \"../extensions/interfaces\";\r\n\r\n/**\r\n * Toggles an action after specified offset is reached in relation to the element or document\r\n * \r\n * target?: string - target which action shall be triggered on\r\n * action?: string - action to trigger\r\n * offsetY?: number - vertical offset\r\n * offsetX?: number - horizontal offset\r\n * root?: boolean - set true if scroll listener shall be set on document element\r\n * mode?: string - static/dynamic \r\n */\r\n\r\nexport interface CuiOffsetEvent {\r\n    matches: boolean;\r\n    offsetX: number;\r\n    offsetY: number;\r\n    ratioY: number;\r\n    ratioX: number;\r\n    scrolling: boolean;\r\n\r\n    timestamp: number;\r\n}\r\n\r\nexport interface CuiOffsetAttribute {\r\n    target?: string;\r\n    action?: string;\r\n    offsetY?: number;\r\n    offsetX?: number;\r\n    root?: boolean;\r\n}\r\n\r\nexport class CuiOffsetArgs extends CuiAutoParseArgs {\r\n    target: string;\r\n    action: string;\r\n    offsetY: number;\r\n    offsetX: number\r\n    mode: \"static\" | \"dynamic\";\r\n    constructor() {\r\n        super();\r\n        this.offsetX = -1;\r\n        this.offsetY = -1;\r\n        this.target = \"\";\r\n        this.action = \"\";\r\n        this.mode = 'static';\r\n    }\r\n}\r\n\r\nexport function CuiOffsetComponent(prefix?: string): ICuiComponent {\r\n    return CuiComponentBaseHook({\r\n        prefix: prefix,\r\n        name: \"offset\",\r\n        create: (element: HTMLElement, utils: CuiCore, prefix: string, attribute: string) => {\r\n            return new CuiOffsetHandler(element, utils, attribute)\r\n        }\r\n    })\r\n}\r\n\r\nexport class CuiOffsetHandler extends CuiHandlerBase<CuiOffsetArgs> {\r\n    private _targets: HTMLElement[];\r\n    private _matched: boolean;\r\n    private _actions: ICuiComponentAction[];\r\n\r\n    private _root: ICuiElementBox;\r\n    private _modeHandler: ICuiOffsetMode;\r\n\r\n\r\n    private _busFacade: ICuiEventBusFacade;\r\n    private _interactions: ICuiInteractionsFacade;\r\n    private _performer: ICuiExtensionPerformer<CuiScrollEvent>;\r\n\r\n    constructor(element: HTMLElement, utils: CuiCore, attribute: string) {\r\n        super(\"CuiOffsetHandler\", element, attribute, new CuiOffsetArgs(), utils);\r\n\r\n        this._targets = [this.element];\r\n        this._matched = false;\r\n        this._actions = [];\r\n        this._modeHandler = CuiOffsetModeFactory.get(this.args.mode);\r\n        this._busFacade = getEventBusFacade(this.cuid, utils.bus, element);\r\n        this._interactions = getCuiHandlerInteractions(utils.interactions);\r\n        const root = this.element.hasAttribute(ATTRIBUTES.root) ? window : element\r\n        this._root = CuiElementBoxFactory.get(root);\r\n        this._performer = getOffsetPerformer({\r\n            callback: this.checkAndPerformActions.bind(this),\r\n            threshold: 20,\r\n        })\r\n\r\n        this.extend(getCuiScrollExtension({\r\n            element: root,\r\n            threshold: 5,\r\n            performer: this._performer\r\n        }))\r\n\r\n\r\n    }\r\n\r\n    async onHandle(): Promise<boolean> {\r\n        this.parseAttribute();\r\n        // Perform initial call to performer to settle up component - if it is scrolled or just matching conditions then actions will be set\r\n        this._performer.perform({\r\n            base: undefined,\r\n            initial: true,\r\n            left: this._root.getScrollLeft(),\r\n            top: this._root.getScrollTop(),\r\n            scrolling: false,\r\n            source: \"CuiOffsetHandler\"\r\n        })\r\n        return true;\r\n    }\r\n\r\n    async onRefresh(): Promise<boolean> {\r\n        this.parseAttribute();\r\n        return true;\r\n    }\r\n\r\n    async onRemove(): Promise<boolean> {\r\n        this._busFacade.detachEmittedEvents();\r\n        return true;\r\n    }\r\n\r\n    private parseAttribute() {\r\n        this._targets = this.getTargets();\r\n        this._actions = CuiActionsListFactory.get(this.args.action);\r\n        this._modeHandler = CuiOffsetModeFactory.get(this.args.mode);\r\n\r\n    }\r\n\r\n    private checkAndPerformActions(ev: CuiScrollEvent) {\r\n        // @ts-ignore modehandler\r\n        let matchesOffset = this._modeHandler.matches(ev.top, ev.left, this.args.offsetX, this.args.offsetY);\r\n        /**\r\n         * Act and emit event when offset has been reached\r\n         */\r\n        if (matchesOffset !== this._matched) {\r\n            this.act(matchesOffset);\r\n            this._matched = matchesOffset;\r\n        }\r\n        this.callEvent(this._matched, ev.left, ev.top, ev.scrolling, ev.source, ...this.calcaRatio(ev.left, ev.top));\r\n    }\r\n\r\n\r\n    private act(matching: boolean) {\r\n        if (!are(this._actions, this._targets)) {\r\n            return;\r\n        }\r\n\r\n        this._interactions.mutate(() => {\r\n            this._actions.forEach(action => {\r\n                this.actForTargets(matching ? action.add.bind(action) : action.remove.bind(action))\r\n            })\r\n        })\r\n    }\r\n\r\n    private actForTargets(callback: (target: Element) => void) {\r\n        this._targets.forEach(target => callback(target))\r\n    }\r\n\r\n    private callEvent(matches: boolean, x: number, y: number, scrolling: boolean, source: string, ratioX: number, ratioY: number) {\r\n        this._busFacade.emit(EVENTS.OFFSET, {\r\n            matches: this._matched,\r\n            offsetX: x,\r\n            offsetY: y,\r\n            ratioX: ratioX,\r\n            ratioY: ratioY,\r\n            scrolling: scrolling,\r\n            source: source,\r\n            timestamp: Date.now()\r\n        })\r\n    }\r\n\r\n\r\n    private calcaRatio(x: number, y: number): [number, number] {\r\n        let ratY = parseFloat(((this._root.getHeight() + y) / this._root.getScrollHeight()).toFixed(2))\r\n        let ratX = parseFloat(((this._root.getWidth() + x) / this._root.getScrollWidth()).toFixed(2))\r\n        return [getRangeValue(ratX, 0, 1), getRangeValue(ratY, 0, 1)];\r\n    }\r\n\r\n    private getTargets(): HTMLElement[] {\r\n        return this.args.target ? this._root.queryAll(this.args.target) : [this.element];\r\n    }\r\n}","import { CuiCore } from \"../../core/models/core\";\r\nimport { CuiHandlerBase } from \"../../core/handlers/base\";\r\nimport { is, are, getParentCuiElement } from \"../../core/utils/functions\";\r\nimport { CuiActionsListFactory } from \"../../core/utils/actions\";\r\nimport { EVENTS } from \"../../core/utils/statics\";\r\nimport { CuiAutoParseArgs } from \"../../core/utils/arguments\";\r\nimport { CuiClickableArgs } from \"../../core/models/arguments\";\r\nimport { clickExtension } from \"../extensions/click/click\";\r\nimport { InteractionEvent } from \"../../core/models/events\";\r\nimport { eventExtension } from \"../extensions/event/event\";\r\nimport { getEventBusFacade, ICuiEventBusFacade } from \"../../core/handlers/extensions/facades\";\r\nimport { CuiActionsHelper } from \"../../core/helpers/helpers\";\r\nimport { CuiComponentBaseHook } from \"../base\";\r\nimport { callbackPerformer } from \"../extensions/performers\";\r\n\r\nexport class CuiOpenArgs extends CuiAutoParseArgs implements CuiClickableArgs {\r\n    target: string;\r\n    action: string;\r\n    timeout: number;\r\n    prevent: boolean;\r\n    state: string;\r\n    stopPropagation: boolean;\r\n\r\n    constructor(timeout?: number) {\r\n        super({\r\n            main: \"target\"\r\n        });\r\n        this.target = \"\";\r\n        this.action = \"\";\r\n        this.timeout = timeout ?? 300;\r\n        this.prevent = false;\r\n        this.stopPropagation = false;\r\n        this.state = \"\";\r\n\r\n    }\r\n\r\n}\r\n\r\n\r\nexport function CuiOpenComponent(prefix?: string) {\r\n    return CuiComponentBaseHook({\r\n        name: 'open',\r\n        prefix: prefix,\r\n        create: (element: HTMLElement, utils: CuiCore, prefix: string, attribute: string) => {\r\n            return new CuiOpenHandler(element, utils, attribute);\r\n        }\r\n    })\r\n}\r\n\r\nexport class CuiOpenHandler extends CuiHandlerBase<CuiOpenArgs> {\r\n    private _busFacade: ICuiEventBusFacade;\r\n    private _actionsHelper: CuiActionsHelper;\r\n    constructor(element: HTMLElement, utils: CuiCore, attribute: string) {\r\n        super(\"CuiOpenHandler\", element, attribute, new CuiOpenArgs(utils.setup.animationTime), utils);\r\n        this._busFacade = getEventBusFacade(this.cuid, utils.bus, element);\r\n        this._actionsHelper = new CuiActionsHelper(utils.interactions);\r\n        this.extend(clickExtension({\r\n            element: element,\r\n            performer: callbackPerformer(this.onOpen.bind(this))\r\n        }))\r\n        this.extend(eventExtension(this._busFacade, {\r\n            eventName: EVENTS.OPEN,\r\n            type: \"open\",\r\n            performer: callbackPerformer(this.onOpen.bind(this))\r\n        }))\r\n    }\r\n\r\n    async onHandle(): Promise<boolean> {\r\n        return true;\r\n    }\r\n    async onRefresh(): Promise<boolean> {\r\n        return true;\r\n    }\r\n    async onRemove(): Promise<boolean> {\r\n        this._busFacade.detachEmittedEvents();\r\n        return true;\r\n    }\r\n\r\n    private onOpen(ev: MouseEvent) {\r\n        if (!this.lock()) {\r\n            return;\r\n        }\r\n        const target = this.getTarget();\r\n        if (!is(target)) {\r\n            this.log.warning(`Target ${this.args.target} not found`, 'onClick')\r\n            return;\r\n        }\r\n        //@ts-ignore - target checked\r\n        this.run(target).then((result) => {\r\n            //@ts-ignore - target checked\r\n            if (result)\r\n                this.emitOpen(ev);\r\n        }).catch((e) => {\r\n            this.log.exception(e);\r\n        }).finally(() => {\r\n            this.unlock();\r\n        })\r\n    }\r\n\r\n    /**\r\n     * Emits open event or performs an opening action\r\n     * @param target target element\r\n     * @returns whether event opened shall be emitted\r\n     */\r\n    private async run(target: Element): Promise<boolean> {\r\n        console.log(target)\r\n        let cuiId = (target as any).$cuid;\r\n        if (is(cuiId)) {\r\n            this.handleClickCui(cuiId);\r\n            return false;\r\n        } else {\r\n            this.log.debug(\"Open html component\")\r\n            if (are(this.args.timeout, this.args.action)) {\r\n                this.log.debug(\"Perfrom an action\")\r\n                let actions = CuiActionsListFactory.get(this.args.action)\r\n                return this._actionsHelper.performActions(target, actions, this.args.timeout, () => {\r\n                    this.classes.setClass(this.activeClassName, target);\r\n                });\r\n            }\r\n            this.asyncClasses.setClasses(target, this.activeClassName);\r\n            return true;\r\n        }\r\n    }\r\n\r\n    handleClickCui(cuid: string) {\r\n        this.log.debug(\"Open cUI component\")\r\n        this.core.bus.emit(EVENTS.OPEN, cuid, this.args.state);\r\n        return false;\r\n    }\r\n\r\n\r\n    private emitOpen(ev: MouseEvent) {\r\n        this._busFacade.emit<InteractionEvent<string>>(EVENTS.OPENED, {\r\n            event: ev,\r\n            state: this.args.state\r\n        })\r\n    }\r\n\r\n    private getTarget(): Element | undefined {\r\n        if (!is(this.args.target)) {\r\n            return getParentCuiElement(this.element);\r\n        }\r\n        return document.querySelector(this.args.target) ?? getParentCuiElement(this.element);\r\n    }\r\n}","import { enumerateObject } from \"../../core/utils/functions\";\r\nimport { PropsTypes } from \"../../core/animation/engine\";\r\nimport { AnimationProperty } from \"../../core/animation/interfaces\";\r\nimport { AnimatorFactory } from \"../../core/animation/factory\";\r\n\r\nexport class ParallaxAnimatorsHandler {\r\n    name: string;\r\n    #animators: any[];\r\n    constructor(name: string, setup: AnimationProperty<PropsTypes>) {\r\n        this.name = name;\r\n        this.#animators = [];\r\n        enumerateObject(setup, (propName: string, prop: PropsTypes) => {\r\n            let animator = AnimatorFactory.get(propName);\r\n            if (!animator) {\r\n                return;\r\n            }\r\n            animator.setProperty(prop);\r\n            this.#animators.push(animator);\r\n        })\r\n\r\n    }\r\n\r\n    perform(element: HTMLElement, progress: number) {\r\n        if (this.#animators.length === 0) {\r\n            return;\r\n        }\r\n\r\n        this.#animators.forEach(animator => animator.perform(element, progress, 1));\r\n    }\r\n}","import { ICuiHandlerExtension } from \"src/core/handlers/extensions/interfaces\";\r\nimport { ICuiExtensionPerformer } from \"../interfaces\";\r\n\r\nexport class CuiComponentMutationExtension implements ICuiHandlerExtension<any> {\r\n    type: string = 'mutations';\r\n    description: string = \"\";\r\n\r\n    private _isObserving: boolean;\r\n    private _observer: MutationObserver;\r\n    private _element: Element;\r\n    private _disabled: boolean;\r\n    private _options: MutationObserverInit;\r\n    private _performer: ICuiExtensionPerformer<MutationRecord[]>;\r\n    constructor(element: Element, performer: ICuiExtensionPerformer<MutationRecord[]>, options?: MutationObserverInit) {\r\n        this._element = element;\r\n        this._performer = performer;\r\n        this._disabled = true;\r\n        this._isObserving = false;\r\n        this._options = options ?? {\r\n            childList: true,\r\n            subtree: true,\r\n        };\r\n        this._observer = new MutationObserver(this.onMutation.bind(this));\r\n    }\r\n\r\n    async init(args: any): Promise<boolean> {\r\n        this.observe();\r\n        return true;\r\n    }\r\n\r\n    async destroy(): Promise<boolean> {\r\n        this.unobserve();\r\n        return true;\r\n    }\r\n\r\n    observe(): void {\r\n        if (!this._isObserving && !this._disabled) {\r\n            this._observer.observe(this._element, this._options);\r\n            this._isObserving = true;\r\n        }\r\n    }\r\n\r\n    unobserve(): void {\r\n        if (this._isObserving) {\r\n            this._observer.disconnect();\r\n            this._isObserving = false;\r\n        }\r\n    }\r\n\r\n    disable(flag: boolean): void {\r\n        this._disabled = flag;\r\n        if (this._disabled) {\r\n            this.unobserve();\r\n        }\r\n    }\r\n\r\n    private onMutation(record: MutationRecord[]) {\r\n        this._performer.perform(record);\r\n    }\r\n}","import { ICuiExtensionPerformer } from \"../interfaces\";\r\n\r\nexport interface ICuiMutationPerformer extends ICuiExtensionPerformer<MutationRecord[]> {\r\n    setSelector(selector: string): void;\r\n}\r\n\r\n\r\nexport function getCuiMutationPerformer(callback: (record: MutationRecord[]) => void): ICuiMutationPerformer {\r\n    let _selector: string | null = null;\r\n    const _callback = callback;\r\n    function matchesSelector(record: MutationRecord): boolean {\r\n        if (record.addedNodes.length > 0) {\r\n            return isAnyItemMatching([...record.addedNodes] as HTMLElement[]);\r\n        }\r\n        if (record.removedNodes.length > 0) {\r\n            return isAnyItemMatching([...record.removedNodes] as HTMLElement[]);\r\n        }\r\n        return false;\r\n    }\r\n\r\n    function isAnyItemMatching(array: HTMLElement[]): boolean {\r\n        //@ts-ignore\r\n        return (array.find((node) => (<HTMLElement>node).matches(_selector)) !== null);\r\n    }\r\n\r\n    function filterRecordsBySelector(record: MutationRecord[]) {\r\n        return record.reduce<MutationRecord[]>((result, record) => {\r\n            if (_selector && record.type === 'childList') {\r\n                if (matchesSelector(record)) {\r\n                    result.push(record)\r\n                }\r\n            } else {\r\n                result.push(record)\r\n            }\r\n            return result;\r\n        }, [])\r\n    }\r\n\r\n    return {\r\n        perform: (record: MutationRecord[]) => {\r\n            let out = record;\r\n            if (_selector) {\r\n                out = filterRecordsBySelector(record);\r\n            }\r\n            if (out.length > 0) {\r\n                _callback(out);\r\n            }\r\n        },\r\n        setSelector: (selector: string) => {\r\n            _selector = selector;\r\n        }\r\n    }\r\n}","import { CuiHandlerBase } from \"../../core/handlers/base\";\r\nimport { CuiIntersectionResult } from \"../../core/intersection/interfaces\";\r\nimport { ICuiComponent } from \"../../core/models/interfaces\";\r\nimport { CuiCore } from \"../../core/models/core\";\r\nimport { CuiAutoParseArgs } from \"../..//core/utils/arguments\";\r\nimport { getIntOrDefault, joinWithScopeSelector } from \"../../core/utils/functions\";\r\nimport { CuiStyleHelper, getCuiHandlerInteractions, ICuiInteractionsFacade, ICuiStyleHelper } from \"../../core/handlers/extensions/facades\";\r\nimport { ParallaxAnimatorsHandler } from \"./animator\";\r\nimport { CuiComponentBaseHook } from \"../base\";\r\nimport { getCuiIntersectionPerformer, ICuiIntersectionPerformer } from \"../extensions/scroll/performers\";\r\nimport { ATTRIBUTES } from \"../../core/utils/statics\";\r\nimport { getCuiScrollExtension } from \"../extensions/scroll/scroll\";\r\nimport { CuiComponentMutationExtension } from \"../extensions/mutations/mutations\";\r\nimport { getCuiMutationPerformer, ICuiMutationPerformer } from \"../extensions/mutations/performer\";\r\n\r\nconst PARALLAX_ATTRIBUTE_ANIMATTION = 'data-parallax-animation';\r\nconst PARALLAX_ATTRIBUTE_START = 'data-parallax-start-ratio';\r\nconst PARALLAX_ATTRIBUTE_STOP = 'data-parallax-stop-ratio';\r\n\r\ninterface TargetSetupItem {\r\n    element: HTMLElement;\r\n    animator?: ParallaxAnimatorsHandler;\r\n    start: number;\r\n    stop: number;\r\n}\r\n\r\nexport class CuiParallaxArgs extends CuiAutoParseArgs {\r\n    targets: string;\r\n    startRatio: number;\r\n    stopRatio: number;\r\n    animation: string;\r\n    constructor() {\r\n        super({\r\n            props: {\r\n                \"targets\": { corrector: joinWithScopeSelector }\r\n            }\r\n        });\r\n        this.targets = joinWithScopeSelector(\"> *\");\r\n        this.startRatio = 0;\r\n        this.stopRatio = 1;\r\n        this.animation = \"\";\r\n\r\n    }\r\n}\r\n\r\nexport function CuiParallaxComponent(prefix?: string): ICuiComponent {\r\n    return CuiComponentBaseHook({\r\n        prefix: prefix,\r\n        name: 'parallax',\r\n        create: (element: HTMLElement, utils: CuiCore, prefix: string, attribute: string) => {\r\n            return new CuiParallaxHandler(element, utils, attribute);\r\n        }\r\n    })\r\n}\r\n\r\nexport class CuiParallaxHandler extends CuiHandlerBase<CuiParallaxArgs> {\r\n\r\n\r\n\r\n    private _defaultAnimator: ParallaxAnimatorsHandler | undefined;\r\n    private _targetSetup: TargetSetupItem[];\r\n    private _interactions: ICuiInteractionsFacade;\r\n    private _intersectionPerformer: ICuiIntersectionPerformer;\r\n    private _mutationPerformer: ICuiMutationPerformer;\r\n    private _styles: ICuiStyleHelper;\r\n\r\n    constructor(element: HTMLElement, utils: CuiCore, attribute: string) {\r\n        super(\"CuiParallaxHandler\", element, attribute, new CuiParallaxArgs(), utils);\r\n        this._defaultAnimator = undefined;\r\n        this._targetSetup = [];\r\n        this._interactions = getCuiHandlerInteractions(utils.interactions);\r\n        const root = element.hasAttribute(ATTRIBUTES.root) ? window : element;\r\n        this._styles = new CuiStyleHelper();\r\n\r\n        this._intersectionPerformer = getCuiIntersectionPerformer({\r\n            element: root,\r\n            callback: this.onIntersection.bind(this)\r\n        })\r\n\r\n        this._mutationPerformer = getCuiMutationPerformer(this.onMutation.bind(this));\r\n\r\n        this.extend(getCuiScrollExtension({\r\n            element: root,\r\n            performer: this._intersectionPerformer,\r\n            threshold: 5\r\n        }))\r\n\r\n        this.extend(new CuiComponentMutationExtension(\r\n            element,\r\n            this._mutationPerformer\r\n        ))\r\n    }\r\n\r\n\r\n    async onHandle(): Promise<boolean> {\r\n        this.updateArguments();\r\n        this._intersectionPerformer.callInitialEvent();\r\n        return true;\r\n    }\r\n    async onRefresh(): Promise<boolean> {\r\n        if (this.prevArgs && this.prevArgs.targets !== this.args.targets) {\r\n            this.clean();\r\n            this.updateArguments()\r\n        }\r\n        return true;\r\n    }\r\n    async onRemove(): Promise<boolean> {\r\n        this.clean();\r\n        return true;\r\n    }\r\n\r\n    private updateArguments() {\r\n        this._mutationPerformer.setSelector(this.args.targets);\r\n        this._defaultAnimator = new ParallaxAnimatorsHandler(this.args.animation, this.core.setup.parallaxAnimations[this.args.animation])\r\n        this._targetSetup = this.getTargets();\r\n        this._intersectionPerformer.setChildren(this._targetSetup.map(item => item.element));\r\n    }\r\n\r\n    onIntersection(ev: CuiIntersectionResult) {\r\n        this._interactions.mutate(() => {\r\n            ev.items.forEach((item, index) => {\r\n                if (index >= this._targetSetup.length) {\r\n                    return;\r\n                }\r\n                const setup = this._targetSetup[index];\r\n                if (setup.animator)\r\n                    setup.animator.perform(item.element, calculateRatio(setup.start, setup.stop, item.verticalRatio))\r\n            })\r\n        })\r\n\r\n    }\r\n\r\n    onMutation(record: MutationRecord[]): void {\r\n        this._targetSetup = this.getTargets();\r\n        this._intersectionPerformer.setChildren(this._targetSetup.map(item => item.element));\r\n    }\r\n\r\n    private getTargets(): TargetSetupItem[] {\r\n        const targetSetup: TargetSetupItem[] = []\r\n        this.element.querySelectorAll(this.args.targets).forEach(target => {\r\n            targetSetup.push({\r\n                element: target as HTMLElement,\r\n                animator: this.getTargetAnimator(target) ?? this._defaultAnimator,\r\n                start: getIntOrDefault(target.getAttribute(PARALLAX_ATTRIBUTE_START), this.args.startRatio),\r\n                stop: getIntOrDefault(target.getAttribute(PARALLAX_ATTRIBUTE_STOP), this.args.stopRatio),\r\n            })\r\n        })\r\n        return targetSetup;\r\n    }\r\n\r\n    private getTargetAnimator(target: Element): ParallaxAnimatorsHandler | undefined {\r\n        if (!target.hasAttribute(PARALLAX_ATTRIBUTE_ANIMATTION)) {\r\n            return undefined;\r\n        }\r\n        const name = target.getAttribute(PARALLAX_ATTRIBUTE_ANIMATTION);\r\n        //@ts-ignore name was checked already\r\n        let setup = this.core.setup.parallaxAnimations[name];\r\n        if (!setup) {\r\n            return undefined;\r\n        }\r\n        //@ts-ignore name was checked already\r\n        return new ParallaxAnimatorsHandler(name, setup);\r\n    }\r\n\r\n    private clean() {\r\n        this._targetSetup.forEach(setup => {\r\n            this.core.interactions.mutate(this._styles.clean, null, setup.element);\r\n\r\n        })\r\n    }\r\n}\r\n\r\nfunction calculateRatio(startRatio: number, stopRatio: number, current: number): number {\r\n    let spread = stopRatio - startRatio;\r\n    let start = current - startRatio;\r\n    if (start < 0) {\r\n        start = 0;\r\n\r\n    }\r\n    let curr = start / spread;\r\n    return Math.min(curr, 1);\r\n}","import { ICuiObserver } from \"../models/interfaces\";\r\n\r\nexport interface ICuiIntersectionObserver {\r\n    observe(target: Element): void;\r\n    unobserve(target: Element): void;\r\n    disconnect(): void;\r\n}\r\n\r\nexport class CuiIntersectionEntry {\r\n    isInView: boolean;\r\n    ratio: number;\r\n\r\n    constructor() {\r\n        this.isInView = false;\r\n        this.ratio = 0;\r\n    }\r\n}\r\n\r\nexport interface ICuiIntersectionHandler {\r\n    onIntersection(entry: CuiIntersectionEntry): Promise<boolean>;\r\n}\r\n\r\n/**\r\n * Creates a wrapper for intersection observer\r\n * Constructor gets a root element for observer and optional array of threshold values [0...1]\r\n */\r\nexport class CuiIntersectionObserver implements ICuiObserver {\r\n    private _observer: IntersectionObserver | undefined;\r\n    private _root: Element;\r\n    private _threshold: number[];\r\n    private _callback: IntersectionObserverCallback | undefined;\r\n    constructor(root: Element, threshold?: number[]) {\r\n        this._root = root;\r\n        this._threshold = threshold ?? [0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1];\r\n        this._callback = undefined;\r\n        this._observer = undefined;\r\n    }\r\n\r\n    setCallback(callback: IntersectionObserverCallback) {\r\n        this._callback = callback;\r\n    }\r\n\r\n    connect(): void {\r\n        if (!this._callback) {\r\n            return;\r\n        }\r\n        this._observer = new IntersectionObserver(this._callback, {\r\n            root: this._root,\r\n            rootMargin: '0px',\r\n            threshold: this._threshold\r\n        })\r\n    }\r\n\r\n    observe(target: Element): void {\r\n        if (this._observer)\r\n            this._observer.observe(target)\r\n    }\r\n\r\n    unobserve(target: Element): void {\r\n        if (this._observer)\r\n            this._observer.unobserve(target)\r\n    }\r\n\r\n    disconnect() {\r\n        if (this._observer)\r\n            this._observer.disconnect()\r\n    }\r\n\r\n}","import { ICuiPair } from \"src/core/models/interfaces\";\r\nimport { CuiWindowSize } from \"src/core/utils/types\";\r\nimport { CuiSizeArgs } from \"./resize\";\r\n\r\ninterface ResizeStepCallback<T extends CuiSizeArgs> {\r\n    (args: T): string | undefined;\r\n}\r\n\r\nconst SmartResizeSteps: ICuiPair<string, ResizeStepCallback<CuiSizeArgs>>[] = [\r\n    { key: \"none\", value: (args) => args.default },\r\n    { key: \"small\", value: (args) => args.small },\r\n    { key: \"medium\", value: (args) => args.medium },\r\n    { key: \"large\", value: (args) => args.large },\r\n    { key: \"xlarge\", value: (args) => args.xlarge },\r\n]\r\n\r\nexport interface ICuiResizeCalculator<T extends CuiSizeArgs> {\r\n    get(args: T, size: CuiWindowSize): string | undefined;\r\n}\r\n\r\nexport class SimpleResizeCalculator<T extends CuiSizeArgs> implements ICuiResizeCalculator<T> {\r\n    private _replace: boolean;\r\n    constructor(replace?: boolean) {\r\n        this._replace = replace === true;\r\n    }\r\n    get(args: T, size: CuiWindowSize): string {\r\n        let value: string | undefined = (<any>args)[size];\r\n        return (this._replace && !value) ? args.default : value ?? \"\";\r\n    }\r\n}\r\n\r\nexport class SmartResizeCalculator<T extends CuiSizeArgs> implements ICuiResizeCalculator<T> {\r\n    private _steps: ICuiPair<string, any>[];\r\n    constructor() {\r\n        this._steps = SmartResizeSteps;\r\n    }\r\n    get(args: T, size: CuiWindowSize): string {\r\n        let value = args.default;\r\n        for (let step of this._steps) {\r\n            value = step.value(args) ?? value;\r\n            if (size === step.key) {\r\n                return value\r\n            }\r\n        }\r\n        return value;\r\n    }\r\n}\r\n\r\nexport function getResizeCalculator<T extends CuiSizeArgs>(mode: string) {\r\n    if (mode === 'smart') {\r\n        return new SmartResizeCalculator<T>();\r\n    }\r\n    return new SimpleResizeCalculator<T>();\r\n}","import { ICuiComponent } from \"../../core/models/interfaces\";\r\nimport { CuiCore } from \"../../core/models/core\";\r\nimport { CuiHandlerBase } from \"../../core/handlers/base\";\r\nimport { EVENTS } from \"../../core/utils/statics\";\r\nimport { calcWindowSize, is, isInViewport } from \"../../core/utils/functions\";\r\nimport { CuiIntersectionObserver } from \"../../core/observers/intersection\";\r\nimport { CuiWindowSize } from \"../../core/utils/types\";\r\nimport {\r\n\tCuiActionsFactory,\r\n\tICuiComponentAction,\r\n} from \"../../core/utils/actions\";\r\nimport { CuiResizeData } from \"../../core/models/events\";\r\nimport { CuiAutoParseArgs } from \"../../core/utils/arguments\";\r\nimport { CuiTaskRunner, ICuiTask } from \"../../core/utils/task\";\r\nimport { cuiObserverExtension } from \"../extensions/observer/observer\";\r\nimport { eventExtension } from \"../extensions/event/event\";\r\nimport {\r\n\tgetEventBusFacade,\r\n\tgetCuiHandlerInteractions,\r\n\tICuiEventBusFacade,\r\n\tICuiInteractionsFacade,\r\n} from \"../../core/handlers/extensions/facades\";\r\nimport { getResizeCalculator, ICuiResizeCalculator } from \"./calculator\";\r\nimport { callbackPerformer } from \"../extensions/performers\";\r\nimport { CuiComponentBaseHook } from \"../base\";\r\n\r\ntype CuiResizeComponentMode = \"smart\" | \"simple\";\r\n\r\nexport interface CuiSizeArgs {\r\n\tsmall?: string;\r\n\tmedium?: string;\r\n\tlarge?: string;\r\n\txlarge?: string;\r\n\tdefault: string;\r\n}\r\n\r\nexport class CuiResizeArgs extends CuiAutoParseArgs implements CuiSizeArgs {\r\n\tmode: CuiResizeComponentMode;\r\n\tdefault: string;\r\n\tsmall?: string;\r\n\tmedium?: string;\r\n\tlarge?: string;\r\n\txlarge?: string;\r\n\tdelay: number;\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.mode = \"simple\";\r\n\t\tthis.default = \"\";\r\n\t\tthis.small = this.medium = this.large = this.xlarge = \"\";\r\n\t\tthis.delay = 1;\r\n\t}\r\n}\r\n\r\nexport function CuiResizeComponent(prefix?: string): ICuiComponent {\r\n\treturn CuiComponentBaseHook({\r\n\t\tprefix: prefix,\r\n\t\tname: \"resize\",\r\n\t\tcreate: (\r\n\t\t\telement: HTMLElement,\r\n\t\t\tutils: CuiCore,\r\n\t\t\tprefix: string,\r\n\t\t\tattribute: string\r\n\t\t) => {\r\n\t\t\treturn new CuiResizeHandler(element, utils, attribute);\r\n\t\t},\r\n\t});\r\n}\r\n\r\nexport class CuiResizeHandler extends CuiHandlerBase<CuiResizeArgs> {\r\n\tprivate _currentValue: string | undefined;\r\n\tprivate _lastValue: string;\r\n\tprivate _currentAction: ICuiComponentAction | undefined;\r\n\tprivate _isIntersecting: boolean;\r\n\tprivate _task: ICuiTask;\r\n\tprivate _busFacade: ICuiEventBusFacade;\r\n\tprivate _resizeValueCalculator: ICuiResizeCalculator<CuiResizeArgs>;\r\n\tprivate _interactions: ICuiInteractionsFacade;\r\n\r\n\tconstructor(element: HTMLElement, utils: CuiCore, attribute: string) {\r\n\t\tsuper(\r\n\t\t\t\"CuiResizeHandler\",\r\n\t\t\telement,\r\n\t\t\tattribute,\r\n\t\t\tnew CuiResizeArgs(),\r\n\t\t\tutils\r\n\t\t);\r\n\t\tthis._busFacade = getEventBusFacade(this.cuid, utils.bus, element);\r\n\t\tthis._lastValue = \"\";\r\n\t\tthis._currentValue = \"\";\r\n\t\tthis._isIntersecting = false;\r\n\t\tthis._currentAction = undefined;\r\n\t\tthis._interactions = getCuiHandlerInteractions(utils.interactions);\r\n\t\tthis._resizeValueCalculator = getResizeCalculator(this.args.mode);\r\n\t\tthis._task = new CuiTaskRunner(\r\n\t\t\tthis.args.delay,\r\n\t\t\tfalse,\r\n\t\t\tthis.updateAction.bind(this)\r\n\t\t);\r\n\t\tconst intersectionObserver = new CuiIntersectionObserver(\r\n\t\t\tdocument.documentElement,\r\n\t\t\t[0, 0.1]\r\n\t\t);\r\n\t\tintersectionObserver.setCallback(this.onIntersection.bind(this));\r\n\t\tthis.extend(\r\n\t\t\tcuiObserverExtension({\r\n\t\t\t\ttype: \"intersection\",\r\n\t\t\t\telement: element,\r\n\t\t\t\tobserver: intersectionObserver,\r\n\t\t\t})\r\n\t\t);\r\n\t\tthis.extend(\r\n\t\t\teventExtension(this._busFacade, {\r\n\t\t\t\teventName: EVENTS.RESIZE,\r\n\t\t\t\tperformer: callbackPerformer(this.resize.bind(this)),\r\n\t\t\t})\r\n\t\t);\r\n\t}\r\n\r\n\tasync onHandle(): Promise<boolean> {\r\n\t\tthis.handleUpdate();\r\n\t\treturn true;\r\n\t}\r\n\r\n\tasync onRefresh(): Promise<boolean> {\r\n\t\tthis.handleUpdate();\r\n\t\treturn true;\r\n\t}\r\n\r\n\tasync onRemove(): Promise<boolean> {\r\n\t\tthis._busFacade.detachEmittedEvents();\r\n\t\treturn true;\r\n\t}\r\n\r\n\thandleUpdate() {\r\n\t\tthis._resizeValueCalculator = getResizeCalculator(this.args.mode);\r\n\t\tthis._isIntersecting = isInViewport(this.element);\r\n\t\tthis._task.setTimeout(this.args.delay);\r\n\t\tthis.setNewValue(calcWindowSize(window.innerWidth));\r\n\t\tthis.updateElement();\r\n\t}\r\n\r\n\tprivate resize(data: CuiResizeData) {\r\n\t\tthis.setNewValue(data.current);\r\n\t\tthis.updateElement();\r\n\t}\r\n\r\n\tprivate onIntersection(entries: IntersectionObserverEntry[]) {\r\n\t\tif (entries.length > 0) {\r\n\t\t\tthis._isIntersecting = entries[0].isIntersecting;\r\n\t\t}\r\n\t\tthis.updateElement();\r\n\t}\r\n\r\n\tprivate setNewValue(size: CuiWindowSize) {\r\n\t\tlet newValue = this._resizeValueCalculator.get(this.args, size);\r\n\t\tif (newValue !== this._currentValue) {\r\n\t\t\tthis._currentValue = newValue;\r\n\t\t}\r\n\t}\r\n\r\n\tprivate updateElement() {\r\n\t\tif (this.cannotUpdate()) {\r\n\t\t\t//this.logInfo(\"Not intersecting\")\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (!this._currentValue || this._lastValue === this._currentValue) {\r\n\t\t\t//this.logWarning(\"Not eligible to set value: \" + this._currentValue)\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis._lastValue = this._currentValue;\r\n\t\tthis._task.start();\r\n\t}\r\n\r\n\t/**\r\n\t * Checks whether element can be updated\r\n\t * @returns\r\n\t */\r\n\tprivate cannotUpdate() {\r\n\t\treturn !this._isIntersecting && this.args.mode === \"smart\";\r\n\t}\r\n\r\n\t/**\r\n\t * Used for task to update action on the element after receiving resize\r\n\t */\r\n\tprivate updateAction() {\r\n\t\t//@ts-ignore already checked\r\n\t\tlet newAction = CuiActionsFactory.get(this._currentValue);\r\n\t\tthis._interactions.mutate(() => {\r\n\t\t\tif (this._currentAction) {\r\n\t\t\t\tthis._currentAction.remove(this.element);\r\n\t\t\t}\r\n\t\t\tnewAction.add(this.element);\r\n\t\t\tthis._currentAction = newAction;\r\n\t\t});\r\n\t}\r\n}\r\n","import { ICuiHandlerExtension } from \"src/core/handlers/extensions/interfaces\";\r\nimport { ICuiObserver } from \"src/core/models/interfaces\";\r\n\r\nexport interface ICuiObserverExtensionSetup {\r\n    type?: string;\r\n    element: HTMLElement;\r\n    observer: ICuiObserver;\r\n}\r\n\r\nexport class CuiObserverExtension implements ICuiHandlerExtension<any> {\r\n    type: string;\r\n    description: string;\r\n\r\n    private _observer: ICuiObserver;\r\n    private _element: HTMLElement;\r\n\r\n    constructor(element: HTMLElement, observer: ICuiObserver) {\r\n        this.type = 'observer';\r\n        this.description = \"\";\r\n        this._observer = observer;\r\n        this._element = element;\r\n    }\r\n\r\n    async init(args: any): Promise<boolean> {\r\n        this._observer.connect();\r\n        this._observer.observe(this._element);\r\n        return true;\r\n    }\r\n\r\n    async destroy(): Promise<boolean> {\r\n        this._observer.unobserve(this._element);\r\n        this._observer.disconnect();\r\n        return true;\r\n    }\r\n\r\n}\r\n\r\nexport function cuiObserverExtension(setup: ICuiObserverExtensionSetup): ICuiHandlerExtension<any> {\r\n    return {\r\n        type: setup.type ?? \"observer\",\r\n        init: async () => {\r\n            setup.observer.connect();\r\n            setup.observer.observe(setup.element);\r\n            return true;\r\n        },\r\n        destroy: async () => {\r\n            setup.observer.unobserve(setup.element);\r\n            setup.observer.disconnect();\r\n            return true;\r\n        }\r\n\r\n    }\r\n}","import { ICuiExtensionPerformer, ICuiPerformerCallback } from \"../interfaces\";\r\n\r\nexport interface ICuiClickPerfromerHook extends ICuiExtensionPerformer<MouseEvent> {\r\n    preventDefault(flag: boolean): void;\r\n    stopPropagation(flag: boolean): void;\r\n}\r\n\r\nexport interface ICuiClickPerformer<T> extends ICuiClickPerfromerHook, ICuiPerformerCallback<T> { }\r\n\r\n\r\nexport class CuiClickPerformer implements ICuiClickPerformer<MouseEvent> {\r\n    private _preventDefault: boolean;\r\n    private _stopPropagation: boolean;\r\n    private _callback: ((t: MouseEvent) => void) | undefined;\r\n\r\n    constructor() {\r\n        this._preventDefault = false;\r\n        this._stopPropagation = false;\r\n        this._callback = undefined;\r\n\r\n    }\r\n\r\n    setCallback(callback: (t: MouseEvent) => void): void {\r\n        this._callback = callback;\r\n    }\r\n\r\n    perform(arg: MouseEvent): void {\r\n        if (!this._callback) {\r\n            return;\r\n        }\r\n\r\n        this._callback(arg);\r\n        if (this._preventDefault) {\r\n            arg.preventDefault();\r\n        }\r\n        if (this._stopPropagation) {\r\n            arg.stopPropagation();\r\n        }\r\n    }\r\n\r\n    preventDefault(flag: boolean): void {\r\n        this._preventDefault = flag;\r\n    }\r\n\r\n    stopPropagation(flag: boolean): void {\r\n        this._stopPropagation = flag\r\n    }\r\n}\r\n\r\n\r\n\r\nexport function clickPerformer(callback: (ev: MouseEvent) => void): ICuiClickPerfromerHook {\r\n    let _prevent = false;\r\n    let _stopPropagation = false;\r\n\r\n    return {\r\n        perform: (ev: MouseEvent) => {\r\n            callback(ev);\r\n            if (_prevent)\r\n                ev.preventDefault();\r\n            if (_stopPropagation)\r\n                ev.stopPropagation();\r\n        },\r\n        stopPropagation: flag => _stopPropagation = flag,\r\n        preventDefault: flag => _prevent = flag,\r\n    }\r\n}","import { ICuiComponent } from \"../../core/models/interfaces\";\r\nimport { CuiCore } from \"../../core/models/core\";\r\nimport { CuiHandlerBase } from \"../../core/handlers/base\";\r\nimport { EVENTS } from \"../../core/utils/statics\";\r\nimport { is, getOffsetTop, getEnumOrDefault } from \"../../core/utils/functions\";\r\nimport { CuiAutoParseArgs } from \"../../core/utils/arguments\";\r\nimport { clickExtension } from \"../extensions/click/click\";\r\nimport { CuiClickableArgs } from \"../../core/models/arguments\";\r\nimport { CuiScrollByEvent } from \"../../core/models/events\";\r\nimport { getEventBusFacade, ICuiEventBusFacade } from \"../../core/handlers/extensions/facades\";\r\nimport { clickPerformer, ICuiClickPerfromerHook } from \"../extensions/click/performer\";\r\nimport { CuiComponentBaseHook } from \"../base\";\r\n\r\n\r\n/**\r\n * Component scrolls to specified target in the document\r\n * Arguments:\r\n * target - selector to target element where page should be scrolled to.\r\n * parent - set parent selector if parent should be different than html parent\r\n * behavior - auto/smooth - choose between step and smooth scrolling\r\n *\r\n */\r\n\r\nexport class CuiScrollArgs extends CuiAutoParseArgs implements CuiClickableArgs {\r\n    target: string;\r\n    parent: string;\r\n    behavior: 'auto' | 'smooth';\r\n    prevent: boolean;\r\n    stopPropagation: boolean;\r\n\r\n    constructor() {\r\n        super({\r\n            props: {\r\n                \"behavior\": { corrector: (value: string) => getEnumOrDefault(value, 'auto', 'smooth') }\r\n            }\r\n        });\r\n        this.target = \"\";\r\n        this.parent = \"\";\r\n        this.behavior = 'auto';\r\n        this.stopPropagation = false;\r\n        this.prevent = false;\r\n    }\r\n\r\n}\r\n\r\n\r\nexport function CuiScrollComponent(prefix?: string): ICuiComponent {\r\n    return CuiComponentBaseHook({\r\n        prefix: prefix,\r\n        name: \"scroll\",\r\n        create: (element: HTMLElement, utils: CuiCore, prefix: string, attribute: string) => {\r\n            return new CuiScrollHandler(element, utils, attribute);\r\n        }\r\n    })\r\n}\r\n\r\nexport class CuiScrollHandler extends CuiHandlerBase<CuiScrollArgs> {\r\n\r\n    private _busFacade: ICuiEventBusFacade;\r\n    private _clickPerformer: ICuiClickPerfromerHook;\r\n\r\n    constructor(element: HTMLElement, utils: CuiCore, attribute: string) {\r\n        super(\"CuiScrollHandler\", element, attribute, new CuiScrollArgs(), utils);\r\n        this._busFacade = getEventBusFacade(this.cuid, utils.bus, element);\r\n        this._clickPerformer = clickPerformer(this.onClick.bind(this));\r\n        this.extend(clickExtension({\r\n            element: element,\r\n            performer: this._clickPerformer\r\n        }));\r\n    }\r\n\r\n    async onHandle(): Promise<boolean> {\r\n        this.handleUpdate();\r\n        return true;\r\n    }\r\n    async onRefresh(): Promise<boolean> {\r\n        this.handleUpdate();\r\n        return true;\r\n    }\r\n    async onRemove(): Promise<boolean> {\r\n        this._busFacade.detachEmittedEvents();\r\n        return true;\r\n    }\r\n\r\n    handleUpdate() {\r\n        this._clickPerformer.preventDefault(this.args.prevent);\r\n        this._clickPerformer.stopPropagation(this.args.stopPropagation);\r\n    }\r\n\r\n    onClick(ev: MouseEvent) {\r\n        const target = this.getTarget();\r\n        const parent = this.getTargetsParent(target);\r\n\r\n        if (!target || !parent) {\r\n            return;\r\n        }\r\n\r\n        let to = getOffsetTop(target) - parent.offsetTop;\r\n        let from = parent.scrollTop;\r\n        let by = to - from;\r\n\r\n        parent.scrollBy({\r\n            top: by,\r\n            behavior: this.args.behavior\r\n        });\r\n\r\n        this._busFacade.emit<CuiScrollByEvent>(EVENTS.ON_SCROLL, {\r\n            to: to,\r\n            by: by,\r\n            target: target,\r\n            parent: parent\r\n        })\r\n    }\r\n\r\n    private getTarget(): HTMLElement | null {\r\n        return is(this.args.target) ? document.querySelector<HTMLElement>(this.args.target) : null;\r\n    }\r\n\r\n    private getTargetsParent(target: HTMLElement | null): HTMLElement | null {\r\n        return is(this.args.parent) ? document.querySelector(this.args.parent) : target ? target.parentElement : null;\r\n    }\r\n}\r\n\r\n","import { ICuiEventBusFacade } from \"src/core/handlers/extensions/facades\";\r\nimport { ICuiHandlerExtension } from \"../../../core/handlers/extensions/interfaces\";\r\nimport { EVENTS } from \"../../../core/utils/statics\";\r\n\r\nexport class CuiSwitchExtension implements ICuiHandlerExtension<any> {\r\n    type: string;\r\n    description: string;\r\n    _busFacade: ICuiEventBusFacade;\r\n\r\n    private _callback: (value: any) => void;\r\n    private _switchEventId: string | null;\r\n    constructor(busFacade: ICuiEventBusFacade, callback: (value: any) => void) {\r\n        this.type = 'switch';\r\n        this.description = \"\";\r\n        this._busFacade = busFacade;\r\n\r\n        this._switchEventId = null;\r\n        this._callback = callback;\r\n    }\r\n\r\n    async init(args: any): Promise<boolean> {\r\n        this._switchEventId = this._busFacade.on<any>(EVENTS.SWITCH, this.onSwitch.bind(this));\r\n        return true;\r\n    }\r\n\r\n    // update?(args: any): Promise<boolean> {\r\n    //     return true;\r\n    // }\r\n\r\n    async destroy(): Promise<boolean> {\r\n        this._busFacade.detach(EVENTS.SWITCH, this._switchEventId)\r\n        return true;\r\n    }\r\n\r\n    onSwitch(value: any) {\r\n        if (!value) {\r\n            return\r\n        }\r\n        this._callback(value);\r\n    }\r\n}","import { ICuiElementBox } from \"../../core/models/elements\";\r\nimport { getOffsetLeft, getOffsetTop } from \"../../core/utils/functions\";\r\nimport { ScrollDirection, ScrollPerformerHelper } from \"./interfaces\";\r\n\r\nexport function getScrollHelper(direction: ScrollDirection, box: ICuiElementBox, behavior: ScrollBehavior) {\r\n    return direction === 'x' ? ScrollXHelper(box, behavior) : ScrollYHelper(box, behavior);\r\n}\r\n\r\nexport function ScrollYHelper(box: ICuiElementBox, behavior: ScrollBehavior): ScrollPerformerHelper {\r\n    function scroll(position: number) {\r\n        box.scrollTo({\r\n            left: 0,\r\n            top: position,\r\n            behavior: behavior\r\n        })\r\n    }\r\n    return {\r\n        scrollTo: (position: number) => {\r\n            scroll(position)\r\n        },\r\n        toIndex: (index: number) => {\r\n            scroll(index * box.getHeight());\r\n        },\r\n        getPagesCount: () => {\r\n            return calcPages(box.getScrollHeight(), box.getHeight());\r\n        },\r\n        getCurrentPage: () => {\r\n            return calcPages(box.getScrollTop(), box.getHeight())\r\n        },\r\n        toLast: () => {\r\n            scroll(box.getScrollHeight() - box.getHeight());\r\n        },\r\n        toPercent: (value: number) => {\r\n            const ratio = value / 100;\r\n            scroll(ratio * box.getScrollHeight());\r\n        },\r\n        toSelector: (selector: string) => {\r\n            const found = box.queryAll(selector);\r\n            if (found.length === 0) {\r\n                return false;\r\n            }\r\n            const to = getOffsetTop(found[0]) - box.getTop();\r\n            scroll(to);\r\n            return true;\r\n        }\r\n    }\r\n}\r\n\r\nexport function ScrollXHelper(box: ICuiElementBox, behavior: ScrollBehavior): ScrollPerformerHelper {\r\n    function scroll(position: number) {\r\n        box.scrollTo({\r\n            left: position,\r\n            top: 0,\r\n            behavior: behavior\r\n        })\r\n    }\r\n    return {\r\n        scrollTo: (position: number) => {\r\n            scroll(position)\r\n        },\r\n        toIndex: (index: number) => {\r\n            scroll(index * box.getWidth());\r\n        },\r\n        getPagesCount: () => {\r\n            return calcPages(box.getScrollWidth(), box.getWidth());\r\n        },\r\n        getCurrentPage: () => {\r\n            return calcPages(box.getScrollLeft(), box.getWidth())\r\n        },\r\n        toLast: () => {\r\n            scroll(box.getScrollWidth() - box.getWidth());\r\n        },\r\n        toPercent: (value: number) => {\r\n            const ratio = value / 100;\r\n            scroll(ratio * box.getScrollWidth());\r\n        },\r\n        toSelector: (selector: string) => {\r\n            const found = box.queryAll(selector);\r\n            if (found.length === 0) {\r\n                return false;\r\n            }\r\n            const to = getOffsetLeft(found[0]) - box.getLeft();\r\n            scroll(to);\r\n            return true;\r\n        }\r\n    }\r\n}\r\n\r\n\r\n\r\nfunction calcPages(scrollSize: number, size: number): number {\r\n    return Math.ceil(scrollSize / size);\r\n}","import { CuiScrollPerformerOptions, ScrollPerformerHelper, ICuiScrollSwitchPerformer } from \"./interfaces\";\r\n\r\nexport const ScrollSwitchPerformers: ICuiScrollSwitchPerformer[] = [\r\n    getPercentPerformer(),\r\n    getToIndexPerform(),\r\n    getToFirstPerform(),\r\n    getToLastPerform(),\r\n    getToNextPerform(),\r\n    getToPrevPerform(),\r\n    getTargetPerformer()\r\n]\r\n\r\nexport function getTargetPerformer(): ICuiScrollSwitchPerformer {\r\n    return {\r\n        name: \"target\",\r\n        check: (arg: any) => {\r\n            return true;\r\n        },\r\n        perform: (arg: any, helper: ScrollPerformerHelper, options: CuiScrollPerformerOptions): boolean => {\r\n            return helper.toSelector(arg);\r\n        }\r\n    }\r\n}\r\n\r\nexport function getToLastPerform(): ICuiScrollSwitchPerformer {\r\n    return getStringBasedPerformer('last', (helper: ScrollPerformerHelper) => {\r\n        helper.toLast();\r\n        return true;\r\n    })\r\n}\r\n\r\nexport function getToFirstPerform(): ICuiScrollSwitchPerformer {\r\n    return getStringBasedPerformer('first', (helper: ScrollPerformerHelper) => {\r\n        helper.scrollTo(0);\r\n        return true;\r\n    })\r\n}\r\n\r\nexport function getToIndexPerform(): ICuiScrollSwitchPerformer {\r\n    let num: number = 0;\r\n    return {\r\n        name: 'index',\r\n        check: (arg: any) => {\r\n            num = parseInt(arg);\r\n            return !isNaN(num);\r\n        },\r\n        perform: (arg: any, helper: ScrollPerformerHelper, options: CuiScrollPerformerOptions) => {\r\n            helper.toIndex(num > 0 ? num - 1 : num);\r\n            return true;\r\n        }\r\n    }\r\n}\r\n\r\nexport function getToNextPerform(): ICuiScrollSwitchPerformer {\r\n    return getStringBasedPerformer('next', (helper: ScrollPerformerHelper, options: CuiScrollPerformerOptions) => {\r\n        const count = helper.getPagesCount();\r\n        const current = helper.getCurrentPage();\r\n        if (current >= count - 1) {\r\n            if (!options.loop) {\r\n                return false;\r\n            }\r\n            helper.scrollTo(0);\r\n        }\r\n\r\n        helper.toIndex(current + 1)\r\n        return true;\r\n    })\r\n}\r\n\r\nexport function getToPrevPerform(): ICuiScrollSwitchPerformer {\r\n    return getStringBasedPerformer('prev',\r\n        (helper: ScrollPerformerHelper, options: CuiScrollPerformerOptions) => {\r\n            const current = helper.getCurrentPage();\r\n            if (current === 0) {\r\n                if (!options.loop) {\r\n                    return false;\r\n                }\r\n                helper.toLast();\r\n            }\r\n\r\n            helper.toIndex(current - 1);\r\n            return true;\r\n        }\r\n    )\r\n}\r\n\r\nexport function getPercentPerformer(): ICuiScrollSwitchPerformer {\r\n    let num: number = -1;\r\n    return {\r\n        name: 'percent',\r\n        check: (arg: any) => {\r\n            if (!arg.match('%')) {\r\n                return false;\r\n            }\r\n            const strValue = arg.substring(0, arg.length - 1);\r\n            num = parseInt(strValue);\r\n            return !isNaN(num);\r\n        },\r\n        perform: (arg: any, helper: ScrollPerformerHelper, options: CuiScrollPerformerOptions) => {\r\n            helper.toPercent(num);\r\n            return true;\r\n        }\r\n    }\r\n}\r\n\r\nfunction getStringBasedPerformer(name: string, callback: (helper: ScrollPerformerHelper, options: CuiScrollPerformerOptions) => boolean): ICuiScrollSwitchPerformer {\r\n    return {\r\n        name: name,\r\n        check: (arg: any) => {\r\n            return arg === name;\r\n        },\r\n        perform: (arg: any, helper: ScrollPerformerHelper, options: CuiScrollPerformerOptions) => {\r\n            return callback(helper, options)\r\n        }\r\n    }\r\n}","import { EVENTS } from \"../../core/utils/statics\";\r\nimport { CuiHandlerBase } from \"../../core/handlers/base\";\r\nimport { getEventBusFacade, ICuiEventBusFacade } from \"../../core/handlers/extensions/facades\";\r\nimport { CuiCore } from \"../../core/models/core\";\r\nimport { CuiElementBoxFactory, ICuiElementBox } from \"../../core/models/elements\";\r\nimport { ICuiComponent } from \"../../core/models/interfaces\";\r\nimport { CuiAutoParseArgs } from \"../../core/utils/arguments\";\r\nimport { CuiComponentBaseHook } from \"../base\";\r\nimport { CuiSwitchExtension } from \"../extensions/switch/switch\";\r\nimport { getScrollHelper } from \"./helper\";\r\nimport { ScrollDirection, ICuiScrollSwitchPerformer, ScrollPerformerHelper } from \"./interfaces\";\r\nimport { ScrollSwitchPerformers } from \"./perform\";\r\nimport { getCuiElementsBySelector, is } from \"../../core/utils/functions\";\r\n\r\nexport class CuiScrollSwitchArgs extends CuiAutoParseArgs {\r\n    mode: ScrollBehavior;\r\n    direction: ScrollDirection;\r\n    loop: boolean;\r\n    switch: string;\r\n    constructor() {\r\n        super();\r\n        this.mode = 'auto';\r\n        this.direction = \"y\";\r\n        this.loop = false;\r\n        this.switch = \"\";\r\n    }\r\n}\r\n\r\nexport function CuiScrollSwitchComponent(prefix?: string): ICuiComponent {\r\n    return CuiComponentBaseHook({\r\n        prefix: prefix,\r\n        name: \"scroll-switch\",\r\n        create: (element: HTMLElement, core: CuiCore, prefix: string, attribute: string) => {\r\n            return new CuiScrollSwitchHandler(element, attribute, core);\r\n        }\r\n    })\r\n}\r\n\r\nexport class CuiScrollSwitchHandler extends CuiHandlerBase<CuiScrollSwitchArgs> {\r\n    private _busFacade: ICuiEventBusFacade;\r\n    private _root: ICuiElementBox;\r\n    private _scrollPerformers: ICuiScrollSwitchPerformer[];\r\n    // @ts-ignore helper is assigned be setArgs in the construcor\r\n    private _helper: ScrollPerformerHelper;\r\n\r\n    constructor(element: HTMLElement, attribute: string, core: CuiCore) {\r\n        super(\"CuiScrollSwitchHandler\", element, attribute, new CuiScrollSwitchArgs(), core);\r\n\r\n        this._busFacade = getEventBusFacade(this.cuid, core.bus, element);\r\n        this._root = CuiElementBoxFactory.get(element);\r\n        this._scrollPerformers = ScrollSwitchPerformers;\r\n        this.setArgs();\r\n        this.extend(new CuiSwitchExtension(this._busFacade, this.switch.bind(this)))\r\n    }\r\n\r\n    async onHandle(): Promise<boolean> {\r\n        this.setArgs();\r\n        return true;\r\n    }\r\n\r\n    async onRefresh(): Promise<boolean> {\r\n        this.setArgs();\r\n        return true;\r\n    }\r\n\r\n    async onRemove(): Promise<boolean> {\r\n        this._busFacade.detachEmittedEvents();\r\n        return true;\r\n    }\r\n\r\n    private switch(arg: any) {\r\n        if (!arg) {\r\n            return;\r\n        }\r\n\r\n        const performer = this._scrollPerformers.find(p => p.check(arg));\r\n        if (!performer) {\r\n            this.logWarning(\"Cannot find matching performer\", 'switch');\r\n            return;\r\n        }\r\n\r\n        const result = performer.perform(arg, this._helper, {\r\n            behavior: this.args.mode,\r\n            loop: this.args.loop\r\n        })\r\n\r\n        if (!result) {\r\n            this.logWarning(\"Switch \" + performer.name + \" was not performed\", 'switch');\r\n            return;\r\n        }\r\n\r\n        this.emitSwitch(arg);\r\n\r\n        this._busFacade.emit(EVENTS.SWITCHED, {\r\n            timestamp: Date.now(),\r\n            index: arg\r\n        })\r\n\r\n    }\r\n\r\n    private setArgs() {\r\n        this._helper = getScrollHelper(this.args.direction, this._root, this.args.mode)\r\n    }\r\n\r\n    private async emitSwitch(arg: any): Promise<boolean> {\r\n        if (!is(this.args.switch)) {\r\n            return false;\r\n        }\r\n\r\n        const elements = getCuiElementsBySelector(this.args.switch);\r\n        const promises: Promise<boolean>[] = [];\r\n        elements.forEach(element => {\r\n            promises.push(this.core.bus.emit(EVENTS.SWITCH, element.$cuid, arg));\r\n        })\r\n        await Promise.all(promises);\r\n        return true;\r\n\r\n    }\r\n\r\n}","\r\nimport { CuiIntersectionResultItem } from \"../../core/intersection/interfaces\";\r\nimport { ICuiComponentAction } from \"../../core/utils/actions\";\r\nimport { are, is } from \"../../core/utils/functions\";\r\n\r\nexport interface CuiScrollspyUpdateResult {\r\n    intersecting?: HTMLElement[];\r\n    changed: boolean;\r\n}\r\n\r\nexport interface ICuiScrollspyModeHandler {\r\n    update(items: CuiIntersectionResultItem[], ratio: number, actions: ICuiComponentAction[], links: HTMLElement[], linksActions: ICuiComponentAction[]): CuiScrollspyUpdateResult;\r\n}\r\n\r\nexport class CuiScrollSpyModeHandlerFactory {\r\n    static get(mode: string) {\r\n        if (mode === \"multi\") {\r\n            return new CuiMultiModeHandler();\r\n        }\r\n        return new CuiSingleModeHandler();\r\n    }\r\n}\r\n\r\nabstract class CuiModeHandlerBase<T> {\r\n    previous: T;\r\n    constructor(init: T) {\r\n        this.previous = init;\r\n    }\r\n\r\n\r\n    getMatching(ratio: number, items: CuiIntersectionResultItem[]): number[] {\r\n        return items.reduce((result: number[], item: CuiIntersectionResultItem, index: number) => {\r\n            if (item.verticalRatio > ratio) {\r\n                result.push(index);\r\n            }\r\n            return result;\r\n        }, [])\r\n    }\r\n\r\n    addActions(actions: ICuiComponentAction[], ...elements: HTMLElement[]) {\r\n        this.forEachAction(actions, elements, (action, element) => {\r\n            action.add(element);\r\n        })\r\n    }\r\n\r\n    removeActions(actions: ICuiComponentAction[], ...elements: HTMLElement[]) {\r\n        this.forEachAction(actions, elements, (action, element) => {\r\n            action.remove(element);\r\n        })\r\n    }\r\n\r\n    private forEachAction(actions: ICuiComponentAction[], elements: HTMLElement[], callback: (action: ICuiComponentAction, element: HTMLElement) => void): void {\r\n        if (!are(actions, elements, callback)) {\r\n            return;\r\n        }\r\n        actions.forEach(action => {\r\n            elements.forEach(element => {\r\n                if (is(element))\r\n                    callback(action, element);\r\n            })\r\n        })\r\n    }\r\n\r\n    abstract matches(item: T): boolean;\r\n\r\n}\r\n\r\nexport class CuiSingleModeHandler extends CuiModeHandlerBase<number> implements ICuiScrollspyModeHandler {\r\n\r\n    constructor() {\r\n        super(-1);\r\n    }\r\n\r\n    update(items: CuiIntersectionResultItem[], ratio: number, actions: ICuiComponentAction[], links: HTMLElement[], linksActions: ICuiComponentAction[]): CuiScrollspyUpdateResult {\r\n        let matching = this.getMatching(ratio, items);\r\n        let len = matching.length;\r\n        let last = len > 0 ? matching[len - 1] : -1;\r\n        let result: CuiScrollspyUpdateResult = {\r\n            changed: false\r\n        }\r\n        if (!this.matches(last)) {\r\n            if (this.previous > -1)\r\n                this.removeActions(actions, items[this.previous].element);\r\n            if (last > -1) {\r\n                let lastElement = items[last].element;\r\n                result.intersecting = [lastElement]\r\n                this.addActions(actions, lastElement)\r\n            }\r\n            if (are(links, linksActions)) {\r\n                if (this.previous > -1)\r\n                    this.removeActions(linksActions, links[this.previous]);\r\n                if (last > -1)\r\n                    this.addActions(linksActions, links[last])\r\n            }\r\n            this.previous = last;\r\n            result.changed = true;\r\n            result.intersecting = []\r\n            return result;\r\n        }\r\n        return result;\r\n    }\r\n\r\n    matches(item: number): boolean {\r\n        return item === this.previous;\r\n    }\r\n}\r\n\r\nexport class CuiMultiModeHandler extends CuiModeHandlerBase<number[]> implements ICuiScrollspyModeHandler {\r\n    constructor() {\r\n        super([]);\r\n    }\r\n    update(items: CuiIntersectionResultItem[], ratio: number, actions: ICuiComponentAction[], links: HTMLElement[], linksActions: ICuiComponentAction[]): CuiScrollspyUpdateResult {\r\n        let matching = this.getMatching(ratio, items);\r\n        let result: CuiScrollspyUpdateResult = {\r\n            changed: false\r\n        }\r\n        if (!this.matches(matching)) {\r\n            let intersecting = matching.map(idx => { return items[idx].element })\r\n            this.removeActions(actions, ...this.previous.map(idx => { return items[idx].element }));\r\n            this.addActions(actions, ...intersecting)\r\n            result.intersecting = intersecting;\r\n            if (are(links, linksActions)) {\r\n                this.removeActions(linksActions, ...this.previous.map(idx => { return links[idx] }));\r\n                this.addActions(linksActions, ...matching.map(idx => { return links[idx] }))\r\n            }\r\n            this.previous = matching;\r\n            result.changed = true;\r\n            return result;\r\n        }\r\n        return result;\r\n    }\r\n\r\n    matches(item: number[]): boolean {\r\n        let len = item.length;\r\n        if (len !== this.previous.length) {\r\n            return false;\r\n        }\r\n        let i = 0;\r\n        for (i = 0; i < len; i++) {\r\n            if (!this.previous.includes(item[i])) {\r\n                return false;\r\n            }\r\n        }\r\n        return true;\r\n    }\r\n}","import { ICuiComponent } from \"../../core/models/interfaces\";\r\nimport { CuiCore } from \"../../core/models/core\";\r\nimport { CuiHandlerBase } from \"../../core/handlers/base\";\r\nimport { ICuiComponentAction, CuiActionsListFactory } from \"../../core/utils/actions\";\r\nimport { getRangeValueOrDefault, getEnumOrDefault, joinWithScopeSelector } from \"../../core/utils/functions\";\r\nimport { ATTRIBUTES, EVENTS } from \"../../core/utils/statics\";\r\nimport { CuiIntersectionResult } from \"../../core/intersection/interfaces\";\r\nimport { CuiElementBoxFactory, ICuiElementBox } from \"../../core/models/elements\";\r\nimport { CuiScrollSpyModeHandlerFactory, CuiScrollspyUpdateResult, ICuiScrollspyModeHandler } from \"./mode\";\r\nimport { CuiScrollspyScrollEvent } from \"../../core/models/events\";\r\nimport { CuiAutoParseArgs } from \"../../core/utils/arguments\";\r\nimport { CuiComponentBaseHook } from \"../base\";\r\nimport { getEventBusFacade, getCuiHandlerInteractions, ICuiEventBusFacade, ICuiInteractionsFacade } from \"../../core/handlers/extensions/facades\";\r\nimport { getCuiIntersectionPerformer, ICuiIntersectionPerformer } from \"../extensions/scroll/performers\";\r\nimport { getCuiScrollExtension } from \"../extensions/scroll/scroll\";\r\n\r\nconst DEFAULT_SELECTOR = \"> *\";\r\n\r\nexport interface CuiScrollspyTargetChangeEvent {\r\n    intersecting: HTMLElement[];\r\n    timestamp: number;\r\n}\r\n\r\nexport interface CuiScrollSpyAttribute {\r\n    selector?: string;\r\n    action?: string;\r\n    link?: string;\r\n    linkAction?: string;\r\n    ratio: number;\r\n    threshold: number;\r\n}\r\n\r\n\r\nexport class CuiScrollSpyArgs extends CuiAutoParseArgs {\r\n    selector: string; // Child selector\r\n    action: string; // Action to be performed on intersecting elements\r\n    link: string; // Link selector\r\n    linkAction: string; //Actions to be triggered on link\r\n    ratio: number; // Value 0..1 telling how much of a child view must be in view to be added to intersecting items\r\n    mode: \"single\" | \"multi\"; // Action is triggered on single (last) intersecting item or all intersecting items\r\n    threshold: number; // Threshold value (in px) for scroll listener\r\n\r\n    constructor() {\r\n        super({\r\n            props: {\r\n                \"selector\": { corrector: joinWithScopeSelector },\r\n                \"ratio\": { corrector: (value: any) => getRangeValueOrDefault(value, 0, 1, 0) },\r\n                'mode': { corrector: (value: string) => getEnumOrDefault(value, 'single', \"multi\") }\r\n            }\r\n        });\r\n        this.ratio = 0;\r\n        this.mode = \"single\";\r\n        this.threshold = -1;\r\n        this.selector = joinWithScopeSelector(DEFAULT_SELECTOR);\r\n        this.action = \"\";\r\n        this.link = \"\";\r\n        this.linkAction = \"\";\r\n    }\r\n}\r\n\r\n\r\nexport function CuiScrollspyComponent(prefix?: string): ICuiComponent {\r\n    return CuiComponentBaseHook({\r\n        prefix: prefix,\r\n        name: \"scrollspy\",\r\n        create: (element: HTMLElement, utils: CuiCore, prefix: string, attribute: string) => {\r\n            return new CuiScrollspyHandler(element, utils, attribute)\r\n        }\r\n    })\r\n}\r\n\r\nexport class CuiScrollspyHandler extends CuiHandlerBase<CuiScrollSpyArgs> {\r\n    private _links: HTMLElement[];\r\n    private _actions: ICuiComponentAction[];\r\n    private _linkActions: ICuiComponentAction[];\r\n    private _modeHandler: ICuiScrollspyModeHandler;\r\n\r\n    private _busFacade: ICuiEventBusFacade;\r\n    private _interactions: ICuiInteractionsFacade;\r\n    private _intersectionPerformer: ICuiIntersectionPerformer;\r\n    private _root: ICuiElementBox;\r\n\r\n\r\n    constructor(element: HTMLElement, utils: CuiCore, attribute: string) {\r\n        super(\"CuiScrollspyHandler\", element, attribute, new CuiScrollSpyArgs(), utils);\r\n        this._links = [];\r\n        this._actions = [];\r\n        this._linkActions = [];\r\n        this._modeHandler = CuiScrollSpyModeHandlerFactory.get(this.args.mode);\r\n        this._interactions = getCuiHandlerInteractions(utils.interactions);\r\n        this._busFacade = getEventBusFacade(this.cuid, utils.bus, element);\r\n        const root = element.hasAttribute(ATTRIBUTES.root) ? window : element;\r\n        this._root = CuiElementBoxFactory.get(root);\r\n        this._intersectionPerformer = getCuiIntersectionPerformer({\r\n            callback: this.onIntersection.bind(this),\r\n            element: root\r\n        })\r\n        this.extend(getCuiScrollExtension({\r\n            element: root,\r\n            performer: this._intersectionPerformer,\r\n            threshold: 5\r\n        }))\r\n    }\r\n\r\n    async onHandle(): Promise<boolean> {\r\n        this.updateSetup();\r\n        this._intersectionPerformer.callInitialEvent();\r\n        return true;\r\n    }\r\n    async onRefresh(): Promise<boolean> {\r\n        this.updateSetup();\r\n        return true;\r\n    }\r\n    async onRemove(): Promise<boolean> {\r\n        this._busFacade.detachEmittedEvents();\r\n        return true;\r\n    }\r\n\r\n    private onIntersection(ev: CuiIntersectionResult): void {\r\n        let timestamp = Date.now();\r\n        this._interactions.mutate(() => {\r\n            //@ts-ignore - modeHandler checked\r\n            let updateResult: CuiScrollspyUpdateResult = this._modeHandler.update(ev.items, this.args.ratio, this._actions, this._links, this._linkActions)\r\n            if (updateResult.changed) {\r\n                this._busFacade.emit(EVENTS.TARGET_CHANGE, {\r\n                    intersecting: updateResult.intersecting,\r\n                    timestamp: timestamp\r\n                })\r\n            }\r\n        })\r\n        this._busFacade.emit<CuiScrollspyScrollEvent>(EVENTS.ON_SCROLL, {\r\n            top: ev.top,\r\n            left: ev.left,\r\n            scrolling: ev.scrolling,\r\n            initial: ev.initial\r\n        })\r\n    }\r\n\r\n    private updateSetup() {\r\n        let targets = this.args.selector ? this._root.queryAll(this.args.selector) : [];\r\n        this._intersectionPerformer.setChildren(targets);\r\n        this._links = this.args.link ? [...document.querySelectorAll<HTMLElement>(this.args.link)] : [];\r\n        this._actions = CuiActionsListFactory.get(this.args.action);\r\n        this._linkActions = CuiActionsListFactory.get(this.args.linkAction);\r\n        this._modeHandler = CuiScrollSpyModeHandlerFactory.get(this.args.mode);\r\n\r\n    }\r\n}","import { is } from \"../../utils/functions\";\r\nimport { ICuiElementDetector } from \"./interfaces\";\r\n\r\n/**\r\n * threshold keeps a outside margin value to extend box outside of an element\r\n */\r\n\r\nexport class CuiSimpleDragOverDetector implements ICuiElementDetector {\r\n    _elements: Element[];\r\n    _count: number;\r\n    _threshold: number;\r\n    constructor() {\r\n        this._elements = [];\r\n        this._count = 0;\r\n        this._threshold = 5;\r\n    }\r\n\r\n    setElements(elements: Element[]): void {\r\n        this._elements = elements;\r\n        this._count = this._elements.length;\r\n    }\r\n\r\n    setThreshold(value: number) {\r\n        this._threshold = value\r\n    }\r\n\r\n    detect(x: Number, y: Number): [number, Element | undefined] {\r\n        if (!is(this._elements)) {\r\n            return [-1, undefined];\r\n        }\r\n\r\n        let idx: number = -1;\r\n        let found: Element | undefined = undefined;\r\n\r\n        for (let i = 0; i < this._count; i++) {\r\n            if (this.isInBounds(this._elements[i], x, y)) {\r\n                if (i === 0) {\r\n                    idx = i;\r\n                    found = this._elements[i];\r\n                    //break;\r\n                } else if (i < this._count - 1) {\r\n                    idx = i + 1;\r\n                    found = this._elements[i + 1];\r\n                    //break;\r\n                }\r\n                break;\r\n            }\r\n        }\r\n\r\n        return [idx, found];\r\n    }\r\n\r\n    private isInBounds(element: Element, x: Number, y: Number): boolean {\r\n        const box = element.getBoundingClientRect();\r\n        return x > box.left - this._threshold && x < box.left + box.width + this._threshold &&\r\n            y > box.top - this._threshold && y < box.top + box.height + this._threshold;\r\n    }\r\n\r\n}","import { ElementBuilder } from \"../../core/builders/element\";\r\nimport { CuiHandlerBase } from \"../../core/handlers/base\";\r\nimport { CuiSimpleDragOverDetector } from \"../../core/handlers/drag/detectors\";\r\nimport { ICuiElementDetector } from \"../../core/handlers/drag/interfaces\";\r\nimport {\r\n\tCuiSwipeAnimationEngine,\r\n\tPropsTypes,\r\n} from \"../../core/animation/engine\";\r\nimport { AnimationProperty } from \"../../core/animation/interfaces\";\r\nimport { ICuiMoveData } from \"../../core/listeners/move\";\r\nimport { ICuiParsable, ICuiComponent } from \"../../core/models/interfaces\";\r\nimport { CuiCore } from \"../../core/models/core\";\r\nimport {\r\n\treplacePrefix,\r\n\tis,\r\n\tare,\r\n\tjoinWithScopeSelector,\r\n} from \"../../core/utils/functions\";\r\nimport { EVENTS, CLASSES } from \"../../core/utils/statics\";\r\nimport { CuiAutoParseArgs } from \"../../core/utils/arguments\";\r\nimport { SortEvent } from \"../../core/models/events\";\r\nimport { CuiComponentBaseHook } from \"../base\";\r\nimport {\r\n\tgetCuiHandlerInteractions,\r\n\tgetEventBusFacade,\r\n\tICuiEventBusFacade,\r\n\tICuiInteractionsFacade,\r\n} from \"../../core/handlers/extensions/facades\";\r\nimport { moveExtension } from \"../extensions/move/move\";\r\nimport { getEaseTimingFunction } from \"../../core/animation/calculators\";\r\nimport { CuiTimeAnimationEngines } from \"../../core/animation/factory\";\r\nimport {\r\n\tgetDragMovePerformer,\r\n\tICuiDragExtensionPerformer,\r\n} from \"../extensions/move/performer\";\r\n\r\nconst SORTABLE_IS_MOVING = \"{prefix}-moving\";\r\nconst DEFAULT_SELECTOR = \" > *\";\r\nconst SORTABLE_PREVIEW_CLS = \"{prefix}-sortable-preview\";\r\nconst SORTABLE_LOCKED = \"{prefix}-locked\";\r\n\r\nexport class CuiSortableArgs extends CuiAutoParseArgs implements ICuiParsable {\r\n\ttarget: string;\r\n\ttrigger: string;\r\n\ttimeout: number;\r\n\tthreshold: number;\r\n\r\n\tconstructor() {\r\n\t\tsuper({\r\n\t\t\tprops: {\r\n\t\t\t\ttarget: { corrector: joinWithScopeSelector },\r\n\t\t\t\ttrigger: { corrector: joinWithScopeSelector },\r\n\t\t\t},\r\n\t\t});\r\n\r\n\t\tthis.target = joinWithScopeSelector(DEFAULT_SELECTOR);\r\n\t\tthis.trigger = joinWithScopeSelector(DEFAULT_SELECTOR);\r\n\t\tthis.timeout = 150;\r\n\t\tthis.threshold = 5;\r\n\t}\r\n}\r\n\r\nexport function CuiSortableComponent(prefix?: string): ICuiComponent {\r\n\treturn CuiComponentBaseHook({\r\n\t\tprefix: prefix,\r\n\t\tname: \"sortable\",\r\n\t\tcreate: (\r\n\t\t\telement: HTMLElement,\r\n\t\t\tutils: CuiCore,\r\n\t\t\tprefix: string,\r\n\t\t\tattribute: string\r\n\t\t) => {\r\n\t\t\treturn new CuiSortableHandler(element, attribute, utils, prefix);\r\n\t\t},\r\n\t});\r\n}\r\n\r\nexport class CuiSortableHandler extends CuiHandlerBase<CuiSortableArgs> {\r\n\tprivate _triggers: Element[];\r\n\tprivate _targets: Element[];\r\n\tprivate _currentTarget: HTMLElement | null;\r\n\tprivate _currentIdx: number;\r\n\tprivate _preview: HTMLElement | null;\r\n\r\n\tprivate _detector: ICuiElementDetector;\r\n\tprivate _currentBefore: HTMLElement | null;\r\n\tprivate _animation: CuiSwipeAnimationEngine;\r\n\r\n\tprivate _previewCls: string;\r\n\tprivate _movingCls: string;\r\n\tprivate _lockedCls: string;\r\n\r\n\tprivate _busFacade: ICuiEventBusFacade;\r\n\tprivate _interactions: ICuiInteractionsFacade;\r\n\tprivate _dragPerformer: ICuiDragExtensionPerformer;\r\n\r\n\tconstructor(\r\n\t\telement: HTMLElement,\r\n\t\tattribute: string,\r\n\t\tutils: CuiCore,\r\n\t\tprefix: string\r\n\t) {\r\n\t\tsuper(\r\n\t\t\t\"CuiSortableHandler\",\r\n\t\t\telement,\r\n\t\t\tattribute,\r\n\t\t\tnew CuiSortableArgs(),\r\n\t\t\tutils\r\n\t\t);\r\n\t\tthis._targets = [];\r\n\t\tthis._triggers = [];\r\n\t\tthis._currentIdx = -1;\r\n\t\tthis._currentTarget = null;\r\n\t\tthis._currentBefore = null;\r\n\t\tthis._preview = null;\r\n\r\n\t\tthis._movingCls = replacePrefix(SORTABLE_IS_MOVING, prefix);\r\n\t\tthis._previewCls = replacePrefix(SORTABLE_PREVIEW_CLS, prefix);\r\n\t\tthis._lockedCls = replacePrefix(SORTABLE_LOCKED, prefix);\r\n\r\n\t\tthis._busFacade = getEventBusFacade(this.cuid, utils.bus, element);\r\n\t\tthis._interactions = getCuiHandlerInteractions(utils.interactions);\r\n\t\tthis._dragPerformer = getDragMovePerformer({\r\n\t\t\tonStart: this.onDragStart.bind(this),\r\n\t\t\tonMove: this.onDragOver.bind(this),\r\n\t\t\tonEnd: this.onDragEnd.bind(this),\r\n\t\t});\r\n\r\n\t\tthis._detector = new CuiSimpleDragOverDetector();\r\n\t\tthis._animation = new CuiSwipeAnimationEngine(\r\n\t\t\tCuiTimeAnimationEngines.get(getEaseTimingFunction())\r\n\t\t);\r\n\t\tthis.extend(\r\n\t\t\tmoveExtension({\r\n\t\t\t\ttarget: element,\r\n\t\t\t\tperformer: this._dragPerformer,\r\n\t\t\t})\r\n\t\t);\r\n\t}\r\n\r\n\tasync onHandle(): Promise<boolean> {\r\n\t\tthis.getTargetsAndTrggers();\r\n\t\tthis._detector.setThreshold(this.args.threshold);\r\n\t\tthis._dragPerformer.setTimeout(this.args.timeout);\r\n\t\treturn true;\r\n\t}\r\n\tasync onRefresh(): Promise<boolean> {\r\n\t\tif (\r\n\t\t\tthis.prevArgs &&\r\n\t\t\t(this.args.target !== this.prevArgs.target ||\r\n\t\t\t\tthis.args.trigger !== this.prevArgs.trigger)\r\n\t\t) {\r\n\t\t\tthis.getTargetsAndTrggers();\r\n\t\t}\r\n\t\tthis._dragPerformer.setTimeout(this.args.timeout);\r\n\t\treturn true;\r\n\t}\r\n\tasync onRemove(): Promise<boolean> {\r\n\t\tthis._busFacade.detachEmittedEvents();\r\n\t\treturn true;\r\n\t}\r\n\r\n\t/**\r\n\t * queries targets and triggers from the element\r\n\t * If exception - lists are cleared\r\n\t */\r\n\tprivate getTargetsAndTrggers() {\r\n\t\tthis._targets = [...this.element.querySelectorAll(this.args.target)];\r\n\t\tthis._triggers = [...this.element.querySelectorAll(this.args.trigger)];\r\n\t\tif (this._triggers.length !== this._targets.length) {\r\n\t\t\tthis.log.error(\"Incorrect trigger or target selector\");\r\n\t\t\tthis._targets = [];\r\n\t\t\tthis._triggers = [];\r\n\t\t}\r\n\t\tthis._detector.setElements(this._targets);\r\n\t}\r\n\r\n\tprivate async onDragStart(data: ICuiMoveData): Promise<boolean> {\r\n\t\tthis._currentIdx = this.getPressedElementIdx(data.target as Node);\r\n\t\tthis._currentTarget =\r\n\t\t\tthis._currentIdx > -1\r\n\t\t\t\t? (this._targets[this._currentIdx] as HTMLElement)\r\n\t\t\t\t: null;\r\n\t\tif (!is(this._currentTarget)) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tthis.core.bus.emit(EVENTS.MOVE_LOCK, null, true);\r\n\t\tthis.startMovementPrep(data);\r\n\t\tthis._busFacade.emit<SortEvent>(EVENTS.SORT_START, {\r\n\t\t\ttarget: this._currentTarget,\r\n\t\t\tindex: this._currentIdx,\r\n\t\t});\r\n\r\n\t\treturn true;\r\n\t}\r\n\r\n\tprivate onDragOver(data: ICuiMoveData): void {\r\n\t\tthis.move(data);\r\n\t\tdata.event.preventDefault();\r\n\t}\r\n\r\n\tprivate onDragEnd(data: ICuiMoveData): void {\r\n\t\tif (!is(this._preview)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t//@ts-ignore preview\r\n\t\tthis._animation.setElement(this._preview);\r\n\t\tthis._animation.setProps(this.getFinishAnimation());\r\n\t\tthis._animation\r\n\t\t\t.finish({ progress: 0, timeout: 100, revert: false })\r\n\t\t\t.then((status: boolean) => {\r\n\t\t\t\tif (status) this.onSortAnimationFinish();\r\n\t\t\t});\r\n\t}\r\n\r\n\tprivate getPressedElementIdx(target: Node) {\r\n\t\treturn this._triggers.findIndex((trigger: Element) => {\r\n\t\t\treturn trigger.contains(target);\r\n\t\t});\r\n\t}\r\n\r\n\tprivate startMovementPrep(data: ICuiMoveData) {\r\n\t\tthis._interactions.mutate(() => {\r\n\t\t\tthis.createPreview();\r\n\t\t\tif (is(this._currentTarget))\r\n\t\t\t\t//@ts-ignore currentTarget\r\n\t\t\t\tthis.classes.setClass(this._movingCls, this._currentTarget);\r\n\t\t\tthis.classes.setClass(this._lockedCls, this.element);\r\n\t\t\tthis.classes.setClass(CLASSES.swipingOn, document.body);\r\n\t\t\tthis.setPreviewPosition(data);\r\n\t\t\tthis.setCurrentPosition(data);\r\n\t\t});\r\n\t}\r\n\r\n\tprivate stopMovementPrep() {\r\n\t\tthis._interactions.mutate(() => {\r\n\t\t\tif (is(this._currentTarget))\r\n\t\t\t\t//@ts-ignore currentTarget\r\n\t\t\t\tthis.classes.removeClass(this._movingCls, this._currentTarget);\r\n\t\t\tthis.classes.removeClass(CLASSES.swipingOn, document.body);\r\n\t\t\tthis.classes.removeClass(this._lockedCls, this.element);\r\n\t\t\tthis.removePreview();\r\n\t\t\tthis._currentTarget = null;\r\n\t\t\tthis._currentBefore = null;\r\n\t\t\tthis.getTargetsAndTrggers();\r\n\t\t});\r\n\t}\r\n\r\n\tprivate move(data: ICuiMoveData) {\r\n\t\tthis._interactions.mutate(() => {\r\n\t\t\tthis.setPreviewPosition(data);\r\n\t\t\tthis.setCurrentPosition(data);\r\n\t\t});\r\n\t}\r\n\r\n\tprivate createPreview() {\r\n\t\tif (!is(this._currentTarget)) {\r\n\t\t\tthis.logError(\r\n\t\t\t\t\"Cannot create preview - current target does not exist\",\r\n\t\t\t\t\"createPreview\"\r\n\t\t\t);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis._preview = new ElementBuilder(\"div\")\r\n\t\t\t.setClasses(this._previewCls)\r\n\t\t\t.build();\r\n\t\t//@ts-ignore currentTarget\r\n\t\tthis._preview.style.width = `${this._currentTarget.offsetWidth}px`;\r\n\t\t//@ts-ignore currentTarget\r\n\t\tthis._preview.style.height = `${this._currentTarget.offsetHeight}px`;\r\n\t\tdocument.body.appendChild(this._preview);\r\n\t}\r\n\r\n\tprivate removePreview() {\r\n\t\tif (is(this._preview)) {\r\n\t\t\t//@ts-ignore currentTarget\r\n\t\t\tthis._preview.remove();\r\n\t\t\tthis._preview = null;\r\n\t\t}\r\n\t}\r\n\r\n\tprivate setPreviewPosition(data: ICuiMoveData) {\r\n\t\tif (!is(this._preview)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t//@ts-ignore preview\r\n\t\tthis._preview.style.top = `${data.y}px`;\r\n\t\t//@ts-ignore preview\r\n\t\tthis._preview.style.left = `${data.x}px`;\r\n\t}\r\n\r\n\tprivate setCurrentPosition(data: ICuiMoveData) {\r\n\t\tif (!this._currentTarget) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet [idx, detected] = this._detector.detect(data.x, data.y);\r\n\t\tif (\r\n\t\t\tidx !== this._currentIdx &&\r\n\t\t\tdetected &&\r\n\t\t\tthis._currentBefore !== detected\r\n\t\t) {\r\n\t\t\tlet el = detected;\r\n\t\t\tthis.insertElement(this._currentTarget, el);\r\n\t\t\tthis._currentBefore = el as HTMLElement;\r\n\t\t\tthis.getTargetsAndTrggers();\r\n\t\t\tthis._currentIdx = idx;\r\n\t\t}\r\n\t}\r\n\r\n\tprivate insertElement(source: Element, destination: Element) {\r\n\t\tif (is(destination)) {\r\n\t\t\tthis.element.insertBefore(source, destination);\r\n\t\t} else {\r\n\t\t\tthis.element.appendChild(source);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate getFinishAnimation(): AnimationProperty<PropsTypes> {\r\n\t\tif (!are(this._currentTarget, this._preview)) {\r\n\t\t\treturn {\r\n\t\t\t\topacity: {\r\n\t\t\t\t\tfrom: 1,\r\n\t\t\t\t\tto: 0,\r\n\t\t\t\t},\r\n\t\t\t};\r\n\t\t}\r\n\t\t//@ts-ignore currentTarget\r\n\t\tconst box = this._currentTarget.getBoundingClientRect();\r\n\t\treturn {\r\n\t\t\topacity: {\r\n\t\t\t\tfrom: 1,\r\n\t\t\t\tto: 0,\r\n\t\t\t},\r\n\t\t\ttop: {\r\n\t\t\t\t//@ts-ignore preview\r\n\t\t\t\tfrom: this._preview.offsetTop,\r\n\t\t\t\t//@ts-ignore preview\r\n\t\t\t\tto: box.top > 0 ? box.top : this._preview.offsetTop,\r\n\t\t\t\tunit: \"px\",\r\n\t\t\t},\r\n\t\t\tleft: {\r\n\t\t\t\t//@ts-ignore preview\r\n\t\t\t\tfrom: this._preview.offsetLeft,\r\n\t\t\t\t//@ts-ignore preview\r\n\t\t\t\tto: box.left > 0 ? box.left : this._preview.offsetLeft,\r\n\t\t\t\tunit: \"px\",\r\n\t\t\t},\r\n\t\t};\r\n\t}\r\n\r\n\tprivate onSortAnimationFinish() {\r\n\t\tthis.stopMovementPrep();\r\n\t\tthis.core.bus.emit(EVENTS.MOVE_LOCK, null, false);\r\n\t\tthis._busFacade.emit<SortEvent>(EVENTS.SORTED, {\r\n\t\t\ttarget: this._currentTarget,\r\n\t\t\tindex: this._currentIdx,\r\n\t\t});\r\n\t}\r\n}\r\n","import { ICuiComponent, ICuiParsable } from \"../../core/models/interfaces\";\r\nimport { CuiCore } from \"../../core/models/core\";\r\nimport { CuiHandlerBase } from \"../../core/handlers/base\";\r\nimport { EVENTS, ICONS } from \"../../core/utils/statics\";\r\nimport { is, replacePrefix } from \"../../core/utils/functions\";\r\nimport { IconBuilder } from \"../../core/builders/icon\";\r\nimport { CuiAutoParseArgs } from \"../../core/utils/arguments\";\r\nimport { CuiSpinnerEvent } from \"../../core/models/events\";\r\nimport { getEventBusFacade, getCuiHandlerInteractions, ICuiEventBusFacade, ICuiInteractionsFacade } from \"../../core/handlers/extensions/facades\";\r\nimport { eventExtension } from \"../extensions/event/event\";\r\nimport { callbackPerformer } from \"../extensions/performers\";\r\nimport { CuiComponentBaseHook } from \"../base\";\r\n\r\nexport class CuiSpinnerArgs extends CuiAutoParseArgs implements ICuiParsable {\r\n    spinner: string;\r\n    scale: number;\r\n    constructor() {\r\n        super({\r\n            main: \"spinner\"\r\n        });\r\n        this.spinner = \"circle\";\r\n        this.scale = 1;\r\n    }\r\n}\r\n\r\n\r\nexport function CuiSpinnerComponent(prefix?: string): ICuiComponent {\r\n    ICONS['spinner_circle'] = \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 20 20\\\" width=\\\"20\\\" height=\\\"20\\\"><path d=\\\"M 7.800378,1.7908996 A 8.4986862,8.4986862 0 0 1 18.2091,7.8003784 8.4986862,8.4986862 0 0 1 12.199621,18.209101 8.4986862,8.4986862 0 0 1 1.7908995,12.199622 8.4986862,8.4986862 0 0 1 7.800378,1.7908996 Z\\\"></path></svg>\";\r\n    ICONS['spinner_circle_double'] = \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 20 20\\\" width=\\\"20\\\" height=\\\"20\\\"><path d=\\\"M 10,1.5000006 A 8.4999997,8.4999997 0 0 1 18.5,10 8.4999997,8.4999997 0 0 1 10,18.499999 8.4999997,8.4999997 0 0 1 1.5000005,10 8.4999997,8.4999997 0 0 1 10,1.5000006 Z\\\"></path><path d=\\\"M 10,3.4999997 A 6.5000002,6.5000002 0 0 1 16.5,10 6.5000002,6.5000002 0 0 1 10,16.5 6.5000002,6.5000002 0 0 1 3.5,9.9999993 6.5000002,6.5000002 0 0 1 10,3.4999997 Z\\\"></path></svg>\";\r\n    return CuiComponentBaseHook({\r\n        prefix: prefix,\r\n        name: \"spinner\",\r\n        create: (element: HTMLElement, utils: CuiCore, prefix: string, attribute: string) => {\r\n            return new CuiSpinnerHandler(element, utils, attribute, prefix);\r\n        }\r\n    })\r\n}\r\n\r\nexport class CuiSpinnerHandler extends CuiHandlerBase<CuiSpinnerArgs> {\r\n    private _animationPauseClass: string;\r\n    private _busFacade: ICuiEventBusFacade;\r\n    private _interactionFacade: ICuiInteractionsFacade;\r\n    constructor(element: HTMLElement, utils: CuiCore, attribute: string, prefix: string) {\r\n        super(\"CuiSpinnerHandler\", element, attribute, new CuiSpinnerArgs(), utils);\r\n        this._busFacade = getEventBusFacade(this.cuid, utils.bus, element);\r\n        this._animationPauseClass = replacePrefix(\"{prefix}-animation-pause\", prefix);\r\n        this._interactionFacade = getCuiHandlerInteractions(utils.interactions, this);\r\n\r\n        this.extend(eventExtension<boolean>(this._busFacade, {\r\n            eventName: EVENTS.PAUSE,\r\n            type: \"pause\",\r\n            performer: callbackPerformer(this.onPause.bind(this))\r\n        }))\r\n    }\r\n\r\n    async onHandle(): Promise<boolean> {\r\n        this.add()\r\n        return true;\r\n    }\r\n    async onRefresh(): Promise<boolean> {\r\n        if (this.prevArgs && this.args.spinner !== this.prevArgs.spinner) {\r\n            this.add();\r\n        }\r\n        return true;\r\n    }\r\n    async onRemove(): Promise<boolean> {\r\n        this.removeIfAnyExisists();\r\n        return true;\r\n    }\r\n\r\n    private addSpinner(iconElement: Element, name: string) {\r\n        this.element.appendChild(iconElement);\r\n        this.element.classList.add(`animation-spinner-${name}`);\r\n    }\r\n\r\n    private add() {\r\n        const svgIcon = is(this.args.spinner) ? ICONS[`spinner_${this.args.spinner}`] : null;\r\n        if (!is(svgIcon)) {\r\n            this.log.warning(\"Incorrect spinner name: \" + this.args.spinner);\r\n            return;\r\n        }\r\n        this.removeIfAnyExisists();\r\n        const iconElement = new IconBuilder(svgIcon).setScale(this.args.scale).build();\r\n        this._interactionFacade.mutate(this.addSpinner, iconElement, this.args.spinner);\r\n    }\r\n\r\n    private removeIfAnyExisists() {\r\n        let existing = this.element.querySelector(\"svg\");\r\n        if (existing) {\r\n            existing.remove();\r\n        }\r\n    }\r\n\r\n    private onPause(flag: boolean) {\r\n        this._interactionFacade.fetch(() => {\r\n            if (flag && !this.classes.hasClass(this._animationPauseClass, this.element)) {\r\n                this.asyncClasses.setClasses(this.element, this._animationPauseClass);\r\n            } else {\r\n                this.asyncClasses.removeClasses(this.element, this._animationPauseClass);\r\n            }\r\n        })\r\n        this._busFacade.emit<CuiSpinnerEvent>(EVENTS.PAUSED, {\r\n            paused: flag\r\n        });\r\n    }\r\n\r\n\r\n}","import { ICuiComponent, ICuiParsable, ICuiSwitchable } from \"../../core/models/interfaces\";\r\nimport { CuiCore } from \"../../core/models/core\";\r\nimport { CuiHandlerBase } from \"../../core/handlers/base\";\r\nimport { ICuiTask, CuiTaskRunner } from \"../../core/utils/task\";\r\nimport { CuiTimeAnimationEngine, CuiSwipeAnimationEngine } from \"../../core/animation/engine\";\r\nimport { AnimationDefinition, SWIPE_ANIMATIONS_DEFINITIONS } from \"../../core/animation/definitions\";\r\nimport { calculateNextIndex, is, getChildrenHeight, isInRange, joinWithScopeSelector, getRangeValueOrDefault, all } from \"../../core/utils/functions\";\r\nimport { EVENTS, CLASSES } from \"../../core/utils/statics\";\r\nimport { CuiAutoParseArgs } from \"../../core/utils/arguments\";\r\nimport { getEventBusFacade, CuiStyleHelper, getCuiHandlerInteractions, ICuiEventBusFacade, ICuiInteractionsFacade, ICuiStyleHelper } from \"../../core/handlers/extensions/facades\";\r\nimport { ICuiSlideEngine } from \"../../core/animation/interfaces\";\r\nimport { getEaseTimingFunction } from \"../..//core/animation/calculators\";\r\nimport { eventExtension } from \"../extensions/event/event\";\r\nimport { getDefaultSwitchKeyCombo } from \"../extensions/helpers/helpers\";\r\nimport { ICuiMoveExtensionPerformer } from \"../extensions/move/performer\";\r\nimport { CuiKeysHandlerExtension } from \"../extensions/keys/keys\";\r\nimport { CuiSwitchExtension } from \"../extensions/switch/switch\";\r\nimport { getCuiKeyActionPerformer, ICuiKeyActionPerformer } from \"../extensions/keys/performer\";\r\nimport { CuiComponentBaseHook } from \"../base\";\r\nimport { ICuiSliderProgress, sliderPerformer } from \"../extensions/performers\";\r\nimport { getCuiMutationPerformer, ICuiMutationPerformer } from \"../extensions/mutations/performer\";\r\nimport { CuiComponentMutationExtension } from \"../extensions/mutations/mutations\";\r\n\r\n\r\n/**\r\n * \r\n *   targets: string - slider elements\r\n *   timeout: number - animation timeout\r\n *   links: string; - link to switcher (indicator, tab, etc)\r\n *   autoTimeout: number - if defined, slider will switch item automatically\r\n *   height: 'auto' | string - element height\r\n *   animation: string - animation name\r\n *   loop: boolean - allows to slide elements in loop\r\n */\r\nconst SWITCH_DEFAULT_TARGETS = \" > li\";\r\n\r\nexport class CuiSliderArgs extends CuiAutoParseArgs implements ICuiParsable {\r\n    targets: string;\r\n    timeout: number;\r\n    links: string;\r\n    autoTimeout: number;\r\n    height: 'auto' | string;\r\n    animation: string;\r\n    loop: boolean;\r\n    swipeRatio: number;\r\n    keyChange: boolean;\r\n\r\n    constructor(prefix: string, timeout?: number) {\r\n        super({\r\n            props: {\r\n                \"targets\": { corrector: joinWithScopeSelector },\r\n                'swipeRatio': { corrector: (value) => getRangeValueOrDefault(value, 0.1, 0.9, 0.4) }\r\n            }\r\n        });\r\n\r\n        this.targets = joinWithScopeSelector(SWITCH_DEFAULT_TARGETS);\r\n        this.links = \"\";\r\n        this.autoTimeout = -1;\r\n        this.height = \"\";\r\n        this.animation = \"slide\";\r\n        this.loop = false;\r\n        this.timeout = timeout ?? 300;\r\n        this.swipeRatio = 0.3;\r\n        this.keyChange = false;\r\n    }\r\n}\r\n\r\nexport function CuiSliderComponent(prefix?: string): ICuiComponent {\r\n    return CuiComponentBaseHook({\r\n        prefix: prefix,\r\n        name: \"slider\",\r\n        create: (element: HTMLElement, utils: CuiCore, prefix: string, attribute: string) => {\r\n            return new CuiSliderHandler(element, utils, attribute)\r\n        }\r\n    })\r\n}\r\n\r\nexport class CuiSliderHandler extends CuiHandlerBase<CuiSliderArgs> implements ICuiSwitchable {\r\n\r\n    private _targets: Element[];\r\n    private _currentIdx: number;\r\n    private _links: Element[];\r\n    private _task: ICuiTask;\r\n\r\n    private _current: HTMLElement | undefined;\r\n    private _nextIdx: number;\r\n    private _nextElement: HTMLElement | null;\r\n    private _currSlider: ICuiSlideEngine;\r\n    private _nextSlider: ICuiSlideEngine;\r\n    private _animationDef: AnimationDefinition;\r\n    private _targetsCount: number;\r\n\r\n    private _keysPerformer: ICuiKeyActionPerformer;\r\n    private _movePerformer: ICuiMoveExtensionPerformer;\r\n    private _busFacade: ICuiEventBusFacade;\r\n    private _interactions: ICuiInteractionsFacade;\r\n    private _styles: ICuiStyleHelper;\r\n    private _mutationPerformer: ICuiMutationPerformer;\r\n\r\n    constructor(element: HTMLElement, utils: CuiCore, attribute: string) {\r\n        super(\"CuiSliderHandler\", element, attribute, new CuiSliderArgs(utils.setup.prefix, utils.setup.animationTime), utils);\r\n        this._targets = [];\r\n        this._currentIdx = -1;\r\n        this._nextIdx = -1;\r\n        this._links = [];\r\n        this._current = undefined;\r\n        this._nextElement = null;\r\n        this._currSlider = new CuiSwipeAnimationEngine(new CuiTimeAnimationEngine(getEaseTimingFunction()));\r\n        this._nextSlider = new CuiSwipeAnimationEngine(new CuiTimeAnimationEngine(getEaseTimingFunction()));\r\n        this._targetsCount = 0;\r\n        this._task = new CuiTaskRunner(this.args.autoTimeout, true, this.switch.bind(this, 'next'));\r\n        this._animationDef = SWIPE_ANIMATIONS_DEFINITIONS[this.args.animation];\r\n        this._keysPerformer = getCuiKeyActionPerformer(this.switch.bind(this));\r\n        this._busFacade = getEventBusFacade(this.cuid, utils.bus, this.element);\r\n        this._interactions = getCuiHandlerInteractions(utils.interactions);\r\n        this._task = new CuiTaskRunner(this.args.autoTimeout, true, this.switch.bind(this, 'next'));\r\n        this._styles = new CuiStyleHelper();\r\n        this._mutationPerformer = getCuiMutationPerformer(this.onMutation.bind(this));\r\n        this._movePerformer = sliderPerformer(this.asyncClasses, {\r\n            element: element,\r\n            prevent: true,\r\n            start: this.onDown.bind(this),\r\n            progress: this.onMove.bind(this),\r\n            end: this.onUp.bind(this),\r\n            adjustRatio: this.adjustMoveRatio.bind(this)\r\n        })\r\n        this.extend(new CuiSwitchExtension(this._busFacade, this.switch.bind(this)));\r\n        this.extend(new CuiKeysHandlerExtension(this.element, this._busFacade, this._keysPerformer));\r\n        this.extend(eventExtension(this._busFacade, {\r\n            type: \"global-move\",\r\n            eventName: EVENTS.GLOBAL_MOVE,\r\n            performer: this._movePerformer\r\n        }))\r\n        this.extend(new CuiComponentMutationExtension(\r\n            element,\r\n            this._mutationPerformer\r\n        ))\r\n    }\r\n\r\n    async onHandle(): Promise<boolean> {\r\n        this.getTargets();\r\n        this.getLinks();\r\n        this.getActiveIndex();\r\n        this.setLinkActive(-1, this._currentIdx);\r\n\r\n        this.setElementHeight()\r\n        this.handleUpdate();\r\n        return true;\r\n    }\r\n    async onRefresh(): Promise<boolean> {\r\n        this.setElementHeight();\r\n        this.handleUpdate();\r\n        return true;\r\n    }\r\n    async onRemove(): Promise<boolean> {\r\n        this._task.stop();\r\n        this._busFacade.detachEmittedEvents();\r\n        return true;\r\n    }\r\n\r\n    onMutation(record: MutationRecord[]): void {\r\n        this.getTargets();\r\n        this.getLinks();\r\n    }\r\n\r\n    private handleUpdate() {\r\n        this._animationDef = SWIPE_ANIMATIONS_DEFINITIONS[this.args.animation];\r\n        this._mutationPerformer.setSelector(this.args.targets)\r\n        this.setKeyCombo(this.args.keyChange);\r\n        this.startTask();\r\n    }\r\n\r\n    private setElementHeight() {\r\n        this._interactions.mutate(() => {\r\n            this._styles.setStyle('height', this.getElementHeight(this._targets[this._currentIdx]), this.element);\r\n        })\r\n    }\r\n\r\n    private onDown() {\r\n        if (!this.lock()) {\r\n            return false;\r\n        }\r\n\r\n        this._current = this._targets[this._currentIdx] as HTMLElement;\r\n        this._currSlider.setElement(this._current);\r\n\r\n        return true;\r\n    }\r\n\r\n    private onMove(data: ICuiSliderProgress) {\r\n        if (!this._current) {\r\n            return;\r\n        }\r\n        const direction = data.ratio > 0 ? \"right\" : \"left\";\r\n        const absRatio = Math.abs(data.ratio);\r\n        let nextIdx = calculateNextIndex(direction === 'left' ? \"next\" : \"prev\", this._currentIdx, this._targetsCount);\r\n        if (nextIdx !== this._nextIdx) {\r\n            this._nextElement && this.classes.removeClass(CLASSES.animProgress, this._nextElement);\r\n            this._nextElement = this._targets[nextIdx] as HTMLElement;\r\n            this._nextIdx = nextIdx;\r\n\r\n            this._nextSlider.setElement(this._nextElement)\r\n            this._nextSlider.setProps(this._animationDef.previous[direction]);\r\n            this._currSlider.setProps(this._animationDef.current[direction]);\r\n            this._interactions.mutate(() => {\r\n                this._nextElement && this.classes.setClass(CLASSES.animProgress, this._nextElement);\r\n            })\r\n        }\r\n        this._interactions.mutate(() => {\r\n            this._currSlider.move(Math.abs(absRatio));\r\n            this._nextSlider.move(Math.abs(absRatio));\r\n        })\r\n    }\r\n\r\n    private onUp(data: ICuiSliderProgress) {\r\n        let absRatio = Math.abs(data.ratio);\r\n        const minVelo = 1 / this.args.timeout;\r\n        const v = data.velocity > minVelo ? data.velocity : minVelo;\r\n        let back = absRatio <= this.args.swipeRatio;\r\n        //  const timeout = absRatio * this.args.timeout;\r\n        Promise.all([\r\n            this._currSlider.finish({ progress: absRatio, acceleration: data.acceleration, velocity: v, timeout: this.args.timeout, revert: back }),\r\n            this._nextSlider.finish({ progress: absRatio, acceleration: data.acceleration, velocity: v, timeout: this.args.timeout, revert: back })\r\n        ]).then((status) => {\r\n            if (status)\r\n                this.onAnimationFinish(this._current, back, false);\r\n        }).catch((e) => {\r\n            this.logError(\"An error\", \"onUp\", e)\r\n            this.onAnimationFinish(this._current, back, true);\r\n        })\r\n    }\r\n\r\n    adjustMoveRatio(ratio: number): number {\r\n        if (this.args.loop) {\r\n            return ratio;\r\n        }\r\n        if (this._currentIdx === 0 && ratio > 0) {\r\n            return 0;\r\n        }\r\n        if (this._currentIdx === this._targetsCount - 1 && ratio < 0) {\r\n            return 0;\r\n        }\r\n        return ratio;\r\n    }\r\n\r\n    /**\r\n     * Api method to switch childrens\r\n     * @param index - index to switch to\r\n     */\r\n    async switch(index: any): Promise<boolean> {\r\n        if (!this.lock()) {\r\n            return false;\r\n        }\r\n        this.onPushSwitch(index);\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param element element this animation was perfromed on\r\n     * @param reverted - flag inidicating whether animation was performed to the end or reverted back to start\r\n     * @param errorOccured - tells whether animation was finished with error\r\n     */\r\n    onAnimationFinish(element: Element | undefined, reverted: boolean, errorOccured: boolean) {\r\n\r\n        // If not go back or from push then switch, else was go back\r\n        let next = this._targets[this._nextIdx];\r\n        let current = this._targets[this._currentIdx];\r\n\r\n        this._interactions.mutate(() => {\r\n            this.classes.removeClass(CLASSES.animProgress, next);\r\n            this._styles.clean(current as HTMLElement);\r\n            this._styles.clean(next as HTMLElement);\r\n            if (!reverted) {\r\n                this.classes.setClass(this.activeClassName, next);\r\n                this.classes.removeClass(this.activeClassName, current);\r\n                this.setLinkActive(this._currentIdx, this._nextIdx);\r\n                this._busFacade.emit(EVENTS.SWITCHED, {\r\n                    timestamp: Date.now(),\r\n                    index: this._nextIdx\r\n                })\r\n                this._currentIdx = this._nextIdx;\r\n            }\r\n            this.clearSlideData();\r\n            this.unlock();\r\n        })\r\n        this.startTask();\r\n    }\r\n\r\n    onPushSwitch(index: string) {\r\n        if (!is(index) ||\r\n            !this._animationDef ||\r\n            (!this.args.loop && this._currentIdx === 0 && index === 'prev') ||\r\n            (!this.args.loop && this._currentIdx === this._targetsCount - 1 && index === 'next')) {\r\n            this.unlock();\r\n            return;\r\n        }\r\n        let nextIdx = calculateNextIndex(index, this._currentIdx, this._targetsCount);\r\n        if (nextIdx == this._currentIdx || nextIdx < 0 || nextIdx >= this._targets.length) {\r\n            this.log.warning(`Index ${index} is not within the suitable range`);\r\n            return false;\r\n        }\r\n        this._nextIdx = nextIdx;\r\n        let current = this._targets[this._currentIdx];\r\n        let next = this._targets[this._nextIdx];\r\n        this._currSlider.setElement(current);\r\n        this._nextSlider.setElement(next);\r\n        this._currSlider.setProps(index === 'prev' ? this._animationDef.current.left : this._animationDef.current.right);\r\n        this._nextSlider.setProps(index === 'prev' ? this._animationDef.previous.left : this._animationDef.previous.right);\r\n        this._interactions.mutate(() => {\r\n            this.classes.setClass(CLASSES.animProgress, next);\r\n        })\r\n        Promise.all([\r\n            this._currSlider.finish({ progress: 0, acceleration: 1, velocity: 0, timeout: this.args.timeout, revert: false }),\r\n            this._nextSlider.finish({ progress: 0, acceleration: 1, velocity: 0, timeout: this.args.timeout, revert: false })\r\n        ]).then((statuses) => {\r\n            let status = all(statuses, (status: boolean) => status === true);\r\n            if (status)\r\n                this.onAnimationFinish(current, false, false)\r\n        }).catch((e) => {\r\n            this.logError(\"An error\", \"onUp\", e)\r\n            this.onAnimationFinish(current, false, true)\r\n        });\r\n    }\r\n\r\n    getActiveIndex(): void {\r\n        this._currentIdx = is(this._targets) ? this._targets.findIndex(target => this.classes.hasClass(this.activeClassName, target)) : -1;\r\n    }\r\n\r\n    clearSlideData() {\r\n        this._nextIdx = -1;\r\n        this._nextElement = null;\r\n    }\r\n\r\n    getElementHeight(current: Element): string {\r\n        if (!is(this.args.height) || this.args.height === 'auto') {\r\n            return getChildrenHeight(current) + \"px\";\r\n        } else {\r\n            return this.args.height;\r\n        }\r\n    }\r\n\r\n    setKeyCombo(flag: boolean) {\r\n        if (!flag) {\r\n            this._keysPerformer.setKeyCombos([]);\r\n            return\r\n        }\r\n        this._keysPerformer.setKeyCombos([{\r\n            key: 'next',\r\n            value: getDefaultSwitchKeyCombo(\"ArrowRight\")\r\n        }, {\r\n            key: \"prev\",\r\n            value: getDefaultSwitchKeyCombo(\"ArrowLeft\")\r\n        }]);\r\n    }\r\n\r\n    /**\r\n     * Queries targets\r\n     */\r\n    getTargets() {\r\n        this._targets = [...this.element.querySelectorAll(this.args.targets)];\r\n        this._targetsCount = this._targets.length;\r\n    }\r\n\r\n    /**\r\n     * Get linked switcher elements\r\n     */\r\n    getLinks() {\r\n        this._links = is(this.args.links) ? [...document.querySelectorAll(this.args.links)] : []\r\n    }\r\n\r\n    /**\r\n     * Set active class on linked switcher if set\r\n     * @param current - current index (to remove active from)\r\n     * @param next - next index (to set action on)\r\n     */\r\n    setLinkActive(current: number, next: number) {\r\n        if (!is(this._links)) {\r\n            return\r\n        }\r\n        this._interactions.mutate(() => {\r\n            if (isInRange(current, 0, this._links.length - 1)) {\r\n                this.classes.removeClass(this.activeClassName, this._links[current])\r\n            }\r\n            if (isInRange(next, 0, this._links.length - 1)) {\r\n                this.classes.setClass(this.activeClassName, this._links[next])\r\n            }\r\n        })\r\n\r\n    }\r\n\r\n    /**\r\n     * Runs task if arguments setup allows for it - auto flag must be set to true \r\n     */\r\n    startTask() {\r\n        this._task.stop();\r\n        if (this.args.autoTimeout) {\r\n            this._task.start();\r\n        }\r\n    }\r\n}\r\n","import { ICuiComponent, ICuiParsable, ICuiSwitchable, CuiHTMLElement } from \"../../core/models/interfaces\";\r\nimport { CuiCore } from \"../../core/models/core\";\r\nimport { CuiHandlerBase } from \"../../core/handlers/base\";\r\nimport { ICuiTask, CuiTaskRunner } from \"../../core/utils/task\";\r\nimport { CuiActionsListFactory } from \"../../core/utils/actions\";\r\nimport { is, replacePrefix, calculateNextIndex, getChildrenHeight, isInRange, joinWithScopeSelector, getCuiElementsBySelector } from \"../../core/utils/functions\";\r\nimport { EVENTS } from \"../../core/utils/statics\";\r\nimport { CuiAutoParseArgs } from \"../../core/utils/arguments\";\r\nimport { CuiKeysHandlerExtension } from \"../extensions/keys/keys\";\r\nimport { getCuiKeyActionPerformer, ICuiKeyActionPerformer } from \"../extensions/keys/performer\";\r\nimport { CuiSwitchExtension } from \"../extensions/switch/switch\";\r\nimport { CuiStyleAsyncHelper, CuiStyleHelper, getEventBusFacade, ICuiEventBusFacade, ICuiStyleAsyncHelper } from \"../../core/handlers/extensions/facades\";\r\nimport { CuiActionsHelper } from \"../../core/helpers/helpers\";\r\nimport { CuiComponentBaseHook } from \"../base\";\r\nimport { getCuiMutationPerformer, ICuiMutationPerformer } from \"../extensions/mutations/performer\";\r\nimport { CuiComponentMutationExtension } from \"../extensions/mutations/mutations\";\r\n\r\nconst SWITCH_DEFAULT_ACTION_IN = \".{prefix}-switch-animation-default-in\";\r\nconst SWITCH_DEFAULT_ACTION_OUT = \".{prefix}-switch-animation-default-out\";\r\nconst SWITCH_DEFAULT_TARGETS = \" > *\";\r\n\r\nexport class CuiSwitchArgs extends CuiAutoParseArgs implements ICuiParsable {\r\n    targets: string;\r\n    in: string;\r\n    out: string;\r\n    timeout: number;\r\n    links: string;\r\n    switch: string;\r\n    autoTimeout: number;\r\n    height: 'auto' | string;\r\n    loop: boolean;\r\n    keyChange: boolean;\r\n\r\n    constructor(prefix: string, timeout?: number) {\r\n        super({\r\n            props: {\r\n                \"targets\": { corrector: joinWithScopeSelector }\r\n            }\r\n        });\r\n\r\n        this.targets = joinWithScopeSelector(SWITCH_DEFAULT_TARGETS);\r\n        this.in = replacePrefix(SWITCH_DEFAULT_ACTION_IN, prefix);\r\n        this.out = replacePrefix(SWITCH_DEFAULT_ACTION_OUT, prefix);\r\n        this.timeout = timeout ?? 300;\r\n        this.links = \"\";\r\n        this.switch = \"\";\r\n        this.autoTimeout = -1;\r\n        this.height = \"auto\";\r\n        this.loop = false;\r\n        this.keyChange = false;\r\n    }\r\n}\r\n\r\n\r\nexport function CuiSwitchComponent(prefix?: string): ICuiComponent {\r\n    return CuiComponentBaseHook({\r\n        prefix: prefix,\r\n        name: \"switch\",\r\n        create: (element: HTMLElement, utils: CuiCore, prefix: string, attribute: string) => {\r\n            return new CuiSwitchHandler(element, utils, attribute)\r\n        }\r\n    })\r\n}\r\n\r\nexport class CuiSwitchHandler extends CuiHandlerBase<CuiSwitchArgs> implements ICuiSwitchable {\r\n\r\n    private _targets: Element[];\r\n    private _task: ICuiTask;\r\n    private _asyncStyles: ICuiStyleAsyncHelper;\r\n\r\n    private _switchPerformer: ICuiKeyActionPerformer;\r\n    private _busFacade: ICuiEventBusFacade;\r\n    private _actionsHelper: CuiActionsHelper;\r\n    private _mutationPerformer: ICuiMutationPerformer;\r\n    constructor(element: HTMLElement, utils: CuiCore, attribute: string) {\r\n        super(\"CuiSwitchHandler\", element, attribute, new CuiSwitchArgs(utils.setup.prefix, utils.setup.animationTime), utils);\r\n        this._targets = [];\r\n        this._actionsHelper = new CuiActionsHelper(utils.interactions);\r\n        this._asyncStyles = new CuiStyleAsyncHelper(utils.interactions, new CuiStyleHelper());\r\n        this._task = new CuiTaskRunner(this.args.autoTimeout, true, this.switch.bind(this, 'next'));\r\n        this._busFacade = getEventBusFacade(this.cuid, utils.bus, this.element);\r\n        this._switchPerformer = getCuiKeyActionPerformer(this.switch.bind(this));\r\n        this._mutationPerformer = getCuiMutationPerformer(this.onMutation.bind(this));\r\n        this.extend(new CuiKeysHandlerExtension(this.element, this._busFacade, this._switchPerformer))\r\n        this.extend(new CuiSwitchExtension(this._busFacade, this.switch.bind(this)))\r\n        this.extend(new CuiComponentMutationExtension(\r\n            element,\r\n            this._mutationPerformer\r\n        ))\r\n\r\n    }\r\n\r\n    async onHandle(): Promise<boolean> {\r\n        this.handleUpdate();\r\n        return true;\r\n    }\r\n    async onRefresh(): Promise<boolean> {\r\n        this.handleUpdate();\r\n        return true;\r\n    }\r\n    async onRemove(): Promise<boolean> {\r\n        this._task.stop();\r\n        this._busFacade.detachEmittedEvents();\r\n        return true;\r\n    }\r\n\r\n\r\n    handleUpdate() {\r\n        this.parseArguments();\r\n        this.getTargets();\r\n        const currentIndex = this.getActiveIndex();\r\n        this.setSwitchesActive(currentIndex);\r\n        this.setLinkActive(-1, currentIndex);\r\n        this.setTargetHeight(currentIndex);\r\n        this.startTask();\r\n    }\r\n\r\n    onMutation(record: MutationRecord[]): void {\r\n        this.getTargets();\r\n        const currentIndex = this.getActiveIndex();\r\n        this.setTargetHeight(currentIndex);\r\n    }\r\n\r\n    async switch(index: any): Promise<boolean> {\r\n        if (!this.lock()) {\r\n            return false;\r\n        }\r\n\r\n        const actionsIn = CuiActionsListFactory.get(this.args.in);\r\n        const actionsOut = CuiActionsListFactory.get(this.args.out);\r\n\r\n        const activeIndex = this.getActiveIndex();\r\n        const nextIdx = calculateNextIndex(index, activeIndex, this._targets.length);\r\n        if (nextIdx < 0) {\r\n            this.logWarning(`Index ${index} is not within the suitable range`, \"switch\");\r\n            return false;\r\n        }\r\n        if (!this.args.loop && ((index === \"next\" && nextIdx === 0) || (index === 'prev' && activeIndex === 0))) {\r\n            this.logInfo(\"Switch blocked by loop settings\", \"switch\");\r\n            return false;\r\n        }\r\n\r\n        this.setSwitchesActive(nextIdx);\r\n        let nextItem = this._targets[nextIdx];\r\n        await this._actionsHelper.performSwitchAction(nextItem,\r\n            activeIndex > -1 ? this._targets[activeIndex] : null,\r\n            actionsIn,\r\n            actionsOut,\r\n            () => {\r\n                // Set next element active\r\n                nextItem.classList.add(this.activeClassName);\r\n                // Remove active from current element (if current exists)\r\n                if (activeIndex > -1)\r\n                    this._targets[activeIndex].classList.remove(this.activeClassName);\r\n                // Update linked items\r\n                this.setLinkActive(activeIndex, nextIdx);\r\n                // Update element height - it must be done a parent get height based on current child\r\n                this.setTargetHeight(activeIndex);\r\n                this.startTask();\r\n                this.unlock();\r\n            },\r\n            this.args.timeout,\r\n        )\r\n        this._busFacade.emit(EVENTS.SWITCHED, {\r\n            timestamp: Date.now(),\r\n            index: nextIdx\r\n        })\r\n        return true;\r\n    }\r\n\r\n    private getActiveIndex(): number {\r\n        return is(this._targets) ? this._targets.findIndex(target => this.classes.hasClass(this.activeClassName, target)) : -1;\r\n    }\r\n\r\n    private getElementHeight(current: Element): string {\r\n        if (!is(this.args.height) || this.args.height === 'auto') {\r\n            return getChildrenHeight(current) + \"px\";\r\n        } else {\r\n            return this.args.height;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Gets attributes value and prepares properties\r\n     */\r\n    private parseArguments() {\r\n        this._task.setTimeout(this.args.autoTimeout);\r\n        if (this.args.keyChange) {\r\n            this._switchPerformer.setKeyCombos([{\r\n                key: 'next',\r\n                value: { isCtrl: true, isAlt: true, isShift: false, key: \"ArrowRight\" }\r\n            }, {\r\n                key: 'prev',\r\n                value: { isCtrl: true, isAlt: true, isShift: false, key: \"ArrowLeft\" }\r\n            }])\r\n        } else {\r\n            this._switchPerformer.setKeyCombos([]);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Query target elements\r\n     */\r\n    private getTargets() {\r\n        this._targets = is(this.args.targets) ? [...this.element.querySelectorAll(this.args.targets)] : [];\r\n    }\r\n\r\n    private setLinkActive(current: number, next: number) {\r\n        const links = is(this.args.links) ? [...document.querySelectorAll(this.args.links)] : null;\r\n        if (!links) {\r\n            return\r\n        }\r\n        const linksLen = links.length - 1;\r\n        if (isInRange(current, 0, linksLen)) {\r\n            //@ts-ignore already checked above\r\n            this.classes.removeClass(this.activeClassName, links[current])\r\n        }\r\n        if (isInRange(next, 0, linksLen)) {\r\n            //@ts-ignore already checked above\r\n            this.classes.setClass(this.activeClassName, links[next])\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Sets propers active state on attached switches\r\n     * @param index \r\n     */\r\n\r\n    private setSwitchesActive(index: number) {\r\n        const switches = getCuiElementsBySelector(this.args.switch);\r\n        switches.forEach(sw => {\r\n            this.emitLinkSwitch(sw.$cuid, index)\r\n        })\r\n    }\r\n\r\n    /**\r\n     * Emits push event to attached switch to set proper index\r\n     * @param id - cuid of element\r\n     * @param index - index to be set on element\r\n     */\r\n    private emitLinkSwitch(id: string | null, index: number) {\r\n        if (is(id))\r\n            this.core.bus.emit(EVENTS.SWITCH, id, index);\r\n    }\r\n\r\n    /**\r\n     * Runs task if arguments setup allows for it - auto flag must be set to true \r\n     */\r\n    private startTask() {\r\n        this._task.stop();\r\n        if (this.args.autoTimeout) {\r\n            this._task.start();\r\n        }\r\n    }\r\n\r\n    private setTargetHeight(targetIndex: number) {\r\n        this._asyncStyles.setStyle('height', this.getElementHeight(this._targets[targetIndex]), this.element);\r\n    }\r\n}","import { ICuiComponent, ICuiComponentHandler, ICuiParsable, CuiElement } from \"../../core/models/interfaces\";\r\nimport { CuiCore } from \"../../core/models/core\";\r\nimport { CuiHandlerBase } from \"../../core/handlers/base\";\r\nimport { getChildSelectorFromScoped, is } from \"../../core/utils/functions\";\r\nimport { EVENTS } from \"../../core/utils/statics\";\r\nimport { CuiAutoParseArgs } from \"../../core/utils/arguments\";\r\nimport { CuiClickableArgs } from \"src/core/models/arguments\";\r\nimport { clickExtension, CuiClickModule } from \"../extensions/click/click\";\r\nimport { clickPerformer, ICuiClickPerfromerHook } from \"../extensions/click/performer\";\r\nimport { CuiComponentBaseHook } from \"../base\";\r\n\r\nconst SWITCHER_LIST_ITEM_SELECTOR = \"li > a\";\r\n\r\nexport class CuiSwitcherArgs extends CuiAutoParseArgs implements CuiClickableArgs {\r\n\r\n    target: string;\r\n    index: string;\r\n    prevent: boolean;\r\n    stopPropagation: boolean;\r\n    targets: string;\r\n    isList: boolean;\r\n\r\n    constructor() {\r\n        super();\r\n        this.index = \"\";\r\n        this.target = \"\";\r\n        this.prevent = false;\r\n        this.stopPropagation = false;\r\n        this.targets = SWITCHER_LIST_ITEM_SELECTOR;\r\n        this.isList = false;\r\n    }\r\n}\r\n\r\nexport function CuiSwitcherComponent(prefix?: string): ICuiComponent {\r\n    return CuiComponentBaseHook({\r\n        prefix: prefix,\r\n        name: \"switcher\",\r\n        create: (element: HTMLElement, utils: CuiCore, prefix: string, attribute: string) => {\r\n            return new CuiSwitcherHandler(element, utils, attribute)\r\n        }\r\n    })\r\n}\r\n\r\nexport class CuiSwitcherHandler extends CuiHandlerBase<CuiSwitcherArgs>  {\r\n    _perfromer: ICuiClickPerfromerHook;\r\n    constructor(element: HTMLElement, utils: CuiCore, attribute: string) {\r\n        super(\"CuiSwitcherHandler\", element, attribute, new CuiSwitcherArgs(), utils);\r\n        this._perfromer = clickPerformer(this.onClickEvent.bind(this));\r\n        this.extend(clickExtension({\r\n            element: element,\r\n            performer: this._perfromer\r\n        }))\r\n    }\r\n\r\n    async onHandle(): Promise<boolean> {\r\n        this.handleArguments();\r\n        return true;\r\n    }\r\n    async onRefresh(): Promise<boolean> {\r\n        this.handleArguments();\r\n        return true;\r\n    }\r\n    async onRemove(): Promise<boolean> {\r\n        return true;\r\n    }\r\n\r\n    private handleArguments() {\r\n        this._perfromer.preventDefault(this.args.prevent);\r\n        this._perfromer.stopPropagation(this.args.stopPropagation);\r\n    }\r\n\r\n    /**\r\n     * Sets current switcher target value\r\n     * \r\n     */\r\n    getTargetCuid(): string | null {\r\n        let targetId = null;\r\n        if (!is(this.args.target)) {\r\n            targetId = null;\r\n        }\r\n\r\n        let target = <CuiElement>(document.querySelector(this.args.target) as any);\r\n        if (is(target)) {\r\n            targetId = target.$cuid;\r\n        }\r\n        return targetId\r\n    }\r\n\r\n    onClickEvent(ev: MouseEvent) {\r\n        const targetId = this.getTargetCuid();\r\n        if (!targetId) {\r\n            return;\r\n        }\r\n\r\n        if (this.args.isList || this.element.tagName === 'UL') {\r\n            this.handleListClick(ev, targetId)\r\n            return;\r\n        }\r\n        this.handleItemClick(ev, targetId);\r\n    }\r\n\r\n    handleItemClick(ev: MouseEvent, targetCuid: string) {\r\n        if (!this.args.index) {\r\n            this.log.warning(\"Switch cannot be performed since component doesn't specify index\")\r\n            return;\r\n        }\r\n        this.core.bus.emit(EVENTS.SWITCH, targetCuid, this.args.index);\r\n    }\r\n\r\n    handleListClick(ev: MouseEvent, targetCuid: string) {\r\n        const currentSelector = getChildSelectorFromScoped(this.args.targets);\r\n        const target = ev.target as HTMLElement;\r\n        if (!target.matches(currentSelector)) {\r\n            return;\r\n        }\r\n        const switcherElements = [...this.element.querySelectorAll(this.args.targets)]\r\n        const targetIndex = switcherElements.findIndex(element => element === ev.target);\r\n        if (targetIndex < 0) {\r\n            return;\r\n        }\r\n\r\n        this.core.bus.emit(EVENTS.SWITCH, targetCuid, targetIndex);\r\n    }\r\n}\r\n\r\n","import { CuiCore } from \"../../core/models/core\";\r\nimport { CuiHandlerBase } from \"../../core/handlers/base\";\r\nimport { CuiActionsListFactory } from \"../../core/utils/actions\";\r\nimport { EVENTS } from \"../../core/utils/statics\";\r\nimport { CuiAutoParseArgs } from \"../../core/utils/arguments\";\r\nimport { clickExtension } from \"../extensions/click/click\";\r\nimport { CuiClickableArgs } from \"../../core/models/arguments\";\r\nimport { CuiComponentBaseHook } from \"../base\";\r\nimport { eventExtension } from \"../extensions/event/event\";\r\nimport { getCuiHandlerInteractions, getEventBusFacade, ICuiEventBusFacade, ICuiInteractionsFacade } from \"../../core/handlers/extensions/facades\";\r\nimport { callbackPerformer } from \"../extensions/performers\";\r\n\r\nexport class CuiToggleArgs extends CuiAutoParseArgs implements CuiClickableArgs {\r\n\r\n    target: string;\r\n    action: string;\r\n    prevent: boolean;\r\n    stopPropagation: boolean;\r\n\r\n    constructor() {\r\n        super({\r\n            main: \"action\"\r\n        });\r\n        this.action = \"\";\r\n        this.target = \"\";\r\n        this.prevent = false;\r\n        this.stopPropagation = false;\r\n    }\r\n\r\n}\r\n\r\nexport function CuiToggleComponent(prefix?: string) {\r\n    return CuiComponentBaseHook({\r\n        name: 'toggle',\r\n        prefix: prefix,\r\n        create: (element: HTMLElement, utils: CuiCore, prefix: string, attribute: string) => {\r\n            return new CuiToggleHandler(element, utils, attribute);\r\n        }\r\n    })\r\n}\r\n\r\n/**\r\n * Events: toggle\r\n * Emits: Toggled\r\n */\r\n\r\nexport class CuiToggleHandler extends CuiHandlerBase<CuiToggleArgs> {\r\n\r\n    private _busFacade: ICuiEventBusFacade;\r\n    private _interactions: ICuiInteractionsFacade;\r\n\r\n    constructor(element: HTMLElement, utils: CuiCore, attribute: string) {\r\n        super(\"CuiToggleHandler\", element, attribute, new CuiToggleArgs(), utils);\r\n\r\n        this._busFacade = getEventBusFacade(this.cuid, utils.bus, element);\r\n        this._interactions = getCuiHandlerInteractions(utils.interactions);\r\n        this.extend(clickExtension({\r\n            element: element,\r\n            performer: callbackPerformer(this.toggle.bind(this))\r\n        }));\r\n        this.extend(eventExtension(this._busFacade, {\r\n            eventName: EVENTS.TOGGLE,\r\n            performer: callbackPerformer(this.toggle.bind(this))\r\n        }))\r\n    }\r\n\r\n    async onHandle(): Promise<boolean> {\r\n        return true;\r\n    }\r\n\r\n    async onRefresh(): Promise<boolean> {\r\n        return true;\r\n    }\r\n\r\n    async onRemove(): Promise<boolean> {\r\n        this._busFacade.detachEmittedEvents();\r\n        return true;\r\n    }\r\n\r\n    toggle() {\r\n        const target = this.getTarget();\r\n        if (!target) {\r\n            this.logError(\"Target in not provided\", \"toggle\");\r\n            return;\r\n        }\r\n        const actions = CuiActionsListFactory.get(this.args.action);\r\n        this._interactions.mutate(() => {\r\n            actions.forEach(action => action.toggle(target, this.core));\r\n            this._busFacade.emit(EVENTS.TOGGLED, {\r\n                action: this.args.action,\r\n                target: target,\r\n                timestamp: Date.now()\r\n            })\r\n        })\r\n\r\n    }\r\n\r\n    getTarget(): Element | null {\r\n        if (!this.args.target) {\r\n            return this.element;\r\n        }\r\n        return document.querySelector(this.args.target) ?? this.element;\r\n    }\r\n}","import { ElementBuilder } from \"../../core/builders/element\";\r\nimport { CuiHandlerBase } from \"../../core/handlers/base\";\r\nimport { CuiHoverEvent } from \"../../core/listeners/hover\";\r\nimport { CuiBasePositionCalculator } from \"../../core/position/calculator\";\r\nimport { ICuiPositionCalculator } from \"../../core/position/interfaces\";\r\nimport { CuiTaskRunner, ICuiTask } from \"../../core/utils/task\";\r\nimport { ICuiComponent } from \"../../core/models/interfaces\";\r\nimport { CuiCore } from \"../../core/models/core\";\r\nimport { CuiActionsListFactory } from \"../../core/utils/actions\";\r\nimport { replacePrefix, is } from \"../../core/utils/functions\";\r\nimport { CuiAutoParseArgs } from \"../../core/utils/arguments\";\r\nimport { hoverExtension } from \"../extensions/hover/hover\";\r\nimport { callbackPerformer } from \"../extensions/performers\";\r\nimport { getCuiHandlerInteractions, ICuiInteractionsFacade } from \"../../core/handlers/extensions/facades\";\r\n\r\nconst TOOLTIP_ACTION = \".{prefix}-animation-tooltip-in\";\r\nconst TOOLTIP_DATA = \"{prefix}-tooltip-data\";\r\n\r\nexport class CuiTooltipArgs extends CuiAutoParseArgs {\r\n    content: string;\r\n    width: number;\r\n    pos: string;\r\n    margin: number;\r\n    action: string;\r\n    timeout: number;\r\n    constructor(prefix: string) {\r\n        super({\r\n            main: \"content\"\r\n        });\r\n        this.content = \"\";\r\n        this.width = 150;\r\n        this.margin = 8;\r\n        this.timeout = 2000;\r\n        this.pos = \"\";\r\n        this.action = replacePrefix(TOOLTIP_ACTION, prefix);\r\n    }\r\n}\r\n\r\nexport function CuiTooltipComponent(prefix?: string): ICuiComponent {\r\n    const _prefix = prefix ?? 'cui';\r\n    const _attribute = `${_prefix}-tooltip`;\r\n    return {\r\n        attribute: _attribute,\r\n        get: (element: HTMLElement, utils: CuiCore) => {\r\n            return new CuiTooltipHandler(element, _attribute, utils, _prefix)\r\n        }\r\n    }\r\n}\r\n\r\nexport class CuiTooltipHandler extends CuiHandlerBase<CuiTooltipArgs> {\r\n\r\n    private _tooltip: HTMLElement | undefined;\r\n    private _positionCalculator: ICuiPositionCalculator;\r\n    private _tooltipDataCls: string;\r\n    private _task: ICuiTask;\r\n    private _interactions: ICuiInteractionsFacade;\r\n\r\n    constructor(element: HTMLElement, attribute: string, utils: CuiCore, prefix: string) {\r\n        super(\"CuiTooltipHandler\", element, attribute, new CuiTooltipArgs(prefix), utils);\r\n        this._tooltip = undefined;\r\n        this._tooltipDataCls = replacePrefix(TOOLTIP_DATA, prefix);\r\n        this._positionCalculator = new CuiBasePositionCalculator();\r\n        this._positionCalculator.setPreferred(\"top-center\");\r\n        this._interactions = getCuiHandlerInteractions(utils.interactions);\r\n        this._task = new CuiTaskRunner(this.args.timeout, false, this.removeTooltip.bind(this));\r\n\r\n        this.extend(hoverExtension({\r\n            element: element,\r\n            performer: callbackPerformer(this.onHover.bind(this))\r\n        }))\r\n    }\r\n\r\n    async onHandle(): Promise<boolean> {\r\n        this.getDataFromArgs();\r\n        return true;\r\n    }\r\n\r\n    async onRefresh(): Promise<boolean> {\r\n        this.getDataFromArgs();\r\n\r\n        return true;\r\n    }\r\n\r\n    async onRemove(): Promise<boolean> {\r\n        this.removeTooltip();\r\n        return true;\r\n    }\r\n\r\n    private onHover(ev: CuiHoverEvent) {\r\n        if (ev.isHovering) {\r\n            this.createTooltip();\r\n        } else {\r\n            this.removeTooltip();\r\n        }\r\n    }\r\n\r\n    private createTooltip() {\r\n        if (is(this._tooltip) || !is(this.args.content)) {\r\n            return;\r\n        }\r\n        const box = this.element.getBoundingClientRect();\r\n        this._tooltip = new ElementBuilder(\"div\").setClasses(this._tooltipDataCls).build();\r\n        this._tooltip.textContent = this.args.content;\r\n        this._tooltip.style.maxWidth = `${this.args.width}px`;\r\n        document.body.appendChild(this._tooltip);\r\n        this._interactions.mutate(() => {\r\n            if (!this._tooltip) {\r\n                return;\r\n            }\r\n            const toolbox = this._tooltip.getBoundingClientRect();\r\n            this._positionCalculator.setMargin(this.args.margin);\r\n            try {\r\n                let [x, y] = this._positionCalculator.calculate(box, toolbox);\r\n                this._tooltip.style.top = `${y}px`;\r\n                this._tooltip.style.left = `${x}px`;\r\n                this.toggleActions(this._tooltip);\r\n                this._task.start();\r\n            } catch (e) {\r\n                this.logError(e.message, \"createTooltip\", e);\r\n            }\r\n\r\n        })\r\n    }\r\n\r\n    private removeTooltip() {\r\n        this._task.stop();\r\n        this._interactions.mutate(() => {\r\n            if (!is(this._tooltip)) {\r\n                return\r\n            }\r\n            //@ts-ignore already checked\r\n            this._tooltip.remove();\r\n            this._tooltip = undefined;\r\n        })\r\n    }\r\n\r\n    private getDataFromArgs() {\r\n        this._positionCalculator.setMargin(this.args.margin);\r\n        this._positionCalculator.setStatic(this.args.pos);\r\n        this._task.setTimeout(this.args.timeout);\r\n    }\r\n\r\n    private toggleActions(element: HTMLElement) {\r\n        const actions = CuiActionsListFactory.get(this.args.action);\r\n        actions.forEach(action => {\r\n            // @ts-ignore\r\n            action.toggle(element);\r\n        })\r\n    }\r\n}","import { ICuiPlugin, ICuiComponent } from \"../core/models/interfaces\";\r\nimport { is } from \"../core/utils/functions\";\r\nimport CuiInitializer, { CuiInitData } from \"./initializer\";\r\nimport { GetPlugins } from \"../plugins/module\";\r\nimport { GetComponents } from \"../components/module\";\r\n\r\nexport async function init(data: CuiInitData): Promise<boolean> {\r\n\tlet pluginList: ICuiPlugin[] = [];\r\n\ttry {\r\n\t\tpluginList = GetPlugins({\r\n\t\t\tautoLight: true,\r\n\t\t\tautoPrint: true,\r\n\t\t});\r\n\t} catch (e) {\r\n\t\tconsole.error(\"An error occured during download plugin module\", e);\r\n\t\treturn false;\r\n\t}\r\n\r\n\tlet componentList: ICuiComponent[] = [];\r\n\ttry {\r\n\t\tcomponentList = GetComponents({\r\n\t\t\tprefix: data.setup?.prefix,\r\n\t\t});\r\n\t} catch (e) {\r\n\t\tconsole.error(\"An error occured during download components module\", e);\r\n\t\treturn false;\r\n\t}\r\n\r\n\tlet appPlugins = pluginList;\r\n\tif (data.plugins) {\r\n\t\tappPlugins = { ...pluginList, ...data.plugins };\r\n\t}\r\n\tlet result = await CuiInitializer({\r\n\t\t...data,\r\n\t\tplugins: appPlugins,\r\n\r\n\t\tcomponents: is(data.components)\r\n\t\t\t? // @ts-ignore already checked\r\n\t\t\t  [...componentList, ...data.components]\r\n\t\t\t: componentList,\r\n\t});\r\n\tif (result.result) {\r\n\t\treturn true;\r\n\t}\r\n\tconsole.error(\r\n\t\t`A cUI instance failed to initialize: [${result.message ?? \"#\"}]`\r\n\t);\r\n\treturn false;\r\n}\r\n","import { ICuiPlugin } from \"../core/models/interfaces\";\r\nimport { CuiAlertsPluginFn } from \"./alert/alert\";\r\nimport { CuiWindowClickPluginFn } from \"./click/click\";\r\nimport { CuiLightFocusPluginFn, ICuiLightFocusPluginSetup } from \"./focus/focus\";\r\nimport { CuiKeysObserverPluginFn } from \"./keys/keys\";\r\nimport { CuiAutoLightModePluginFn } from \"./light/light\";\r\nimport { CuiMoveObserverPluginFn } from \"./move/move\";\r\nimport { CuiNotificationPluginFn } from \"./notification/notification\";\r\nimport { CuiAutoPrintModePluginFn } from \"./print/print\";\r\n//import { CuiCSSVariablesPlugin } from \"./properties/properties\";\r\nimport { CuiResizeObserverPluginFn } from \"./resize/resize\";\r\nimport { CuiToastPlugin } from \"./toast/toast\";\r\n\r\nexport interface CuiPluginsInit {\r\n    autoLight: boolean;\r\n    autoPrint: boolean;\r\n    notifcationTimeout?: number;\r\n    focusSetup?: ICuiLightFocusPluginSetup;\r\n}\r\n\r\nexport function GetPlugins(init: CuiPluginsInit): ICuiPlugin[] {\r\n    let light: boolean = init ? init.autoLight : true;\r\n    let print: boolean = init ? init.autoPrint : true;\r\n    return [\r\n        CuiAutoLightModePluginFn({ autoLight: light }),\r\n        CuiAutoPrintModePluginFn({ autoPrint: print }),\r\n        CuiKeysObserverPluginFn({}),\r\n        CuiWindowClickPluginFn(),\r\n        //  new CuiCSSVariablesPlugin({}),\r\n        CuiMoveObserverPluginFn(),\r\n        CuiResizeObserverPluginFn({}),\r\n        CuiToastPlugin({}),\r\n        CuiAlertsPluginFn(),\r\n        CuiNotificationPluginFn({ timeout: init.notifcationTimeout }),\r\n        CuiLightFocusPluginFn(init.focusSetup ?? {})\r\n\r\n    ]\r\n}","import { ICuiPlugin } from \"../../core/models/interfaces\";\r\nimport { CuiCore } from \"../../core/models/core\";\r\nimport { CuiPlugin } from \"../base\";\r\nimport { ICuiKeysObserver, CuiKeysObserver } from \"./observer\";\r\n\r\n\r\nexport interface CuiKeysObserverPluginSetup {\r\n    dummy?: boolean;\r\n}\r\nexport function CuiKeysObserverPluginFn(setup: CuiKeysObserverPluginSetup): ICuiPlugin {\r\n    return new CuiPlugin({\r\n        name: 'keys-plugin',\r\n        description: \"CuiKeysObserverPlugin\",\r\n        setup: setup,\r\n        callback: (utils: CuiCore, setup: CuiKeysObserverPluginSetup) => {\r\n            const observer = new CuiKeysObserver(utils.bus);\r\n            observer.connect();\r\n            return [\r\n                [],\r\n                () => { observer.disconnect(); }\r\n            ]\r\n        }\r\n    })\r\n}\r\n// export class CuiKeysObserverPlugin implements ICuiPlugin {\r\n//     description: string;\r\n//     name: string = 'keys-plugin';\r\n//     setup: CuiKeysObserverPluginSetup;\r\n//     #keysObserver: ICuiKeysObserver | undefined;\r\n//     constructor(keySetup: CuiKeysObserverPluginSetup) {\r\n//         this.description = \"CuiKeysObserverPlugin\";\r\n//         this.setup = keySetup;\r\n//         this.#keysObserver = undefined;\r\n//     }\r\n\r\n//     init(utils: CuiUtils): void {\r\n//         this.#keysObserver = new CuiKeysObserver(utils.bus);\r\n//         this.#keysObserver.connect();\r\n//     }\r\n\r\n//     destroy(): void {\r\n//         if (this.#keysObserver)\r\n//             this.#keysObserver.disconnect();\r\n//     }\r\n// }","import { GlobalClickEvent } from \"src/core/models/events\";\r\nimport { ICuiPlugin } from \"../../core/models/interfaces\";\r\nimport { CuiCore } from \"../../core/models/core\";\r\nimport { EVENTS } from \"../../core/utils/statics\";\r\nimport { CuiPlugin } from \"../base\";\r\n\r\nexport function CuiWindowClickPluginFn(): ICuiPlugin {\r\n    return new CuiPlugin({\r\n        name: 'click-plugin',\r\n        description: \"CuiWindowClickPlugin\",\r\n        setup: undefined,\r\n        callback: (utils: CuiCore) => {\r\n\r\n            function onWindowClick(ev: MouseEvent) {\r\n                utils.bus.emit<GlobalClickEvent>(EVENTS.WINDOW_CLICK, null, {\r\n                    ev: ev,\r\n                    source: \"CuiWindowClickPlugin\",\r\n                    timestamp: Date.now(),\r\n                    name: EVENTS.WINDOW_CLICK\r\n                })\r\n            }\r\n\r\n            window.addEventListener('click', onWindowClick)\r\n            return [\r\n                [],\r\n                () => {\r\n                    window.removeEventListener('click', onWindowClick);\r\n                }\r\n            ]\r\n        }\r\n    })\r\n}\r\n\r\n\r\n\r\n\r\n\r\n// export class CuiWindowClickPlugin implements ICuiPlugin {\r\n//     description: string;\r\n//     name: string = 'click-plugin';\r\n//     setup: any;\r\n//     #bus: ICuiEventBus | undefined;\r\n//     #boundClick: (ev: MouseEvent) => void;\r\n\r\n//     constructor() {\r\n//         this.description = \"CuiWindowClickPlugin\";\r\n//         this.#bus = undefined;\r\n//         this.#boundClick = this.onWindowClick.bind(this);\r\n//     }\r\n\r\n//     init(utils: CuiUtils): void {\r\n//         this.#bus = utils.bus;\r\n//         window.addEventListener('click', this.#boundClick)\r\n//     }\r\n\r\n//     destroy(): void {\r\n//         window.removeEventListener('click', this.#boundClick);\r\n//     }\r\n\r\n//     onWindowClick(ev: MouseEvent) {\r\n//         if (this.#bus)\r\n//             this.#bus.emit<GlobalClickEvent>(EVENTS.WINDOW_CLICK, null, {\r\n//                 ev: ev,\r\n//                 source: \"CuiWindowClickPlugin\",\r\n//                 timestamp: Date.now(),\r\n//                 name: EVENTS.WINDOW_CLICK\r\n//             })\r\n//     }\r\n// }","import { ICuiPlugin } from \"../../core/models/interfaces\";\r\nimport { CuiCore } from \"../../core/models/core\";\r\nimport { CuiPlugin } from \"../base\";\r\nimport { CuiMoveObserver } from \"./observer\";\r\n\r\nexport function CuiMoveObserverPluginFn(gestures?: boolean): ICuiPlugin {\r\n    return new CuiPlugin({\r\n        name: 'move-observer-plugin',\r\n        description: \"CuiMoveObserverPlugin\",\r\n        setup: gestures === true,\r\n        callback: (utils: CuiCore, gestures: boolean) => {\r\n            const observer = new CuiMoveObserver(utils.bus, gestures);\r\n            observer.attach();\r\n            return [\r\n                [],\r\n                () => {\r\n                    if (observer.isAttached()) {\r\n                        observer.detach();\r\n                    }\r\n                }\r\n            ]\r\n        }\r\n    })\r\n}","import { ICuiComponent } from \"../core/models/interfaces\";\r\nimport { CuiAccordionComponent } from \"./accordion/accordion\";\r\nimport { CuiBannerComponent } from \"./banner/banner\";\r\nimport { CuiCircleComponent } from \"./circle/circle\";\r\nimport { CuiCloseComponent } from \"./close/close\";\r\nimport { CuiCoverComponent } from \"./cover/cover\";\r\nimport { CuiDialogComponent } from \"./dialog/dialog\";\r\nimport { CuiDropComponent } from \"./drop/drop\";\r\nimport { CuiFloatComponent } from \"./float/float\";\r\nimport { CuiIconComponent } from \"./icon/icon\";\r\n//import { CuiIntersectionComponent } from \"./intersection/intersection\";\r\nimport { CuiOffCanvasComponent } from \"./offcanvas/offcanvas\";\r\nimport { CuiOffsetComponent } from \"./offset/offset\";\r\nimport { CuiOpenComponent } from \"./open/open\";\r\nimport { CuiParallaxComponent } from \"./parallax/parallax\";\r\nimport { CuiResizeComponent } from \"./resize/resize\";\r\nimport { CuiScrollComponent } from \"./scroll/scroll\";\r\nimport { CuiScrollSwitchComponent } from \"./scroll/switch\";\r\nimport { CuiScrollspyComponent } from \"./scrollspy/scrollspy\";\r\nimport { CuiSortableComponent } from \"./sortable/sortable\";\r\nimport { CuiSpinnerComponent } from \"./spinner/spinner\";\r\nimport { CuiSliderComponent } from \"./switch/slider\";\r\nimport { CuiSwitchComponent } from \"./switch/switch\";\r\nimport { CuiSwitcherComponent } from \"./switch/switcher\";\r\nimport { CuiToggleComponent } from \"./toggle/toggle\";\r\nimport { CuiTooltipComponent } from \"./tooltip/tooltip\";\r\n\r\nexport interface ComponentsModuleAttributes {\r\n    prefix?: string;\r\n}\r\n\r\n\r\n/**\r\n * Function that initializes and returns all components available in package\r\n * @param attributes - object holding data needed for components initialization\r\n */\r\nexport function GetComponents(attributes: ComponentsModuleAttributes): ICuiComponent[] {\r\n    let prefix = attributes?.prefix;\r\n    return [\r\n        CuiIconComponent(prefix),\r\n        CuiTooltipComponent(prefix),\r\n        CuiCircleComponent(prefix),\r\n        CuiSpinnerComponent(prefix),\r\n        CuiScrollComponent(prefix),\r\n        CuiScrollspyComponent(prefix),\r\n        CuiOpenComponent(prefix),\r\n        CuiCloseComponent(prefix),\r\n        CuiToggleComponent(prefix),\r\n        CuiDialogComponent(prefix),\r\n        CuiOffCanvasComponent(prefix),\r\n        CuiAccordionComponent(prefix),\r\n        CuiDropComponent(prefix),\r\n        CuiOffsetComponent(prefix),\r\n        CuiSwitchComponent(prefix),\r\n        CuiSwitcherComponent(prefix),\r\n        CuiFloatComponent(prefix),\r\n        CuiSliderComponent(prefix),\r\n        CuiBannerComponent(prefix),\r\n        CuiCoverComponent(prefix),\r\n        CuiSortableComponent(prefix),\r\n        CuiResizeComponent(prefix),\r\n        CuiParallaxComponent(prefix),\r\n        CuiScrollSwitchComponent(prefix)\r\n    ]\r\n}","export const CUI_LIGHT_VERSION = \"0.5.0\";\r\nexport { init } from \"./app/init\";\r\nexport { ElementManager } from \"./app/managers/element\";\r\n"],"sourceRoot":""}